<!-- $Id: troubleshoot.sgml,v 1.3 1998-07-20 22:31:11 kuriyama Exp $ -->
<!-- The FreeBSD Japanese Documentation Project -->
<!-- Original revision: 1.5 --> 

  <sect>
    <heading>トラブルシューティング<label id="troubleshoot"></heading>
    <p><em>訳: &a.yoshiaki;.<newline>10 November 1997.</em>

    <sect1>
      <heading>ハードディスクに不良ブロックがあります!<label id="awre"></heading>

      <p>SCSI ディスクの場合は自動的に再マップする機能があるはずです. 
      しかし, 理解し難い理由から多くのドライブがこの機能が無効化
      されて出荷されています...

      <p>これを有効化するには, 最初のデバイスのモードページを変更する
      必要があります. これは次のコマンドを実行することで, FreeBSD 
      上でおこなうことができます (root 権限でおこないます).

      <verb>
        scsi -f /dev/rsd0c -m 1 -e -P 3
      </verb>

      <p>そして, AWRE と ARRE の値を 0 から 1 へ変更します:-

      <verb>
        AWRE (Auto Write Reallocation Enbld):  1
        ARRE (Auto Read Reallocation Enbld):  1
      </verb>

      <p>他の種類のディスクでは, オペレーティングシステムからサポート
      されているかによります. 残念ながら, この目的のために FreeBSD 
      が提供する ``bad144'' コマンドはかなり手を入れる必要があります...

      <p>IDE ディスクは, おそらく不良ブロックの再マップを内蔵していると
      思います; ディスクの説明書がある場合は, この機能が無効になって
      いるかを確認するとよいでしょう. しかし, ESDI, RLL, ST-506 
      ディスクは, 通常これをおこないません. 

      <p>再マップが可能になっていてで不良ブロックを見つけたのであれば,
      ドライブを交換することを考えましょう. 不良ブロックの状態は時間と
      ともに悪い方向にしか行きません.
 
    <sect1>
      <heading>Bustek 742a EISA SCSI が認識されません.</heading>

      <p>この情報は 742a のためのものですが, 他の Buslogic カードについても
      同様のことが言えます. (Bustek = Buslogic)

      <p>742a カードには大きくわけて 2つのバージョンが存在します. 
      ハードウェアリビジョンの A-G と H 以降です. リビジョンの
      文字はカードの隅にあるアセンブリ番号の後ろにあります. 
      742a は二つの ROM チップを持っており, 一つは BIOS チップで
      もう一つはファームウェアチップです. FreeBSD はあなたの
      持っているものがどの BIOS バージョンかは問題ありませんが, 
      ファームウェアバージョンについては問題となります.
      Buslogic の技術サポート部門に連絡すれば, アップグレード版の
      ROM を送ってくれることでしょう. BIOS チップと
      ファームウェアチップはペアで出荷されます. 
      アダプタカードのハードウェアリビジョンにあわせた
      最も新しいファームウェア ROM を使用しなければなりません.

      <p>リビジョン A-G のカードには, 2.41/2.21 までの
      BIOS/ファームウェアのセットを使用することができます.
      リビジョン H 以降のカードには, 最新のものである
      4.70/3.37 の BIOS/ファームウェアのセットを
      使用することができます. これらのファームウェアの違いは,
      ファームウェア 3.37 が 「ラウンドロビン方式」
      をサポートしているところからきています.

      <p>Buslogic のカードには, 製造番号も刻印されています. 古い
      ハードウェアリビジョンのカードを持っている場合は, Buslogic の RMA
      部門に問い合わせて製造番号を伝えると, 新しいハードウェアリビジョンの
      カードに交換することもできます. もしカードが十分新しければ, 彼らは
      交換に応じてくれるでしょう.

      <p>FreeBSD 2.1 は ファームウェアリビジョン 2.21
      以降のものをサポートしています.
      これよりも古いファームウェアリビジョンのものは,
      Buslogic カードとして正常に認識されません.
      しかし, Adaptec 1540 として認識されるかもしれません. 
      初期の Buslogic のファームウェアは AHA1540 互換モードを
      持っています. しかし, EISA カードにとってこれは
      よいことではありません.

      <p>古いハードウェアリビジョンのカードを持っていてファームウェア
      2.21 を入手するのであれば, ジャンパ W1 の位置をデフォルトの
      A-B から B-C に合わせる必要があるでしょう.

      <p>742a EISA カードには, <ref id="bigram" name="16 MB 
      を越える容量のメモリを載せたマシン">の節で説明している
      「16 MB を越える」ことによる問題はありません. 
      これは Vesa-Local Buslogic SCSI カードで発生する問題です.

    <sect1>
      <heading>
        HP Netserver 上のオンボード SCSI コントローラが認識されません.
      </heading>
        
      <p>基本的にこれは既知の問題です. HP Netserver マシンの
      EISA オンボード SCSI コントローラは EISA のスロット番号 11
      を占有しますが, 「本当の」EISA スロットはすべてそれよりも
      前のアドレスに配置されているのです. 残念ながら,
      10 番以上の EISA スロットは PCI に割り当てられたアドレス空間
      と衝突し, FreeBSD 
      の自動コンフィグレーションは, 現状ではうまくこの状況を
      処理できていないのです.

      <p>ですから現時点での最良の方法は, カーネルオプションの
      <tt/EISA_SLOTS/ を 12 に変え, アドレス空間の衝突がないかの
      ようなふりをさせることです :)
      <url url="../handbook/kernelconfig.html"
      name="ハンドブックのカーネルの構築">
      に記述されているようにしてカーネルをコンパイルし,
      構築してください.

      <p>もちろん, これはこのようなマシンにインストールする際に
       卵が先か鶏が先か」といった問題を生み出すことになります. 
      この問題を回避するために, <em>ユーザコンフィグ
      (UserConfig)</em> の中には特別な仕組みが組み込まれています.
      このとき ``visual'' インタフェースは使用せず,
      コマンドラインインタフェースを使用してください. 単純に

      <verb>
        eisa 12
        quit
      </verb>

      <p>とプロンプト上から打ち込み, 
      後は普通にインストールをおこなってください.
      とにかくカスタムカーネルのコンパイルとインストールをおこなうことを
      おすすめしますが, 

      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?dset" name="dset">
      も現時点ではこの値の変更を認識するようになっています. 

      <p>うまくいけば, 将来のバージョンではこの問題が解決していることでしょう.

      <p><tt/注:/ HP Netserver では<bf/危険覚悟の専用ディスク/は
      使用できません. 詳細については <ref id="dedicate" name="この注意事項">
      をご覧ください.

    <sect1>
      <heading>この CMD640 IDE コントローラはどこかおかしいようです.</heading>

      <p>それは壊れているのです. 両方のチャンネルを同時に制御できないのです. 

      <p>現在ではこのチップを使っているシステムでは自動的に検出して
      うまく動かすためのしくみが使えるようになっています. くわしくは
      マニュアルページのディスクドライバ (man 4 wd) を参照してください.

      <p>CMD640 IDE コントローラを使っているシステムで FreeBSD 2.2.1 
      あるいは 2.2.2 を使っている場合でセカンダリのチャネルを
      使いたいのであれば <tt/options "CMD640"/ を有効にしてカーネルを
      作り直してください. 
      これは 2.2.5 以降ではデフォルトになります.

    <sect1>
      <heading>``<tt/ed1: timeout/'' のようなメッセージがいつも出ます. </heading>

      <p>たぶん IRQ の衝突が原因でしょう (二つのボードが同じ IRQ 
      を使用しているなど). FreeBSD 2.0.5R 以前では, これに関しては
      寛大で IRQ の衝突があってもネットワークドライバは機能して
      いました. しかし 2.0.5R 以降は IRQ の衝突はもはや寛大では
      ありません. -c オプションをつけてブートして ed0/de0/... の
      エントリをボードの設定に合わせてください. 

      <p>ネットワークカードの BNC コネクタ (訳注: 10BASE-2 タイプ
      のインターフェース) を使っている場合, デバイスのタイムアウト
      はターミネーションの不良によっても起きます. 
      これをチェックするにはケーブルを外してターミネータを直接 NIC
      に接続します. そしてエラーメッセージが消えるかどうか
      確認します.

      <p>NE2000 コンパチブルカードのなかには UTP ポートのリンクが
      なかったりケーブルが接続されていない場合にこのエラーを出す
      ものがあります.

    <sect1>
      <heading>CDROM をマウントしようとすると ``Incorrect super block'' と言われます. </heading>

      <p><htmlurl url="http://www.freebsd.org/cgi/man.cgi?mount"
      name="mount"> にマウントしたいデバイスのタイプを指定する必要
      があります. デフォルトでは
      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?mount"
      name="mount"> はファイルシステムを 
      ``<tt/ufs/'' とみなします. CDROM のファイルシステムを
      マウントしたいのであれば ``<tt/-t cd9660/'' と 
      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?mount"
      name="mount"> オプションをつけて明示する必要があります. 
      これはもちろん 
      CDROM が ISO 9660 ファイルシステムである場合です. ほとんどの 
      CDROM はこの形式です. 1.1R の FreeBSD では (訳注: 現行の 2.1.5R, 
      2.2R でも同様です) 自動的に Rock Ridge 拡張 
      (長いファイル名への対応) をうまく解釈します. 

      <p>CDROM のデバイス ``<tt>/dev/cd0c</tt>'' を
      <tt>/mnt</tt> にマウントしたい場合の例では, 次のようにします:

      <verb>
        mount -t cd9660 /dev/cd0c /mnt
      </verb>

      <p>デバイスの名前はインタフェースによっては別の名前になっている
      かもしれないので注意してください (``<tt>/dev/cd0c</tt>'' は
      この場合の例です).
      オプション ``<tt/-t cd9660/'' によって 
      ``<tt/mount&lowbar;cd9660/'' コマンドが実行されることに注意
      してください. このため例は次のようにすることもできます:

      <verb>
        mount_cd9660 /dev/cd0c /mnt
      </verb>

    <sect1>
      <heading>CDROM をマウントしようとすると ``Device not configured'' と言われます. </heading>

      <p>これは 一般的に CDROM ドライブの中に CDROM が入っていないか, 
      ドライブがバス上に見えないことを意味します. ドライブに CDROM 
      を入れるか, IDE (ATAPI) であれば master/slave の状態をチェック
      してください. CDROM ドライブに CDROM を入れてから認識するまで
      数秒かかりますので少し待ってみてください. 

      <p>SCSI CDROM ではバスリセットへの応答時間が遅いために失敗する
      ことがあるかもしれません. SCSI CDROM を持っている場合は
      カーネルコンフィグレーションファイルに以下の行を加えて
      再コンパイルして試してみてください. 

      <verb>
        options "SCSI_DELAY=15"
      </verb>

      <p>(訳注: 現在の GENERIC カーネルでは上の設定はデフォルトに
      なっています. 問題のある場合は SCSI_DELAY の数値を増やして
      みてください.)

    <sect1>
      <heading>私のプリンタはとてつもなく遅いのです. どうしたらよいのでしょう?</heading>

      <p>パラレルインタフェースで, 問題はとんでもなく遅いだけであるなら, 
      プリンタボートを ``polled'' モードに設定してみてください:

      <verb>
        lptcontrol -p
      </verb>

      <p>HP の新しいプリンタのいくつかは割り込みモードでは
      使えないようです. (完全にわかったわけではありませんが) 
      タイミングの問題のように思われます. 

    <sect1>
      <heading>私のプログラムは時々 ``Signal 11'' のエラーで止まってしまいます. </heading>

      <p>これはハードウェア (メモリ, マザーボードなど) の不具合いが
      原因です. PC でメモリテストプログラムを動かしてみてください. 
      ただしメモリが正常に動作していると報告されたとしても, ぎりぎりで
      メモリテストにパスしたメモリは, 処理の内容 (例えば 
      kernel のコンパイルや特にシステムの負荷が高いような場合には, 
      Adaptec 1542 などの SCSI コントローラのバスマスタ DMA など)
      によっては問題が起きる可能性は大いにあります. 

      <p>SIG11 FAQ (後で URLを示します) では遅いメモリが一般的に問題
      を起こしがちであることを指摘しています. BIOS セットアップで
      ウエイトステート数を増やすかメモリを速いものに交換してください. 
  
      <p>私の場合はキャッシュ RAM やオンボードキャッシュコントローラ
      の問題でした. このような問題ではないか確認するために BIOS
      セットアップでオンボード (セカンダリ) キャッシュを無効にして
      みてください. 

      <p>以下のところには広い範囲の FAQ があります. 
      <url url="http://www.bitwizard.nl/sig11/" name="the SIG11 problem FAQ">

    <sect1>
      <heading>ブートの時に画面が真っ暗になって同期も取れません. </heading>

      <p>これは ATI Mach 64 ビデオカードの既知の問題です. 
      この問題はカードがアドレス<tt/2e8/を使い, 4番目のシリアルポート 
      もここを使うということにあります.
      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?sio" name="sio.c">
      ドライバのバグ 
      (仕様?) のため4番目のシリアルポートがなくても, 通常この
      アドレスを使う sio3 (4 番目のポートにあたります) を無効にしても, 
      ドライバはこのアドレスをさわります. 

      <p>バグが修正されるまでは, 次のようにして対処してください. 

      <enum>
        <item> ブートプロンプトが出たら <tt/-c/ と入力します
        (これによりカーネルはコンフィグレーションモードに入ります).
             
        <item> <tt/sio0/, <tt/sio1/, <tt/sio2/ ,<tt/sio3/
        (これらすべて) を無効にします. これによって sio ドライバは
        動作しなくなります
         -> 問題はありません. 

        <item> exit とタイプしてブートを続行します. 
      </enum>

      <p>もしシリアルポートを有効にしたいのであれば以下の変更をおこなって
      新しいカーネルを作る必要があります. 
      <tt>/usr/src/sys/i386/isa/sio.c</tt> の中で1ヵ所ある 
      <tt/0x2e8/ という文字列を探し, この文字列とその手前にある
      コンマを削除します (後ろのコンマは残します). 後は通常の手続き
      にしたがって新しいカーネルを作ります. 

      <p>この対処をおこなった後でもまだ X ウィンドウシステムはうまく
      動かないかもしれません. いくつかの新しい ATI Mach 64 ビデオカード 
      (特に ATI Mach Xpression) は現在のバージョンの 
      <tt/XFree86/ では動きません. X を起動するとスクリーンが真っ暗
      になったり, 奇妙な動き方をしたりします. より新しい X サーバ
      はもっとうまく動きます. 
      <url url="http://www.xfree86.org" name="the XFree86 site"> 
      を見てベータリリースへのリンクを追ってください. 
      以下のファイルを持ってきましょう. 

      <p><tt>AccelCards, BetaReport, Cards, Devices, FILES, README.ati,
      README.FreeBSD, README.Mach64, RELNOTES, VGADriver.Doc,
      X312BMa64.tgz</tt>

      <p>古いファイルをこの新しいバージョンのファイルに置き換え, 
      <htmlurl
      url="http://www.freebsd.org/cgi/man.cgi?manpath=xfree86&amp;query=xf86config"
      name="xf86config"> をもう一度実行します. 
          
    <sect1>
      <heading>
        128MB の RAM があるのですが, 64MB しか認識しません. <label id="reallybigram">
      </heading>

      <p>FreeBSD がメモリのサイズを BIOS から取得する方法の制限により,
      KB 単位で 16 ビット分までしか検出できません
      (すなわち最大 65535Kb=64MB です)(これより少ない場合もあります. ある BIOS
      の場合はメモリサイズが 16MB に制限されます). 
      64MB 以上のメモリを積んでいる場合, FreeBSD はそれを検出しようとし
      ます. しかしその試みは失敗するかもしれません.

      <p>この問題を回避するには, 以下に示すカーネルオプションを
      使用する必要があります. 完全なメモリ情報を BIOS から取得する
      方法もありますが, ブートブロックに空きが無いため実装できません.
      ブートブロックの問題が解決されれば, いつか拡張 BIOS
      機能を使用して完全なメモリ情報を取得できるようになるでしょう.
      とりあえず現在は, カーネルオプションを使ってください. 

      <tt>
        options "MAXMEM=&lt;n>"
      </tt>

      <p><tt/n/ には, キロバイト単位でメモリの量を指定します. 128MB 
      の場合は, <tt/131072/ となります. 

    <sect1>
      <heading>FreeBSD 2.0 が ``kmem_map too small!'' と言ってパニックします. </heading>

      <p><tt /注:/ メッセージは, ``mb_map too small!'' の場合もあります. 

      <p>このパニックは, ネットワークバッファ (特に mbuf クラスタ) 
      の仮想メモリが無くなったことを示します. 以下のオプションを
      カーネルコンフィグファイルに追加して mbuf クラスタに使用できる
      仮想メモリの量を増やしてください.

      <p><tt>options "NMBCLUSTERS=&lt;n>"</tt>

      <p>&lt;n&gt には, 同時に使用したい TCP コネクションの数に応じて 
      512 から 4096 までの数値を指定できます. とりあえず 2048 を
      試してみるのを勧めます. これでパニックは完全の予防できるはずです. 
      mbuf クラスタの割り当て／使用状況については,
      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?netstat"
      name="netstat -m"> で知ることができます. 
      name="netstat -m"> で知ることができます. NMBCLUSTERS の
      デフォルト値は 
      <tt/512 + MAXUSERS * 16/ です.
 
    <sect1>
      <heading>新しいカーネルでリブートすると ``CMAP busy panic'' となってパニックを起こしてしまいます. </heading>

      <p>ファイル <tt>/var/db/kvm_*.db</tt> において範囲外のデータを
      検出するためのロジックは失敗することがあり, こうした矛盾のある
      ファイルを使用することでパニックを引き起こすことがあります. 

      <p>これが起こったなら, シングルユーザでリブートした後に, 
      以下のコマンドを実行してください. 

      <verb>
        rm /var/db/kvm_*.db
      </verb>

    <sect1>
      <heading>ahc0: brkadrint,  Illegal Host Access at seqaddr 0x0 というエラーが出ます</heading>

      <p>これは Ultrastor SCSI Host Adapter と衝突しています. 

      <p>ブート時に kernel configuration メニューに入り, 問題を起こしている
      <htmlurl url="http://www.freebsd.org/cgi/man.cgi?uha(4)"
      name="uha0"> を disable にしましょう. 

    <sect1>
      <heading>sendmailが ``mail loops back to myself'' というメッセージを出すのですが. </heading>

      <p>この事は, sendmail FAQ に次のように書いてあります. 

      <verb>
        * "Local configuration error" というメッセージが出ます. 例えば:

        553 relay.domain.net config error: mail loops back to myself
        554 <user@domain.net>... Local configuration error

        のような物ですが, どのようにしたらこの問題を解決できますか?

        これは, 例えば domain.net のようなドメイン宛てのメールを 
        MX record で特定のホスト (ここでは relay.domain.net) に送ろう
        としたのに, そのホストでは domain.net 宛てのメールを受け取れる
        ような設定になっていない場合です. 設定の際に 
        FEATURE(use_cw_file) を指定してある場合には/etc/sendmail.cw 
        の中に domain.net を追加してください. もしくは, /etc/sendmail.cf 
        の中に "Cw domain.net" を追加してください.
      </verb>

      <p>もはや現在の <url
      url="ftp://rtfm.mit.edu/pub/usenet/news.answers/mail/sendmail-faq"
      name="sendmail FAQ"> は sendmail release とは一緒には保守されて
      いません. しかし次のネットニュースに定期的に投稿されてます. 
      <url url="news:comp.mail.sendmail" name="comp.mail.sendmail">,
      <url url="news:comp.mail.misc" name="comp.mail.misc">,
      <url url="news:comp.mail.smail" name="comp.mail.smail">,
      <url url="news:comp.answers" name="comp.answers">,
      <url url="news:news.answers" name="news.answers">.
      また, メール経由でコピーを入手する場合は 
      <url url="mailto:mail-server@rtfm.mit.edu"
      name="mail-server@rtfm.mit.edu"> 宛まで本文に "send
      usenet/news.answers/mail/sendmail-faq" と書いて送ります. 

    <sect1>
      <heading>リモートマシン上のフルスクリーンアプリケーションがうまく動かない
      </heading>
      <p>リモートマシンのターミナルタイプが FreeBSD のコンソールで
      つかわれている <tt>cons25</tt> 以外のものです.
      <p>この問題を解決する方法はいろいろあります:
	<itemize>
	<item>リモートマシンに login した後, shell 変数の TERM に
	<tt>ansi</tt> か <tt>sco</tt> のいずれかを設定します.
	<item>ローカル側で <htmlurl
	url="http://www.freebsd.org/cgi/ports.cgi?screen-" 
	 name="screen"> のような VT100 エミュレータを使用します.
	 <tt>screen</tt> は一つのターミナルの中で複数のセッションを
	 並列動作させることができますし, 本来の機能も優れています.
	<item>リモートマシンのターミナルデータベースに <tt>cons25</tt>
	 のエントリをインストールします.
	<item>Xを起動してリモートマシンに <tt>xterm</tt> から login
	します. (訳注: 日本語が必要な場合は <tt>kterm</tt> 等を
	利用します)
	</itemize>
  </sect>

