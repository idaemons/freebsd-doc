<!--
     The FreeBSD Documentation Project
     The FreeBSD Japanese Documentation Project

     Original revision: 1.78
     $FreeBSD$
-->

<chapter id="multimedia">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Ross</firstname>
	<surname>Lippert</surname>
	<contrib>編集: </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>マルチメディア</title>
  <sect1 id="multimedia-synopsis">
    <title>この章では</title>

    <para>FreeBSD は数多くの種類のサウンドカードに対応しており、
      コンピュータで原音に忠実な出力を楽しむことができます。
      これには録音機能と、MPEG Layer 3 Audio (MP3) や WAV, Ogg Vorbis
      などをはじめとした多くの形式の音楽の再生機能が含まれます。
      加えて FreeBSD の Ports Collection には、録音した音楽を
      編集したり、音響効果を加えたり、接続された
      MIDI 機器を制御するためのアプリケーションがあります。</para>

    <para>意欲的な試みによって、FreeBSD ではビデオファイルおよび DVD の
      再生ができるようになりました。さまざまなビデオメディアをエンコード、
      変換、再生するアプリケーションの数は、
      音声用のアプリケーションほど充実していません。
      この文書を執筆している時点では、たとえば
      <filename role="package">audio/sox</filename>
      のようなファイル形式を変換するためのすぐれたアプリケーションは
      Ports Collection にありません。しかしながら、
      この分野のソフトウェアの状況は急速に変わりつつあります。</para>

    <para>この章ではサウンドカードを設定するために必要な方法を説明します
      (ただし、高音質で再生するためには若干の微調整が必要かもしれません)。
      ビデオカードのハードウェアに関する問題は、
      <application>&xfree86;</application> (<xref linkend="x11">)
      のインストールと設定においてすでに扱いましたので、
      そちらをご覧ください。</para>

    <para>この章を読むと、以下のことがわかります。</para>

    <itemizedlist>
      <listitem>
        <para>サウンドカードを認識させるためにシステムを設定する方法</para>
      </listitem>

      <listitem>
        <para>サンプルアプリケーションを利用して、サウンドカードが
          うまく動作しているかどうかテストする方法</para>
      </listitem>

      <listitem>
        <para>サウンドの設定に関するトラブルシューティング</para>
      </listitem>

      <listitem>
        <para>MP3 およびその他の形式の音声を再生、エンコードする方法</para>
      </listitem>

      <listitem>
        <para><application>&xfree86;</application> 環境で
	  どのようにビデオに対応しているか</para>
      </listitem>

      <listitem>
        <para>ビデオを再生、エンコードするのに役に立つ ports</para>
      </listitem>

      <listitem>
        <para>DVD の <filename>.mpg</filename> ファイルおよび
          <filename>.avi</filename> ファイルを再生する方法</para>
      </listitem>

      <listitem>
        <para>CD および DVD の情報を抽出する方法</para>
      </listitem>

      <listitem>
	<para>TV カードの設定方法</para>
      </listitem>
    </itemizedlist>

    <para>この章を読む前に、以下のことを理解しておく必要があります。</para>

    <itemizedlist>
      <listitem><para>新しいカーネルを設定してインストールする方法
	  (<xref linkend="kernelconfig">)</para></listitem>
    </itemizedlist>

    <para>ビデオに関する節では <application>&xfree86; 4.X</application>
      (<filename role='package'>x11/XFree86-4</filename>)
      がインストールされているものとします。
      <application>&xfree86; 3.X</application> でも動作するかもしれませんが、
      この章で説明している方法ではテストされていません。
      もし <application>&xfree86; 3.X</application> において
      ここで説明している方法で動かないことを見付けたら、
      私たちに知らせてください。</para>

    <warning>
      <para>オーディオ CD を &man.mount.8;
        でマウントしようとすると、少なくともエラーになります。
        最悪の場合、<emphasis>カーネルパニック</emphasis>が発生するでしょう。
        これらのメディアは通常の ISO ファイルシステムとは異なり、
        特別なエンコードが施されているからです。</para>
    </warning>
  </sect1>

  <sect1 id="sound-setup">
    <sect1info>
      <authorgroup>
        <author>
	  <firstname>Moses</firstname>
	  <surname>Moore</surname>
	  <contrib>寄稿: </contrib>
	  <!-- 20 November 2000 -->
        </author>
      </authorgroup>
    </sect1info>

    <title>サウンドカードの設定</title>
    <sect2 id="sound-device">
      <title>デバイスを正しく設置する</title>

      <indexterm><primary>PCI</primary></indexterm>
      <indexterm><primary>ISA</primary></indexterm>
      <indexterm><primary>サウンドカード</primary></indexterm>

      <para>設定をはじめる前に、あなたが持っているカードのモデル、
	そのカードが使用しているチップ、そして PCI, ISA
	どちらのカードなのかを確認する必要があります。
	FreeBSD は PCI および ISA の両方のカードに幅広く対応しています。
	次のリストは完全ではありませんが、
	良く使われているカードがだいたい含まれています。
	もし、お使いのカードがこのリストにない場合は、
	&man.pcm.4; のマニュアルを確認してください。</para>

      <itemizedlist>
	<listitem>
	  <para>Crystal 4237, 4236, 4232, 4231</para>
	</listitem>

	<listitem>
	  <para>Yamaha OPL-SAx</para>
	</listitem>

	<listitem>
	  <para>OPTi931</para>
	</listitem>

	<listitem>
	  <para>Ensoniq AudioPCI 1370/1371</para>
	</listitem>

	<listitem>
	  <para>ESS Solo-1/1E</para>
	</listitem>

	<listitem>
	  <para>NeoMagic 256AV/ZX</para>
	</listitem>

	<listitem>
	  <para>&soundblaster; Pro, 16, 32, AWE64, AWE128, Live</para>
	</listitem>

	<listitem>
	  <para>Creative ViBRA16</para>
	</listitem>

	<listitem>
	  <para>Advanced Asound 100, 110 および Logic ALS120</para>
	</listitem>

	<listitem>
	  <para>ES 1868, 1869, 1879, 1888</para>
	</listitem>

	<listitem>
	  <para>Gravis UltraSound</para>
	</listitem>

	<listitem>
	  <para>Aureal Vortex 1 および 2</para>
	</listitem>
      </itemizedlist>

      <indexterm>
	<primary>カーネル</primary>
	<secondary>設定</secondary>
      </indexterm>

      <para>サウンドデバイスを使うために、
	適切なデバイスドライバを読み込まなければいけません。
	これには二つの方法のどちらかでできるでしょう。
	もっとも簡単な方法は &man.kldload.8;
	を使ってサウンドカードのカーネルモジュールを単に読み込むことです。
	次のコマンドで実現できます。</para>

      <screen>&prompt.root; <userinput>kldload snd_emu10k1.ko</userinput></screen>
      <para>または <filename>/boot/loader.conf</filename>
	ファイルにこのような適切な行を加えて実現することもできます。</para>

      <programlisting>snd_emu10k1_load="YES"</programlisting>

      <para>以上は Creative &soundblaster; Live! サウンドカードの例です。
	他に利用可能な読み込み可能なサウンドモジュールは
	<filename>/boot/defaults/loader.conf</filename>
	に記載されています。</para>

      <para>もう一つの方法は、
	サウンドカードのドライバをカーネルへ静的に組み込むことです。
	以下の節では、この方法でハードウェアを対応させる方法を説明します。
	カーネル再構築の詳細は
	<xref linkend="kernelconfig"> を参照してください。</para>

      <sect3>
	<title>Creative, Advance および ESS 社製サウンドカード</title>

	<para>これらのカードを使用する場合は、
	  カーネルコンフィグレーションファイル
	  に以下の設定を追加する必要があります。</para>

	<programlisting>device pcm</programlisting>

	<para>PnP 対応の ISA カードを使用する場合は、
	  さらに以下を追加する必要があるでしょう。</para>

	<programlisting>device sbc</programlisting>

	<para>PnP 非対応の ISA のカードを使用する場合は以下を加えます。</para>

	<programlisting>device pcm
device sbc0 at isa? port 0x220 irq 5 drq 1 flags 0x15</programlisting>

	<para>これらは標準の設定にあわせたものです。
	  IRQ や他の設定はカードに合わせて変更する必要があるかもしれません。
	  詳細は &man.sbc.4; のマニュアルを参照してください。</para>

	<note>
	  <para>FreeBSD&nbsp;4.0 は、パッチを適用しない限り、
	    Sound Blaster Live には対応していません
	    (また、この節ではその方法について扱いません)。
	    このカードを使用しようとする前に、最新の -STABLE
	    に更新することをおすすめします。</para>
	</note>
      </sect3>

      <sect3>
	<title>Gravis 社製 UltraSound カード</title>

	<para>PnP 対応 ISA カードを使用するには、
	  カーネルコンフィグレーションファイル
	  に次の設定を追加する必要があるでしょう。</para>

	<programlisting>device pcm
device gusc</programlisting>

	<para>PnP 非対応の
	  ISA カードの場合には次の設定を追加する必要があるでしょう。</para>

	<programlisting>device pcm
device gus0 at isa? port 0x220 irq 5 drq 1 flags 0x13</programlisting>

	<para>IRQ や他の設定はカードに合わせて変更する必要があるかもしれません。
	  詳細は &man.gusc.4; のマニュアルを参照してください。</para>
      </sect3>

      <sect3>
	<title>Crystal 社製サウンドカード</title>

	<para>Crystal 社製のカードを使用する場合は、
	  カーネルコンフィグレーションファイル
	  に以下の設定が必要となるでしょう。</para>

	<programlisting>device pcm
device csa</programlisting>
      </sect3>

      <sect3>
	<title>一般的なカードのサポート</title>

	<para>PnP 対応の ISA カードまたは PCI カードを使用する場合は、
	  カーネルコンフィグレーションファイル
	  に以下の設定が必要となるでしょう。</para>

	<programlisting>device pcm</programlisting>

	<para>ブリッジドライバを持たない、PnP 非対応の ISA
	  カードの場合は次の設定が必要となるでしょう。</para>

	<programlisting>device pcm0 at isa? irq 10 drq 1 flags 0x0</programlisting>

	<para>IRQ や他の設定はカードに合わせて変更する必要があるかもしれません。</para>
      </sect3>

      <sect3>
	<title>オンボードサウンド</title>

	<para>マザーボードに搭載されたサウンドデバイスを利用するシステムでは、
	  以下の設定が必要になるかもしれません。</para>

	<programlisting>options PNPBIOS</programlisting>
      </sect3>
    </sect2>

    <sect2 id="sound-devicenodes">
      <title>デバイスノードの作成とテスト</title>

      <indexterm><primary>デバイスノード</primary></indexterm>
      <para>再起動した後、ログインして次のように
	<filename>/var/run/dmesg.boot</filename>
	にデバイスがあるか確かめます。</para>

      <screen>&prompt.root; <userinput>grep pcm /var/run/dmesg.boot</userinput>
pcm0: &lt;SB16 DSP 4.11&gt; on sbc0</screen>

      <para>あなたのシステムでは、これとは異なる出力になるかもしれません。
	<devicename>pcm</devicename> デバイスがなければ、
	今までの手順のどこかが間違っています。
	カーネルコンフィグレーションファイルをもう一度見直して、
	正しいデバイスを選択しているかどうか確認してください。
	トラブルシューティングは <xref linkend="troubleshooting">
	を参照してください。</para>

      <note>
	<para>FreeBSD&nbsp;5.0 以降を使用しているなら、
	  この節の残りの部分は読み飛ばすことができます。
	  これらのバージョンでは、デバイスノードを自動的に作成するために
	  &man.devfs.5; を使用します。</para>
      </note>

      <para>前述したコマンドで
	<devicename>pcm0</devicename> が表示されたなら、
	<username>root</username> 権限で次を実行しなければなりません。</para>

      <screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV snd0</userinput></screen>

      <para>もし <devicename>pcm1</devicename> が表示されたのなら
	<devicename>snd0</devicename> を
	<devicename>snd1</devicename>
	に置き換えて、上と同様に実行してください。</para>

      <note>
	<para>上記のコマンドは、実際は
	  <devicename>/dev/snd</devicename>
	  デバイスを作成するものでは<emphasis>ありません</emphasis>!</para>
      </note>

      <para><command>MAKEDEV</command>
	を実行すると、次のようなデバイスノード群が作成されるでしょう。</para>

      <informaltable frame="none">
	<tgroup cols="2">
	  <thead>
	    <row>
	      <entry>デバイスノード</entry>
	      <entry>説明</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><devicename>/dev/audio</devicename></entry>
	      <entry>&sparc; 互換オーディオデバイス</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/dsp</devicename></entry>
	      <entry>サンプリングデバイス (訳注: 8 ビット)</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/dspW</devicename></entry>
	      <entry><devicename>/dev/dsp</devicename> と同様。
		ただし、量子化ビット数は 16。</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/midi</devicename></entry>
	      <entry>raw MIDI アクセスデバイス</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/mixer</devicename></entry>
	      <entry>ミキサデバイスのコントロールポート</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/music</devicename></entry>
	      <entry>レベル 2 シーケンサインタフェース</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/sequencer</devicename></entry>
	      <entry>シーケンサデバイス</entry>
	    </row>

	    <row>
	      <entry><devicename>/dev/pss</devicename></entry>
	      <entry>プログラム可能なデバイスインタフェース</entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para>すべてうまくいけば、サウンドカードが機能するでしょう。
	CD-ROM または
	DVD-ROM ドライブがサウンドカードと適切に接続されていれば、
	&man.cdcontrol.1; を使ってドライブ内の CD を再生できます。</para>

      <screen>&prompt.user; <userinput>cdcontrol -f /dev/acd0c play 1</userinput></screen>

      <para><filename role="package">audio/workman</filename>
	のように、よりよいインタフェースを提供する
	さまざまなアプリケーションがあります。
	MP3 オーディオファイルを聴くために
	<filename role="package">audio/mpg123</filename>
	のようなアプリケーションをインストールしようと思うかもしれません。</para>

      <sect3 id="troubleshooting">
	<title>よくある問題</title>

	<indexterm><primary>デバイスノード</primary></indexterm>
	<indexterm><primary>I/O ポート</primary></indexterm>
	<indexterm><primary>IRQ</primary></indexterm>
	<indexterm><primary>DSP</primary></indexterm>

	<informaltable>
	  <tgroup cols="2">
	    <thead>
	      <row>
		<entry>エラー</entry>
		<entry>解決方法</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><errorname>unsupported subdevice XX</errorname></entry>
		<entry><para>いくつかのデバイスノードが正しく作成されて
		    いません。上記の手順をくり返してください。</para></entry>
	      </row>

	      <row>
		<entry><errorname>sb_dspwr(XX) timed out</errorname></entry>
		<entry><para>使用する
		    I/O ポートが適切に設定されていません。</para></entry>
	      </row>

	      <row>
		<entry><errorname>bad irq XX</errorname></entry>
		<entry><para>使用する IRQ が正しく設定されていません。
		    サウンドカードの IRQ と設定した IRQ
		    が同じかどうか確かめてください。</para></entry>
	      </row>

	      <row>
		<entry><errorname>xxx: gus pcm not attached, out of memory</errorname></entry>
		<entry><para>デバイスを使用するのに
		    十分なメモリを確保できません。</para></entry>
	      </row>

	      <row>
		<entry><errorname>xxx: can't open /dev/dsp!</errorname></entry>
		<entry><para><command>fstat | grep dsp</command>
		    を使って、他のアプリケーションがデバイスを
		    使用しているか調べてください。
		    注目すべきトラブルメーカは
		    <application>esound</application> と
		    <application>KDE</application>
		    のサウンド機能です。</para></entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>
      </sect3>
    </sect2>

    <sect2>
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Munish</firstname>
	    <surname>Chopra</surname>
	    <contrib>寄稿: </contrib>
	  </author>
	</authorgroup>
      </sect2info>
      <title>複数音源の利用</title>

      <para>特定のアプリケーションとのサウンドデバイスの共用に対応していない時、
	<application>esound</application> または
	<application>artsd</application> のように
	同時に再生することのできる音源を複数実装していることは、
	多くの場合望ましいことです。</para>

      <para>FreeBSD では、
	<emphasis>仮想サウンドチャネル</emphasis>
	を使ってこれを実現でき、&man.sysctl.8; で設定できます。
	仮想チャネルはカーネル内でサウンドを合成することにより、
	サウンドカードの再生チャネルを多重化することができます。</para>

      <para>仮想チャネルの数を決めるのに二つの sysctl 変数を設定できます。
	<username>root</username> ユーザで以下のようにします。</para>

      <screen>&prompt.root; <userinput>sysctl hw.snd.pcm0.vchans=4</userinput>
&prompt.root; <userinput>sysctl hw.snd.maxautovchans=4</userinput></screen>

      <para>上記の例では四つの仮想チャネルを設定しています。
	これは通常利用する上で十分実用的な数です。
	<varname>hw.snd.pcm0.vchans</varname>
	は <devicename>pcm0</devicename> が持っている仮想チャネルの数で、
	一度デバイスが取り付けられると設定することができます。
	<literal>hw.snd.maxautovchans</literal> は、
	&man.kldload.8;
	を用いて認識された新しいデバイスの仮想チャネル数です。
	<devicename>pcm</devicename>
	モジュールはハードウェアドライバとは独立して読み込むことができるので、
	後でどんなにデバイスを認識しても
	<varname>hw.snd.maxautovchans</varname>
	は仮想チャネルを格納できます。</para>

      <para>&man.devfs.5; を使用していないのなら、
	利用するアプリケーションに
	<devicename>/dev/dsp0</devicename>.<replaceable>x</replaceable>
	を指定しなければならないでしょう。
	上記の例のように仮想チャネル数を 4 に設定すると
	<replaceable>x</replaceable> は 0 から 3 となります。
	&man.devfs.5; を使用しているシステムでは、
	ユーザが意識しなくてもこれらが自動的に設定されます。</para>
    </sect2>
  </sect1>

  <sect1 id="sound-mp3">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Chern</firstname>
	  <surname>Lee</surname>
	  <contrib>寄稿: </contrib>
	</author>
      </authorgroup>
      <!-- 11 Sept 2001 -->
    </sect1info>

    <title>MP3 オーディオ</title>

    <para>MP3 (MPEG Layer 3 Audio) は
      CD に匹敵する音質でサウンドを再生できます。あなたの FreeBSD
      ワークステーションにこのプレイヤをインストールしない理由はないでしょう。</para>

    <sect2 id="mp3-players">
      <title>MP3 プレイヤ</title>

      <para><application>XMMS</application> (X Multimedia System) は
        とても人気のある
        <application>&xfree86;</application> ベースの MP3 プレイヤです。
	<application>XMMS</application>
        のグラフィカルインタフェースは
        Nullsoft の <application>Winamp</application>
        とほとんど同一なので、<application>Winamp</application>
        のスキンを使うことができます。
	<application>XMMS</application>
        はネイティブプラグインにも対応しています。</para>

      <para><application>XMMS</application> は
	<filename role="package">multimedia/xmms</filename> の
        port または package からインストールできます。</para>

      <para><application>XMMS</application>
        のプレイリスト、グラフィックイコライザそしてその他のインタフェースは
        直感的です。
        <application>Winamp</application> を使いなれている人は
	簡単に <application>XMMS</application> を使えるでしょう。</para>

      <para><filename role="package">audio/mpg123</filename>
        はコマンドライン上の代替となる MP3 プレイヤの port です。</para>

      <para><application>mpg123</application>
        は次のようにサウンドデバイスと MP3 ファイルを
        指定して実行できます。</para>

      <screen>&prompt.root; <userinput>mpg123 -a <replaceable>/dev/dsp1.0</replaceable> Foobar-GreatestHits.mp3</userinput>
High Performance MPEG 1.0/2.0/2.5 Audio Player for Layer 1, 2 and 3.
Version 0.59r (1999/Jun/15). Written and copyrights by Michael Hipp.
Uses code from various people. See 'README' for more!
THIS SOFTWARE COMES WITH ABSOLUTELY NO WARRANTY! USE AT YOUR OWN RISK!





Playing MPEG stream from Foobar-GreatestHits.mp3 ...
MPEG 1.0 layer III, 128 kbit/s, 44100 Hz joint-stereo
</screen>

      <para><literal>/dev/dsp1.0</literal> は実際の
        <devicename>dsp</devicename>
        デバイスのエントリに応じて置き換えられるべきでしょう。</para>

    </sect2>

    <sect2 id="rip-cd">
      <title>CD 音声トラックの抽出</title>

      <para>CD 全体または CD トラックを MP3 に変換する前に、CD
        上のオーディオデータをハードディスク上に抽出する必要があります。
        これには raw CDDA (CD Digital Audio) データを WAV
        ファイルにコピーします。</para>

      <para><filename role="package">sysutils/cdrtools</filename>
        スイートの一部である <command>cdda2wav</command> ツールは
        CD からオーディオデータを抽出したり、
	情報を関係づけるのに使われます。</para>

      <para>CD をドライブにいれて次のコマンドを
        (<username>root</username>で) 実行して、
        CD 全体を (トラックごとに) 個々の WAV ファイルに抽出できます。</para>

      <screen>&prompt.root; <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -B</userinput></screen>

      <para><application>cdda2wav</application>
        は ATAPI (IDE) CDROM ドライブにも対応しています。
        IDE ドライブから抽出するには、
        SCSI ユニット番号をデバイス名に置き換えて指定します。
	たとえば IDE ドライブから七番目のトラックを抽出するには、
        次のようにします。</para>

      <screen>&prompt.root; <userinput>cdda2wav -D <replaceable>/dev/acd0a</replaceable> -t 7</userinput></screen>

      <para><option>-D <replaceable>0,1,0</replaceable></option> は
	SCSI デバイス <devicename>0,1,0</devicename> を表します。
	これは <command>cdrecord -scanbus</command>
        の出力に一致します。</para>

      <para>個々のトラックを抽出するには、
	次のように <option>-t</option> オプションを使用します。</para>

      <screen>&prompt.root; <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -t 7</userinput></screen>

      <para>上記の例はオーディオ CDROM の七番目のトラックを抽出します。
        範囲を指定して、
        たとえば一番目から七番目のトラックまで抽出したい場合、
        次のようにします。</para>

      <screen>&prompt.root; <userinput>cdda2wav -D <replaceable>0,1,0</replaceable> -t 1+7</userinput></screen>

      <para>&man.dd.1; ユーティリティも ATAPI
        ドライブ上のオーディオトラックを展開するのに使われます。
        何ができるか詳しいことは
        オーディオ CD の複製について
        <!-- rushani:2003/12/21
             should be refer this after updating disks/chapter.sgml
        <xref linkend="duplicating-audiocds">
        -->
	を参照してください。</para>

    </sect2>

    <sect2 id="mp3-encoding">
      <title>MP3 のエンコード</title>

      <para>現在、一般に好まれている MP3 エンコーダは
	<application>lame</application> です。
	<application>lame</application> は Ports Collection の
	<filename role="package">audio/lame</filename>
	に収録されています。</para>

      <para>次のコマンドを実行すると、抽出した WAV ファイル
	<filename>audio01.wav</filename> を使って
	<filename>audio01.mp3</filename> に変換します。</para>

      <screen>&prompt.root; <userinput>lame -h -b <replaceable>128</replaceable> \
--tt "<replaceable>曲名</replaceable>" \
--ta "<replaceable>アーティスト名</replaceable>" \
--tl "<replaceable>アルバム名</replaceable>" \
--ty "<replaceable>年</replaceable>" \
--tc "<replaceable>コメント</replaceable>" \
--tg "<replaceable>ジャンル</replaceable>" \
<replaceable>audio01.wav audio01.mp3</replaceable></userinput></screen>

      <para>128&nbsp;kbits が標準のビットレートのようです。
	多くの人はさらに高音質の 160&nbsp;kbits または 192&nbsp;kbits
        を好むでしょう。
        ビットレートが高くなるにつれて作成される
	MP3 ファイルは多くのディスク領域を消費しますが、より高音質となります。
	<option>-h</option> オプションを指定すると
        <quote>低速高品質</quote> モードとなります。
        <option>--t</option> ではじまるオプションは ID3 タグを設定します。
        このタグにはたいてい曲の情報が含まれており、
        MP3 ファイルに格納されます。
	lame のマニュアルを参照すれば他のオプションが見つかるでしょう。</para>
    </sect2>

    <sect2 id="mp3-decoding">
      <title>MP3 のデコード</title>

      <para>MP3 からオーディオ CD を作成するには、
        MP3 形式を非圧縮 WAV 形式に変換しなければなりません。
        <application>XMMS</application> と
	<application>mpg123</application> の両方が
        MP3 から非圧縮ファイル形式への出力に対応しています。</para>

      <para><application>XMMS</application>
        でディスクへ書き出す方法は次の通りです。</para>

      <procedure>
	<step>
	  <para><application>XMMS</application> を起動します。</para>
	</step>

	<step>
	  <para>右クリックで
            <application>XMMS</application> メニューを表示します。</para>
	</step>

	<step>
	  <para><literal>Options</literal>
            から <literal>Preference</literal> を選択します。</para>
	</step>

	<step>
	  <para>Output Plugin を <quote>Disk Writer Plugin</quote>
            に変更します。</para>
	</step>

	<step>
	  <para><literal>Configure</literal> を押します。</para>
	</step>

	<step>
	  <para>非圧縮ファイルを書き出すディレクトリを入力
            (または選択) します。</para>
	</step>

	<step>
	  <para>普段通り <application>XMMS</application>
            へ MP3 ファイルを読み込みます。
            音量は 100% で イコライザの設定はオフにします。</para>
	</step>

	<step>
	  <para><literal>Play</literal> を押します&mdash;
	    <application>XMMS</application>
            は MP3 を再生しているかのように表示しますが、
            音声はきこえません。
            実際には MP3 をファイルに出力しています。</para>
	</step>

	<step>
	  <para>再び MP3 を聴けるように
	    Output Plugin を以前のように元に戻すのを忘れないでください。</para>
	</step>
      </procedure>

      <para><application>mpg123</application>
        で標準出力へ書き出す方法は次の通りです。</para>

      <procedure>
	<step>
	  <para><command>mpg123 -s <replaceable>audio01.mp3</replaceable>
	      &gt; audio01.pcm</command> を実行します。</para>
	</step>
      </procedure>

      <para><application>XMMS</application>
        は WAV 形式でファイルに書き出しますが、
        <application>mpg123</application> は
	MP3 を PCM オーディオデータに変換します。
        両形式は <application>cdrecord</application>
        を使ってオーディオ CD を作成するのに利用することができます。
	&man.burncd.8; を使う場合は raw PCM データが必要です。
	WAV ファイルを使用する場合、
        それぞれのトラックの先頭に小さなノイズが入るのに気づくでしょう。
        これは WAV ファイルのヘッダ情報です。
	<application>SoX</application>
	(<filename role="package">audio/sox</filename> の port または package
        からインストールできます)
        を使うと簡単に WAV ファイルのヘッダ情報を削除できます。</para>

      <screen>&prompt.user; <userinput>sox -t wav -r 44100 -s -w -c 2 <replaceable>track.wav track.raw</replaceable></userinput></screen>

      <para>FreeBSD での CD 作成の詳しい情報は
        <xref linkend="creating-cds"> を参照してください。</para>
    </sect2>
  </sect1>

  <sect1 id="video-playback">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Ross</firstname>
	  <surname>Lippert</surname>
	  <contrib>寄稿: </contrib>
	</author>
      </authorgroup>
      <!-- 5 June 2002 -->
    </sect1info>

    <title>ビデオ再生</title>

    <para>ビデオ再生は今まさに成長中の新しいアプリケーション分野です。
      辛抱強くしてください。
      音声のようにすべてが順調にいくとは限りません。</para>

    <para>設定をはじめる前に、あなたが持っているビデオカードのモデル、
      そのカードが使用しているチップを確認する必要があります。
      <application>&xfree86;</application>
      はさまざまなビデオカードに対応していますが、
      ビデオ再生に申し分のない性能を発揮できるカードはわずかです。
      あなたのビデオカードの利用している X
      サーバが対応している拡張機能のリストを得るには、
      X11 を実行中に &man.xdpyinfo.1; コマンドを実行してください。</para>

    <para>さまざまなプレイヤやオプションを試すのに、
      テストファイルとして小さな MPEG ファイルを用意しておくのはよい考えです。
      いくつかの DVD プレイヤは DVD メディアを
      <filename>/dev/dvd</filename> として
      初期設定しているか、ハードコーディングされているので、
      次のように適切なデバイスにシンボリックリンクを張っておくと便利かもしれません。</para>

    <screen>&prompt.root; <userinput>ln -sf /dev/acd0c /dev/dvd</userinput>
&prompt.root; <userinput>ln -sf /dev/racd0c /dev/rdvd</userinput></screen>

    <para>&man.devfs.5; を使う FreeBSD&nbsp;5.X では、
      下記のように少し異なったリンクが推奨されます。</para>

    <screen>&prompt.root; <userinput>ln -sf /dev/acd0 /dev/dvd</userinput>
&prompt.root; <userinput>ln -sf /dev/acd0 /dev/rdvd</userinput></screen>

    <para>&man.devfs.5; の仕様により、
      このように手動で作成されたリンクは再起動すると消えてしまいます。
      システムの起動時にこれらのシンボリックリンクを自動的に作成するには、
      <filename>/etc/devfs.conf</filename> に下記の設定を追加します。</para>

    <programlisting>link acd0c dvd
link acd0c rdvd</programlisting>

    <para>加えて、特別な DVD-ROM 機能を必要とする DVD 解読は、
      DVD デバイスへの書き込み権限が必要です。</para>

    <indexterm>
      <primary>カーネルオプション</primary>
      <secondary>options CPU_ENABLE_SSE</secondary>
    </indexterm>
    <indexterm>
      <primary>カーネルオプション</primary>
      <secondary>options USER_LDT</secondary>
    </indexterm>

    <para>ここで議論する ports のいくつかは、
      正しく構築するために次のカーネルオプションが使用できることを期待しています。
      port を構築する前に、
      次のオプションをカーネルコンフィグレーションファイルに追加し、
      新しいカーネルを構築して再起動してください。</para>

    <programlisting>option CPU_ENABLE_SSE
option USER_LDT</programlisting>

    <note>
      <para><literal>option USER_LDT</literal> は
	&os;&nbsp;5.X にはありません。</para>
    </note>

    <para>共有メモリ X11 インタフェースを改善するために、
      いくつかの &man.sysctl.8; 変数の値を増やすことが推奨されています。</para>

    <programlisting>kern.ipc.shmmax=67108864
kern.ipc.shmall=32768</programlisting>

    <sect2 id="video-interface">
      <title>ビデオ機能の決定</title>

      <indexterm><primary>XVideo</primary></indexterm>
      <indexterm><primary>SDL</primary></indexterm>
      <indexterm><primary>DGA</primary></indexterm>

      <para>X11 においてビデオ表示性能を改善する方法はいくつかあると思われます。
	ちゃんと動作するかどうかはハードウェアに大きく依存しています。
	下記に説明したどの方法でも、
	ハードウェアが変わると品質が変わるでしょう。
	二つ目に、X11
	でのビデオレンダリングは最近多くの注目を集めるトピックです。
	そして <application>&xfree86;</application>
	のバージョンを追うごとに、著しく改良されているかもしれません。</para>

      <para>よく知られたビデオインタフェースは次の通りです。</para>

      <orderedlist>
	<listitem>
	  <para>X11: 共有メモリを用いた通常の X11 出力</para>
	</listitem>
	<listitem>
	  <para>XVideo: X11 drawable 内でのビデオ再生に対応した
	    X11 インタフェースの拡張機能</para>
	</listitem>
	<listitem>
	  <para>SDL: Simple Directmedia Layer</para>
	</listitem>
	<listitem>
	  <para>DGA: Direct Graphics Access</para>
	</listitem>
	<listitem>
	  <para>SVGAlib: 低レベルコンソールグラフィックレイヤ</para>
	</listitem>
      </orderedlist>

      <sect3 id="video-interface-xvideo">
	<title>XVideo</title>

	<para><application>&xfree86; 4.X</application> には
	  <emphasis>XVideo</emphasis> (または Xvideo, Xv, xv)
	  と呼ばれる拡張機能があります。
	  これは特別なアクセラレーションによって drawable オブジェクト
	  に直接ビデオを表示することができます。
	  この拡張機能によって、
	  低速なマシン (たとえばわたしの PIII&nbsp;400&nbsp;Mhz laptop)
	  でも、とてもすぐれた品質の再生が可能となります。
	  不幸なことに、<quote>箱から出しただけで</quote>
	  すぐにこの機能を使用できるカードは限られています。
	  現在のところ、以下のカードが対応しています。</para>

        <orderedlist>
	  <listitem>
	    <para>3DFX Voodoo 3</para>
	  </listitem>
	  <listitem>
	    <para>&intel; i810 および i815</para>
	  </listitem>
	  <listitem>
	    <para>いくつかの S3 chips (Savage/IX および Savage/MX など)</para>
	  </listitem>
        </orderedlist>

	<para>あなたのカードがここにないからといって、
	  まだ失望しないでください。
	  <application>&xfree86; 4.X</application> のリリースを追うごとに
	  新しく xv に対応したカードが増えているからです
	  <footnote>
	    <para>一般的に、<application>&xfree86;</application>
	      がすぐれた性能を発揮し、
	      よく知られていて人気のある nVidia 社製のグラフィックカードは、
	      XVideo に対応するための仕様書が
	      <application>&xfree86;</application>
	      開発チームにまだ提供されていません。
	      <application>&xfree86;</application>
	      がこれらのカードに完全に対応するには、
	      少し時間がかかるかもしれません。</para>
	  </footnote>。
	  この拡張機能が動作しているかどうかを調べるには、
	  <command>xvinfo</command> を使います。</para>

        <screen>&prompt.user; <userinput>xvinfo</userinput></screen>

	<para>以下のような結果が得られたならば、あなたのカードは
	  XVideo に対応しています。</para>

	<screen>X-Video Extension version 2.2
screen #0
  Adaptor #0: "Savage Streams Engine"
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
      "XV_COLORKEY" (range 0 to 16777215)
              client settable attribute
              client gettable attribute (current value is 2110)
      "XV_BRIGHTNESS" (range -128 to 127)
              client settable attribute
              client gettable attribute (current value is 0)
      "XV_CONTRAST" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_SATURATION" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_HUE" (range -180 to 180)
              client settable attribute
              client gettable attribute (current value is 0)
    maximum XvImage size: 1024 x 1024
    Number of image formats: 7
      id: 0x32595559 (YUY2)
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        type: YUV (packed)
      id: 0x32315659 (YV12)
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x30323449 (I420)
        guid: 49343230-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x36315652 (RV16)
        guid: 52563135-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x3e0, 0x7c00
      id: 0x35315652 (RV15)
        guid: 52563136-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x7e0, 0xf800
      id: 0x31313259 (Y211)
        guid: 59323131-0000-0010-8000-00aa00389b71
        bits per pixel: 6
        number of planes: 3
        type: YUV (packed)
      id: 0x0
        guid: 00000000-0000-0000-0000-000000000000
        bits per pixel: 0
        number of planes: 0
        type: RGB (packed)
        depth: 1
        red, green, blue masks: 0x0, 0x0, 0x0</screen>

	<para>リストにある形式 (YUV2, YUV12 など) が XVideo
	  のすべての実装で存在するとは限りません。
	  対応している形式が少ないために、あるプレーヤでは悪影響が出る
	  かもしれないことにも注意してください。</para>

	<para>出力が以下のような場合、</para>
	<screen>X-Video Extension version 2.2
screen #0
no adaptors present</screen>

	<para>あなたのカードはおそらく
	  XVideo に対応していないのでしょう。</para>

	<para>あなたのカードが XVideo に対応していないとしても、
	  このことはあなたのディスプレイでビデオを表示するのに、
	  計算上の要求を満たすことがより困難になるだけのことです。
	  しかしながら、あなたのビデオカードおよびプロセッサによっては、
	  それでも満足のいく性能が得られるかもしれません。
	  性能を向上させるには
	  <xref linkend="video-further-reading">
	  をよく読むとよいでしょう。</para>

      </sect3>

      <sect3 id="video-interface-SDL">
	<title>Simple Directmedia Layer</title>

	<para>Simple Directmedia Layer (SDL) は
	  &microsoft.windows;, BeOS そして &unix; の間で
	  サウンドとグラフィックスを効果的に利用した
	  クロスプラットホームアプリケーションを
	  開発することを目的としたレイヤです。
	  SDL レイヤはハードウェアに対する低レベルの抽象的概念を提供し、
	  時には X11 インタフェースを使用するよりも効果的なことがあります。</para>

	<para>SDL は <filename role="package">devel/sdl12</filename>
	  からインストールできます。</para>

      </sect3>

      <sect3 id="video-interface-DGA">
	<title>Direct Graphics Access</title>

	<para>Direct Graphics Access は、
	  プログラムが X サーバを介せず
	  直接フレームバッファを変更することを可能にする
	  <application>&xfree86;</application> の拡張機能です。
	  共有メモリを使用するために
	  低レベルのメモリマッピングが実行できることを期待しているので、
	  この機能を使うプログラムは <username>root</username>
	  権限で実行されなければなりません。</para>

	<para>DGA 機能拡張は &man.dga.1;
	  によってテストとベンチマークができます。
	  <command>dga</command>
	  実行中はキーボードを押せばいつでもディスプレイ色が変更されます。
	  中止するには <keycap>q</keycap> を押します。</para>

      </sect3>

    </sect2>

    <sect2 id="video-ports">
      <title>ビデオを扱う ports および packages</title>

      <indexterm><primary>ビデオ ports</primary></indexterm>
      <indexterm><primary>ビデオ packages</primary></indexterm>

      <para>この節では Ports Collection で利用可能な、
	ビデオの再生に使用できるソフトウェアについて論じます。
	ビデオ再生は大変活発なソフト開発分野で、
	さまざまなアプリケーションの機能は、
	ここでの説明から省かざるをえません。</para>

      <para>はじめに、FreeBSD で実行できるビデオアプリケーションの多くは、
	Linux アプリケーションとして開発されたということを知ることは重要です。
	これらのアプリケーションの多くはまだベータ版の品質です。
	FreeBSD でこれらのビデオアプリケーションを使用する際に、
	以下のような問題が起こるかもしれません。</para>

      <orderedlist>

	<listitem>
	  <para>あるアプリケーションが、
	    他のアプリケーションの作成したファイルを再生できない。</para>
	</listitem>

	<listitem>
	  <para>あるアプリケーションが、
	    自身の作成したファイルを再生できない。</para>
	</listitem>

	<listitem>
	  <para>二つの異なるマシンで構築した同じアプリケーションが、
	    同じファイルを再生する挙動がそれぞれ異なる。</para>
	</listitem>

	<listitem>
	  <para>イメージサイズ変更のように見たところではありふれたフィルタが、
	    バグの多いサイズ変更ルーチンによってひどい人工物を作成する。</para>
	</listitem>

	<listitem>
	  <para>アプリケーションがよくコアダンプする。</para>
	</listitem>

	<listitem>
	  <para>文書が port と一緒にインストールされない
	    (文書は web サイトにあったり、その port の
	    <filename role='directory'>work</filename> ディレクトリの中に
	    残っていることがある)。</para>
	</listitem>

      </orderedlist>

      <para>これらのアプリケーションの多くはさらに
	<quote>Linux 主義</quote> を主張するかもしれません。
	すなわち、アプリケーションの作者が仮定した、
	Linux ディストリビューションでのみ実装されている
	ある標準ライブラリの使用方法や
	Linux カーネルの特定の機能に起因する問題が生じるかもしれません。
	必ずしも port 保守担当者がこれらの問題を把握して作業しているとは限らず、
	次のような問題が発生する可能性があります。
      </para>

      <orderedlist>

	<listitem>
	  <para>プロセッサの特性を検知するための
	    <filename>/proc/cpuinfo</filename> の利用</para>
	</listitem>

	<listitem>
	  <para>本当はプログラムを終了させるはずであるのに、
	    停止させてしまうようなスレッドの誤用</para>
	</listitem>

	<listitem>
	  <para>一般的にアプリケーションとともに使用され、まだ FreeBSD の
	    Ports Collection に収録されていないソフトウェアを必要とする</para>
	</listitem>

      </orderedlist>

      <para>これまで、これらのアプリケーションの開発者は、
	移植に必要だったその場しのぎの回避方法を最小化し
	問題を解決するために port 保守担当者と協力しています。</para>

      <sect3 id="video-mplayer">
	<title>MPlayer</title>

	<para><application>MPlayer</application> は最近開発され、
	  急激に成長つつあるビデオプレイヤです。
	  <application>MPlayer</application> チームの目的は、
	  Linux や他の Unix 系 OS 上で高速性と柔軟性をもたらすことです。
	  このプロジェクトは、
	  チーム創設者が当時利用可能だったビデオプレイヤの
	  ひどい再生能力にうんざりしたのをきっかけとして始まりました。
	  合理化された設計のために GUI が犠牲にされたと言う人もいます。
	  しかしながら、コマンドラインオプションおよびキーボード操作に
	  一度慣れれば非常によく動作します。</para>

	<sect4 id="video-mplayer-building">
	  <title>MPlayer の作成</title>

	  <indexterm>
	    <primary>MPlayer</primary>
	    <secondary>作成</secondary>
	  </indexterm>

	  <para><application>MPlayer</application> は
	    <filename role="package">multimedia/mplayer</filename>
	    にあります。
	    <application>MPlayer</application> は
	    構築の際にさまざまなハードウェアのチェックをするため、
	    あるシステムで作成されたバイナリは、
	    別のシステムで利用できないかもしれません。
	    したがって port から構築し、
	    バイナリパッケージを利用しないことが重要です。
	    さらに、構築のはじめに説明されるように
	    <command>make</command>
	    のコマンドラインで多くのオプションを指定することができます。</para>

	  <screen>&prompt.root; <userinput>cd /usr/ports/multimedia/mplayer</userinput>
&prompt.root; <userinput>make</userinput>
You can enable additional compilation optimizations
by defining WITH_OPTIMIZED_CFLAGS
You can enable GTK GUI by defining WITH_GUI.
You can enable DVD support by defining WITH_DVD.
You can enable SVGALIB support by defining WITH_SVGALIB.
You can enable VORBIS sound support by defining WITH_VORBIS.
You can enable XAnim DLL support by defining WITH_XANIM.
</screen>

	  <para><filename role="package">x11-toolkits/gtk12</filename>
	    がインストールされているなら、GUI を有効にした方がいいでしょう。
	    そうでなければ努力の価値がありません。
	    (おそらく CSS エンコードされた) DVD を
	    <application>MPlayer</application> で再生しようと思うならば、
	    ここで DVD 対応のオプションを有効にしなければなりません
	    <footnote><para>無許可で DVD を再生するのは、
		いくつかの国では重大な犯罪行為です。
		このオプションを有効にする前に、
		地域法を確認してください。</para></footnote>。
	    適切なオプションを指定して構築するには、以下のように実行します。</para>

	  <screen>&prompt.root; <userinput>make WITH_DVD=yes WITH_SVGALIB=yes</userinput></screen>

	  <para>この文書を執筆している時点では、
	    <application>MPlayer</application> の port は HTML
	    文書と <command>mplayer</command>
	    という一つの実行可能なバイナリを構築します。
	    また、ビデオを再エンコーディングするためのツールである
	    <command>mencoder</command>
	    というエンコーダも
	    <filename>Makefile</filename> を編集すれば構築できます。
	    のちのバージョンの port では、
	    デフォルトで利用可能になっているかもしれません。</para>

	  <note>
	    <title>訳注</title>

	    <para>邦訳した時点では、
	      デフォルトで <command>mencoder</command> が作成されます。
	    </para>
	  </note>

	  <para><application>MPlayer</application> のための
	    HTML 文書は非常に有益です。この章で不足した
	    ビデオハードウェアおよびインタフェースに関する情報があれば、
	    <application>MPlayer</application>
	    の文書は非常に詳細な補足になります。
	    &unix; のビデオ対応情報を探しているのなら、時間を割いて
	    <application>MPlayer</application> の文書を読むべきなのは
	    明らかです。</para>

	</sect4>

	<sect4 id="video-mplayer-using">
	  <title>MPlayer の使用</title>

	  <indexterm>
	    <primary>MPlayer</primary>
	    <secondary>使用</secondary>
	  </indexterm>

	  <para><application>MPlayer</application> を使用する人はすべて、
	    各自のホームディレクトリ内に <filename>.mplayer</filename>
	    サブディレクトリを用意しなければなりません。
	    この必要となるサブディレクトリを作成するために、
	    次のコマンドを入力します。</para>

	  <screen>&prompt.user; <userinput>cd /usr/ports/multimedia/mplayer</userinput>
&prompt.user; <userinput>make install-user</userinput></screen>

	  <para><command>mplayer</command>
	    のコマンドオプションはマニュアルに記載されています。
	    さらにより詳細な説明について知りたいなら、HTML 文書をご覧ください。
	    この節では、一般的な使用法についてほんの少し説明します。</para>

	  <para>さまざまなビデオインタフェースの一つを用いて
	    <filename><replaceable>testfile.avi</replaceable></filename>
	    というファイルを再生するには、
	    <option>-vo</option> オプションを指定します。
	  </para>

	  <screen>&prompt.user; <userinput>mplayer -vo xv testfile.avi</userinput></screen>
	  <screen>&prompt.user; <userinput>mplayer -vo sdl testfile.avi</userinput></screen>
	  <screen>&prompt.user; <userinput>mplayer -vo x11 testfile.avi</userinput></screen>
	  <screen>&prompt.root; <userinput>mplayer -vo dga testfile.avi</userinput></screen>
	  <screen>&prompt.root; <userinput>mplayer -vo 'sdl:dga' testfile.avi</userinput></screen>

	  <para>ビデオ再生の相対的性能は多くの要因に依存し、
	    ハードウェアに応じて著しく変わると思われるので、
	    これらのオプションをすべて試してみる価値はあるでしょう。</para>

	  <para>DVD を再生するには、
	    <filename>testfile.avi</filename> を <option>-dvd &lt;N&gt;
	      <replaceable>DEVICE</replaceable></option> に置き換えてください。
	    &lt;N&gt; には再生するタイトル番号を、
	    <filename><replaceable>DEVICE</replaceable></filename>
	    は DVD-ROM のデバイスノードを指定します。
	    たとえば、<filename>/dev/dvd</filename>
	    から 2 番目のタイトルを再生するには以下のようにします。</para>

	  <screen>&prompt.root; <userinput>mplayer -vo dga -dvd 2 /dev/dvd</userinput></screen>

	  <para>停止、休止、再生などをするにはキーの割り当てを調べてください。
	    <command>mplayer -h</command> を実行したり、
	    マニュアルを読めばわかります。</para>

	  <para>再生に関してさらに重要なオプションがあります。
	    全画面モードにする <option>-fs -zoom</option> オプションと、
	    性能を向上させる <option>-framedrop</option> オプションです。</para>

	  <para><command>mplayer</command>
	    に指定するコマンドラインが長くなりすぎないように、
	    <filename>.mplayer/config</filename>
	    を作成してデフォルトのオプションを設定できます。</para>
	  <programlisting>vo=xv
fs=yes
zoom=yes</programlisting>

	  <para>最後に <command>mplayer</command> は DVD タイトルを
	    <filename>.vob</filename> ファイルに抽出するのに使用できます。
	    DVD から 2 番目のタイトルをダンプするには次のようにします。</para>

	  <screen>&prompt.root; <userinput>mplayer -dumpstream -dumpfile out.vob -dvd 2 /dev/dvd</userinput></screen>

	  <para>出力された <filename>out.vob</filename> ファイルは
	    MPEG 形式で、
	    この節で説明される他のアプリケーションで編集できます。</para>

	</sect4>

	<sect4 id="video-mencoder">
	  <title>mencoder</title>
	  <indexterm>
	    <primary>mencoder</primary>
	  </indexterm>

	  <para><application>MPlayer</application> を構築する際に
	    <command>mencoder</command> もインストールするなら、
	    これにはまだ実験的な要素が含まれていることに注意してください。
	    <command>mencoder</command> を使う前に、
	    HTML 文書を読んでオプションに慣れておくのはよい考えです。
	    マニュアルもありますが、HTML 文書なしではあまり有用ではありません。
	    品質向上、低ビットレート、形式変換をする方法が無数にあります。
	    これらの要素の調節具合で、性能が良かったり悪かったりするなど、
	    結果に違いが出るかもしれません。
	    ここにいくつか例を示します。
	    はじめは単純なファイルのコピーです。</para>

	  <screen>&prompt.user; <userinput>mencoder input.avi -oac copy -ovc copy -o output.avi</userinput></screen>

	  <para>コマンドラインオプションを不適切に組合せると、
	    <command>mplayer</command>
	    でさえ再生できない出力ファイルを作成してしまいます。
	    したがって、単にファイルを抽出したいときには、
	    <command>mplayer</command> に <option>-dumpfile</option>
	    オプションをつけます。</para>

	  <para><filename>input.avi</filename> を音声に MPEG3 エンコードを使用して
	    MPEG4 コーデックに変換するには次のようにします
	    (<filename role="package">audio/lame</filename> が必要です)。</para>

	  <screen>&prompt.user; <userinput>mencoder input.avi -oac mp3lame -lameopts br=192 \
	 -ovc lavc -lavcopts vcodec=mpeg4:vhq -o output.avi</userinput></screen>

	  <para>これは <command>mplayer</command> や
	    <command>xine</command> で再生可能な出力ファイルを作成します。</para>

	  <para>DVD タイトルを直接再エンコードするためには、
	    上記のコマンドラインの
	    <filename>input.avi</filename> を
	    <option>-dvd 1 /dev/dvd</option> に置き換えて、
	    <username>root</username> 権限で実行します。
	    はじめの作業結果に不満をもつと思われるので、
	    タイトルをファイルにダンプして、ファイルに対して作業することを
	    おすすめします。</para>
	</sect4>

      </sect3>

      <sect3 id="video-xine">
	<title>xine ビデオプレイヤ</title>

	<para><application>xine</application> ビデオプレイヤは
	  オールインワンのビデオソリューションであるだけでなく、
	  プラグインで拡張できる再利用可能な基本ライブラリと
	  実行可能なモジュールを提供する広範囲のプロジェクトです。
	  <filename role="package">multimedia/xine</filename> の
	  port と package の両方からインストールできます。</para>

	<para><application>xine</application> プレイヤは開発途上であり
	  まだ非常に荒削りですが、通常の利用には十分安定しています。
	  実用上、<application>xine</application>
	  を使用するには高速なビデオカードとともに高速な CPU があるか、
	  またはビデオカードが XVideo 拡張に対応していることが必要です。
	  GUI も利用できますがすこし扱いにくいです。</para>

	<para>この文書を執筆している時点では、
	  <application>xine</application> と一緒に提供されている
	  CSS エンコードされた DVD を再生する入力モジュールはありません。
	  このモジュールがあるサードパーティの構築物はいくつかありますが、
	  これらのどれも FreeBSD の Ports Collection には収録されていません。</para>

	<para><application>xine</application> は
	  <application>MPlayer</application> と比べて
	  利用者にとって多くのことをしてくれますが、
	  と同時にきめの細かい制御ができません。なお、
	  <application>xine</application> ビデオプレイヤは、
	  XVideo インタフェース上で最良の性能を発揮します。</para>

	<para>デフォルトでは、<application>xine</application> プレイヤは
	  GUI インタフェース付きで起動するでしょう。
	  その後、メニューを使用して特定のファイルを開くことができます。</para>

	<screen>&prompt.user; <userinput>xine</userinput></screen>

	<para>GUI インタフェースなしでファイルを直ちに再生するには、
	  次のコマンドを実行します。</para>

	<screen>&prompt.user; <userinput>xine -g -p mymovie.avi</userinput></screen>

      </sect3>

      <sect3 id="video-ports-transcode">
	<title>transcode ユーティリティ</title>

	<para><application>transcode</application>
	  というソフトウェアは、プレイヤではなく
	  <filename>.avi</filename> および <filename>.mpg</filename>
	  ファイルを再エンコードするためのツール一式です。
	  <application>transcode</application> を使えば、
	  <filename>stdin/stdout</filename> インタフェースとともに
	  コマンドラインツールを用いることによって、
	  ビデオファイルの統合や、壊れたファイルの修復ができます。</para>

	<para><application>MPlayer</application> と同じように、
	  <application>transcode</application> は非常に実験的なソフトウェアで、
	  <filename role="package">multimedia/transcode</filename>
	  port から構築することをおすすめします。
	  <command>make</command>
	  コマンドに非常に多くのオプションを指定できますが、
	  とりわけ次のコマンドで構築するのを推奨します。</para>

	<screen>&prompt.root; <userinput>make WITH_LIBMPEG2=yes</userinput></screen>

	<para><filename role="package">multimedia/avifile</filename>
	  をインストールする予定なら、
	  次のように <command>make</command> コマンドに
	  <literal>WITH_AVIFILE</literal> オプションを加えてください。</para>

	<screen>&prompt.root; <userinput>make WITH_AVIFILE=yes WITH_LIBMPEG2=yes</userinput></screen>

	<para>ここに、サイズを変更した出力を作成するビデオ変換のための
	  <command>transcode</command> の使用例を二つあげます。
	  一つ目は出力を openDIVX AVI ファイルに変換します。
	  二つ目はよりポータブルな MPEG 形式のファイルに変換します。</para>

	<screen>&prompt.user; <userinput>transcode -i input.vob -x vob -V -Z 320x240 \
-y opendivx -N 0x55 -o output.avi</userinput></screen>

	<screen>&prompt.user; <userinput>transcode -i input.vob -x vob -V -Z 320x240 \
-y mpeg -N 0x55 -o output.tmp</userinput>
&prompt.user; <userinput>tcmplex -o output.mpg -i output.tmp.m1v -p output.tmp.mpa -m 1</userinput></screen>

	<para><command>transcode</command> のマニュアルもありますが、
	  同時にインストールされる、
	  さまざまな <command>tc*</command> ユーティリティ
	  (<command>tcmplex</command> など) に関する文書はほとんどありません。
	  しかしながら、<option>-h</option> コマンドラインオプションを使えば
	  いつでもコマンドの短い使用法を調べることができます。</para>

	<para><command>transcode</command> の動作は
	  <command>mencoder</command> と比較すると著しく遅いです。
	  しかし、幅広いプラットフォームで再生可能なファイルを
	  作成する可能性はいっそうすぐれています。
	  たとえば、<command>transcode</command> で作成した MPEG ファイルは、
	  旧版の <application>&windows.media; Player</application>
	  および Apple の <application>&quicktime;</application>
	  上でも再生できることが知られています。</para>

      </sect3>

    </sect2>

    <sect2 id="video-further-reading">
      <title>さらに進んだ情報</title>

      <para>FreeBSD 用のさまざまなビデオソフトウェアは急速に成長しています。
	近い将来、ここにあげた問題の多くが解決している可能性は高いでしょう。
	それまでの間、FreeBSD の A/V 能力を最大限発揮させたい人々は、
	FAQ およびチュートリアルから得た知識を寄せ集めて、
	わずかなアプリケーションを使用しなければならないでしょう。
	この節は、読者に
	そのような付加的な情報へのポインタを提供するために存在します。</para>

      <para><ulink url="http://www.mplayerhq.hu/DOCS/">MPlayer の文書</ulink>
	は技術的に非常に有益です。
	おそらく、&unix; ビデオの高水準な専門的知識を得たい人はすべて、
	これらの文書を調べるべきです。
	<application>MPlayer</application>
	メーリングリストを購読している人たちは、
	文書を面倒がって読まない人には、それが誰であれ反感を持ちます。
	そのため、彼らにバグ報告をするときには、マニュアルを読んでください。</para>

      <para>
	<ulink url="http://dvd.sourceforge.net/xine-howto/en_GB/html/howto.html">xine HOWTO</ulink>
	にはすべてのプレイヤに一般的な性能向上についての章が含まれています。</para>

      <para>最後に、読者が試みるかもしれない
	有望なアプリケーションをいくつかあげます。</para>

      <itemizedlist>

	<listitem>
	  <para>
	    <ulink url="http://avifile.sourceforge.net/">Avifile</ulink>.
	    port が <filename role='package'>multimedia/avifile</filename>
	    にあります。</para>
	</listitem>

	<listitem>
	  <para>
	    <ulink url="http://www.dtek.chalmers.se/groups/dvd/">Ogle</ulink>.
	    port が <filename role='package'>multimedia/ogle</filename>
	    にあります。</para>
	</listitem>

	<listitem>
	  <para><ulink url="http://xtheater.sourceforge.net/">Xtheater</ulink>.</para>
	</listitem>

	<listitem>
         <para><filename role="package">multimedia/dvdauthor</filename>. DVD
	    コンテンツをオーサリングするためのオープンソースパッケージです。</para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 id="tvcard">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Josef</firstname>
	  <surname>El-Rayes</surname>
	  <contrib>原作: </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>改訂: </contrib>
	  <!-- 02 January 2004 -->
	</author>
      </authorgroup>
    </sect1info>

    <title>TV カードの設定</title>
    <indexterm>
      <primary>TV カード</primary>
    </indexterm>

    <sect2>
      <title>はじめに</title>

      <para>TV カードを使用することで、
	TV 放送をコンピュータで見ることができます。
	これらの多くは RCA コンポジットまたは S-video 入力端子を備えており、
	FM ラジオチューナを装備したカードもあります。</para>

      <para>&os; は
	Brooktree Bt848/849/878/879 または Conexant CN-878/Fusion 878a
	をビデオキャプチャチップに採用した PCI TV カードに &man.bktr.4;
	ドライバで対応しています。
	対応しているチューナを搭載したボードかどうかを &man.bktr.4;
	マニュアルページの一覧を参照して確認してください。</para>
    </sect2>

    <sect2>
      <title>ドライバの追加</title>

      <para>TV カードを使用するために &man.bktr.4;
	ドライバを読み込む必要があります。
	<filename>/boot/loader.conf</filename>
	ファイルに以下の行を追加してください。</para>

      <programlisting>bktr_load="YES"</programlisting>

      <para>あるいは、カーネルにドライバを静的に組み込むこともできます。
	この場合、次の行をカーネルコンフィギュレーションファイルに追加します。</para>

      <programlisting>device	 bktr
device	iicbus
device	iicbb
device	smbus</programlisting>

      <para>カードコンポーネントは I2C バス経由で連結されているため、
	&man.bktr.4; ドライバに加えてこれらのデバイスドライバが必要になります。
	編集したら新しいカーネルを構築し、インストールします。</para>

      <para>システムにドライバを追加したら、計算機を再起動してください。
	起動時に TV カードは以下のように認識されるでしょう。</para>

      <programlisting>bktr0: &lt;BrookTree 848A&gt; mem 0xd7000000-0xd7000fff irq 10 at device 10.0 on pci0
iicbb0: &lt;I2C bit-banging driver&gt; on bti2c0
iicbus0: &lt;Philips I2C bus&gt; on iicbb0 master-only
iicbus1: &lt;Philips I2C bus&gt; on iicbb0 master-only
smbus0: &lt;System Management Bus&gt; on bti2c0
bktr0: Pinnacle/Miro TV, Philips SECAM tuner.</programlisting>

      <para>もちろん、これらのメッセージはハードウェアに応じて異なります。
	とはいえ、チューナが正しく検知されているかどうか確認するべきです。
	&man.sysctl.8; による MIB の設定や、
	カーネルコンフィギュレーションファイルオプションで、
	検知されたいくつかのパラメータを変更できます。
	たとえば、チューナを Philips SECAM チューナとして検知されるようにするには、
	カーネルコンフィギュレーションファイルに以下の行を追加します。</para>

      <programlisting>options OVERRIDE_TUNER=6</programlisting>

      <para>または、直接 &man.sysctl.8; を使用して変更します。</para>

      <screen>&prompt.root; <userinput>sysctl hw.bt848.tuner=6</userinput></screen>

      <para>利用可能なオプションの詳細については &man.bktr.4;
	マニュアルページおよび <filename>/usr/src/sys/conf/NOTES</filename>
	ファイルを参照してください (&os;&nbsp;4.X を使用しているのなら、
	<filename>/usr/src/sys/conf/NOTES</filename> を
	<filename>/usr/src/sys/i386/conf/LINT</filename> に置き換えてください)。</para>
    </sect2>

    <sect2>
      <title>便利なアプリケーション</title>

      <para>TV カードを使用するためには、以下のアプリケーションの一つをインストールする必要があります。</para>

      <itemizedlist>
	<listitem>
	  <para><filename role="package">multimedia/fxtv</filename>
	    はウィンドウ内に TV 映像を映します。
	    画像/音声/ビデオを取り込むこともできます。</para>
	</listitem>
	<listitem>
	  <para><filename role="package">multimedia/xawtv</filename>
	    も TV アプリケーションです。
	    <application>fxtv</application> と同様の機能があります。</para>
	</listitem>
	<listitem>
	  <para><filename role="package">misc/alevt</filename>
	    は文字放送 (ビデオテキスト/テレテキスト) のデコードと表示をします。</para>
	</listitem>
	<listitem>
	  <para><filename role="package">audio/xmradio</filename>
	    は TV カードに搭載された FM ラジオチューナを使用するためのアプリケーションです。</para>
	</listitem>
	<listitem>
	  <para><filename role="package">audio/wmtune</filename>
	    はラジオチューナのためのお手軽なデスクトップアプリケーションです。</para>
	</listitem>
      </itemizedlist>

      <para>他にも多くのアプリケーションが &os; Ports Collection に収録されています。</para>
    </sect2>

    <sect2>
      <title>トラブルシューティング</title>

      <para>TV カードに関する問題が起きたときには、
	&man.bktr.4; ドライバが本当にビデオキャプチャチップおよびチューナに
	対応しているか、オプションが正しく設定されているかどうかをまず確認してください。
	TV カードに関するサポートやさまざまな質問に関しては、
	&a.multimedia.name; メーリングリストに参加したり、
	過去のアーカイブを検索してみてください。</para>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
