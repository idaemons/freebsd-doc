.\" Copyright (c) 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" Hugh Smith at The University of Guelph.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)ar.1	8.1 (Berkeley) 6/29/93
.\"	%Id: ar.1,v 1.5 1997/06/23 06:41:29 charnier Exp %
.\" jpman %Id: ar.1,v 1.2 1997/03/29 02:06:03 horikawa Stab %
.\"
.Dd June 29, 1993
.Dt AR 1
.Sh 名称
.Nm ar
.Nd ライブラリアーカイブの作成およびメンテナンス
.Sh 書式
.Nm ar
.Fl d
.Op Fl \Tv
.Ar archive file ...
.Nm ar
.Fl m
.Op Fl \Tv
.Ar archive file ...
.Nm ar
.Fl m
.Op Fl abiTv
.Ar position archive file ...
.Nm ar
.Fl p
.Op Fl \Tv
.Ar archive [file ...]
.Nm ar
.Fl q
.Op Fl cTv
.Ar archive file ...
.Nm ar
.Fl r
.Op Fl cuTv
.Ar archive file ...
.Nm ar
.Fl r
.Op Fl abciuTv
.Ar position archive file ...
.Nm ar
.Fl t
.Op Fl \Tv
.Ar archive [file ...]
.Nm ar
.Fl x
.Op Fl ouTv
.Ar archive [file ...]
.Sh 解説
The
.Nm ar
ユーティリティは、ファイルの集まりであるアーカイブファイルの作成、およ
びそのアーカイブの整備を行ないます。いったんアーカイブを作成した
後は、新しいファイルの追加、存在しているファイルの展開、削除、置き換えな
ども行なうことが可能です。
.Pp
ファイルはアーカイブ内では、一つの要素で名づけられます。
つまり、スラッシュ(``/'')を含むパスで参照されたファイルは
そのパスの最後の要素によって名づけられるのです。
コマンドラインに並べられたパスをアーカイブ内のファイル名と一致させる
ときには、パスの最後の要素のみが比較されます。
.Pp
すべての情報およびエラーメッセージは、コマンドラインにパスが
指定されていれば、それを利用します。指定されていなければ、
アーカイブ内の名前を利用します。もし、アーカイブ内で複数のファイルが
同じ名前で存在しており、ある操作を行うためにアーカイブ
ファイルを``選択''するようコマンドラインにパスを並べた場合は、
.Em 最初に
名前の一致したファイルのみが選択されます。
.Pp
.Nm ar
の通常の利用方法は、ローダ(
.Xr ld 1
を参照してください)に適したライブラリの作成および整備です。しかし、
この目的に限定されているのではありません。
オプションは以下の通りです:
.Bl -tag -width indent
.It Fl a
.Fl r
や
.Fl m
と共に用いられ、格納位置を修正します。
ファイルはアーカイブ内の要素である
.Ar position
の
.Em 後ろに
格納もしくは移動されます。
.Ar position
を指定する必要があります。
.It Fl b
.Fl r
や
.Fl m
と共に用いられ、格納位置を修正します。
ファイルはアーカイブ内の要素である
.Ar position
の
.Em 前に
格納もしくは移動されます。
.Ar position
を指定する必要があります。
.It Fl c
通常、アーカイブが作成されるときは、その動作状況についての
情報が、標準エラー出力に出力されます。
.Fl c
オプションが指定されると、
.Nm ar
はこの出力を行わなくなります。
.It Fl d
指定されたアーカイブファイルを削除します。
.It Fl i
.Fl b
オプションと同じです。
.It Fl m
指定されたアーカイブファイルをアーカイブ内に移動します。
.Fl a ,
.Fl b ,
.Fl i
のオプションの一つが指定された場合は、ファイルは
アーカイブ内のファイルである
.I position
の前後に移動されます。これらのオプションが指定されなかった場合には、
ファイルはアーカイブの最後に移動されます。
.It Fl o
展開されたファイルのアクセス時刻および修正時刻を、アーカイブに
格納された時点での修正時刻に合わせます。この操作は、ユーザが
そのファイルの所有者でもスーパユーザでもない場合には失敗します。
.It Fl p
指定されたアーカイブファイルの内容を標準出力に出力します。
ファイルが指定されなかった場合には、アーカイブ内のすべての
ファイルの内容が、アーカイブ内にある順番どおりに出力されます。
.It Fl q
指定されたファイルをアーカイブにすばやく追加します。アーカイブが
存在しない場合には、新たなアーカイブファイルが作成されます。
ファイルがアーカイブ内のファイルと重複していないかどうかを
調べないため、大きなアーカイブをすこしづつ作っている場合には
.Fl r
オプションより非常に高速です。
.It Fl r
指定されたファイルをアーカイブに追加、もしくは置換します。
アーカイブが存在しない場合には、新たなアーカイブファイルが
作成されます。すでにあるファイルを置換する場合にも、
アーカイブ内の順序は変化しません。
.Fl a ,
.Fl b ,
.Fl i
のいずれかの
オプションが指定されない限り、追加されるファイルは最後尾に
追加されます。
.It Fl T
アーカイブメンバを選択するとき、およびアーカイブメンバに
名前をつけるとき、アーカイブメンバ名やコマンドラインファイル名の
最初の15文字だけを利用するようにします。古いアーカイブ形式は
名前として16バイトの領域がありましたが、古いアーカイバや
ローダの中には、その領域すべてを使うような名前を扱えない実装の
ものもあったのです。これは、最初の15文字が等しいファイル名は
後で混同されるかもしれない、ということを意味しています。
もし、いずれかのファイル名が切り捨てられた場合には、標準エラー
出力に警告メッセージが出力されます。(さらに情報を得るには、
.Xr ar 5
を参照してください。)
.It Fl t
指定されたファイル名を、アーカイブ内に格納されている順で、
1行に1つずつ出力します。もしファイル名が指定されなかった場合には、
アーカイブ内のすべてのファイル名が出力されます。
.It Fl u
ファイルを更新します。
.Fl r
オプションと共に指定された場合には、
アーカイブ内のファイルの修正時刻よりもディスクのファイルの
修正時刻のほうが新しい場合のみ、アーカイブファイルが
置き換えられます。
.Fl x
オプションと共に指定された場合には、
ディスクのファイルの修正時刻よりもアーカイブ内のファイルの
修正時刻の方が新しい場合のみ、アーカイブファイルが展開されます。
.It Fl v
動作状況を詳しく出力します。
.Fl d ,
.Fl m ,
.Fl q ,
.Xl x
オプションと共に
指定された場合には、
.Nm ar
はアーカイブの変更について、ファイル
ごとに報告します。この情報は、空白で区切られた3つの
フィールド、すなわちオプション名、ダッシュ(``-'') 、
ファイル名から構成されています。
.Fl r
オプションと共に使われた
場合には、
.Nm ar
は上と同様の出力を行いますが、最初の文字は
ファイルがアーカイブに追加された場合は ``a''、アーカイブ内に
既にあるファイルを置き換えた場合には ``r'' となります。
.Pp
.Fl p
オプションと共に指定された場合には、
表示されるファイルそれぞれについて、
改行 1 つ、
``<'' と ``>'' に括られたファイルの名前、
改行 2 つ、
ファイルの内容の順で出力されます。
.Pp
.Fl t
オプションと共に指定された場合には、
.Nm ar
は ``ls -l'' の形式で
アーカイブのメンバについての情報を出力します。この情報は、
空白で区切られた8つのフィールド、すなわち、ファイルの
パーミッション(
.Xr strmode 3
を参照してください)、一つの
スラッシュ(``/'')で区切られた、10進数表現のユーザIDと
グループID、ファイルの大きさ(バイト単位)、ファイルの
修正時刻(
.Xr date 1
の``%b %e %H:%M %Y''形式)、ファイル名
から構成されています。
.It Fl x
指定されたアーカイブのメンバを、コマンドライン引数で
指定されたファイルに展開します。メンバが指定されなかった
場合には、アーカイブ内のすべてのメンバが現在のディレクトリに
展開されます。
.Pp
ファイルが存在しなかった場合には、作成されます。存在していた
場合には、所有者およびグループは変更されません。ファイルの
アクセス時刻および修正時刻は、(
.Fl o
オプションの指定がない限り)
展開を行った時刻となります。ファイルのパーミッションは、
アーカイブ内に格納された時点のものに設定されます。この操作は、
ユーザがそのファイルの所有者でもスーパユーザでもない場合には
失敗します。
.El
.Pp
.Nm ar
ユーティリティは、成功の場合には0、エラーが起きた
場合には0より大きい値を返します。
.Sh 環境変数
.Bl -tag -width indent -compact
.It Ev TMPDIR
テンポラリファイルを作成する時に使用されるディレクトリのパス名
.El
.Sh 関連ファイル
.Bl -tag -width indent -compact
.It Pa /tmp
デフォルトのテンポラリディレクトリ
.It Pa ar.XXXXXX
テンポラリファイル名
.El
.Sh 互換性
デフォルトでは、
.Nm ar
は古いアーカイブと互換性のないアーカイブを
作成するかもしれません。というのも、15文字よりも長いファイル名を
持ったアーカイブメンバの格納に用いるファイル形式が変更されたためです。
現在の
.Nm ar
の実装では、(
.Fl T
オプションを用いることによって)古い
アーカイブ形式の読み書きができるように、以前の
.Nm ar
との下位互換性が
あります。
.Fl T
オプションは互換性のためだけに用意されており、
将来のリリースでは削除されるかもしれません。さらに情報を得るには、
.Xr ar 5
を見てください。
.Sh 規格
.Nm ar
ユーティリティは
.St -p1003.2
の機能のスーパセットを提供しているはずです。
.Sh 関連項目
.Xr ld 1 , 
.Xr ranlib 1 ,
.Xr strmode 3 ,
.Xr ar 5
