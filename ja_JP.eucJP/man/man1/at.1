.\" %Id: at.man,v 1.8.2.1 1999/02/15 08:46:19 fenner Exp %
.\" jpman %Id: at.1,v 1.3 1997/08/05 18:36:01 george Stab %
.Dd April 12, 1995
.Dt "AT" 1
.Os FreeBSD 2.1
.Sh 名称
.Nm at, batch, atq, atrm
.Nd あとでジョブを実行させるためのキューの設定、確認、ジョブの削除をおこなう
.Sh 書式
.Nm at
.Op Fl V 
.Op Fl q Ar queue
.Op Fl f Ar file
.Op Fl mldbv
.Ar time
.Pp
.Nm at
.Op Fl V
.Fl c Ar job Op Ar job ...
.Pp
.Nm atq
.Op Fl V 
.Op Fl q Ar queue
.Op Fl v
.Pp
.Nm atrm
.Op Fl V 
.Ar job
.Op Ar job ...
.Pp
.Nm batch
.Op Fl V 
.Op Fl q Ar queue
.Op Fl f Ar file
.Op Fl mv
.Op Ar time
.Sh 解説
.Nm at
と
.Nm batch
ユーティリティは、標準入力もしくは指定したファイルからコマンドを読み
込み、あとで
.Xr sh 1
を使って実行します。
.Pp
コマンドの各機能を以下に示します:
.Bl -tag -width indent
.It Nm at
コマンドを、引数で指定した時間に実行します。
.It Nm atq
ユーザの、実行待ち状態のジョブのリストを表示します。
スーパーユーザが実行した場合は全員のジョブが表示されます。
.It Nm atrm
指定したジョブを削除します。
.It Nm batch
ロードアベレージが特定の値以下になったときにジョブを実行
します。この値は、デフォルトでは 1.5 です。
この値は
.Nm atrun
によって指定可能です。
.El
.Pp
.Nm at
では、様々な形式の時間を
.Ar time
として受け付けます。
時刻は
.Ar HHMM
もしくは
.Ar HH:MM
の形で指定します
(もしこの時刻が過ぎていた場合は、次の日のその時刻に設定されます)。また、
.Nm midnight ,
.Nm noon ,
.Nm teatime
(4pm) も受け付けますし、時刻の後ろに
.Nm am
もしくは
.Nm pm
をつけた時間も受け付けます。日付は、 
.Ar \%month-name day
およびオプションの 
.Ar year
の形で受け付けます。
.Ar MMDDYY
、
.Ar MM/DD/YY
、
.Ar DD.MM.YY
も受け付けます。
日付の指定は時刻の指定の後に記述します。
.Op Nm now
.Nm  + Ar count \%time-units
のような形式で時間を指定することも可能です。time-units は時間の単位で、
.Nm minutes ,
.Nm hours ,
.Nm days ,
.Nm weeks
のいずれかです。時間のサフィックスの
.Nm today
はジョブを今日に設定すること、
.Nm tommorow
はジョブを明日に設定することを意味します。
たとえば、今から 3 日後の午後 4 時にジョブを走らせるためには
.Nm 4PM + 3 days
と指定します。7 月 31 日の午前 10 時の場合は
.Nm 10am Jul 31
と指定します。明日の午前 1 時は 
.Nm 1am tomorrow
です。
.Pp
.Nm at
と
.Nm batch
では、標準入力または
.Fl f
オプションで指定したファイルからコマンドを読み込み、実行します。
ワーキングディレクトリと環境変数 (
.Ev TERM ,
.Ev TERMCAP ,
.Ev DISPLAY
および
.Nm _
は除く)、umask は実行時のものが保持されます。
.Nm at
もしくは
.Nm batch
が
.Xr su 1
で起動されたシェルから実行された場合は、カレントの userid を保持します。
出力結果が得られた場合は、
その標準出力と標準エラー出力がメールで送られます。メールは
.Xr sendmail 8
を使って送られます。もし
.Nm at
が
.Xr su 1
で起動されたシェルから実行された場合は、そのログインシェルの所有者が
メールを受けることになります。
.Pp
スーパユーザはどんな場合でもこれらのコマンドを実行できます。
その他のユーザは
.Pa /var/at/at.allow
と
.Pa /var/at/at.deny
のファイルによって実行できるか決められます。
.Pp
もし
.Pa /var/at/at.allow
が存在するならば、その中にユーザ名を記述されたユーザだけが
.Nm at
の実行を許可されます。
.Pp
もし
.Pa /var/at/at.allow
が存在しなかったら、
.Pa /var/at/at.deny
がチェックされ、その中にユーザ名が記述されていないすべてのユーザが
.Nm at
の実行を許可されます。
.Pp
もし両方ともなければ、スーパーユーザだけが
.Nm at
を実行できます。
これがデフォルトの設定です。
.Pp
空の
.Pa /var/at/at.deny
は全てのユーザがこれらのコマンドを使用できることを意味します。
.Sh オプション
オプションとしては以下のものがあります:
.Bl -tag -width indent
.It Fl V
標準エラー出力にバージョン番号を出力します。
.It Fl q Ar queue
指定したキューを用います。キューの名称は単一の文字からなります。
有効なキューの名前は
.Nm a
から
.Nm z
と
.Nm A
から
.Nm Z
です。
.Nm at
のデフォルトのキューは
.Nm c
で、
.Nm batch
のデフォルトのキューは
.Nm E
です。
キューの文字が後の方であればあるほど nice 値が上がります。
もし大文字のキューがジョブに対して指定されたならば、時間を指定して
batch が実行されたものとして扱われます。
もし
.Nm atq
でキューが指定されたときは、そのキューだけの実行待ちのジョブを表示します。
.It Fl m
出力がなかった場合でも、ジョブの完了時にメールをユーザに送ります。
.It Fl f Ar file
標準入力のかわりにファイルからジョブを読み込みます。
.It Fl l
.Nm atq
のエイリアス。
.It Fl d
.Nm atrm
のエイリアス。
.It Fl b
.Nm batch
のエイリアス。
.It Fl v
atq の場合は、キューの中の実行されたがまだ削除されていないジョブを
表示します。さもなければジョブが実行される時間を表示します。
.It Fl c
コマンドラインにリストされたジョブを標準出力に出力します。
.Sh 関連ファイル
.Bl -tag -width /var/at/jobs/.lockfile -compact
.It Pa /var/at/jobs
ジョブファイルを保管しておくディレクトリ
.It Pa /var/at/spool
出力ファイルを保管しておくディレクトリ
.It Pa /var/run/utmp
ログインレコード
.It Pa /var/at/at.allow
許可属性の設定
.It Pa /var/at/at.deny
不許可属性の設定
.It Pa /var/at/jobs/.lockfile
ジョブ作成のロックファイル
.El
.Sh 関連項目
.Xr cron 8 ,
.Xr nice 1 ,
.Xr umask 2 ,
.Xr sh 1 ,
.Xr sendmail 8 ,
.Xr atrun 8
.Sh バグ
.Pa /var/run/utmp
が利用できないか不正であった場合、もしくは
.Nm at
が実行された時にユーザがログインしていない場合、
メールは環境変数
.Nm LOGNAME
で表される userid に出されます。
もし定義されていないか空ならばカレントの userid になります。
.Pp
ユーザ同士でリソースの競合がある場合は現実装の
.Nm at
と
.Nm batch
は適当ではありません。
もしあなたのサイトがこのような場合にあてはまるのなら、
.Nm nqs
のようなバッチシステムを検討してください。
.Sh 作者
at のほとんどの部分は
.An Thomas Koenig Aq ig25@rz.uni-karlsruhe.de
によって作成されました。
時間の構文解析部分は
.An David Parsons Aq orc@pell.chi.il.us
によって作成されました。
