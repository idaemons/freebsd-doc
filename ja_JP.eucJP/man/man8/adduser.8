.\" Copyright (c) 1995-1996 Wolfram Schneider <wosch@FreeBSD.org>. Berlin.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" %FreeBSD: src/usr.sbin/adduser/adduser.8,v 1.30.2.8 2002/02/01 15:51:19 ru Exp %
.\" $FreeBSD$
.\"
.Dd January 9, 1995
.Dt ADDUSER 8
.Os
.Sh 名称
.Nm adduser
.Nd 新しいユーザを加えるためのコマンド
.Sh 書式
.Nm
.Bk -words
.Op Fl check_only
.Op Fl class Ar login_class
.Op Fl config_create
.Op Fl dotdir Ar dotdir
.Op Fl group Ar login_group
.Op Fl h | help
.Op Fl home Ar home
.Op Fl message Ar message_file
.Op Fl noconfig
.Op Fl shell Ar shell
.Op Fl s | silent | q | quiet
.Op Fl uid Ar uid_start
.Op Fl v | verbose
.Ek
.Sh 解説
.Nm
は新しいユーザを加えるための簡単なプログラムです。
.Nm
はパスワード, グループ, シェル等のデータベースをチェックし、
passwd/group の登録を行い、
.Ev HOME
ディレクトリとドットファイルを作成し、
新しいユーザに歓迎メッセージを送ります。
.Sh 制限事項
.Bl -tag -width Ds -compact
.It Sy username
ログイン名です。
英小文字と数字のみ使用可能です。
長さは 16 文字までです (
.Xr setlogin 2
のバグの章を参照してください)。この制限の理由は、 ``歴史的な'' 物です。
美的な理由からこの制限を破りたいとする人々はいつもいましたが、
UNIX における基本的なパラメータを変更するほどの重要な理由ではありま
せんでした。
.Pa /usr/include/utmp.h
ファイル内の
.Dv UT_NAMESIZE
パラメータを変更し、全てを再コンパイルすることで、変更できますが、
コンパイル済みのプログラムや名前の 8 文字制限を前提としたソースコード、
そして NIS については、問題が起こるでしょう。 NIS のプロトコルは、
ユーザ名を 8 文字と定めています。電子メールアドレスとして、もっと長い
ログイン名を必要とする場合には、別名を
.Pa /etc/mail/aliases
ファイルに定義することができます。
.It Sy fullname
名と姓です。
.Ql Pa \&:
(コロン) は、使えません。
.It Sy shell
シェルデータベースに定義されている有効なシェル、もしくは、sliplogin
と pppd だけが有効です。
.It Sy uid
自動生成されますが、自分で指定することもできます。ただし、32000 よ
りも小さい数字でなければなりません。
.It Sy gid/login group
あなたが指定したものです。さもなければ、自動的に生成されます。
.It Sy password
定義した時には、パスワードは
.Xr crypt 3
を利用して暗号化されます。
.El
.Sh 一意なグループ
ひょっとして、あなたは、この方法ではできても他のほとんどの方法ではう
まく行かないことがあるのを見逃しているかもしれません。個々のユーザを
そのユーザ独自のグループに入れることで、 umask を 002 としておいても
安全になり、ホームディレクトリにファイルを作っても、他の人にファイル
を読まれる心配がなくなります。
.Pp
共有場所を作るためには、 (freefall における cvs や ncvs のように)
uid/gid を別に設けて、ユーザを個別にその新しいグループに入れることで、
その場所へのアクセスを可能とすべきです。
.Pp
この uid/gid の管理モデルは、たくさんのユーザをグループにまとめるよ
り柔軟性があり、共有場所で仕事をする時に umask をいじり回さずにすみ
ます。
.Pp
この方法をほぼ 10 年間使っていますが、ほとんどの場合に使えることがわ
かり、じゃまになったことはありませんでした。 (Rod Grimes)
.Sh 設定
.Bl -enum
.It
内部変数を読込みます。
.It
設定ファイル (/etc/adduser.conf) を読込みます。
.It
コマンドラインオプションを解析します。
.El
.Sh オプション
.Bl -tag -width Ds
.It Fl check_only
/etc/passwd, /etc/group, /etc/shells をチェックし、終了します。
.It Fl class Ar login_class
デフォルトのログインクラスを設定します。
.It Fl config_create
新しい設定を設定ファイルに書込み、メッセージファイルを作成して、
終了します。
.It Fl dotdir Ar directory
ファイルを
.Ar directory
から、新しいユーザの
.Ev HOME
ディレクトリへコピーします。
.Ql Pa dot.foo
というファイルは、
.Ql Pa .foo
という名前に変更されます。
.Ar directory
として
.Ar no
が指定された場合には、コピーを行いません。セキュリティ的な理由から全
てのファイルは所有者に対して読み書き可能となり、グループや他の人達に
対しては書込み可能にはなりません。また、以下のファイルは、所有者に
対してのみ読み書き実行可能となります。
.Pa .rhost ,
.Pa .Xauthority ,
.Pa .kermrc ,
.Pa .netrc ,
.Pa Mail ,
.Pa prv ,
.Pa iscreen ,
.Pa term
.It Fl group Ar login_group
ログイングループの指定です。
.Ar USER
はユーザ名がログイングループとして使用されることを意味します。
.It Fl help , h , \&?
オプションの要約を表示して、終了します。
.It Fl home Ar partition
全てのユーザがホームディレクトリを持つデフォルトのディレクトリ (home
partition) を指定します。
.It Fl message Ar file
新しいユーザに
.Ar file
の歓迎メッセージを送ります。
.Ar file
が
.Ar no
であった時にはメッセージは送りません。
.It Fl noconfig
デフォルトの設定ファイルを読みません。
.It Fl shell Ar shell
新しいユーザに対するデフォルトのシェルを指定します。
.It Fl silent , s , quiet , q
警告や質問、バグの報告を少ししか行いません。
.It Fl uid Ar uid
ユーザ id を
.Ar uid
かそれ以上にします。
.It Fl verbose , v
警告と質問をたくさん行います。初心者ユーザにはおすすめです。
.El
.Sh フォーマット
.Bl -tag -width Ds -compact
.Ql Pa #
はコメントです。
.It Sy 設定ファイル
.Nm
はこのファイルを読み書きします。
より詳しくは、
.Pa /etc/adduser.conf
を見てください。
.It Sy メッセージファイル
このファイル内では変数は評価されます。
より詳しくは、
.Pa /etc/adduser.message
を見てください。
.El
.Sh 関連ファイル
.Bl -tag -width /etc/master.passwdxx -compact
.It Pa /etc/master.passwd
ユーザのデータベース
.It Pa /etc/group
グループのデータベース
.It Pa /etc/shells
シェルデータベース
.It Pa /etc/login.conf
ログインクラスデータベース
.It Pa /etc/adduser.conf
adduser 用の設定ファイル
.It Pa /etc/adduser.message
adduser 用のメッセージファイル
.It Pa /usr/share/skel
ログインディレクトリの雛型
.It Pa /var/log/adduser
adduser の ログ記録ファイル
.El
.Sh 関連項目
.Xr chpass 1 ,
.Xr finger 1 ,
.Xr passwd 1 ,
.Xr setlogin 2 ,
.Xr aliases 5 ,
.Xr group 5 ,
.Xr login.conf 5 ,
.Xr passwd 5 ,
.Xr shells 5 ,
.Xr pw 8 ,
.Xr pwd_mkdb 8 ,
.Xr rmuser 8 ,
.Xr vipw 8 ,
.Xr yp 8
.\" .Sh バグ
.Sh 歴史
.Nm
コマンドは
.Fx 2.1
から導入されました．
