.\" Copyright (c) 1983, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)connect.2	8.1 (Berkeley) 6/4/93
.\"
.Dd June 4, 1993
.Dt CONNECT 2
.Os BSD 4.2
.Sh 名称
.Nm connect
.Nd ソケット上で接続を開始する
.Sh 書式
.Fd #include <sys/types.h>
.Fd #include <sys/socket.h>
.Ft int
.Fn connect "int s" "const struct sockaddr *name" "int namelen"
.Sh 解説
パラメータ
.Fa s
はソケットです。これのタイプが
.Dv SOCK_DGRAM
の場合、この呼び出しは、ソケットが対応付けられる
通信相手を指定します。このアドレスはデータグラムが送信される宛先であり、
データグラムが受信される元となる
唯一のアドレスです。ソケットのタイプが
.Dv SOCK_STREAM
の場合、この呼び出しは別のソケットに接続を作成
しようとします。他のソケットは
.Fa name
で指定されます。
.Fa name
はソケットの通信空間内のアドレスです。各通信空間は
.Fa name
パラメータを独自の方法で解釈します。一般に、ストリームソケットが正常に
.Fn connect
できるのは
1 回だけです。データグラムソケットは
.Fn connect
を複数回使用してその対応を変更できます。データグラム
ソケットは、NULL アドレスのような無効なアドレスに接続することによって
対応付けを解除する可能性があります。
.Sh システムの注意事項
.Pp
非スレッドライブラリでは、
.Fn connect
は
.Va connect
システムコールとして実装されています。
.Pp
スレッドライブラリでは、
.Va connect
システムコールは
.Fn _thread_sys_connect
にアセンブルされ、
.Fn connect
は、読取りと書込みについて
.Va s
をロックしてから
.Fn _thread_sys_connect
を呼び出す関数として実装されています。
.Fn _thread_sys_connect
の呼び出しがブロックする場合、コンテキストスイッチが
実行されます。戻る前に
.Fn connect
は
.Va s
をアンロックします。
.Sh 戻り値
接続またはバインドが正常に完了すると 0 が返されます。
そうでない場合は -1 が返され、エラーを示すためにグローバル変数
.Va errno
が設定されます。
.Sh エラー
.Fn connect
は次の場合に失敗します。
.Bl -tag -width EADDRNOTAVAILABB
.It Bq Er EBADF
.Fa s
が有効な記述子でありません。
.It Bq Er ENOTSOCK
.Fa s
がソケットではなくファイルの記述子です。
.It Bq Er EADDRNOTAVAIL
指定のアドレスがこのマシンでは利用できません。
.It Bq Er EAFNOSUPPORT
指定のアドレスファミリ内のアドレスがこのソケットでは使用できません。
.It Bq Er EISCONN
ソケットは既に接続されています。
.It Bq Er ETIMEDOUT
接続を確立せずに、接続確立が時間切れになりました。
.It Bq Er ECONNREFUSED
接続しようとする試みが強制的に拒絶されました。
.It Bq Er ENETUNREACH
このホストからネットワークにホストから到達できません。
.It Bq Er EADDRINUSE
アドレスが既に使用中です。
.It Bq Er EFAULT
.Fa name
パラメータはプロセスアドレス空間の外側の領域を指定しています。
.It Bq Er EINPROGRESS
ソケットは非ブロッキングであり、コネクションがただちに完了できません。
書込み用にソケットを選択することによって、完了用に
.Xr select 2
を選択できます。
.It Bq Er EALREADY
ソケットはノンブロッキングであり、
以前のコネクションの試みがまだ完了していません。
.El
.Pp
以降のエラーは、UNIX ドメイン内の接続名に固有です。
これらのエラーは、UNIX IPC ドメインの将来の
バージョンには適用されない可能性があります。
.Bl -tag -width EADDRNOTAVAILABB
.It Bq Er ENOTDIR
パスの構成要素中にディレクトリ以外のものが含まれています。
.It Bq Er ENAMETOOLONG
パス名の構成要素が 255 文字を越えているか、
またはパス名全体が 1023 文字を越えています。
.It Bq Er ENOENT
指定のソケットが存在しません。
.It Bq Er EACCES
前置パス名の構成要素について検索許可が拒否されています。
.It Bq Er EACCES
指定のソケットへの書込みアクセスが拒絶されています。
.It Bq Er ELOOP
パス名を変換するときに検出されたシンボリックリンクが多すぎます。
.El
.Sh 関連項目
.Xr accept 2 ,
.Xr getpeername 2 ,
.Xr getsockname 2 ,
.Xr select 2 ,
.Xr socket 2
.Sh 歴史
.Fn connect
関数は
.Bx 4.2
で登場しました。
