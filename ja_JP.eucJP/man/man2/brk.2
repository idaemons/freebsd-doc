.\" Copyright (c) 1980, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)brk.2	8.4 (Berkeley) 5/1/95
.\"
.Dd May 1, 1995
.Dt BRK 2
.Os BSD 4
.Sh 名称
.Nm brk ,
.Nm sbrk
.Nd データセグメントのサイズを変更する
.Sh 書式
.Fd #include <unistd.h>
.Ft char *
.Fn brk "const char *addr"
.Ft char *
.Fn sbrk "int incr"
.Sh 解説
.Bf -symbolic
brk 関数と sbrk 関数は、仮想メモリ管理の到来の前の初期の日々から残された
歴史的に興味あるものです。
.Ef
.Fn brk
関数は、プロセスのデータセグメント (初期化されていないデータ) のブレーク
または最下位アドレスを
.Fa addr
(bss の真上) に設定します。データアドレス指定は、
.Fa addr
とスタックセグメントへの最も低いスタックポインタの間に制約されます。
メモリはページサイズ単位で
.Fa brk
によって割当てされます。
.Fa addr
は、システムページサイズ上に均等に分割されない場合には
次のページ境界まで増加させます。
.Pp
プログラムブレークの現在の値は、
.Dq Li sbrk(0)
によって信頼性をもって返されます
.Pf ( Xr end 3
も参照)。
.Xr getrlimit 2
システムコールは、
.Em data
セグメントの許容できる最大のサイズを決定するのに利用できます。
.Xr getrlimit 2
の呼び出しから返された
.Em rlim_max
値を越えるブレークを設定することはできません。たとえば、
.Dq etext + rlp\(->rlim_max
です
.Pf ( Em etext
の定義については
.Xr end 3
を参照してください)。
.Sh 戻り値
.Fn brk
は、正常に完了すると 0 を返します。それ以外の場合は値 -1 を返し、
割当てが処理失敗した理由を示す
.Va errno
が設定されます。
.Fn sbrk
関数は、正常に完了すると新しい記憶域のベースを指すポインタを
返します。それ以外の場合は値 -1 を返し、割当てが処理失敗した理由を示す
.Va errno
が設定されます。
.Sh エラー
.Fn brk
または
.Fn sbrk
は、以降のうちの 1 つが真の場合に処理に失敗し、新しくメモリを
割当てられません。
.Bl -tag -width [ENOMEM]
.It Bq Er ENOMEM
.Xr setrlimit 2
が設定した限界を越えました。
.It Bq Er ENOMEM
データセグメントの可能な最大サイズ (システム内部にコンパイルされます)
を越えました。
.It Bq Er ENOMEM
展開をサポートするスワップ領域内に不充分な空間が存在しました。
.El
.Sh 関連項目
.Xr execve 2 ,
.Xr getrlimit 2 ,
.Xr end 3 ,
.Xr malloc 3
.Sh バグ
ブレークの設定は、スワップ空間の一次的な不足のために処理が失敗する
可能性があります。これは
.Xr getrlimit 2
を使用せずには、データセグメントの最大サイズを越えることで起こされた
障害と区別することはできません。
.Sh 歴史
.Fn brk
関数は
.At v7
で登場しました。
