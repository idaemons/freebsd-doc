<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % man PUBLIC "-//FreeBSD//ENTITIES DocBook Manual Page Entities//EN">
%man;
<!ENTITY % authors PUBLIC "-//FreeBSD//ENTITIES DocBook Author Entities//EN">
%authors;
<!ENTITY % not.published "IGNORE">
]>

<article>
  <articleinfo>
    <title>Mirroring FreeBSD</title>
    <pubdate>$FreeBSD$</pubdate>
    <authorgroup>
      <author>
        <firstname>Jun</firstname>
        <surname>Kuriyama</surname>
        <affiliation>
          <address><email>kuriyama@FreeBSD.org</email></address>
        </affiliation>
      </author>
      <author>
        <firstname>Valentino</firstname>  
        <surname>Vaschetto</surname>
        <affiliation>
          <address><email>logo@FreeBSD.org</email></address>                             
        </affiliation>
      </author>
    </authorgroup>
    <abstract>
      <para>An in-progress article on how to mirror FreeBSD, aimed at
        hub administrators</para>
    </abstract>
  </articleinfo>

  <sect1 id="mirror-howtomirror">
    <title>How to mirror FreeBSD</title>
    <sect2 id="mirror-ftp">
      <title>FTP</title>
      <para>At this time (just before 4.5-RELEASE), full mirror
        requires 65GB disk space. For safety, 70-80GB will be
        required</para>
      <para>An anonymous ftp mirror requires network bandwidth.
        It is not encouraged if your site does not have enough
        spare bandwidth</para>
      <itemizedlist>
        <listitem>
          <para>Choose favorite ftp mirror tool (such as
          <port>ftp/mirror</port>, <port>ftp/ftpmirror</port>
          , <port>ftp/spegla</port> and so on.)</para>
        </listitem>
        <listitem>
          <para>Select upstream. First candidate is your
          local mirror (ftpX.XX.FreeBSD.org). If there is no
          official mirror in your country, use ftpX.FreeBSD.org
          instead. (X stands for a number, and XX stands for
          your local country code)</para>
        </listitem>
        <listitem>
          <para>Setting up your mirror configuration.</para>
        </listitem>
      </itemizedlist>
    </sect2>
    <sect2 id="mirror-cvsup">
      <title>CVSup</title>
      <para>At this time (01/29/2002), full CVSup mirror requires
        3GB disk space. For safety, 4-5GB will be required.</para>
      <para>Public CVSup mirror requires high disk activity. It
        is encouraged to use RAID-0 or RAID-5.</para>
      <para>You can setting up CVSup mirror configuration by
        <port>net/cvsup-mirror</port> port.</para>
      <para>Upstream selection is same as ftp. First candidate is
        your local CVSup mirror (ftp?.??.FreeBSD.org). Next is
        ftp?.FreeBSD.org.</para>
    </sect2>
    <sect2 id="mirror-www">
      <title>WWW</title>
      <para>At this time (01/29/2002), full www mirror requires
        150MB disk space. For safety, 200MB will be required</para>
    </sect2>
  </sect1>

  <sect1 id="mirror-becomingofficial">
    <title>How to become an official FreeBSD mirror site</title>
    <para>Official mirrors may get access to <emphasis>master
      </emphasis>sites:</para>
    <itemizedlist>
      <listitem>
        <para>ftp-master.FreeBSD.org: <email>peter@FreeBSD.org</email></para>
      </listitem>
      <listitem>
        <para>cvsup-master.FreeBSD.org: <email>jdp@FreeBSD.org</email></para>
      </listitem>
    </itemizedlist>
    <sect2 id="mirror-ftpmaster">
      <title>About ftp-master.FreeBSD.org</title>
      <para>ftp-master.FreeBSD.org provides rsync and CVSup
        access rather in addition to ftp protocol.</para>
      <para>Mirrors should be encouraged to also allow rsync
        access for the FTP contents, especially Tier-1 mirrors.</para>
    </sect2>
    <sect2 id="mirror-officialcvsup">
      <title>CVSup</title>
      <sect3 id="mirror-cvsupmaster">
        <title>About cvsup-master.FreeBSD.org</title>
        <para>Sample supfile for cvsup-master:</para>
        <programlisting>*default host=cvsup-master.FreeBSD.org
*default base=/ftp-master
*default prefix=/ftp-master/pub
*default delete use-rel-suffix

FreeBSD-archive         release=all preserve</programlisting>
      </sect3>
      <sect3 id="mirror-cvsuprocedure">
        <title>Procedure</title>
        <para><emphasis>By <email>jdp@FreeBSD.org</email></emphasis>.</para>
        <itemizedlist>
          <listitem>
            <para>Make sure your country really needs another mirror.
              If it already has three or more, ask
              <email>freebsd-hubs@FreeBSD.org</email> first.</para>
          </listitem>
          <listitem>
            <para>Read the
              <ulink url="http://people.freebsd.org/~jdp/cvsup-access/">
              FreeBSD CVSup Access Policy</ulink></para>
          </listitem>
          <listitem>
            <para><ulink url="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/eresources.html#ERESOURCES-MAIL">
              Subscribe to freebsd-hubs@freebsd.org</ulink></para>
          </listitem>
          <listitem>
            <para>Install CVSup using the <port>net/cvsup</port> port
              or package. You may prefer to use the package, because it
              eliminates the need to download and build the large PM3
              ports. You can find the latest package <ulink
              url="http://people.freebsd.org/~jdp/s1g/i386-nogui/cvsup-16.1e.tgz">
              here.</ulink></para>
          </listitem>
          <listitem>
            <para>Set up the required authentication by following <ulink
              url="http://people.freebsd.org/~jdp/cvpasswd/">these
              instructions</ulink>. Make sure you specify the server as
              <hostid>freefall.freebsd.org</hostid> on the cvpasswd
              command line.</para>
          </listitem>
          <listitem>
            <para>Install the <port>net/cvsup-mirror</port> port. Specify
              the master site as <hostid>cvsup-master.freebsd.org</hostid>
              when it asks you.</para>
          </listitem>
          <listitem>
            <para>Once you are sure your mirror site is working OK, ask the DNS
              administrator of the <hostid>xx.freebsd.org</hostid> zone (where
              "xx" is your country) to add a CNAME <hostid>cvsupN.xx.freebsd.org
              </hostid> pointing to your mirror</para>
          </listitem>
          <listitem>
            <para>Ask <email>freebsd-doc@freebsd.org</email>, or 
              <email>freebsd-hubs@freebsd.org</email> to add your mirror site to
              the <ulink url="http://www.freebsd.org/handbook">FreeBSD
              Handbook</ulink>. Make sure you tell them the email address
              to list as the maintainer of the site</para>
          </listitem>
          <listitem>
            <para>To get better performance and lower system loads during updates
              from the master site, edit <filename>/etc/crontab</filename> and add
              the option "-s" at the end of the command
              <filename>/usr/local/etc/cvsup/update.sh</filename>. Make sure your
              mirror is working well before you do this.</para>
          </listitem>
        </itemizedlist>
            
      </sect3>
    </sect2>

          
  </sect1>
  <sect1 id="mirror-statpages">
    <title>Stat links</title>
    <para>Here are links to the stat pages of your favorite mirrors
      (a.k.a. the only ones who feel like providing stats).</para>
    <sect2 id="mirror-statpagesftp">
      <title>FTP site stats</title>
      <itemizedlist>
        <listitem>
          <para>ftp2.FreeBSD.org - <email>grisha@ispol.com</email> -
            <ulink url="http://people.freebsd.org/~logo/ftp2/">(Bandwidth)</ulink></para>
        </listitem>
        <listitem>
          <para>ftp.is.FreeBSD.org - <email>oli@isnic.is</email> - 
            <ulink url="http://www.rhnet.is/status/draupnir/draupnir.html">
            (Bandwidth)</ulink> <ulink url="http://www.rhnet.is/status/ftp/ftp-notendur.html">(FTP
            processes)</ulink> <ulink url="http://www.rhnet.is/status/ftp/http-notendur.html">(HTTP processes)
            </ulink></para>
        </listitem>
        <listitem>
          <para>ftp.cz.FreeBSD.org - <email>cejkar@fit.vutbr.cz</email> -
            <ulink url="http://www.cz.FreeBSD.org/stats/mrtg/net.html">(Bandwidth)</ulink>
            <ulink url="http://www.freebsd.cz/stats/mrtg/ftpd.html">(FTP processes)</ulink>
            <ulink url="http://www.freebsd.cz/stats/mrtg/rsyncd.html">(Rsync processes)</ulink></para>
        </listitem>

      </itemizedlist>
    </sect2>
    <sect2 id="mirror-statpagescvsup">
      <title>CVSup site stats</title>
      <itemizedlist>
        <listitem>
          <para>cvsup5.FreeBSD.org - <email>logo@FreeBSD.org</email> - <ulink
            url="http://blitzkrieg.blackened.com/~logo/cvsup5/cvsup5.html">(CVSup processes)</ulink></para>
        <listitem>
          <para>cvsup[23456].jp.FreeBSD.org - <email>kuriyama@FreeBSD.org</email> - <ulink
            url="http://home.jp.freebsd.org/stats/mrtg/cvsup/">(CVSup processes)</ulink></para>
        </listitem>
        <listitem>
          <para>cvsup.cz.FreeBSD.org - <email>cejkar@fit.vutbr.cz</email> -
            <ulink url="http://www.freebsd.cz/stats/mrtg/cvsupd.html">(CVSup processes)</ulink></para>
        </listitem>

      </itemizedlist>
    </sect2>
  </sect1>
  <sect1 id="mirror-otherinfo">
    <title>Other important information</title>
    <para>It is <emphasis>very</emphasis> important for a hub administrator, especially
      Tier-1 hub admins, to check the <ulink
      url="http://www.freebsd.org/releases/4.6R/schedule.html">release schedule</ulink> for the next
      FreeBSD release. This is important because it will tell you when the next release is scheduled
      to come out, and thus giving you time to prepare for the big spike of traffic which follows it.</para>
    <para>It is also eminent that hub administrators try to keep their mirrors as up-to-date as
      possible (again, even more crucial for Tier-1 mirrors). If Mirror1 doesn't update for a
      while, lower tier mirrors will begin to mirror old data from Mirror1 and thus begins
      a downward spiral... Keep your mirrors up to date!</para>
  </sect1>
</article>

<!-- 
     Local Variables:
     mode: sgml
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     End:
-->
