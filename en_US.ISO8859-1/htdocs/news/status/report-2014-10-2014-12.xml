<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE report PUBLIC "-//FreeBSD//DTD FreeBSD XML Database for
  Status Report//EN"
  "http://www.FreeBSD.org/XML/share/xml/statusreport.dtd" >

<!-- $FreeBSD$ -->

<report>
  <date>
    <month>October-December</month>

    <year>2014</year>
  </date>

  <section>
    <title>Introduction</title>

<!-- <?ignore -->
    <p><strong>This is a draft of the October&ndash;December 2014 status
	report.	 Please check back after it is finalized, and an
	announcement email is sent to the &os;-Announce mailing
	list.</strong></p>
<!-- ?> -->

    <p>This report covers &os;-related projects between October and
      December 2014.  This is the last of four reports planned for
      2014.</p>

    <p>The fourth quarter of 2014... was a very busy and productive
      time</p>

    <p>Thanks to all the reporters for the excellent work!</p>

    <p>The deadline for submissions covering the period from January
      to March 2015 is April 7th, 2015.</p>
  </section>

  <category>
    <name>team</name>

    <description>&os; Team Reports</description>
  </category>

  <category>
    <name>proj</name>

    <description>Projects</description>
  </category>

  <category>
    <name>kern</name>

    <description>Kernel</description>
  </category>

  <category>
    <name>arch</name>

    <description>Architectures</description>
  </category>

  <category>
    <name>bin</name>

    <description>Userland Programs</description>
  </category>

  <category>
    <name>ports</name>

    <description>Ports</description>
  </category>

  <category>
    <name>doc</name>

    <description>Documentation</description>
  </category>

  <category>
    <name>misc</name>

    <description>Miscellaneous</description>
  </category>

  <project cat='misc'>
    <title>&os; Forum Software Migration</title>

    <contact>
      <person>
	<name>&os; Forums Administration Team</name>
	<email>forum-admins@</email>
      </person>
    </contact>

    <body>
      <p>With funding from the &os; Foundation, the &os; forums
	were migrated to XenForo software.  The new software is far more
	capable and easy to use.  While the entire forum team
	contributed, &a.danger; did a particularly excellent job
	importing existing users and messages and bringing back the
	often-requested "Thanks" feature.  The upgrade was completed in
	time to be ready for the influx of new users from the release of
	&os; 10.1, and we have already seen an increase in usage.</p>

      <p>Developers with an @FreeBSD.org address can contact forum
	administrators to obtain the highly-desired "@"	suffix on their
	forum user name along with a Developer flag.</p>

      <p>We want to thank the Foundation for making this possible, and
	the users for their patience and continued presence on the
	forums!</p>
    </body>

    <sponsor>
      The &os; Foundation
    </sponsor>

    <help>
      <task>
 	<p>Encourage more developers and users to try the new forums.</p>
      </task>

      <task>
	<p>Continue getting feedback from users for tuning and
	  improvements.</p>
      </task>
    </help>
  </project>

  <project cat='kern'>
    <title>Process management</title>

    <contact>
      <person>
	<name>
	  <given>Konstantin</given>
	  <common>Belousov</common>
	</name>
	<email>kib@FreeBSD.org</email>
      </person>
      <person>
	<name>
	  <given>Peter</given>
	  <common>Holm</common>
	</name>
	<email>pho@FreeBSD.org</email>
      </person>
    </contact>

    <body>
      <p>There were several improvements made to the FreeBSD process
	management last quarter.</p>

      <p>Reaper. The facility to allow a process to reliably track the
	running and exiting state of the whole subtree of the processes,
	was added.  It is intended to improve tools like timeout(1) or
	poudriere, by making it impossible for the runaway granchild to
	escape the controlling process.  Feature was designed based on
	similar facility in the DragonFlyBSD and Linux, with some
	references to the Solaris contracts.  Committed to HEAD in
	r275800.</p>

      <p>Total stop.  Right now, the FreeBSD suspension code does not
	ensures that the system, both from software and from hardware
	view, is in the steady and consistent state.  One aspect is the
	usermode process activity which is not stopped, continuing to
	making requests to the hardware.  It is not realistic to expect
	drivers to be able to correctly handle the calls after
	SUSPEND_CHILD.</p>

      <p>Together with Peter Holm, we developed a facility to stop
	usermode threads at the safe points, where they are known to not
	own and to not wait for kernel resources, in particular, not
	waiting for device requests finishing.  It is based on the
	existing single-threading code, but extending it to allow external
	thread to put some process into stopped state.  Also, a facility
	to sync filesystems before suspend was added, to ensure that
	consistent metadata and as much as possilbe of the cached user
	data are on stable storage, to minimize damage of failed
	resume.</p>

      <p>The code stressed some parts of the system and lead to
	discovery of the unusual numbers of bugs in the different parts of
	the system, including process management, buffer cache and syscall
	handlers.  The bugs were fixed, fixes and the features commmitted
	by a series culminating in r275745.</p>

      <p>Process spinlock changes. During the work described above, it
	was noted that process spinlock duties are significantly
	overloaded (the same is true for the process lock).  The spinlock
	was split into per-feature lock, see r275121.  Also, as result, it
	was possible to eliminate recursion on it, r275372.</p>
    </body>

    <sponsor>The FreeBSD Foundation</sponsor>

  </project>

  <project cat='proj'>
    <title>FreeBSD on the Acer C720 Chromebook</title>

    <contact>
      <person>
	<name>
	  <given>Michael</given>
	  <common>Gmelin</common>
	</name>
	<email>freebsd@grem.de</email>
      </person>
    </contact>

    <links>
      <url href="http://blog.grem.de/pages/c720.html" />
    </links>

    <body>
      <p>Most system features work, including keyboard, WiFi, sound,
	VESA graphics, touchpad, USB and decent battery life (5 to 6 hours).</p>
    </body>

    <help>
      <task>
	<p>Streamline patches and merge them into HEAD.</p>
      </task>

      <task>
	<p>Make suspend/resume work (depends on Haswell support).</p>
      </task>
    </help>
  </project>

  <project cat='misc'>
    <title>Creating Vagrant images with Packer</title>

    <contact>
      <person>
	<name>
	  <given>Brad</given>
	  <common>Davis</common>
	</name>
	<email>brd@FreeBSD.org</email>
      </person>
    </contact>

    <links>
      <url href="http://blogs.freebsdish.org/brd/2014/12/22/freebsd-packer-vagrant/">Blog Announcement</url>
      <url href="https://github.com/so14k/packer-freebsd">Git Repo</url>
    </links>

    <body>
      <p>We have developed a recipe to use Packer to create FreeBSD
	Vagrant images to run on VMware and VirtualBox.</p>

      <p><a href="https://www.packer.io/">Packer</a> is a tool for
	creating identical machine images for multiple platforms from a
	single source configuration.</p>

      <p><a href="https://www.vagrantup.com/">Vagrant</a> is a tool to
	create and configure lightweight, reproducible, and portable
	development environments.</p>

      <p>To get started clone the Git repo and follow the directions in
	the README.  More information is available from the Packer and
	Vagrant websites.</p>
    </body>
  </project>

  <project cat="proj">
    <title>pkg(8)</title>

    <contact>
      <person>
	<name>The pkg team</name>

	<email>pkg@FreeBSD.org</email>
      </person>
    </contact>

    <links>
      <url href="https://github.com/freebsd/pkg"/>
    </links>

    <body>
      <p>The package development team has released <tt>pkg(8)</tt> 1.4.
	This release fixes lots of bugs and adds some new features:
	<ul>
	  <li>Stricter checking of the path passed via the plist</li>
	  <li>Change in the ABI to be closer to MACHINE_ARCH</li>
	  <li>Add three-way merge functionnality</li>
	  <li>Add conservative upgrade support for multi repository configurations</li>
	  <li>Multirepository priority</li>
        </ul>
      </p>

      <p>An important part of the development direction for the 1.4
	release has been done on stabilizing the existing features, and
	improving the <tt>pkg(8)</tt> experience on small/embedded
	machines (reduce memory usage, speed up operations).</p>

      <p><tt>pkg(8)</tt> is not only the &os; Package Manager, but the
	Package Manager for DragonflyBSD.  Additionally support has been
	added to build <tt>pkg(8)</tt> on OS X and Linux.  This work
	will allow other Operating Systems the option of adopting
	<tt>pkg(8)</tt> to manage their packages and bring new
	developers into the project.</p>
    </body>

    <help>
       <task>Add more regression tests</task>
       <task>Package FreeBSD base</task>
       <task>Allow using mtree as a plist when creating a package</task>
       <task>Implement flexible dependencies</task>
       <task>Test the developement branch</task>
       <task>More developers are needed, check the Issues on Github</task>
    </help>
  </project>

  <project cat="bin">
    <title>mandoc(1) support</title>

    <contact>
      <person>
	<name>
	  <given>Baptiste</given>
	  <common>Daroussin</common>
	</name>
	<email>bapt@FreeBSD.org</email>
      </person>
      <person>
	<name>
	  <given>Ulrich</given>
	  <common>Spoerlein</common>
	</name>
	<email>uqs@FreeBSD.org</email>
      </person>
      <person>
	<name>
	  <given>The Documentation Team</given>
	</name>
	<email>docs@FreeBSD.org</email>
      </person>
    </contact>

    <links>
      <url href="http://mdocml.bsd.lv" />
    </links>

    <body>
      <p><tt>mandoc(1)</tt> has been made the default manual page
	formatter on HEAD -- man(1) will use <tt>mandoc(1)</tt> to
	format manual pages by default, then fall back to
	<tt>groff(1)</tt> if it fails.</p>
 
      <p>This change also fixes an issue with FreeBSD <tt>man(1)</tt>
	command not able to properly deal with ".so" in gzipped manual
	pages.</p>
 
      <p>The documentation team has spent a lot of time fixing issues
	reported by <tt>mdoc(7)</tt> in the FreeBSD manual pages.  This
	greatly improves the quality of our manual pages.</p>
 
      <p>Most manual pages with remaining issues are from contrib/ for
	which changes should be reported and fixed upstream.</p>
 
      <p>The "manlint" target has also been switch to use <tt>mandoc
	-Tlint</tt> which results in the target being way more useful
	when working on manual pages.</p>
 
      <p>Some <tt>groff(1)</tt> vs <tt>mandoc(1)</tt> formatting
	differencies have been spotted and reported to mandoc's upstream
	developers.</p>
    </body>

    <help>
      <task>Switch <tt>makewhatis(1)</tt> to the version shipped with <tt>mandoc(1)</tt></task>
      <task>Figure out a way to detect non <tt>mandoc(1)</tt> friendly manpages from ports and create catpages with <tt>groff(1)</tt> for them</task>
      <task>Remove <tt>groff(1)</tt> from base.</task>
    </help>
  </project>

  <project cat='proj'>
    <title>External toolchain</title>

    <contact>
      <person>
	<name>
	  <given>Baptiste</given>
	  <common>Daroussin</common>
	</name>
	<email>bapt@FreeBSD.org</email>
      </person>
      <person>
	<name>
	  <given>Warner</given>
	  <common>Losh</common>
	</name>
	<email>imp@FreeBSD.org</email>
      </person>
      <person>
	<name>
	  <given>Brooks</given>
	  <common>Davis</common>
	</name>
	<email>brooks@FreeBSD.org</email>
      </person>
    </contact>

    <links>
      <url href="https://wiki.freebsd.org/ExternalToolchain" />
    </links>

    <body>
      <p>The main goal of the external toolchain project is to be able
	to build world and kernel with non default toolchain.  It can be
	helpful to:
	<ul>
	  <li>Prepare a migration to a newer version of the components like compilers, binutils, and elftoolchain.</li>
	  <li>Port &os; to newer architecture</li>
	  <li>Upgrade from a &os; that ships with GCC 4.2 to a version that ship with clang 3.5+ (which need a more modern toolchain than GCC 4.2 to bootstrap.</li>
	</ul>
      </p>

      <p>The initial support for external toolchain only supported
	clang.  It has been extended to support recent GCC (4.9.1 has
	been tested) and recent binutils (2.24 and 2.25).</p>

      <p>A large number of fixes have been committed to HEAD to support
	incompatible behaviour changes between <tt>ld(1)</tt> from
	binutils 2.17.50 (the version in base) and binutils 2.24+.</p>

      <p>A large number of warnings have been deactivated when building
	the kernel to make sure it is possible to build the kernel with
	recent GCC (first 4.6 and then 4.9.1)</p>

      <p>The build system has been changed to build libc++ as a C++
	stack when a recent enough GCC (4.6+) is used to build world.
	</p>

      <p>To simplify using an external toolchain, the following
	pre-seeded configurations have been added to the ports tree:
	<ul>
	  <li>amd64-xtoolchain-gcc</li>
	  <li>powerpc64-xtoolchain-gcc</li>
	  <li>sparc64-xtoolchain-gcc</li>
	</ul>
      </p>

      <p>Those packages will depend on special version of GCC
	(minimalistic cross-built ready GCC) and on binutils.  To use
	them run: <tt>make CROSS_TOOLCHAIN=powerpc64-gcc TARGET=powerpc
	TARGET_ARCH=powerpc64</tt></p>

      <p>As a result of this effort, it has been possible to
	successfully build and run a kernel and world built with GCC
	4.9.1 and binutils 2.24 on sparc64, amd64 (with minor tweaks for
	amd64), powerpc and powerpc64.</p>
    </body>

    <help>
      <task>Patch and upstream GCC 4.9 to support &os; mips, arm and
	aarch64</task>
      <task>Adapt and upstream the aarch64 patches for binutils 2.25
	</task>
      <task>Add more pre seeded configurations</task>
    </help>
  </project>

  <project cat='kern'>
    <title>Timer function support for linuxolator</title>

    <contact>
      <person>
	<name>
	  <given>Bjoern A.</given>
	  <common>Zeeb</common>
	</name>
	<email>bz@FreeBSD.org</email>
      </person>
    </contact>

    <body>
      <p>Since 2006, initial support for Linux timer function
	compatibility support was present but untested.
	This update corrects the initial implementation and makes it
	available to the 32bit linuxolator on amd64, not just on i386.
      </p>

      <p>Starting with &os; 10.1, this enables users to run another
	FPGA high-level synthesis toolchain and emulation platform
	on a FreeBSD system.
      </p>
    </body>

    <sponsor>DARPA</sponsor>
    <sponsor>AFRL</sponsor>

  </project>

  <project cat='ports'>
    <title>GNOME on FreeBSD</title>

    <contact>
      <person>
	<name>FreeBSD GNOME Team</name>
	<email>gnome@FreeBSD.org</email>
      </person>
    </contact>

    <links>
      <url href="http://www.freebsd.org/gnome">FreeBSD GNOME Team website</url>
      <url href="https://github.com/freebsd/freebsd-ports-gnome">FreeBSD Team development repo</url>.
      <url href="https://wiki.gnome.org/Projects/Jhbuild/FreeBSD">GNOME jhbuild buildbot wiki pages.</url>
    </links>

    <body>
      <p>The FreeBSD GNOME Team maintains the GNOME, MATE and CINNAMON desktop
	environments and graphical user interfaces for FreeBSD. GNOME 3 is part
	of the GNU Project. MATE is a fork of the GNOME 2 desktop. CINNAMON
	is desktop environment using GNOME 3 technologies but with a GNOME 2
	look and feel.</p>

      <p>This quarter was exciting time for the GNOME Team. We imported
	GNOME 3.14.0 and CINNAMON 2.2.16 into the ports tree. At the same
	time we removed the old GNOME 2.32 desktop. And two weeks later
	we updated GNOME to 3.14.2 and CINNAMON to 2.4.2 which was collected
	while the preparation for the initial GNOME 3.14.0 import was
	underway.</p>

      <p>We moved our development repo to GitHub. The link is in the links
	section. The <tt>master</tt> branch is vanilla, and we have
	<tt>theme branches</tt> for topic, like the porting of MATE 1.9
	(mate-1.10 branch) and GNOME 3.15 (gnome-3.16 branch). The GNOME
	3.14 branch (gnome-3.14) is not used/updated anymore because the
	content has been committed to ports.</p>
    </body>

    <help>
      <task>The GNOME website is stale. Work is starting on updating
	the development section. We could use some help here.
      </task>

      <task>MATE 1.10 porting is underway, the latest 1.9 releases are
	available in the mate-1.10 branch.
      </task>

      <task>GNOME 3.16 porting is underway, and is available in the
	gnome-3.16 branch.
      </task>
    </help>
  </project>

</report>
