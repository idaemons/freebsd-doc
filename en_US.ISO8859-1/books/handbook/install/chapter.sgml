<!--
     The FreeBSD Documentation Project

     $FreeBSD: doc/en_US.ISO8859-1/books/handbook/install/chapter.sgml,v 1.83 2001/08/09 23:42:30 chern Exp $
-->

<chapter id="install">
  <chapterinfo>
    <authorgroup>
      <author>
        <firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Restructured, reorganized, and parts
	  rewritten by </contrib>
      </author>
    </authorgroup>
    <!-- January 2000 -->
  </chapterinfo>

  <title>Installing FreeBSD</title>

  <sect1>
    <title>Synopsis</title>

    <indexterm><primary>installation</primary></indexterm>
    <para>The following chapter will attempt to guide you through the
      installation of FreeBSD on your system.  It can be installed through a
      variety of methods, including anonymous FTP (assuming you have
      network connectivity via modem or local network), CDROM, floppy
      disk, tape, an MS-DOS partition, or even NFS.</para>

    <para>No matter which method you choose, you will need to get started
      by creating the <emphasis>installation disks</emphasis> as described
      in the <link linkend="install-floppies">next section</link>.
      Booting into the FreeBSD installer, even if you are not planning on
      installing FreeBSD right away, will provide important information
      about compatibility with your hardware.  This information may
      dictate which installation options are even possible for you.  It
      can also provide clues early-on in the process to potential problems
      you may come across later.</para>

    <indexterm>
      <primary>installation</primary>
      <secondary>network</secondary>
      <tertiary>anonymous FTP</tertiary>
    </indexterm>
    <para>If you plan to install FreeBSD via anonymous FTP, the only
      things you will need are the <link
      linkend="install-floppies">installation floppies</link>.  The
      installation program itself will handle anything else that is
      required.</para>

    <para>For more information about obtaining FreeBSD, see the <link
      linkend="mirrors">Obtaining FreeBSD</link> section of the
      Appendix.</para>

    <para>By now, you are probably wondering what exactly it is you need
      to do.  Continue on to the installation guide.</para>
  </sect1>

  <sect1 id="install-guide">
    <title>Installation Guide</title>

    <para>The following sections will guide you through preparing for and
      actually installing FreeBSD.  If you find something missing, please
      let us know about it by sending email to the &a.doc;.</para>

    <sect2 id="install-prepare">
      <title>Preparing for the Installation</title>

      <para>There are various things you should do in preparation for the
        installation.  The following describes what needs to be done prior to
	each type of installation.</para>

      <para>The first thing to do is to make sure your hardware is
	supported by FreeBSD.  The Hardware Notes document for your
	release of FreeBSD (which is usually named
	<filename>HARDWARE.TXT</filename>) should
	come in handy here.  It would also be a good idea to make a
	list of any <quote>special</quote> cards you have installed,
	such as SCSI controllers, Ethernet cards, sound cards, etc..
	The list should include their IRQs and IO port addresses.</para>

      <sect3 id="install-floppies">
	<title>Creating the Installation Floppies</title>

        <indexterm>
          <primary>installation</primary>
          <secondary>boot floppies</secondary>
        </indexterm>
        <indexterm>
          <primary>installation</primary>
          <secondary>CDROM</secondary>
        </indexterm>
	<para>You may need to prepare some floppy disks.  These disks will
	  be used to boot your computer in to the FreeBSD install process.
	  This step is not necessary <emphasis>if</emphasis> you are
	  installing from CDROM, <emphasis>and</emphasis> your computer
	  supports booting from the CDROM.  If you do not meet these
	  requirements then you will need to create some floppies to boot
	  from.</para>

	<note>
	  <para>If you are not sure whether your computer can boot from the
	    CDROM it does not hurt to try.  Just insert the CDROM as
	    normal and restart your computer.  You might need to adjust some 
	    options in your BIOS so that your computer will try and boot
	    from the CDROM drive before the hard disk.</para>
	</note>
	  
	<tip>
	  <para>Even if you have the CDROM it might make sense for you to
	    download the files.  There have been occasions where bugs  in the
	    FreeBSD installer have been discovered after the CDs have been
	    released.  When this happens the copies of the images on the FTP
	    site will be fixed as soon as possible. Obviously, it is not
	    possible to update the CDs after they have been pressed.</para>
	</tip>

	<procedure>
	  <step>
	    <title>Acquire the boot floppy images</title>
	      
	    <para>These are files with a <filename>.flp</filename>
	      extension.  If you have a CDROM release of FreeBSD then you
	      will find the files in the <filename>floppies</filename>
	      subdirectory.  Alternatively, you can download the images from
	      the <ulink
		url="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/floppies/">floppies directory</ulink> of the FreeBSD FTP site or your local mirror.</para>

	    <para>The names of the files you will need varies between
	      FreeBSD releases (sometimes) and the architecture you will be
	      installing on.  The <ulink
		url="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/floppies/README.TXT">installation
		boot image information</ulink> on the FTP site provides
	      up-to-the-minute information about the specific files you will 
	      need.</para>
	  </step>

	  <step>
	    <title>Prepare the floppy disks</title>
	    
	    <para>You must prepare one floppy disk per image file you had to
	      download.  It is imperative that these disks are free from
	      defects.  The easiest way to test this is to format the disks
	      for yourself.  Do not trust pre-formatted floppies.</para>

	    <important>
	      <para>If you try to install FreeBSD and the installation
		program crashes, freezes, or otherwise misbehaves one of
		the first things to suspect is the floppies.  Try writing
		the floppy image files to some other disks, and try
		again.</para>
	    </important>
	  </step>

	  <step>
	    <title>Write the image files to the floppy disks.</title>

	    <para>The image files, such as <filename>kern.flp</filename>,
	      are <emphasis>not</emphasis> regular files you copy to the
	      disk.  Instead, they are images of the complete contents of
	      the disk.</para>

	    <para>This means that you can <emphasis>not</emphasis> use
	      commands like DOS' <command>copy</command> to write the
	      files.  Instead, you must use specific tools to write the
	      images directly to the disk.</para>

	    <indexterm><primary>DOS</primary></indexterm>
	    <para>If you are creating the floppies on a computer running DOS 
	      then we provide a tool to do this called
	      <command>fdimage</command>.</para>

	    <para>If you are using the floppies from the CDROM, and your
	      CDROM is the <devicename>E:</devicename> drive then you would 
	      run this:</para>

	    <screen><prompt>E:\&gt;</prompt> <userinput>tools\fdimage floppies\kern.flp A:</userinput></screen>

	    <para>Repeat this command for each <filename>.flp</filename>
	      file, replacing the floppy disk each time.  Adjust the command 
	      line as necessary, depending on where you have placed the
	      <filename>.flp</filename> files.  If you do not have the
	      CDROM then <command>fdimage</command> can be downloaded from
	      the <ulink
		url="ftp://ftp.FreeBSD.org/pub/FreeBSD/tools/"><filename>tools</filename> directory</ulink> on the FreeBSD FTP site.</para>

	    <para>If you are writing the floppies on a Unix system (such as
	      another FreeBSD system) you can use the &man.dd.1; command to
	      write the image files directly to disk.  On FreeBSD you would
	      run:</para>

	    <screen>&prompt.root; <userinput>dd if=kern.flp of=/dev/fd0</userinput></screen>

	    <para>On FreeBSD <filename>/dev/fd0</filename> refers to the
	      first floppy disk (the <devicename>A:</devicename> drive).
	      <filename>/dev/fd1</filename> would be the
	      <devicename>B:</devicename> drive, and so on.  Other Unix
	      variants might have different names for the floppy disk
	      devices, and you will need to check the documentation for the
	      system as necessary.</para>
	  </step>
	</procedure>
      </sect3>

      <sect3 id="install-cdrom">
        <title>Before Installing from CDROM</title>
	
	<para>If your CDROM is of an unsupported type, please skip ahead
	  to the <link linkend="install-msdos">MS-DOS Preparation</link>
	  section.</para>
	
	<para>There is not a whole lot of preparation needed if you are
	  installing from a FreeBSD CDROM.  You can either boot into the
	  CD installation directly from DOS using the
	  <filename>install.bat</filename> or you can make floppies with
	  the <filename>makeflp.bat</filename> command.</para>

	<para>If the CD has El Torito boot support and your system
	  supports booting directly from the CDROM drive (many older
	  systems do <emphasis>NOT</emphasis>), simply insert the first
	  CD of the set into the drive and reboot your system.  You
	  will be put into the installation menu directly from the CD.</para>

	<indexterm><primary>DOS</primary></indexterm>
	<para>If you are installing from an MS-DOS partition and have
	  the proper drivers to access your CD, run the
	  <filename>install.bat</filename> script provided on the CDROM.
	  This will attempt to boot the FreeBSD installation directly
	  from DOS.</para>

	<note>
	  <para>You must do this from actual DOS (i.e., boot in DOS
	    mode) and not from a DOS window under Windows.</para>
	</note>

	<para>For the easiest interface of all (from DOS), type
	  <command>view</command>.  This will bring up a DOS menu utility
	  that leads you through all of the available options.</para>

	<indexterm><primary>Unix</primary></indexterm>
	<para>If you are creating the boot floppies from a Unix machine,
	  see the <link linkend="install-floppies">Creating the Boot
	  Floppies</link> section of this guide for examples.</para>
	
	<para>Once you have booted from DOS or floppy, you should then be
	  able to select CDROM as the media type during the install
	  process and load the entire distribution from CDROM.  No other
	  types of installation media should be required.</para>

	<para>After your system is fully installed and you have rebooted
	  (from the hard disk), you can mount the CDROM at any time by
	  typing:</para>

	<screen>&prompt.root; <userinput>mount /cdrom</userinput></screen>

	<para>Before removing the CD from the drive again, you must first
	  unmount it.  This is done with the following command:</para>

	<screen>&prompt.root; <userinput>umount /cdrom</userinput></screen>

	<para>Do not just remove it from the drive!</para>

	<note>
	  <para>Before invoking the installation, be sure that the CDROM
	    is in the drive so that the install probe can find it.  This
	    is also true if you wish the CDROM to be added to the default
	    system configuration automatically during the installation (whether
	    or not you actually use it as the installation media).</para>
	</note>

	<indexterm>
    <primary>installation</primary>
    <secondary>network</secondary>
    <tertiary>FTP</tertiary>
  </indexterm>
	<para>Finally, if you would like people to be able to FTP install
	  FreeBSD directly from the CDROM in your machine, you will find
	  it quite easy.  After the machine is fully installed, you simply
	  need to add the following line to the password file (using the
	  <command>vipw</command> command):</para>

	<programlisting>ftp:*:99:99::0:0:FTP:/cdrom:/nonexistent</programlisting>

	<para>Anyone with network connectivity to your machine can now
	  chose a media type of FTP and type in
	  <userinput>ftp://<replaceable>your machine</replaceable></userinput>
	  after picking <quote>Other</quote> in the FTP sites menu during
	  the install.</para>

	 <note><para>If you choose to enable anonymous FTP during the
	 installation of your system, the installation program will do
	 the above for you.</para></note>

      </sect3>

      <sect3>
        <title>Before installing from Floppies</title>

	<indexterm>
    <primary>installation</primary>
    <secondary>floppies</secondary>
  </indexterm>
	<para>If you must install from floppy disk (which we suggest you
	  do <emphasis>NOT</emphasis> do), either due to unsupported
	  hardware or simply because you insist on doing things the hard
	  way, you must first prepare some floppies for the installation.</para>

	<para>At a minimum, you will need as many 1.44MB or 1.2MB floppies
	  as it takes to hold all the files in the
	  <filename>bin</filename> (binary distribution) directory.  If
	  you are preparing the floppies from DOS, then they
	  <emphasis>MUST</emphasis> be formatted using the MS-DOS
	  <command>FORMAT</command> command.  If you are using Windows,
	  use Explorer to format the disks (right-click on the
	  <devicename>A:</devicename> drive, and select &quot;Format&quot;.</para>

	<para>Do <emphasis>NOT</emphasis> trust factory pre-formatted
	  floppies!  Format them again yourself, just to be sure.  Many
	  problems reported by our users in the past have resulted from
	  the use of improperly formatted media, which is why we are
	  making a point of it now.</para>

	<para>If you are creating the floppies on another FreeBSD machine,
	  a format is still not a bad idea, though you do not need to put
	  a DOS filesystem on each floppy.  You can use the
	  <command>disklabel</command> and <command>newfs</command>
	  commands to put a UFS filesystem on them instead, as the
	  following sequence of commands (for a 3.5" 1.44MB floppy)
	  illustrates:</para>

	<screen>&prompt.root; <userinput>fdformat -f 1440 fd0.1440</userinput>
&prompt.root; <userinput>disklabel -w -r fd0.1440 floppy3</userinput>
&prompt.root; <userinput>newfs -t 2 -u 18 -l 1 -i 65536 /dev/fd0</userinput></screen>

	<note>
	  <para>Use <literal>fd0.1200</literal> and
	    <literal>floppy5</literal> for 5.25" 1.2MB disks.</para>
	</note>

	<para>Then you can mount and write to them like any other
	  filesystem.</para>

	<para>After you have formatted the floppies, you will need to copy
	  the files to them.  The distribution files are split into chunks
	  conveniently sized so that 5 of them will fit on a conventional
	  1.44MB floppy.  Go through all your floppies, packing as many
	  files as will fit on each one, until you have all of the
	  distributions you want packed up in this fashion.  Each
	  distribution should go into a subdirectory on the floppy, e.g.:
	  <filename>a:\bin\bin.aa</filename>,
	  <filename>a:\bin\bin.ab</filename>, and so on.</para>

	<para>Once you come to the Media screen during the install
	  process, select <quote>Floppy</quote> and you will be prompted
	  for the rest.</para>
      </sect3>

      <sect3 id="install-msdos">
        <title>Before Installing from MS-DOS</title>

	<indexterm>
    <primary>installation</primary>
    <secondary>from MS-DOS</secondary>
  </indexterm>
	<para>To prepare for an installation from an MS-DOS partition,
	  copy the files from the distribution into a directory named,
	  for example, <filename>c:\FreeBSD</filename>.  The directory
	  structure of the CDROM or FTP site must be partially reproduced
	  within this directory, so we suggest using the DOS
	  <command>xcopy</command> command if you are copying it from a
	  CD.  For example, to prepare for a minimal installation of
	  FreeBSD:</para>

	<screen><prompt>C:\&gt;</prompt> <userinput>md c:\FreeBSD</userinput>
<prompt>C:\&gt;</prompt> <userinput>xcopy e:\bin c:\FreeBSD\bin\ /s</userinput>
<prompt>C:\&gt;</prompt> <userinput>xcopy e:\manpages c:\FreeBSD\manpages\ /s</userinput></screen>

	<para>Assuming that <devicename>C:</devicename> is where you have
	  free space and <devicename>E:</devicename> is where your CDROM
	  is mounted.</para>
	
	<para>If you do not have a CDROM drive, you can download the
	distribution from <ulink
	url="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/">
	ftp.FreeBSD.org</ulink>. Each distribution is in its own directory; 
	for example, the <emphasis>bin</emphasis> distribution can be 
	found in the <ulink
	url="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/bin">&rel.current;/bin</ulink> directory.</para>
    
	<para>For as many distributions you wish to install from an MS-DOS
	  partition (and you have the free space for), install each one
	  under <filename>c:\FreeBSD</filename> &mdash; the
	  <literal>BIN</literal> distribution is the only one required for
	  a minimum installation.</para>
      </sect3>

      <sect3>
        <title>Before Installing from QIC/SCSI Tape</title>

	<indexterm>
    <primary>installation</primary>
    <secondary>from QIC/SCSI Tape</secondary>
  </indexterm>
	<para>Installing from tape is probably the easiest method, short
	  of an online FTP install or CDROM install.  The installation
	  program expects the files to be simply tarred onto the tape, so
	  after getting all of the distribution files you are interested
	  in, simply tar them onto the tape like so:</para>

	<screen>&prompt.root; <userinput>cd /freebsd/distdir</userinput>
&prompt.root; <userinput>tar cvf /dev/rwt0 dist1 ... dist2</userinput></screen>

	<para>When you go to do the installation, you should also make
	  sure that you leave enough room in some temporary directory
	  (which you will be allowed to choose) to accommodate the
	  <emphasis>full</emphasis> contents of the tape you have created.
	  Due to the non-random access nature of tapes, this method of
	  installation requires quite a bit of temporary storage.  You
	  should expect to require as much temporary storage as you have
	  stuff written on tape.</para>

	<note>
	  <para>When starting the installation, the tape must be in the
	    drive <emphasis>before</emphasis> booting from the boot
	    floppy.  The installation probe may otherwise fail to find
	    it.</para>
	</note>
      </sect3>

      <sect3>
        <title>Before Installing over a Network</title>

	<indexterm>
    <primary>installation</primary>
    <secondary>network</secondary>
    <tertiary>serial (SLIP or PPP)</tertiary>
  </indexterm>
	<indexterm>
    <primary>installation</primary>
    <secondary>network</secondary>
    <tertiary>parallel (PLIP)</tertiary>
  </indexterm>
	<indexterm>
    <primary>installation</primary>
    <secondary>network</secondary>
    <tertiary>Ethernet</tertiary>
  </indexterm>
	<para>There are three types of network installations you can do.
	  Serial port (SLIP or PPP), Parallel port (PLIP (laplink cable)),
	  or Ethernet (a standard Ethernet controller (includes some
	  PCMCIA)).</para>

	<para>The SLIP support is rather primitive, and limited primarily
	  to hard-wired links, such as a serial cable running between a
	  laptop computer and another computer.  The link should be
	  hard-wired as the SLIP installation does not currently offer a
	  dialing capability; that facility is provided with the PPP
	  utility, which should be used in preference to SLIP whenever
	  possible.</para>

	<para>If you are using a modem, then PPP is almost certainly
	  your only choice.  Make sure that you have your service
	  provider's information handy as you will need to know it fairly
	  early in the installation process.</para>  
	  <para>If you use PAP or CHAP to connect your ISP (in other
	  words, if you can connect to the ISP in Windows without
	  using a script), then all you will need to do is type in
	  <command>dial</command> at the
	  <application>ppp</application> prompt. Otherwise,
	  you will need to know
	  how to dial your ISP using the <quote>AT commands</quote>
	  specific to your modem, as the PPP dialer provides only a very
	  simple terminal emulator. Please refer
	  to the user-ppp <link linkend="userppp">handbook</link> and <ulink
	  url="../FAQ/ppp.html">FAQ</ulink> entries for further
	  information.  If you have problems, logging can be directed to
	  the screen using the command <command>set log local
	  ...</command>.</para>

	<para>If a hard-wired connection to another FreeBSD (2.0-R or
	  later) machine is available, you might also consider installing
	  over a <quote>laplink</quote> parallel port cable.  The data rate
	  over the parallel port is much higher than what is typically
	  possible over a serial line (up to 50kbytes/sec), thus resulting
	  in a quicker installation.</para>

	<para>Finally, for the fastest possible network installation, an
	  Ethernet adapter is always a good choice!  FreeBSD supports most
	  common PC Ethernet cards; a table of supported cards (and their
	  required settings) is provided in the Hardware Notes
	  for each release of FreeBSD.  If you are
	  using one of the supported PCMCIA Ethernet cards, also be sure
	  that it is plugged in <emphasis>before</emphasis> the laptop is
	  powered on!  FreeBSD does not, unfortunately, currently support
	  hot insertion of PCMCIA cards during installation.</para>

	<para>You will also need to know your IP address on the network,
	  the netmask value for your address class, and the name of your
	  machine.  If you are installing over a PPP connection and do not
	  have a static IP, fear not, the IP address can be dynamically
	  assigned by your ISP.  Your system administrator can tell you
	  which values to use for your particular network setup.  If you
	  will be referring to other hosts by name rather than IP address,
	  you will also need a name server and possibly the address of a
	  gateway (if you are using PPP, it is your provider's IP address)
	  to use in talking to it.  If you want to install by FTP via a
	  HTTP proxy (see below), you will also need the proxy's address.
	  If you do not know the answers to all or most of these questions,
	  then you should really probably talk to your system administrator
	  or ISP <emphasis>before</emphasis> trying this type of
	  installation.</para>

	<sect4>
	  <title>Before Installing via NFS</title>

    <indexterm>
      <primary>installation</primary>
      <secondary>network</secondary>
      <tertiary>NFS</tertiary>
    </indexterm>
	  <para>The NFS installation is fairly straight-forward.  Simply
	    copy the FreeBSD distribution files you want onto a server
	    somewhere and then point the NFS media selection at it.</para>

	  <para>If this server supports only <quote>privileged port</quote>
	    (as is generally the default for Sun workstations), you will
	    need to set this option in the Options menu before
	    installation can proceed.</para>

	  <para>If you have a poor quality Ethernet card which suffers
	    from very slow transfer rates, you may also wish to toggle the
	    appropriate Options flag.</para>

	  <para>In order for NFS installation to work, the server must
	    support subdir mounts, e.g., if your FreeBSD 3.4 distribution
	    directory lives
	    on:<filename>ziggy:/usr/archive/stuff/FreeBSD</filename>, then
	    <hostid>ziggy</hostid> will have to allow the direct mounting
	    of <filename>/usr/archive/stuff/FreeBSD</filename>, not just
	    <filename>/usr</filename> or
	    <filename>/usr/archive/stuff</filename>.</para>

	  <para>In FreeBSD's <filename>/etc/exports</filename> file, this
	    is controlled by the <option>-alldirs</option>.  Other NFS
	    servers may have different conventions.  If you are getting
	    <quote>permission denied</quote> messages from the server, then
	    it is likely that you do not have this enabled
	    properly.</para>
	</sect4>

	<sect4>
	  <title>Before Installing via FTP</title>

    <indexterm>
      <primary>installation</primary>
      <secondary>network</secondary>
      <tertiary>FTP</tertiary>
    </indexterm>
	  <para>FTP installation may be done from any FreeBSD mirror site
	    containing a reasonably up-to-date version of FreeBSD.  A full
	    list of FTP mirrors located all over the world is provided
	    during the install process.</para>

	  <para>If you are installing from an FTP site not listed in this
	    menu, or are having trouble getting your name server
	    configured properly, you can also specify a URL to use by
	    selecting the choice labeled <quote>Other</quote> in that menu.
	    You can also use the IP address of a machine you wish to
	    install from, so the following would work in the absence of a
	    name server:</para>

	  <screen><userinput>ftp://209.55.82.20/pub/FreeBSD/&rel.current;-RELEASE</userinput></screen>

	  <para>There are three FTP installation modes you can choose from:
	    active or passive FTP or via a HTTP proxy.</para>

	  <variablelist>
	    <varlistentry>
	      <term>FTP Active</term>

	      <listitem>
	        <para>This option will make all FTP transfers 
		  use <quote>Active</quote>
		  mode.  This will not work through firewalls, but will
		  often work with older FTP servers that do not support
		  passive mode.  If your connection hangs with passive
		  mode (the default), try active!</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>FTP Passive</term>

	      <listitem>
	        <indexterm>
            <primary>FTP</primary>
            <secondary>Passive mode</secondary>
          </indexterm>
	        <para>This option instructs FreeBSD to use 
		  <quote>Passive</quote> mode for all FTP operations.  
		  This allows the user to pass through firewalls
		  that do not allow incoming connections on random port
		  addresses.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>FTP via a HTTP proxy</term>

	      <listitem>
	        <indexterm>
            <primary>FTP</primary>
            <secondary>via a HTTP proxy</secondary>
          </indexterm>
	        <para>This option instructs FreeBSD to use the HTTP
		  protocol (like a web browser) to connect to a proxy
		  for all FTP operations.  The proxy will translate
		  the requests and send them to the FTP server.
		  This allows the user to pass through firewalls
		  that do not allow FTP at all, but offer a HTTP
		  proxy.
		  In this case, you have to specify the proxy in
		  addition to the FTP server.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <note>
	    <para>There is another type of FTP proxy other tha HTTP
	      proxies.  This type is very uncommon, though.  If you
	      are not absolutely certain, you can assume that you
	      have a HTTP proxy as described above.</para>
	  </note>

	  <para>For a proxy FTP server, you should usually give the name
	    of the server you really want as a part of the username, after
	    an <quote>@</quote> sign.  The proxy server then
	    <quote>fakes</quote> the real server.  For example, assuming
	    you want to install from <hostid
	    role="fqdn">ftp.FreeBSD.org</hostid>, using the proxy FTP
	    server <hostid role="fqdn">foo.bar.com</hostid>, listening on
	    port 1024.</para>

	  <para>In this case, you go to the options menu, set the FTP
	    username to ftp@ftp.FreeBSD.org, and the password to your
	    email address.  As your installation media, you specify FTP
	    (or passive FTP, if the proxy supports it), and the URL
	    <literal>ftp://foo.bar.com:1234/pub/FreeBSD</literal>.</para>

	  <para>Since <filename>/pub/FreeBSD</filename> from <hostid
	    role="fqdn">ftp.FreeBSD.org</hostid> is proxied under <hostid
	    role="fqdn">foo.bar.com</hostid>, you are able to install from
	    <emphasis>that</emphasis> machine (which will fetch the files
	    from <hostid role="fqdn">ftp.FreeBSD.org</hostid> as your
	    installation requests them.</para>
	</sect4>
      </sect3>
	
      <sect3>
	<title>Check your BIOS drive numbering</title>

	<para>If you have used features in your BIOS to renumber your disk
	  drives without re-cabling them then you should read <xref
	    linkend="disks-bios-numbering"> first to avoid confusion.</para>
      </sect3>
    </sect2>

    <sect2 id="install-freebsd">
      <title>Installing FreeBSD</title>

      <para>Once you have completed the pre-installation step relevant to
        your situation, you are ready to install FreeBSD!</para>

      <para>Although you should not experience any difficulty, there is
        always the chance that you may, no matter how slight it is.  If this
	is the case in your situation, then you may wish to go back and
	re-read the relevant preparation section or sections.  Perhaps you
	will come across something you missed the first time.  If you are
	having hardware problems, or FreeBSD refuses to boot at all, read
	the <ulink url="../FAQ/hardware.html">Hardware Guide</ulink> for a
	list of possible solutions.</para>

      <indexterm>
        <primary><application>sysinstall</application></primary>
      </indexterm>
      <para>The FreeBSD boot floppies contain all of the online
        documentation you should need to be able to navigate through an
	installation.  If it does not, please let us know what you found
	to be the most confusing or most lacking.  Send your comments to
	the &a.doc;.  It is the objective of the installation program
	(sysinstall) to be self-documenting enough that painful
	<quote>step-by-step</quote> guides are no longer necessary.  It may
	take us a little while to reach that objective, but nonetheless,
	it is still our objective.</para>

      <para>Meanwhile, you may also find the following <quote>typical
        installation sequence</quote> to be helpful:</para>

      <orderedlist>
        <listitem>
	  <para>Boot the <filename>kern.flp</filename> floppy and when
	    asked, remove it and insert the
	    <filename>mfsroot.flp</filename> and hit return.  After a
	    boot sequence which can take anywhere from 30 seconds to 3
	    minutes, depending on your hardware, you should be presented
	    with a menu of initial choices.  If the
	    <filename>kern.flp</filename> floppy does not boot at all or
	    the boot hangs at some stage, read the Q&amp;A section of the
	    <ulink url="../FAQ/hardware.html">Hardware Guide</ulink> for
	    possible causes.</para>
	</listitem>

	<listitem>
	  <para>Press F1.  You should see some basic usage instructions on
	    the menu screen and general navigation.  If you have not used
	    this menu system before then <emphasis>please</emphasis> read
	    this thoroughly.</para>
	</listitem>

	<listitem>
	  <para>Select the Options item and set any special preferences
	    you may have.</para>
	</listitem>

        <indexterm>
          <primary>installation</primary>
          <secondary>standard</secondary>
        </indexterm>
        <indexterm>
          <primary>installation</primary>
          <secondary>express</secondary>
        </indexterm>
        <indexterm>
          <primary>installation</primary>
          <secondary>custom</secondary>
        </indexterm>
	<listitem>
	  <para>Select a Standard, Express, or Custom install, depending on
	    whether or not you would like the installation to help you
	    through a typical installation, give you a high degree of
	    control over each step, or simply whiz through it (using
	    reasonable defaults when possible) as fast as possible.  If
	    you have never used FreeBSD before, the Standard installation
	    method is most recommended.</para>
	</listitem>

	<listitem>
	  <para>The final configuration menu choice allows you to further
	    configure your FreeBSD installation by giving you menu-driven
	    access to various system defaults.  Some items, like
	    networking, may be especially important if you did a CDROM,
	    tape, or floppy install and have not yet configured your
	    network interfaces (assuming you have any).  Properly
	    configuring such interfaces here will allow FreeBSD to come up
	    on the network when you first reboot from the hard
	    disk.</para>
	</listitem>
      </orderedlist>
    </sect2>
  </sect1>

  <sect1>
    <title>Supported Hardware</title>

    <indexterm><primary>hardware</primary></indexterm>
    <para>FreeBSD currently runs on a wide variety of ISA, VLB, EISA, and
      PCI bus-based PCs with Intel, AMD, Cyrix, or NexGen
      <quote>x86</quote> processors, as well as a number of
      machines based on the Compaq Alpha processor.
      Support for generic IDE or
      ESDI drive configurations, various SCSI controllers, PCMCIA
      cards, USB devices, and network and
      serial cards is also provided.  FreeBSD also supports IBM's
      microchannel (MCA) bus.</para>

    <para>A list of supported hardware is provided with each FreeBSD
      release in the FreeBSD Hardware Notes.  This document can
      usually be found in a file named
      <filename>HARDWARE.TXT</filename>, in the top-level directory of
      a CDROM or FTP distribution or in sysinstall's documentation
      menu.  It lists, for a given architecture, what hardware devices
      are known to be supported by each release of FreeBSD.</para>

  </sect1>

  <sect1 id="install-trouble">
    <title>Troubleshooting</title>

    <indexterm>
      <primary>installation</primary>
      <secondary>troubleshooting</secondary>
    </indexterm>
    <para>The following section covers basic installation troubleshooting,
      such as common problems people have reported.  There are also a few
      questions and answers for people wishing to dual-boot FreeBSD with
      MS-DOS.</para>

    <sect2>
      <title>What to do if something goes wrong...</title>

      <para>Due to various limitations of the PC architecture, it is
        impossible for probing to be 100% reliable, however, there are a
        few things you can do if it fails.</para>

      <para>Check the Hardware Notes document for your version of
        FreeBSD to make sure your hardware is
        supported.</para>

      <para>If your hardware is supported and you still experience
        lock-ups or other problems, reset your computer, and when the
        visual kernel configuration option is given, choose it.  This will
        allow you to go through your hardware and supply information to the
        system about it.  The kernel on the boot disks is configured
        assuming that most hardware devices are in their factory default
        configuration in terms of IRQs, IO addresses, and DMA channels.  If
        your hardware has been reconfigured, you will most likely need to
        use the configuration editor to tell FreeBSD where to find
        things.</para>

      <para>It is also possible that a probe for a device not present will
        cause a later probe for another device that is present to fail.  In
        that case, the probes for the conflicting driver(s) should be
        disabled.</para>

      <warning>
        <para>Do not disable any drivers you will need during the
          installation, such as your screen (<devicename>sc0</devicename>).
	  If the installation wedges or fails mysteriously after leaving
	  the configuration editor, you have probably removed or changed
	  something you should not have.  Reboot and try again.</para>
      </warning>

      <para>In configuration mode, you can:</para>

      <itemizedlist>
        <listitem>
          <para>List the device drivers installed in the kernel.</para>
        </listitem>

        <listitem>
          <para>Change device drivers for hardware that is not present in
	    your system.</para>
        </listitem>

        <listitem>
          <para>Change IRQs, DRQs, and IO port addresses used by a device
	    driver.</para>
        </listitem>
      </itemizedlist>

      <para>After adjusting the kernel to match your hardware
        configuration, type <command>Q</command> to boot with the new
        settings.  Once the installation has completed, any changes you
        made in the configuration mode will be permanent so you do not have
        to reconfigure every time you boot.  It is still highly likely that
        you will eventually want to build a <link
        linkend="kernelconfig">custom kernel</link>.</para>
    </sect2>
    
    <sect2>
      <title>MS-DOS User's Questions and Answers</title>

      <indexterm><primary>DOS</primary></indexterm>
      <para>Many users wish to install FreeBSD on PCs inhabited by MS-DOS.
        Here are some commonly asked questions about installing FreeBSD on
        such systems.</para>

      <qandaset>
        <qandaentry>
	  <question>
	    <para>Help, I have no space!  Do I need to delete everything 
	      first?</para>
	  </question>

	  <answer>
	    <para>If your machine is already running MS-DOS and has little
	      or no free space available for the FreeBSD installation, all
	      hope is not lost!  You may find the FIPS utility, provided
	      in the <filename>tools</filename> directory on the FreeBSD
	      CDROM or various FreeBSD FTP sites to be quite
	      useful.</para>

	    <indexterm>
        <primary><command>FIPS</command></primary>
      </indexterm>
	    <para>FIPS allows you to split an existing MS-DOS partition
	      into two pieces, preserving the original partition and
	      allowing you to install onto the second free piece.  You
	      first defragment your MS-DOS partition using the Windows
	      DEFRAG utility (go into Explorer, right-click on the
	      hard drive, and choose to defrag your
	      hard drive), or Norton Disk Tools. You then must run FIPS.  It
	      will prompt you for the rest of the information it needs.
	      Afterwards, you can reboot and install FreeBSD on the new
	      free slice.  See the <emphasis>Distributions</emphasis> menu
	      for an estimate of how much free space you will need for the
	      kind of installation you want.</para>

	    <indexterm>
        <primary><application>Partition Magic</application></primary>
      </indexterm>
	    <para>There is also a <emphasis>very</emphasis> useful
	      product from <ulink
	      url="http://www.powerquest.com/">PowerQuest</ulink>
	      called <application>Partition Magic</application>. This
	      application has far more functionality than FIPS, and is
	      highly recommended if you plan to often add/remove
	      operating systems (like me). However, it does cost
	      money, and if you plan to install FreeBSD once and then
	      leave it there, FIPS will probably be fine for you.</para>
	  </answer>
	</qandaentry>

	<qandaentry>
	  <question>
	    <para>Can I use compressed MS-DOS filesystems from
	      FreeBSD?</para>
	  </question>

	  <answer>
	    <para>No.  If you are using a utility such as Stacker(tm) or
	      DoubleSpace(tm), FreeBSD will only be able to use whatever
	      portion of the filesystem you leave uncompressed.  The rest
	      of the filesystem will show up as one large file (the
	      stacked/double spaced file!).  <emphasis>Do not remove that
	      file or you will probably regret it
	      greatly!</emphasis></para>

	    <para>It is probably better to create another uncompressed
	      primary MS-DOS partition and use this for communications
	      between MS-DOS and FreeBSD.</para>
	  </answer>
	</qandaentry>

	<qandaentry>
	  <question>
	    <para>Can I mount my extended MS-DOS partition?</para>
	  </question>

	  <answer>
	    <indexterm><primary>partitions</primary></indexterm>
	    <indexterm><primary>slices</primary></indexterm>
	    <para>Yes.  DOS extended partitions are mapped in at the end
	      of the other <quote>slices</quote> in FreeBSD, e.g., your
	      <devicename>D:</devicename> drive might be
	      <filename>/dev/da0s5</filename>, your
	      <devicename>E:</devicename> drive,
	      <filename>/dev/da0s6</filename>, and so on.  This example
	      assumes, of course, that your extended partition is on SCSI
	      drive 0.  For IDE drives, substitute <filename>ad</filename>
	      for <filename>da</filename> appropriately if installing
	      4.0-RELEASE or later, and substitute
	      <filename>wd</filename> for <filename>da</filename> if you
	      are installing a version of FreeBSD prior to 4.0.  You otherwise
	      mount extended partitions exactly like you would any other
	      DOS drive, for example:</para>

	    <screen>&prompt.root; <userinput>mount -t msdos /dev/ad0s5 /dos_d</userinput></screen>
	  </answer>
	</qandaentry>
      </qandaset>
    </sect2>
  </sect1>

  <sect1 id="install-advanced">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Valentino</firstname>
	  <surname>Vaschetto</surname>
	  <contrib>Contributed by </contrib>
	</author>
	<!-- May 2001 -->
      </authorgroup>
    </sect1info>

    <title>Advanced Installation Guide</title>

    <para>This section describes how to install FreeBSD in exceptional
       cases.</para>

    <sect2 id="headless-install">
      <title>Installing FreeBSD on a system without a monitor or
        keyboard</title>

      <indexterm>
        <primary>installation</primary>
        <secondary>headless (serial console)</secondary>
      </indexterm>
      <indexterm><primary>serial console</primary></indexterm>
      <para>This type of installation is called a "headless install",
        because the machine that you are trying to install FreeBSD on
        either doesnt have a monitor attached to it, or doesnt even
        have a VGA output. How is this possible you ask? Using a
        serial console. A serial console is basically using another
        machine to act as the main display and keyboard for a
        system. To do this, just follow these steps:</para>

      <procedure>
        <step>
          <title>Fetch the right boot floppy images</title>

          <para>First you will need to get the right disk images so
            that you can boot into the install program. The secret
            with using a serial console is that you tell the boot
            loader to send I/O through a serial port instead of
            displaying console output to the VGA device and trying to
            read input from a local keyboard.  Enough of that now,
            let's get back to getting these disk images.</para>

	  <para>You will need to get <ulink url="ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/floppies/kern.flp">kern.flp</ulink> and
            <ulink url="ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/floppies/mfsroot.flp">
            mfsroot.flp</ulink> from the
            <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/&rel.current;-RELEASE/floppies/">
            floppies directory</ulink>.</para>

        </step>
        <step>
	  <title>Write the image files to the floppy disks.</title>

          <para>The image files, such as
	    <filename>kern.flp</filename>, are
	    <emphasis>not</emphasis> regular files that you copy to
	    the disk.  Instead, they are images of the complete
	    contents of the disk.</para>

	  <para>This means that you can <emphasis>not</emphasis> use
	    commands like DOS' <command>copy</command> to write the
	    files.  Instead, you must use specific tools to write the
	    images directly to the disk.</para>
	  
	  <indexterm>
      <primary><command>fdimage</command></primary>
    </indexterm>
	  <para>If you are creating the floppies on a computer running
	    DOS then we provide a tool to do this called
	    <command>fdimage</command>.</para>
	  
	  <para>If you are using the floppies from the CDROM, and
	    your CDROM is the <devicename>E:</devicename> drive then
	    you would run this:</para>

	  <screen><prompt>E:\&gt;</prompt> <userinput>tools\fdimage floppies\kern.flp A:</userinput></screen> 

	  <para>Repeat this command for each <filename>.flp</filename>
	    file, replacing the floppy disk each time.  Adjust the
	    command line as necessary, depending on where you have
	    placed the <filename>.flp</filename> files.  If you do not
	    have the CDROM then <command>fdimage</command> can be
	    downloaded from the <ulink
	    url="ftp://ftp.FreeBSD.org/pub/FreeBSD/tools/"><filename>tools</filename>
	    directory</ulink> on the FreeBSD FTP site.</para>

	  <para>If you are writing the floppies on a Unix system (such
	    as another FreeBSD system) you can use the &man.dd.1;
	    command to write the image files directly to disk.  On
	    FreeBSD you would run:</para>

	  <screen>&prompt.root; <userinput>dd if=kern.flp of=/dev/fd0</userinput></screen>

	  <para>On FreeBSD <filename>/dev/fd0</filename> refers to
	    the first floppy disk (the <devicename>A:</devicename>
	    drive).  <filename>/dev/fd1</filename> would be the
	    <devicename>B:</devicename> drive, and so on.  Other Unix
	    variants might have different names for the floppy disk
	    devices, and you will need to check the documentation for
	    the system as necessary.</para>

	  </step>

	  <step>
	    <title>Enabling the boot floppies to boot into a serial
	    console</title>

            <warning>
              <para>Do not try to mount the floppy if it is write-protected</para>
            </warning>

  	    <indexterm>
          <primary><command>mount</command></primary>
        </indexterm>
	    <para>If you were to boot into the floppies that you just
	      made, FreeBSD would boot into its normal install mode. We
	      want FreeBSD to boot into a serial console for our
	      install. To do this, you have to mount the
	      <filename>kern.flp</filename> floppy onto your FreeBSD
	      system using the &man.mount.8; command.</para>

            <screen>&prompt.root; <userinput>mount /dev/fd0 /mnt</userinput></screen>

	    <para>Now that you have the floppy mounted, you must
	      change into the floppy directory</para>

	    <screen>&prompt.root; <userinput>cd /mnt</userinput></screen>

	    <para>Here is where you must set the floppy to boot into a
	      serial console. You have to make a file called
	      <filename>boot.config</filename> containing "/boot/loader
	      -h".  All this does is pass a flag to the bootloader to
	      boot into a serial console.</para>

	    <screen>&prompt.root; <userinput>echo "/boot/loader -h" > boot.config</userinput></screen>

	    <para>Now that you have your floppy configured correctly,
	      you must unmount the floppy using the &man.umount.8;
	      command</para>

            <screen>&prompt.root; <userinput>cd /</userinput>
&prompt.root; <userinput>umount /mnt</userinput></screen>

	    <para>Now you can remove the floppy from the floppy
	      drive</para>
	  </step>

	  <step>
	    <title>Connecting your null modem cable</title>

  	    <indexterm><primary>null-modem cable</primary></indexterm>
	    <para>You now need to connect a null modem cable between
	      the two machines. Just connect the cable to the serial
	      ports of the 2 machines. <emphasis>A normal serial cable
	      will not work here</emphasis>, you need a null modem
	      cable because it has some of the wires inside crossed
	      over.</para>
	  </step>

	  <step>
	    <title>Booting up for the install</title>

	    <para>It's now time to go ahead and start the install. Put
	      the <filename>kern.flp</filename> floppy in the floppy
	      drive of the machine you're doing the headless install
	      on, and power on the machine.</para>
	  </step>

	  <step>
	    <title>Connecting to your headless machine</title>
	    <indexterm>
        <primary><command>cu</command></primary>
      </indexterm>
	    <para>Now you have to connect to that machine with
	    &man.cu.1;:</para> 

	    <screen>&prompt.root; <userinput>cu -l /dev/cuaa0</userinput></screen>
	  </step>
      </procedure>

      <para>That's it! You should be able to control the headless
        machine through your cu session now.  It will ask you to put
        in the <filename>mfsroot.flp</filename>, and then it will come
        up with a selection of what kind of terminal to use. Just
        select the FreeBSD color console and proceed with your
        install!</para>

    </sect2>
  </sect1>

</chapter>

<!-- 
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
