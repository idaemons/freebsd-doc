<!--
     The FreeBSD Dutch Documentation Project

     $FreeBSD$
     $FreeBSDnl: nl_NL.ISO8859-1/books/handbook/disks/chapter.sgml,v 1.27 2005/08/02 19:33:26 siebrand Exp $
     Gebaseerd op: 1.239
-->

<chapter id="disks">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Ren&eacute;</firstname>
	<surname>Ladan</surname>
	<contrib>Vertaald door </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Opslag</title>

  <sect1 id="disks-synopsis">
    <title>Overzicht</title>

    <para>Dit hoofdstuk behandelt het gebruik van schijven in &os;.
      Dit omvat geheugenschijven, schijven die met het netwerk
      verbonden zijn, SCSI/IDE-opslagapparaten en apparaten die gebruik
      maken van de USB-interface.</para>

    <para>Na het lezen van dit hoofdstuk weet de lezer:</para>

    <itemizedlist>
      <listitem>
	<para>Welke terminologie &os; gebruikt om de gegevensindeling
	  op een fysieke schijf te beschrijven (partities en
	  slices);</para>
      </listitem>

      <listitem>
	<para>Hoe aanvullende harde schijven aan een systeem toe te
	  voegen;</para>
      </listitem>

      <listitem>
	<para>Hoe &os; in te stellen om het gebruik te laten maken van
	  USB-opslagapparaten;</para>
      </listitem>

      <listitem>
	<para>Hoe virtu&euml;le bestandssystemen, zoals
	  geheugenschijven, aan te maken;</para>
      </listitem>

      <listitem>
	<para>Hoe quota te gebruiken om het schijfgebruik te
	  beperken;</para>
      </listitem>

      <listitem>
	<para>Hoe schijven te versleutelen om ze tegen inbrekers te
	  beschermen;</para>
      </listitem>

      <listitem>
	<para>Hoe vanuit &os; CD's en DVD's aan te maken en te
	  branden;</para>
      </listitem>

      <listitem>
	<para>Wat de verschillende mogelijkheden zijn voor opslagmedia
	  voor back-ups;</para>
      </listitem>

      <listitem>
	<para>Hoe back-upprogramma's te gebruiken die beschikbaar zijn
	  in &os;;</para>
      </listitem>

      <listitem>
	<para>Hoe een back-up naar diskettes te maken;</para>
      </listitem>

      <listitem>
	<para>Wat snapshots zijn en hoe ze effici&euml;nt te
	  gebruiken.</para>
      </listitem>
    </itemizedlist>

    <para>Aangeraden voorkennis:</para>

    <itemizedlist>
      <listitem>
	<para>Hoe een nieuwe &os;-kernel in te stellen en te
	  installeren (<xref linkend="kernelconfig">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="disks-naming">
    <title>Apparaatnamen</title>

    <para>De volgende lijst noemt de fysieke opslagapparaten die in
      &os; ondersteund worden, samen met de bijhorende namen.</para>

    <table id="disk-naming-physical-table" frame="none">
      <title>Naamconventies voor fysieke Schijven</title>

      <tgroup cols="2">
	<thead>
	  <row>
	    <entry>Type medium</entry>

	    <entry>Apparaatnaam medium</entry>
	  </row>
	</thead>

	<tbody>
	  <row>
	    <entry>IDE harde schijven</entry>

	    <entry><literal>ad</literal></entry>
	  </row>

	  <row>
	    <entry>IDE CD-ROM-stations</entry>

	    <entry><literal>acd</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI harde schijven en USB-apparaten voor
	      massa-opslag</entry>

	    <entry><literal>da</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI CD-ROM-schijven</entry>

	    <entry><literal>cd</literal></entry>
	  </row>

	  <row>
	    <entry>Overige niet-standaard-CD-ROM-stations</entry>

	    <entry><literal>mcd</literal> voor Mitsumi CD-ROM,
	      <literal>scd</literal> voor Sony CD-ROM,
	      <literal>matcd</literal> voor Matsushita/Panasonic CD-ROM

	      <footnote>
		<para>Het stuurprogramma voor &man.matcd.4; is sinds
		  2002 uit de &os;&nbsp;4.X-tak verwijderd en bestaat
		  niet in &os; versies 5.0 en latere versies.
		</para>
	      </footnote>
	    </entry>
	  </row>

	  <row>
	    <entry>Diskettestations</entry>

	    <entry><literal>fd</literal></entry>
	  </row>

	  <row>
	    <entry>SCSI bandstations</entry>

	    <entry><literal>sa</literal></entry>
	  </row>

	  <row>
	    <entry>IDE bandstations</entry>

	    <entry><literal>ast</literal></entry>
	  </row>

	  <row>
	    <entry>Flashdrives</entry>

	    <entry><literal>fla</literal> voor &diskonchip;
	      flashapparaten</entry>
	  </row>

	  <row>
	    <entry>RAID-schijven</entry>

	    <entry><literal>aacd</literal> voor &adaptec; AdvancedRAID,
	      <literal>mlxd</literal> en <literal>mlyd</literal> voor
	      &mylex;, <literal>amrd</literal> voor AMI &megaraid;,
	      <literal>idad</literal> voor Compaq Smart RAID,
	      <literal>twed</literal> voor &tm.3ware; RAID.</entry>
	    </row>
	</tbody>
      </tgroup>
    </table>
  </sect1>

  <sect1 id="disks-adding">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>David</firstname>
	  <surname>O'Brien</surname>
	  <contrib>Origineel bijgedragen door </contrib>
	</author>
      </authorgroup>
      <!-- 26 april 1998 -->
    </sect1info>

    <title>Schijven toevoegen</title>

    <indexterm>
      <primary>schijven</primary>

      <secondary>toevoegen</secondary>
    </indexterm>

    <para>Stel dat het gewenst is om een nieuwe SCSI-schijf aan een
      machine toe te voegen die slechts een enkele drive heeft.  Ten
      eerste dient de computer uitgeschakeld te worden en dient de
      schijf volgens de instructies van de computer, controller en
      schijffabrikant ge&iuml;nstalleerd te worden.  Wegens de grote
      vari&eacute;teiten om dit soort procedures uit te voeren, vallen
      de details buiten het bereik van dit document.</para>

    <para>Er dient als gebruiker <username>root</username> ingelogd te
      worden.  Nadat de schijf is toegevoegd, dient
      <filename>/var/run/dmesg.boot</filename> bekeken te worden om er
      zeker van te zijn dat de nieuwe schijf is gevonden.  Volgens het
      voorbeeld heet de nieuw toegevoegde schijf
      <devicename>da1</devicename> en die wordt gemount op
      <filename>/1</filename> (als er een IDE-schijf wordt toegevoegd,
      is de apparaatnaam <devicename>wd1</devicename> op systemen
      voorafgaand aan 4.0, en <devicename>ad1</devicename> in 4.X- en
      5.X-systemen).</para>

    <indexterm><primary>partities</primary></indexterm>

    <indexterm><primary>slices</primary></indexterm>

    <indexterm><primary><command>fdisk</command></primary></indexterm>

    <para>&os; draait op IBM-PC-compatibele computers.  Daarom moet het
      rekening houden met de PC-BIOS-partities.  Deze wijken af van de
      traditionele BSD-partities.  Een PC-schijf bevat tot vier
      ingangen voor BIOS-partities.  Indien de schijf geheel aan &os;
      wordt gewijd, kan de <emphasis>toegewijde</emphasis>-modus
      gebruikt worden.  In het andere geval moet &os; binnen
      &eacute;&eacute;n van de vier PC-BIOS-partities draaien.  De
      PC-BIOS-partities worden door &os; <emphasis>slices</emphasis>
      genoemd om ze niet met de traditionele BSD-partities te
      verwarren.  Slices kunnen ook op een schijf worden gebruikt die
      toegewijd is aan &os;, maar in een computer zit die ook andere
      besturingssystemen heeft ge&iuml;nstalleerd.  Dit is een goede
      manier om verwarring met het programma <command>fdisk</command>
      van andere, niet-&os; besturingssystemen te voorkomen.</para>

    <para>Als er met slices gewerkt wordt, wordt de schijf toegevoegd
      als <filename>/dev/da1s1e</filename>.  Dit moet worden gelezen
      als: SCSI-schijf, eenheid 1 (tweede SCSI-schijf), slice 1
      (PC-BIOS-partitie 1) en BSD-partitie <filename>e</filename>.  Als
      de schijf toegewijd is, wordt deze simpelweg als
      <filename>/dev/da1e</filename> toegevoegd.</para>

    <para>Omdat 32-bit-integers worden gebruikt om het aantal sectoren
      op te slaan, is &man.bsdlabel.8; (&man.disklabel.8; op
      &os;&nbsp;4.X) beperkt tot 2^32-1 sectoren per schijf, wat
      meestal neerkomt op 2&nbsp;TB.  Het programma &man.fdisk.8; staat
      geen hogere startsector toe dan 2^32-1 en geen grotere lengte dan
      2^32-1, meestal worden hiermee partities tot 2&nbsp;TB begrensd
      en schijven tot 4&nbsp;TB.  Het formaat van &man.sunlabel.8; is
      beperkt tot 2^32-1 sectoren per partitie en 8 partities per
      schijf, in totaal dus 16&nbsp;TB.  Voor grotere schijven kan
      &man.gpt.8; worden gebruikt.</para>

    <sect2>
      <title>&man.sysinstall.8; gebruiken</title>

      <indexterm>
	<primary><application>sysinstall</application></primary>

	<secondary>schijven toevoegen</secondary>
      </indexterm>

      <indexterm><primary>su</primary></indexterm>

      <procedure>
	<step>
	  <title>Navigeren door
	    <application>sysinstall</application></title>

	  <para><command>sysinstall</command>
	    (<command>/stand/sysinstall</command> in versies van &os;
	    ouder dan 5.2) kan gebruikt worden om een nieuwe schijf te
	    partitioneren en te labelen met eenvoudig te gebruiken
	    menu's.  Hiervoor dient &ograve;fwel als gebruiker
	    <username>root</username> ingelogd te zijn, &ograve;fwel
	    gebruik te worden gemaakt van <command>su</command>.  Draai
	    <command>sysinstall</command> en ga naar het menu
	    <literal>Configure</literal>.  Scroll binnen het
	    <literal>&os; Configuration Menu</literal> naar
	    beneden en kies de optie <literal>Fdisk</literal>.</para>
	</step>

	<step>
	  <title><application>fdisk</application>
	    partitie-bewerker</title>

	  <para>Eenmaal binnen <application>fdisk</application> kan
	    <userinput>a</userinput> ingetypt worden om de gehele
	    schijf voor &os; te gebruiken.  Wanneer gevraagd wordt of
	    het systeem compatibel dient te blijven met mogelijk
	    toekomstige besturingssystemen, dient met
	    <literal>YES</literal> geantwoord te worden.  Met
	    <userinput>W</userinput> kunnen de veranderingen naar de
	    schijf worden geschreven.  Nu dient de FDISK-bewerker
	    verlaten te worden door het intypen van
	    <userinput>q</userinput>.  Vervolgens wordt er een vraag
	    gesteld over het <quote>Master Boot Record</quote>.  Omdat
	    er een schijf aan een reeds draaiend systeem wordt
	    toegevoegd, dient hier <literal>None</literal> gekozen te
	    worden.</para>
	</step>

	<step>
	  <title>Schijflabelbewerker</title>

	  <indexterm><primary>BSD-partities</primary></indexterm>

	  <para>Vervolgens dient <application>sysinstall</application>
	    verlaten en opnieuw gestart te worden.  Volg bovenstaande
	    aanwijzingen, maar kies deze keer voor de optie
	    <literal>Label</literal>.  Dit geeft toegang tot de
	    <literal>Disk Label Editor</literal>.   Hier worden de
	    traditionele BSD-partities aangemaakt.  Een schijf kan tot
	    acht partities bevatten, gelabeld <literal>a-h</literal>.
	    Enkele partitielabels hebben een speciale functie.  De
	    partitie <literal>a</literal> wordt gebruikt voor de
	    rootpartitie (<filename>/</filename>).  Alleen de
	    systeemschijf (bijvoorbeeld de schijf van waaruit opgestart
	    wordt) moet een partitie <literal>a</literal> hebben.  De
	    partitie <literal>b</literal> wordt voor swappartities
	    gebruikt, en het is mogelijk om vele schijven met
	    swappartities te hebben.  De partitie <literal>c</literal>
	    adresseert de gehele schijf in toegewijde modus, of de
	    gehele &os;-slice in slice-modus.  De andere partities zijn
	    voor algemeen gebruik.</para>

	  <para><application>sysinstall</application>'s Labelbewerker
	    heeft een voorkeur voor de partitie <literal>e</literal>
	    voor niet-root-niet-swap-partities.  Binnen de
	    Labelbewerker dient een enkel bestandssysteem te worden
	    aangemaakt door <userinput>C</userinput> in te typen.  Kies
	    <literal>FS</literal> wanneer gevraagd wordt of dit een FS
	    (file system) of swap wordt, en geef een mountpunt in
	    (bijvoorbeeld <filename>/mnt</filename>).  Wanneer een
	    schijf in post-installatie-modus wordt toegevoegd, maakt
	    <application>sysinstall</application> geen ingangen aan in
	    <filename>/etc/fstab</filename>, dus dan is het opgegeven
	    mountpunt niet van belang.</para>

	  <para>Nu kan het nieuwe label naar de schijf worden
	    geschreven en er een bestandssysteem op aangemaakt worden.
	    Dit kan gedaan worden door <userinput>W</userinput> in te
	    typen.  Fouten van <application>sysinstall</application>
	    dat de nieuwe partitie niet gemount kon worden kunnen
	    genegeerd worden.  De Labelbewerker en
	    <application>sysinstall</application> kunnen nu volledig
	    verlaten worden.</para>
	</step>

	<step>
	  <title>Afronden</title>

	  <para>De laatste stap bestaat uit het bewerken van
	    <filename>/etc/fstab</filename> om hier een regel voor de
	    nieuwe schijf aan toe te voegen.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Het gebruik van opdrachtregelgereedschappen</title>

      <sect3>
	<title>Het gebruik van slices</title>

	<para>Deze installatie zorgt ervoor dat de schijf correct
	  samenwerkt met andere besturingssystemen die eventueel op de
	  computer zijn ge&iuml;nstalleerd en dat de
	  <command>fdisk</command>-gereedschappen van andere
	  besturingssystemen niet verward raken.  Het wordt aangeraden
	  om deze methode te gebruiken voor de installatie van nieuwe
	  schijven.  Gebruik de <literal>toegewijde</literal> modus
	  alleen als hier een goede reden voor bestaat!</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>fdisk -BI da1</userinput> # Initialiseer de nieuwe schijf.
&prompt.root; <userinput>disklabel -B -w -r da1s1 auto</userinput> # Label de schijf.
&prompt.root; <userinput>disklabel -e da1s1</userinput> # Bewerk de zojuist aangemaakte schijflabel en voeg partities toe.
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>newfs /dev/da1s1e</userinput> # Herhaal dit voor alle aangemaakte partities.
&prompt.root; <userinput>mount /dev/da1s1e /1</userinput> # Mount de partitie(s).
&prompt.root; <userinput>vi /etc/fstab</userinput> # Voeg de juiste regel(s) aan <filename>/etc/fstab</filename> toe.</screen>

	<para>Vervang voor een IDE-schijf <filename>da</filename> door
	  <filename>ad</filename>.  Op systemen voor 4.X dient
	  <filename>wd</filename> gebruikt te worden.</para>
      </sect3>

      <sect3>
	<title>Toegewijd</title>

	<indexterm><primary>OS/2</primary></indexterm>

	<para>Indien de nieuwe schijf niet met een ander
	  besturingssysteem gedeeld wordt, kan de
	  <literal>toegewijde</literal> modus gebruikt worden.  Denk
	  eraan dat deze modus besturingssystemen van Microsoft kan
	  verwarren.  Ze richten echter geen schade aan.  IBM's &os2;
	  <quote>fatsoeneert</quote> echter partities die het niet
	  begrijpt.</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 bs=1k count=1</userinput>
&prompt.root; <userinput>disklabel -Brw da1 auto</userinput>
&prompt.root; <userinput>disklabel -e da1</userinput> # Maak de `e'-partitie aan.
&prompt.root; <userinput>newfs -d0 /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput>
&prompt.root; <userinput>vi /etc/fstab</userinput> # Voeg een regel voor /dev/da1e toe.
&prompt.root; <userinput>mount /1</userinput></screen>

	<para>Een alternatieve methode is:</para>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=/dev/da1 count=2</userinput>
&prompt.root; <userinput>disklabel /dev/da1 | disklabel -BrR da1 /dev/stdin</userinput>
&prompt.root; <userinput>newfs /dev/da1e</userinput>
&prompt.root; <userinput>mkdir -p /1</userinput> # Voeg een regel voor /dev/da1e toe.
&prompt.root; <userinput>mount /1</userinput></screen>

	<note>
	  <para>Sinds &os;&nbsp;5.1-RELEASE is het oude programma
	    &man.disklabel.8; vervangen door &man.bsdlabel.8;.  In
	    &man.bsdlabel.8; zijn een aantal overbodige opties en
	    parameters verwijderd.  In de bovenstaande voorbeelden
	    dient de optie <option>-r</option> met &man.bsdlabel.8;
	    weggelaten te worden.  Meer informatie staat in de
	    hulppagina van &man.bsdlabel.8;.</para>
	</note>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="raid">
    <title>RAID</title>

    <sect2 id="raid-soft">
      <title>Software RAID</title>

      <sect3 id="ccd">
	<sect3info>
	  <authorgroup>
	    <author>
	      <firstname>Christopher</firstname>
	      <surname>Shumway</surname>
	      <contrib>Origineel werk van </contrib>
	    </author>
	  </authorgroup>

	  <authorgroup>
	    <author>
	      <firstname>Jim</firstname>
	      <surname>Brown</surname>
	      <contrib>Herzien door </contrib>
	    </author>
	  </authorgroup>
	</sect3info>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>softwarematig</secondary>
	</indexterm>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>CCD</secondary>
	</indexterm>

	<title>Concatenated Disk Driver (CCD) instellingen</title>

	<para>Bij het kiezen van een medium voor massa-opslag zijn de
	  belangrijkste afwegingen snelheid, betrouwbaarheid en kosten.
	  Het komt zelden voor dat alle drie in balans zijn.
	  Normaalgesproken is een snel, betrouwbaar apparaat voor
	  massa-opslag duur en kosten sparen gaat ten koste van
	  &ograve;fwel snelheid &ograve;fwel betrouwbaarheid.</para>

	<para>Bij het ontwerpen van het onderstaande systeem werd
	  primair op de kosten gelet, gevolgd door snelheid en als
	  laatste betrouwbaarheid.  De overdrachtsnelheid van gegevens
	  wordt voor dit systeem uiteindelijk beperkt door het netwerk.
	  En hoewel betrouwbaarheid erg belangrijk is, wordt
	  onderstaande CCD-schijf gebruikt voor het serven van on-line
	  gegevens die reeds volledig op CD-R's zijn geback-upt en
	  eenvoudig vervangen kunnen worden.</para>

	<para>De eerste stap in het kiezen van een
	  massa-opslagoplossing is het bepalen van de eigen
	  benodigdheden.  Indien snelheid belangrijker is dan
	  betrouwbaarheid of kosten, wijkt de oplossing af van het
	  systeem dat in deze sectie wordt beschreven.</para>

	<sect4 id="ccd-installhw">
	  <title>Hardware installeren</title>

	  <para>Als aanvulling op de IDE systeemschijf zijn drie
	    Western Digital IDE-schijven van 30&nbsp;GB, 5400&nbsp;RPM
	    vanuit de kern van de onderstaande CCD-schijf aanwezig, die
	    ongeveer 90&nbsp;GB aan on-line opslag bieden.  Ideaal
	    gezien heeft iedere IDE-schijf een eigen IDE-controller en
	    kabel, maar om de kosten te minimaliseren zijn geen
	    aanvullende IDE-kabels gebruikt.  In plaats hiervan zijn de
	    schijven zodanig met jumpers ingesteld dat elke
	    IDE-controller &eacute;&eacute;n master en
	    &eacute;&eacute;n slave heeft.</para>

	  <para>Tijdens het opnieuw opstarten werd het systeem-BIOS
	    zodanig ingesteld dat het automatisch de aangekoppelde
	    schijven detecteerde.  Het was belangrijker dat &os; ze
	    tijdens het opnieuw opstarten herkende:</para>

	  <programlisting>ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</programlisting>

	  <note>
	    <para>Indien &os; niet alle schijven detecteert, moet
	      gecontroleerd worden of de jumpers juist zijn ingesteld.
	      De meeste IDE-schijven hebben ook een jumper voor
	      <quote>Cable Select</quote>.  Dit is
	      <emphasis>niet</emphasis> de jumper voor de
	      master/slave-instelling.  Voor hulp met het identificeren
	      van de juiste jumper dient de documentatie van de schijf
	      geraadpleegd te worden.</para>
	  </note>

	  <para>Vervolgens dient besloten te worden hoe ze deel gaan
	    uitmaken van het bestandssysteem.  Hiervoor dienen
	    &man.vinum.8; (<xref linkend="vinum-vinum">) en &man.ccd.4;
	    bestudeerd te worden.  Voor deze instellingen werd voor
	    &man.ccd.4; gekozen.</para>
	</sect4>

	<sect4 id="ccd-setup">
	  <title>CCD installeren</title>

	  <para>Het stuurprogramma &man.ccd.4; biedt de mogelijkheid om
	    meerdere identieke schijven aaneen te rijgen tot
	    &eacute;&eacute;n logisch bestandssysteem.  Om gebruik te
	    kunnen maken van &man.ccd.4; is een kernel met ingebouwde
	    ondersteuning voor &man.ccd.4; nodig.  De volgende regel
	    dient toegevoegd te worden aan het
	    kernelinstellingenbestand en de kernel dient opnieuw
	    gebouwd en ge&iuml;nstalleerd te worden:</para>

	  <programlisting>pseudo-device	ccd 4</programlisting>

	  <para>Op 5.X-systemen dient de volgende regel gebruikt
	    te worden:</para>

	  <programlisting>device  ccd</programlisting>

	  <note>
	    <para>In &os;&nbsp;5.X is het niet nodig om het aantal
	      &man.ccd.4;-apparaten op te geven aangezien het
	      &man.ccd.4;-apparaat nu zelfklonend is.  Nieuwe
	      instanties van het apparaat worden automatisch op verzoek
	      aangemaakt.</para>
	  </note>

	  <para>De ondersteuning voor &man.ccd.4; kan ook als
	    kernelmodule geladen worden in &os;&nbsp;3.0 en
	    hoger.</para>

	  <para>Om &man.ccd.4; te installeren dient eerst
	    &man.disklabel.8; gebruikt te worden om de schijven te
	    labelen:</para>

	  <programlisting>disklabel -r -w -ad1 auto
disklabel -r -w ad2 auto
disklabel -r -w ad3 auto</programlisting>

	  <para>Bovenstaande maakt een schijflabel aan voor
	    <devicename>ad1c</devicename>,
	    <devicename>ad2c</devicename> en
	    <devicename>ad3c</devicename> die de gehele schijf
	    beslaat.</para>

	  <note>
	    <para>Sinds &os;&nbsp;5.1-RELEASE is het oude programma
	      &man.disklabel.8; vervangen door &man.bsdlabel.8;.  In
	      &man.bsdlabel.8; zijn een aantal overbodige opties en
	      parameters verwijderd.  In de bovenstaande voorbeelden
	      dient de optie <option>-r</option> met &man.bsdlabel.8;
	      weggelaten te worden.  Meer informatie staat in de
	      hulppagina van &man.bsdlabel.8;.</para>
	  </note>

	  <para>Vervolgens dient het labeltype van de schijf veranderd
	    te worden.  Voor het bewerken van de schijven kan
	    &man.disklabel.8; gebruikt worden:</para>

	  <programlisting>disklabel -e ad1
disklabel -e ad2
disklabel -e ad3</programlisting>

	  <para>Dit zorgt ervoor dat het huidige schijflabel van elke
	    schijf met de tekstverwerker wordt geopend die door de
	    omgevingsvariabele <envar>EDITOR</envar> wordt
	    gespecificeerd, vaak &man.vi.1;.</para>

	  <para>Een ongewijzigd schijflabel ziet er ongeveer als volgt
	    uit:</para>

	  <programlisting>8 partitions:
# size	offset	fstype	[fsize	bsize bps/cpg]
c: 60074784 0 unused  0	0 0 # (Cyl. 0 - 59597)</programlisting>

	  <para>Er dient een nieuwe partitie <literal>e</literal>
	    toegevoegd te worden die door &man.ccd.4; gebruikt kan
	    worden.  Deze kan gewoonlijk van partitie
	    <literal>c</literal> overgenomen worden, maar het
	    <option>fstype</option> <emphasis>moet</emphasis>
	    <userinput>4.2BSD</userinput> zijn.  Het schijflabel ziet
	    er nu ongeveer als volgt uit:</para>

	  <programlisting>8 partitions:
# size	offset	fstype	[fsize	bsize bps/cpg]
c:  60074784  0	unused	0 0 0 # (Cyl. 0 - 59597)
e:  60074784  0	4.2BSD	0 0 0 #	(Cyl. 0 - 59597)</programlisting>
	</sect4>

	<sect4 id="ccd-buildingfs">
	  <title>Bestandssysteem aanmaken</title>

	  <para>Het kan zijn dat de apparaatnode voor
	    <devicename>ccd0c</devicename> nog niet bestaat.  Om deze
	    aan te maken dienen de volgende commando's uitgevoerd te
	    worden:</para>

	  <programlisting>cd /dev
sh MAKEDEV ccd0</programlisting>

	  <note>
	    <para>In &os;&nbsp;5.0 beheert &man.devfs.5; automatisch
	      apparaatnodes in <filename>/dev</filename>, dus is het
	      niet nodig om <command>MAKEDEV</command> te
	      gebruiken.</para>
	  </note>

	  <para>Nu alle schijven gelabeld zijn, moet de &man.ccd.4;
	    gebouwd worden.  Om dit te doen, dient &man.ccdconfig.8;
	    gebruikt te worden met opties die ongeveer gelijk zijn aan
	    de volgende:</para>

	  <programlisting>ccdconfig ccd0<co id="co-ccd-dev"> 32<co id="co-ccd-interleave"> 0<co id="co-ccd-flags"> /dev/ad1e<co id="co-ccd-devs"> /dev/ad2e /dev/ad3e</programlisting>

	  <para>Hieronder staat het gebruik en de betekenis van elke
	    optie:</para>

	  <calloutlist>
	    <callout arearefs="co-ccd-dev">
	      <para>Het eerste argument is het in te stellen apparaat,
		in dit geval <filename>/dev/ccd0c</filename>.  Het
		gedeelte <filename>/dev/</filename> is
		optioneel.</para>
	    </callout>

	    <callout arearefs="co-ccd-interleave">
	      <para>De interleave voor het bestandssysteem.  De
		interleave defini&euml;ert de grootte van een stripe
		in schijfblokken, elk schijfblok is normaalgesproken
		512&nbsp;bytes groot.  Een interleave van 32 is dus
		16.384&nbsp;bytes groot.</para>
	    </callout>

	    <callout arearefs="co-ccd-flags">
	      <para>Vlaggen voor &man.ccdconfig.8;.  Indien het gewenst
		is om schijfspiegeling aan te zetten, kan er hier een
		vlag voor gespecificeerd worden.  Deze opstelling biedt
		geen spiegeling voor &man.ccd.4;, dus is die op 0 (nul)
		ingesteld.</para>
	    </callout>

	    <callout arearefs="co-ccd-devs">
	      <para>De laatste argumenten voor &man.ccdconfig.8; zijn
		de apparaten die in de rij geplaatst dienen te worden.
		Voor elk apparaat dient de complete padnaam gebruikt te
		worden.</para>
	    </callout>
	  </calloutlist>

	  <para>Nadat &man.ccdconfig.8; gedraaid is, is de &man.ccd.4;
	    ingesteld.  Er kan een bestandssysteem worden
	    ge&iuml;nstalleerd.  Er kan in &man.newfs.8; worden gekeken
	    voor opties, of het draaien van het onderstaande commando
	    is ook toereikend:</para>

	  <programlisting>newfs /dev/ccd0c</programlisting>
	</sect4>

	<sect4 id="ccd-auto">
	  <title>Alles automatisch maken</title>

	  <para>In het algemeen is het wenselijk om de &man.ccd.4;
	    telkens te mouten wanneer er opnieuw opgestart wordt.
	    Dit dient eerst ingesteld te worden.  Met het volgende
	    commando worden de huidige instellingen naar
	    <filename>/etc/ccd.conf</filename> geschreven:</para>

	  <programlisting>ccdconfig -g &gt; /etc/ccd.conf</programlisting>

	  <para>Tijdens het opstarten draait het script
	    <command>/etc/rc</command> <command>ccdconfig -C</command>
	    indien <filename>/etc/ccd.conf</filename> bestaat.  Dit
	    stelt automatisch de &man.ccd.4; in, zodat die kan worden
	    gemount.</para>

	  <note>
	    <para>Indien er in enkele-gebruiker-modus wordt opgestart,
	      dient het volgende commando te worden uitgevoerd om de
	      rij in te stellen voordat de &man.ccd.4; gemount kan
	      worden:</para>

	    <programlisting>ccdconfig -C</programlisting>
	  </note>

	  <para>Om de &man.ccd.4; automatisch te mounten, kan er een
	    regel voor de &man.ccd.4; in
	    <filename>/etc/fstab</filename> geplaatst worden, zodat die
	    tijdens het opstarten gemount wordt:</para>

	  <programlisting>/dev/ccd0c  /media  ufs rw  2	2</programlisting>
	</sect4>
      </sect3>

      <sect3 id="vinum">
	<title>Volumebeheerder Vinum</title>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>software</secondary>
	</indexterm>

	<indexterm>
	  <primary>RAID</primary>

	  <secondary>Vinum</secondary>
	</indexterm>

	<para>De volumebeheerder Vinum is een blokstuurprogramma dat
	  virtuele schijven implementeert.  Het isoleert schijfhardware
	  van de blokapparaat-interface en projecteert gegevens op een
	  manier die de flexibiliteit, prestatie en betrouwbaarheid
	  verhoogt in vergelijking met de traditionele slice-blik op
	  schijfopslag.  &man.vinum.8; implementeert de modellen
	  RAID-0, RAID-1 en RAID-5, zowel individueel als als
	  combinatie.</para>

	<para>In <xref linkend="vinum-vinum"> staat meer informatie
	  over &man.vinum.8;.</para>
      </sect3>
    </sect2>

    <sect2 id="raid-hard">
      <title>Hardwarematige RAID</title>

      <indexterm>
	<primary>RAID</primary>

	<secondary>hardwarematig</secondary>
      </indexterm>

      <para>&os; ondersteunt ook een verscheidenheid aan hardwarematige
	<acronym>RAID</acronym>-stuurprogramma's.  Deze apparaten
	besturen een <acronym>RAID</acronym>-deelsysteem zonder dat er
	&os;-specifieke software nodig is om de rij te beheren.</para>

      <para>Door gebruik te maken van een <acronym>BIOS</acronym> die
	op de kaart aanwezig is, beheert de kaart de meeste
	schijfbewerkingen zelf.  Nu volgt een korte beschrijving van
	een opzet waarbij een Promise
	<acronym>IDE</acronym>-stuurprogramma is gebruikt.  Wanneer
	deze kaart ge&iuml;nstalleerd en het systeem opgestart is,
	beeldt het een prompt af waarbij om informatie wordt gevraagd.
	De instructies dienen opgevolgd te worden om bij het
	instelscherm van de kaart te komen.  Van hieruit kunnen alle
	aangekoppelde schijven gecombineerd worden.  Nadat dit gedaan
	is, zien de schijven er voor &os; als &eacute;&eacute;n enkele
	schijf uit.  Andere <acronym>RAID</acronym>-niveaus kunnen
	overeenkomstig ingesteld worden.</para>
    </sect2>

    <sect2>
      <title>ATA RAID1-rijen opnieuw bouwen</title>

      <para>Met &os; is het mogelijk om een defecte schijf in een rij
	te vervangen terwijl de computer aanstaat (<quote>hot
	  replace</quote>).  Hiervoor dient de schijf
	  v&oacute;&oacute;r het opnieuw opstarten vervangen te
	  zijn.</para>

      <para>Waarschijnlijk is zoiets als het volgende in
	<filename>/var/log/messages</filename> of in de uitvoer van
	&man.dmesg.8; te zien:</para>

      <programlisting>ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11)\\
status=59 error=40
ar0: WARNING - mirror lost</programlisting>

      <para>Meer informatie kan met behulp van &man.atacontrol.8;
	gezocht worden:</para>

      <screen>&prompt.root; <userinput>atacontrol list</userinput>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</screen>

      <procedure>
	<step>
	  <para>Ontkoppel schijf van de rij zodat deze veilig kan
	    worden verwijderd:</para>

	  <screen>&prompt.root; <userinput>atacontrol detach 3</userinput></screen>
	</step>

	<step>
	  <para>Vervang de schijf.</para>
	</step>

	<step>
	  <para>Koppel de schijf als een reserveschijf aan:</para>

	  <screen>&prompt.root; <userinput>atacontrol attach 3</userinput>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</screen>
	</step>

	<step>
	  <para>De rij dient nu opnieuw opgebouwd te worden:</para>

	  <screen>&prompt.root; <userinput>atacontrol rebuild ar0</userinput></screen>
	</step>

	<step>
	  <para>Het rebuild-commando blijft hangen totdat het voltooid
	    is.  Het is echter wel mogelijk om een andere terminal te
	    openen (door middel van <keycombo
	      action="simul"><keycap>Alt</keycap><keycap>F<replaceable>n</replaceable></keycap></keycombo>)
	    en de voortgang te controleren door middel van:</para>

	  <screen>&prompt.root; <userinput>dmesg | tail -10</userinput>
[uitvoer verwijderd]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

&prompt.root; <userinput>atacontrol status ar0</userinput>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</screen>
	</step>

	<step>
	  <para>Nu moet er gewacht worden tot de bewerking voltooid
	    is.</para>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 id="usb-disks">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Bijgedragen door </contrib>
	</author>
      </authorgroup>
      <!-- juli 2004 -->
    </sect1info>

    <title>USB-opslagapparaten</title>

    <indexterm>
      <primary>USB</primary>

      <secondary>schijven</secondary>
    </indexterm>

    <para>Veel externe opslagoplossingen gebruiken tegenwoordig de
      Universele Seri&euml;le Bus (USB): harde schijven,
      USB-duimdrives, CD-R-branders, etc.  &os; biedt voor al dit soort
      apparaten ondersteuning.</para>

    <sect2>
      <title>Instellen</title>

      <para>Het stuurprogramma &man.umass.4; biedt de ondersteuning
	voor USB-opslagapparaten.  Indien de kernel
	<filename>GENERIC</filename> wordt gebruikt, hoeft er niets aan
	de instellingen gewijzigd te worden.  Als er een eigen kernel
	wordt gebruikt, dienen de volgende regels in het
	kernelinstellingenbestand aanwezig zijn:</para>

      <programlisting>device scbus
device da
device pass
device uhci
device ohci
device usb
device umass</programlisting>

      <para>Het stuurprogramma &man.umass.4; gebruikt het subsysteem
	SCSI om toegang te krijgen tot de USB-opslagapparaten.  Het
	USB-apparaat wordt door het systeem als een SCSI-apparaat
	gezien.  Afhankelijk van de chipset op het moederbord is
	slechts &ograve;f <literal>device uhci</literal> &ograve;f
	<literal>device ohci</literal> nodig.  Het kan echter geen
	kwaad om ze beiden in het kernelinstellingenbestand te hebben.
	Indien er regels zijn toegevoegd dient de kernel opnieuw
	gecompileerd en ge&iuml;nstalleerd te worden.</para>

      <note>
	<para>Indien het USB-apparaat een CD-R- of DVD-brander is,
	  dient het SCSI CD-ROM-stuurprogramma &man.cd.4; met de
	  volgende regel aan de kernel toegevoegd te worden:</para>

	<programlisting>device cd</programlisting>

	<para>Aangezien de brander als een SCSI-schijf gezien wordt,
	  dient het stuurprogramma &man.atapicam.4; niet in de
	  kernelinstellingen gebruikt te worden.</para>
      </note>

      <para>Ondersteuning voor controllers voor USB 2.0 is aanwezig in
	&os;&nbsp;5.X en in de 4.X-tak sinds &os;&nbsp;4.10-RELEASE.
	Het volgende dient toegevoegd te worden aan het
	kernelinstellingenbestand voor ondersteuning voor USB
	2.0:</para>

      <programlisting>device ehci</programlisting>

      <para>De stuurprogramma's &man.uhci.4; en &man.ohci.4; zijn nog
	steeds nodig voor USB 1.X-ondersteuning.</para>

      <note>
	<para>Op &os;&nbsp;4.X dient de USB-daemon (&man.usbd.8;) te
	  draaien om sommige USB-apparaten te kunnen zien.  Om die aan
	  te zetten dient <literal>usbd_enable="YES"</literal> aan het
	  bestand <filename>/etc/rc.conf</filename> toegevoegd te
	  worden en de machine opnieuw gestart te worden.</para>
      </note>
    </sect2>

    <sect2>
      <title>Instellingen testen</title>

      <para>De instellingen zijn klaar om getest te worden: het
	USB-apparaat dient aangesloten te worden en in de buffer voor
	systeemmeldingen (&man.dmesg.8;) dient het stuurprogramma
	ongeveer als volgt te verschijnen:</para>

      <screen>umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</screen>

      <para>Uiteraard kunnen het merk, de apparaatnode
	(<devicename>da0</devicename>) en andere details verschillen
	naar gelang de instelling.</para>

      <para>Aangezien het USB-apparaat als een SCSI-apparaat gezien
	wordt, kan het commando <command>camcontrol</command> gebruikt
	worden om de USB-opslagapparaten weer te geven die aan het
	systeem gekoppeld zijn:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</screen>

      <para>Indien er een bestandssysteem op de schijf aanwezig is, kan
	dat gemount worden.  <xref linkend="disks-adding"> biedt
	indien nodig hulp bij het formatteren en aanmaken van partities
	op de USB-drive.</para>

      <para>Indien het apparaat losgekoppeld wordt (nadat de schijf
	gedismount is), dient in de buffer voor systeemmeldingen iets
	als het volgende te zien te zijn:</para>

      <screen>umass0: at uhub0 port 1 (addr2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</screen>
    </sect2>

    <sect2>
      <title>Referenties</title>

      <para>Naast de onderdelen <link linkend="disks-adding">Schijven
	toevoegen</link> en <link
	  linkend="mount-unmount">Bestandssystemen mounten en
	  unmounten</link>, kunnen de volgende hulppagina's ook nuttig
	zijn: &man.umass.4;, &man.camcontrol.8; en
	&man.usbdevs.8;.</para>
    </sect2>
  </sect1>

  <sect1 id="creating-cds">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Mike</firstname>
	  <surname>Meyer</surname>
	  <contrib>Bijgedragen door </contrib>
	  <!-- mwm@mired.org -->
	</author>
      </authorgroup>
      <!-- april 2001 -->
    </sect1info>

    <title>Optische media (CD's) aanmaken en gebruiken</title>

    <indexterm>
      <primary>CD-ROM's</primary>

      <secondary>aanmaken</secondary>
    </indexterm>

    <sect2>
      <title>Inleiding</title>

      <para>CD's hebben een aantal eigenschappen waardoor ze
	verschillen van conventionele schijven.  Initieel zijn ze door
	de gebruiker niet beschrijfbaar.  Ze zijn z&oacute; ontworpen
	dat ze continu, zonder vertragingen van het verplaatsen van de
	kop tussen tracks, gelezen kunnen worden.  Ze zijn ook veel
	gemakkelijker tussen twee systemen te verplaatsen dan
	gelijksoortige media in hun tijd waren.</para>

      <para>CD's hebben tracks, maar die verwijzen naar secties van
	gegevens die continu gelezen dienen te worden en niet naar
	fysieke eigenschappen van de schijf.  Om een CD op &os; te
	produceren, dienen de gegevensbestanden waaruit de tracks op de
	CD gaan bestaan te worden voorbereid, waarna de tracks op de CD
	worden geschreven.</para>

      <indexterm><primary>ISO 9660</primary></indexterm>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>ISO 9660</secondary>
      </indexterm>

      <para>Het bestandssysteem ISO 9660 is ontworpen om met deze
	verschillen om te gaan.  Helaas codeert het
	bestandssysteemgrenzen die destijds gebruikelijk waren.
	Gelukkig biedt het een uitbreidingsmechanisme dat correct
	geschreven CD's toestaat om deze grenzen te overschrijden en
	nog steeds te werken met systemen die deze uitbreidingen niet
	ondersteunen.</para>

      <indexterm><primary><filename role="package">sysutils/cdrtools</filename></primary></indexterm>

      <para>De port <filename
	  role="package">sysutils/cdrtools</filename> bevat
	&man.mkisofs.8;, een programma dat gebruikt kan worden om een
	gegevensbestand aan te maken dat een ISO 9660-bestandssysteem
	bevat.  Het bevat opties die verschillende uitbreidingen
	ondersteunen en wordt hieronder beschreven.</para>

      <indexterm>
	<primary>CD-brander</primary>

	<secondary>ATAPI</secondary>
      </indexterm>

      <para>Het gereedschap om de CD te branden hangt af van het feit
	of de CD-brander ATAPI of iets anders is.  ATAPI CD-branders
	gebruiken het programma <command><link
	    linkend="burncd">burncd</link></command> dat deel uitmaakt
	van het basissysteem.  SCSI en USB CD-branders dienen
	<command><link linkend="cdrecord">cdrecord</link></command> van
	de port <filename role="package">sysutils/cdrtools</filename>
	te gebruiken.</para>

      <para><command>burncd</command> ondersteunt een beperkt aantal
	stations.  Om erachter te komen of een station ondersteund is,
	dient de lijst <ulink
	  url="http://www.freebsd.dk/ata/">CD-R/RW ondersteunde
	  stations</ulink> te worden geraadpleegd.</para>

      <note>
	<indexterm>
	  <primary>CD-brander</primary>

	  <secondary>ATAPI/CAM-stuurprogramma</secondary>
	</indexterm>

	<para>Indien &os;&nbsp;5.X of &os;&nbsp;4.8-RELEASE of hoger
	  gedraaid wordt, is het mogelijk om <command><link
	      linkend="cdrecord">cdrecord</link></command> en andere
	  gereedschappen voor SCSI-drives op ATAPI-hardware te
	  gebruiken door middel van de <link
	    linkend="atapicam">module ATAPI/CAM</link>.</para>
      </note>

      <para>Indien CD-brandsoftware met een grafische
	gebruikersinterface gewenst is, is
	<application>X-CD-Roast</application> of <application>K3b
	</application> een mogelijkheid.  Deze gereedschappen zijn
	beschikbaar als package of vanuit de ports <filename
	  role="package">sysutils/xcdroast</filename> en <filename
	  role="package">sysutils/k3b</filename>.
	<application>X-CD-Roast</application> en
	<application>K3b</application> hebben de <link
	  linkend="atapicam">module ATAPI/CAM</link> met
	ATAPI-hardware nodig.</para>
    </sect2>

    <sect2 id="mkisofs">
      <title>mkisofs</title>

      <para>Het programma &man.mkisofs.8;, dat deel uitmaakt van de
	port <filename role="package">sysutils/cdrtools</filename>,
	maakt een ISO 9660-bestandssysteem aan dat een beeld is van een
	boomstructuur in de &unix; bestandssysteem-namespace.  De
	eenvoudigste gebruiksvorm is:</para>

      <screen>&prompt.root; <userinput>mkisofs -o <replaceable>beeldbestand.iso</replaceable> <replaceable>/pad/naar/boomstructuur</replaceable></userinput></screen>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>ISO 9660</secondary>
      </indexterm>

      <para>Dit commando maakt een
	<replaceable>beeldbestand.iso</replaceable> aan dat een ISO
	9660-bestandssysteem bevat dat een kopie is van de
	boomstructuur in
	<replaceable>/pad/naar/boomstructuur</replaceable>.  Tijdens
	het proces beeldt het bestandsnamen af op namen die aan de
	beperkingen van het standaard ISO 9660-bestandssysteem voldoen
	en sluit het bestanden uit die namen hebben die niet
	karakteristiek zijn voor ISO-bestandssystemen.</para>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>HFS</secondary>
      </indexterm>

      <indexterm>
	<primary>bestandssystemen</primary>

	<secondary>Joliet</secondary>
      </indexterm>

      <para>Er is een aantal opties beschikbaar om over deze
	beperkingen heen te komen.  In het bijzonder zet
	<option>-R</option> de Rock Ridge-uitbreidingen aan die
	gangbaar zijn voor &unix; systemen, zet <option>-J</option> de
	Rock Ridge-uitbreidingen aan die gebruikt worden op
	Microsoft-systemen en <option>-hfs</option> kan gebruikt worden
	om HFS-bestandssystemen aan te maken die door &macos; gebruikt
	worden.</para>

      <para>Voor CD's die alleen op &os;-systemen gebruikt gaan worden,
	kan <option>-U</option> gebruikt worden om alle restricties op
	bestandsnamen uit te zetten.  Indien het met
	<option>-R</option> gebruikt wordt, maakt het een
	bestandssysteembeeld aan dat identiek is aan de
	&os;-boomstructuur van waaruit begonnen is, alhoewel het
	mogelijk is dat het zich op aantal manieren niet aan de
	ISO 9660-standaard houdt.</para>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>opstartbaar maken</secondary>
      </indexterm>

      <para>De laatste optie voor algemeen gebruik is
	<option>-b</option>.  Deze wordt gebruikt om de plaats van het
	opstartbeeld aan te geven om een <quote>El Torito</quote>
	opstartbare CD te maken.  Deze optie heeft een argument nodig,
	namelijk het pad naar een opstartbeeld dat het begin van de
	boomstructuur die naar de CD geschreven wordt voorstelt.
	Gewoonlijk maakt &man.mkisofs.8; een ISO-beeld aan in de
	zogenaamde <quote>diskette-emulatie</quote>-modus en verwacht
	het dus dat het beeldbestand exact 1200, 1440 of 2880&nbsp;KB
	groot is.  Sommige bootloaders, zoals degene die door de
	distributieschijven van &os; wordt gebruikt, gebruiken de
	emulatiemodus niet.  In dat geval dient de optie
	<option>-no-emul-boot</option> gebruikt te worden.  Dus indien
	<filename>/tmp/myboot</filename> een opstartbaar &os;-systeem
	met het beeldbestand in
	<filename>/tmp/myboot/boot/cdboot</filename> bevat, kan het
	beeld van een ISO 9660-bestandssysteem als volgt in
	<filename>/tmp/bootable.iso</filename> aangemaakt
	worden:</para>

      <screen>&prompt.root; <userinput>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</userinput></screen>

      <para>Als dit gedaan is en <devicename>vn</devicename> (
	&os;&nbsp;4.X) of <devicename>md</devicename> (&os;&nbsp;5.X)
	in de kernel is ingesteld, kan het bestandssysteem gemount
	worden voor &os;&nbsp;4.X met:</para>

      <screen>&prompt.root; <userinput>vnconfig -e vn0c /tmp/bootable.iso</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/vn0c /mnt</userinput></screen>

      <para>Voor &os;&nbsp;5.X met:</para>

      <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</userinput>
&prompt.root; <userinput>mount -t cd9660 /dev/md0 /mnt</userinput></screen>

      <para>Nu kan gecontroleerd worden of <filename>/mnt</filename> en
	<filename>/tmp/myboot</filename> identiek zijn.</para>

      <para>Er zijn vele andere opties die met &man.mkisofs.8; gebruikt
	kunnen worden om het gedrag af te stemmen.  In het bijzonder
	wijzigingen aan een ISO 9660-structuur en het aanmaken van
	Joliet- en HFS-schijven.  Details staan in
	&man.mkisofs.8;.</para>
    </sect2>

    <sect2 id="burncd">
      <title>burncd</title>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>branden</secondary>
      </indexterm>

      <para>Indien er een ATAPI CD-brander aanwezig is, kan het
	commando <command>burncd</command> gebruikt worden om een
	ISO-beeld naar een CD te branden.  <command>burncd</command>
	maakt deel uit van het basissysteem en is ge&iuml;nstalleerd
	als <filename>/usr/sbin/burncd</filename>.  Het gebruik is erg
	eenvoudig, aangezien het weinig opties heeft.</para>

      <screen>&prompt.root; <userinput>burncd -f <replaceable>cd-apparaat</replaceable> gegevens <replaceable>beeldbestand.iso</replaceable> fixate</userinput></screen>

      <para>Het bovenstaande commando brandt een kopie van
	<replaceable>beeldbestand.iso</replaceable> naar
	<replaceable>cd-apparaat</replaceable>.  Het standaardapparaat
	is <filename>/dev/acd0</filename> (of
	<filename>/dev/acd0c</filename> op &os;&nbsp;4.X).  Opties om
	de schrijfsnelheid in te stellen, de CD na het branden uit
	te werpen en geluidsgegevens te schrijven staan in
	&man.burncd.8;.</para>
    </sect2>

    <sect2 id="cdrecord">
      <title>cdrecord</title>

      <para>Indien er geen ATAPI CD-brander aanwezig is, dient
	<command>cdrecord</command> gebruikt te worden om CD's te
	branden.  <command>cdrecord</command> maakt geen deel uit van
	het basissysteem.  Het dient &ograve;fwel vanuit de port in
	<filename role="package">sysutils/cdrtools</filename>
	&ograve;fwel als package ge&iuml;nstalleerd te worden.
	Veranderingen in het basissysteem kunnen ervoor zorgen dat
	binaire versies van dit programma falen, wat mogelijk tot een
	<quote>coaster</quote> leidt.  Daarom dient &ograve;fwel de
	port bijgewerkt te worden als het systeem wordt bijgewerkt,
	&ograve;wel, als <link linkend="stable">-STABLE gevolgd</link>
	wordt, dient de port bijgewerkt te worden wanneer er een nieuwe
	versie beschikbaar komt.</para>

      <para>Hoewel <command>cdrecord</command> vele opties heeft, is
	het gebruik voor gewone situaties nog eenvoudiger dan dat van
	<command>burncd</command>.  Een ISO 9660-beeld kan gebrand
	worden met:</para>

      <screen>&prompt.root; <userinput>cdrecord dev=<replaceable>device</replaceable> <replaceable>beeldbestand.iso</replaceable></userinput></screen>

      <para>Het lastige gedeelte in het gebruik van
	<command>cdrecord</command> is het vinden van de juiste
	<option>dev</option>.  Om de juiste instelling te vinden, kan
	de vlag <option>-scanbus</option> van
	<command>cdrecord</command> gebruikt worden, wat resultaten
	zoals de onderstaande kan geven:</para>

      <indexterm>
	<primary>CD-ROM's</primary>

	<secondary>branden</secondary>
      </indexterm>

      <screen>&prompt.root; <userinput>cdrecord -scanbus</userinput>
Cdrecord 1.9 (i386-unknown-freebsd4.2) Copyright (C) 1995-2000 J&ouml;rg Schilling
Using libscg version 'schily-0.1'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</screen>

      <para>Dit geeft de gepaste <option>dev</option>-waarden voor de
	apparaten in de lijst.  De CD-brander dient gezocht te worden,
	waarna de drie getallen gescheiden door komma's gebruikt kunnen
	worden als de waarde voor <option>dev</option>.  In dit geval
	is het CD-RW-apparaat 1,5,0, dus is de juiste invoer
	<option>dev=1,5,0</option>.  Er zijn eenvoudigere manieren om
	deze waarde te specificeren.  In &man.cdrecord.1; staan meer
	details.  Hier staat ook informatie over geluidstracks, de
	snelheid instellen en meer.</para>
    </sect2>

    <sect2 id="duplicating-audiocds">
      <title>Audio-CD's dupliceren</title>

      <para>Een audio-CD kan gedupliceerd worden door de
	geluidsgegevens van de CD naar een serie bestanden te
	schrijven en deze bestanden daarna naar een lege CD te
	schrijven.  Het proces verschilt licht tussen ATAPI- en
	SCSI-drives.</para>

      <procedure>
	<title>SCSI-drives</title>

	<step>
	  <para>Onttrek <command>cdda2wav</command> de audio:</para>

	  <screen>&prompt.user; <userinput>cdda2wav -v255 -D2,0 -B -Owav</userinput></screen>
	</step>

	<step>
	  <para>Schrijf met <command>cdrecord</command> de
	    <filename>.wav</filename>-bestanden:</para>

	  <screen>&prompt.user; <userinput>cdrecord -v dev=<replaceable>2,0</replaceable> -dao -useinfo *.wav</userinput></screen>

	  <para>Controleer of <replaceable>2,0</replaceable> juist is
	    opgegeven, zoals beschreven in <xref
	      linkend="cdrecord">.</para>
	</step>
      </procedure>

      <procedure>
	<title>ATAPI-drives</title>

	<step>
	  <para>Het ATAPI CD-stuurprogramma maakt elke track
	    beschikbaar als
	    <filename>/dev/acd<replaceable>d</replaceable>t<replaceable>nn</replaceable></filename>,
	    waarin <replaceable>d</replaceable> het stationsnummer is
	    en <replaceable>nn</replaceable> het tracknummer is in twee
	    decimale cijfers, dat indien nodig vooraf wordt gegaan door
	    een nul.  Dus is de eerste track op de eerste schijf
	    <filename>/dev/acd0t01</filename>, de tweede
	    <filename>/dev/acd0t02</filename>, de derde
	    <filename>/dev/acd0t03</filename>, enzovoort.</para>

	  <para>Controleer of de juiste bestanden in
	    <filename>/dev</filename> bestaan.</para>

	  <screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV acd0t99</userinput></screen>

	  <note>
	    <para>In &os;&nbsp;5.0 maakt &man.devfs.5; automatisch
	      ingangen in <filename>/dev</filename> aan en beheert
	      deze, dus is het niet nodig om <command>MAKEDEV</command>
	      te gebruiken.</para>
	  </note>
	</step>

	<step>
	  <para>De track kan met &man.dd.1; onttrokken worden.  Bij het
	    onttrekken van de bestanden dient een specifieke
	    blokgrootte gebruikt te worden.</para>

	  <screen>&prompt.root; <userinput>dd if=/dev/acd0t01 of=track1.cdr bs=2352</userinput>
&prompt.root;<userinput>dd if=/dev/acd0t02 of=track2.cdr bs=2352</userinput>
...
	  </screen>
	</step>

	<step>
	  <para>Brand de onttrokken bestanden met
	    <command>burncd</command>.  Er dient opgegeven te worden
	    dat het geluidsbestanden zijn en dat
	    <command>burncd</command> de schijf moet fixeren wanneer
	    na afronding van het proces.</para>

	  <screen>&prompt.root; <userinput>burncd -f <replaceable>/dev/acd0</replaceable> audio track1.cdr track2.cdr <replaceable>...</replaceable> fixate</userinput></screen>
	</step>
      </procedure>
    </sect2>

    <sect2 id="imaging-cd">
      <title>Gegevens-CD's dupliceren</title>

      <para>Een gegevens-CD kan gekopieerd worden naar een beeldbestand
	dat functioneel gelijk is aan het beeldbestand dat met
	&man.mkisofs.8; gemaakt is en het kan gebruikt worden om elke
	gegevens-CD te dupliceren.  Het hier gegeven voorbeeld neemt
	aan dat het CD-ROM-apparaat <devicename>acd0</devicename>
	is.  Voor &os;&nbsp;4.X wordt een <literal>c</literal>
	toegevoegd aan het einde van de apparaatnaam om de volledige
	partitie, of in het geval van CD-ROM's, de volledige schijf
	aan te duiden.</para>

      <screen>&prompt.root; <userinput>dd if=/dev/acd0 of=bestand.iso bs=2048</userinput></screen>

      <para>Nu het beeld beschikbaar is, kan het naar CD geschreven
	worden zoals hierboven beschreven.</para>
    </sect2>

    <sect2 id="mounting-cd">
      <title>Gegevens-CD's gebruiken</title>

      <para>Nu er een standaard gegevens-CD-ROM is aangemaakt moet deze
	waarschijnlijk gemount worden om de gegevens die er op staan te
	lezen.  Normaalgesproken neemt &man.mount.8; aan dat een
	bestandssysteem van het soort <literal>ufs</literal> is.  Als
	zoiets als onderstaande geprobeerd wordt komt er een klacht
	over <errorname>Incorrect super block</errorname> en geen
	mount:</para>

      <screen>&prompt.root; <userinput>mount /dev/cd0 /mnt</userinput></screen>

      <para>De CD-ROM bevat geen
	<literal>UFS</literal>-bestandssysteem, dus pogingen om zo te
	mounten mislukken.  Er dient aan &man.mount.8; verteld te
	worden dat het bestandssysteem van het soort
	<literal>ISO9660</literal> is en dan werkt alles.  Dit kan
	door de optie <option>-t cd9660</option> van &man.mount.8; op
	te geven.  Het CD-ROM-apparaat <filename>/dev/cd0</filename>
	onder <filename>/mnt</filename> mounten kan zo:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>De apparaatnaam (in dit voorbeeld
	<filename>/dev/cd0</filename>) kan afwijken, afhankelijk van de
	interface die de CD-ROM gebruikt.  Verder voert de optie
	<option>-t cd9660</option> gewoon &man.mount.cd9660.8; uit.
	Bovenstaand voorbeeld kan verkort worden tot:</para>

      <screen>&prompt.root; <userinput>mount_cd9660 /dev/cd0 /mnt</userinput></screen>

      <para>Het is in het algemeen mogelijk om gegevens-CD-ROMs van
	elke fabrikant op deze manier te gebruiken.  Schijven met
	bepaalde uitbreidingen op ISO 9660 kunnen zich echter vreemd
	gedragen.  Joliet-schijven bijvoorbeeld, slaan alle
	bestandsnamen op in twee-byte Unicode-karakters.  De
	&os;-kernel spreekt (nog!) geen Unicode, dus verschijnen
	niet-Engelse karakters als vraagtekens.  Als &os;&nbsp;4.3 of
	later gedraaid wordt, bevat het CD9660-stuurprogramma haken om
	tijdens het draaien een geschikte Unicode-omzettabel te laden.
	Modules voor enkele veelgebruikte coderingen zijn beschikbaar
	via de port <filename
	  role="package">sysutils/cd9660_unicode</filename>.)</para>

      <para>Zo nu en dan kan <errorname>Device not
	configured</errorname> verschijnen als geprobeerd wordt om een
	CD-ROM te mounten.  Dit betekent meestal dat het CD-ROM-station
	denkt dat er geen schijf in de lade ligt of dat het station
	niet zichtbaar is op de bus.  Omdat het enkele seconden kan
	duren voordat een CD-ROM-station doorheeft dat er een CD-ROM
	in ligt, is geduld geboden.</para>

      <para>Soms wordt een SCSI CD-ROM gemist omdat het station niet
	genoeg tijd had om antwoord te geven op de busreset.  Indien er
	een SCSI CD-ROM aanwezig is, dient de volgende optie aan de
	kernelinstellingen toegevoegd te worden en de <link
	  linkend="kernelconfig-building">kernel opnieuw gebouwd</link>
	te worden.</para>

      <programlisting>options SCSI_DELAY=15000</programlisting>

      <para>Dit zorgt ervoor dat de SCSI-bus 15 seconden pauzeert
	tijdens het opstarten opdat het CD-ROM-station elke gelegenheid
	krijgt om de busreset te beantwoorden.</para>
    </sect2>

    <sect2 id="rawdata-cd">
      <title>Rauwe gegevens-CD's branden</title>

      <para>Een bestand kan direct naar CD geschreven worden zonder een
	ISO 9660-bestandssysteem aan te maken.  Sommige mensen doen dit
	voor back-updoeleinden.  Dit gaat sneller dan een standaard-CD
	branden:</para>

      <screen>&prompt.root; <userinput>burncd -f /dev/acd1 -s 12 gegevens archief.tar.gz fixate</userinput></screen>

      <para>Om de gegevens terug te halen die op zo'n CD gebrand zijn,
	is het noodzakelijk om gegevens van de rauwe apparaatnode te
	lezen:</para>

      <screen>&prompt.root; <userinput>tar xzvf /dev/acd1</userinput></screen>

      <para>Het is niet mogelijk om deze schijf te mounten zoals dat
	voor een normale CD-ROM gedaan wordt.  Zo'n CD-ROM kan onder
	geen enkel besturingssysteem, behalve &os;, gelezen worden.
	Om de CD te kunnen mounten of gegevens te delen met een ander
	besturingssysteem, dient &man.mkisofs.8; gebruikt te worden,
	zoals boven beschreven is.</para>
    </sect2>

    <sect2 id="atapicam">
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Marc</firstname>
	    <surname>Fonvieille</surname>
	    <contrib>Bijgedragen door </contrib>
	  </author>
	</authorgroup>
      </sect2info>

      <indexterm>
	<primary>CD-brander</primary>

	<secondary>ATAPI/CAM-stuurprogramma</secondary>
      </indexterm>

      <title>Het ATAPI/CAM-stuurprogramma gebruiken</title>

      <para>Dit stuurprogramma stelt ATAPI-apparaten (CD-ROM, CD-RW,
	DVD-stations, enzovoort) in staat om vanuit het SCSI-subsysteem
	benaderd te worden en maakt daarmee het gebruik van applicaties
	zoals <filename role="package">sysutils/cdrdao</filename> of
	&man.cdrecord.1; mogelijk.</para>

      <para>Om dit stuurprogramma te gebruiken, is het noodzakelijk om
	de volgende regel aan het kernelinstellingenbestand toe te
	voegen:</para>

      <programlisting>device atapicam</programlisting>

      <para>Ook zijn de volgende regels in het
	kernelinstellingenbestand nodig, die meestal wel aanwezig
	zijn:</para>

      <programlisting>device ata
device scbus
device cd
device pass</programlisting>

      <para>Hierna dient de nieuwe kernel opnieuw gebouwd en
	ge&iuml;nstalleerd te worden en dient de machine opnieuw
	gestart te worden.  Tijdens het opstartproces dient de brander
	als volgt te verschijnen:</para>

      <screen>acd0: CD-RW &lt;MATSHITA CD-RW/DVD-ROM UJDA740&gt; at ata1-master PIO4
cd0 at ata1 bus 0 target 0 lun 0
cd0: &lt;MATSHITA CD-RW/DVD UJDA740 1.00&gt; Removable CD-ROM SCSI-0 device
cd0: 16.000MB/s transfers
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</screen>

      <para>Het station is nu toegankelijk via de apparaatnaam
	<filename>/dev/cd0</filename>.  Om bijvoorbeeld een CD-ROM op
	<filename>/mnt</filename> te mounten:</para>

      <screen>&prompt.root; <userinput>mount -t cd9660 <replaceable>/dev/cd0</replaceable> /mnt</userinput></screen>

      <para>Als <username>root</username> kan het volgende commando
	gegeven worden om het SCSI-adres van de brander te
	verkrijgen:</para>

      <screen>&prompt.root; <userinput>camcontrol devlist</userinput>
&lt;MATSHITA CD-RW/DVD UJDA740 1.00&gt; at scbus1 target 0 lun 0 (pass0,cd0)</screen>

      <para>Dus <literal>1,0,0</literal> is het SCSI-adres dat met
	&man.cdrecord.1; en andere SCSI-toepassingen gebruikt dient te
	worden.</para>

      <para>Meer informatie over het ATAPI/CAM en het SCSI-systeem
	staat in de hulppagina's van &man.atapicam.4; en
	&man.cam.4;.</para>
    </sect2>
  </sect1>

  <sect1 id="creating-dvds">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Bijgedragen door </contrib>
	</author>
      </authorgroup>

      <authorgroup>
	<author>
	  <firstname>Andy</firstname>
	  <surname>Polyakov</surname>
	  <contrib>Met toevoegingen van </contrib>
	</author>
      </authorgroup>
      <!-- februari 2004 -->
    </sect1info>

    <title>Optische media (DVD's) aanmaken en gebruiken</title>

    <indexterm>
      <primary>DVD</primary>

      <secondary>branden</secondary>
    </indexterm>

    <sect2>
      <title>Inleiding</title>

      <para>Vergeleken met de CD behoort de DVD de tot de volgende
	generatie van optische media-opslagtechnologie.  De DVD kan
	meer gegevens bevatten dan enige CD en is tegenwoordig de
	standaard voor videopublicatie.</para>

      <para>Er kunnen vijf fysieke opneembare formaten gedefinieerd
	worden die opneembare DVD heten:</para>

      <itemizedlist>
	<listitem>
	  <para>DVD-R: dit was het eerst beschikbare opneembare
	    DVD-formaat.  De DVD-R-standaard is gedefinieerd door het
	    <ulink url="http://www.dvdforum.com/forum.shtml">DVD
	      Forum</ulink>.  Dit formaat is voor eenmalig
	    schrijven.</para>
	</listitem>

	<listitem>
	  <para>DVD-RW: dit is de herschrijfbare versie van de
	    DVD-R-standaard.  Een DVD-RW kan tot ongeveer 1.000 maal
	    herschreven worden.</para>
	</listitem>

	<listitem>
	  <para>DVD-RAM: dit is ook een herschrijfbaar formaat dat
	    door het DVD Forum ondersteund wordt.  Een DVD-RAM kan
	    gezien worden als een verwisselbare harde schijf.  Dit
	    medium is echter niet uitwisselbaar met de meeste
	    DVD-ROM-stations en DVD-Video-spelers.  Slechts enkele
	    DVD-schrijvers ondersteunen het DVD-RAM-formaat.</para>
	</listitem>

	<listitem>
	  <para>DVD+RW: dit is het herschrijfbare formaat dat is
	    gedefinieerd door de <ulink
	      url="http://www.dvdrw.com/">DVD+RW Alliance</ulink>.  Een
	    DVD+RW kan tot ongeveer 1.000 maal herschreven
	    worden.</para>
	</listitem>

	<listitem>
	  <para>DVD+R: dit formaat is de eenmalig beschrijfbare versie
	    van het DVD+RW-formaat.</para>
	</listitem>
      </itemizedlist>

      <para>Een enkellaags opneembare DVD kan maximaal
	4.700.000.000&nbsp;bytes bevatten, wat eigenlijk 4,38&nbsp;GB
	of 4.485&nbsp;MB is (1&nbsp;kB is 1024 bytes).</para>

      <note>
	<para>Er dient onderscheid gemaakt te worden tussen het fysieke
	  medium en de toepassing.  Een DVD-Video bijvoorbeeld is een
	  specifiek bestandsschema dat op elk fysiek opneembaar
	  DVD-medium geschreven kan worden: DVD-R, DVD+R, DVD-RW,
	  enzovoort.  Voordat het mediumtype gekozen wordt, dient het
	  zeker te zijn dat zowel de brander als de DVD-Video-speler
	  (een onafhankelijke speler of een DVD-ROM-station in een
	  computer) overweg kunnen met het overwogen medium.</para>
      </note>
    </sect2>

    <sect2>
      <title>Instellingen</title>

      <para>Het programma &man.growisofs.1; wordt gebruikt om DVD's op
	te nemen.  Dit commando is deel van de
	<application>dvd+rw-tools</application> gereedschappen
	(<filename role="package">sysutils/dvd+rw-tools</filename>>).
	<application>dvd+rw-tools</application> ondersteunt alle types
	DVD-media.</para>

      <para>Deze gereedschappen gebruiken het SCSI-subsysteem om
	toegang tot de apparaten te krijgen, daarvoor moet <link
	  linkend="atapicam">ondersteuning voor ATAPI/CAM</link> aan de
	kernel toegevoegd worden.  Indien de brander de USB-interface
	gebruikt, is deze toevoeging nutteloos en dient <xref
	  linkend="usb-disks"> gelezen te worden voor meer details over
	het instellen van USB-apparaten.</para>

      <para>De DMA-toegang voor ATAPI-apparaten dient ook aangezet te
	worden door de volgende regel aan het bestand
	<filename>/boot/loader.conf</filename> toe te voegen:</para>

      <programlisting>hw.ata.atapi_dma="1"</programlisting>

      <para>Voordat de <application>dvd+rw-tools</application> gebruikt
	kunnen worden, dienen de <ulink
	  url="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html">
	  dvd+rw-tools' hardware compatibility notes</ulink>
	geraadpleegd te worden voor enige informatie die betrekking
	heeft op de DVD-brander.</para>

      <note>
	<para>Indien een grafische gebruikersinterface gewenst is, is
	  <application>K3b</application> (<filename
	    role="package">sysutils/k3b</filename>), die een
	  gebruikersvriendelijke interface biedt voor &man.growisofs.1;
	  en vele andere brandprogramma's, het bekijken waard.</para>
      </note>
    </sect2>

    <sect2>
      <title>Gegevens-DVD's branden</title>

      <para>Het commando &man.growisofs.1; is een frontend voor <link
	  linkend="mkisofs">mkisofs</link>.  Het roept &man.mkisofs.8;
	aan om het bestandssysteemoverzicht aan te maken en het
	schrijft naar de DVD.  Hierdoor is het niet nodig om een beeld
	van de gegevens aan te maken voordat met branden begonnen
	wordt.</para>

      <para>Om de gegevens uit de map <filename
	  class="directory">/pad/naar/gegevens</filename> op een DVD+R
	of een DVD-R te branden:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/pad/naar/gegevens</replaceable></userinput></screen>

      <para>De opties <option>-J -R</option> worden doorgegeven aan
	&man.mkisofs.8; voor het aanmaken van het bestandssysteem (in
	dit geval een ISO 9660-bestandssysteem met Joliet en Rock Ridge
	uitbreidingen).  Meer details staan in de hulppagina
	&man.mkisofs.8;.</para>

      <para>De optie <option>-Z</option> wordt gebruikt voor het
	opnemen van de eerste sessie, ook bij meerdere sessies.  Het
	DVD-apparaat, <replaceable>/dev/cd0</replaceable>, dient aan de
	hand van de instellingen aangepast te worden.  De parameter
	<option>-dvd-compat</option> sluit de schijf zodat er niets aan
	de opname toegevoegd kan worden.  Dit zou als tegenprestatie
	betere uitwisselbaarheid met DVD-ROM-stations moeten
	geven.</para>

      <para>Het is ook mogelijk om een vooraf gemastered beeld te
	branden, om bijvoorbeeld het beeld
	<replaceable>beeldbestand.iso</replaceable> te branden:</para>

      <screen>&prompt.root; <userinput>growisofs -dvd-compat -Z <replaceable>/dev/cd0</replaceable>=<replaceable>beeldbestand.iso</replaceable></userinput></screen>

      <para>De schrijfsnelheid moet automatisch gedetecteerd en
	ingesteld worden, afhankelijk van het medium en het gebruikte
	station.  Om de schrijfsnelheid te forceren, dient de parameter
	<option>-speed=</option> gebruikt te worden.  Meer informatie
	staat in de hulppagina &man.growisofs.1;.</para>
    </sect2>

    <indexterm>
      <primary>DVD</primary>

      <secondary>DVD-Video</secondary>
    </indexterm>

    <sect2>
      <title>DVD-Video branden</title>

      <para>Een DVD-Video is een specifiek bestandsschema dat gebaseerd
	is op de ISO 9660 en de micro-UDF (M-UDF) specificaties.
	DVD-Video heeft ook een specifieke hi&euml;rarchie voor de
	gegevensstructuur, de reden waarom een speciaal programma zoals
	<filename role="package">multimedia/dvdauthor</filename> nodig
	is om de DVD te schrijven.</para>

      <para>Indien er reeds een beeld van het bestandssysteem van de
	DVD-Video beschikbaar is, kan het zoals elk ander beeld gebrand
	worden.  In de vorige sectie staat een voorbeeld.  Als het
	resultaat voor de inhoud voor de DVD bijvoorbeeld in de map
	<filename class="directory">/pad/naar/video</filename> staat,
	kan de DVD-Video als volgt gebrand worden:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -dvd-video <replaceable>/pad/naar/video</replaceable></userinput></screen>

      <para>De optie <option>-dvd-video</option> wordt doorgegeven aan
	&man.mkisofs.8; en geeft het opdracht om een
	bestandssysteemschema voor een DVD-Video aan te maken.  Verder
	impliceert de optie <option>-dvd-video</option> de optie
	<option>-dvd-compat</option> van &man.growisofs.1;.</para>
    </sect2>

    <indexterm>
      <primary>DVD</primary>

      <secondary>DVD+RW</secondary>
    </indexterm>

    <sect2>
      <title>DVD+RW gebruiken</title>

      <para>In tegenstelling tot een CD-RW dient een nieuwe DVD+RW voor
	het eerste gebruik geformatteerd te worden.  Het programma
	&man.growisofs.1; regelt dit automatisch als nodig.  Dit is de
	<emphasis>aanbevolen</emphasis> manier.  Het is ook mogelijk om
	<command>dvd+rw-format</command> te gebruiken om een DVD+RW te
	formatteren:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Deze operatie hoeft slechts &eacute;&eacute;n maal
	uitgevoerd te worden.  Onthoud dat alleen nieuwe DVD+RW-media
	geformatteerd dienen te worden.  Daarna is het mogelijk om de
	DVD+RW op dezelfde manier te branden zoals in bovenstaande
	secties staat vermeldt.</para>

      <para>Om nieuwe gegevens op een DVD+RW te branden (een geheel
	nieuw bestandssysteem branden, niet wat gegevens toevoegen), is
	het niet nodig om deze te wissen.  Het is voldoende om de
	vorige opname te overschrijven (tijdens het aanmaken van een
	initi&euml;le sessie), zoals hieronder:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/pad/naar/nieuwe gegevens</replaceable></userinput></screen>

      <para>Het DVD+RW-formaat biedt de mogelijkheid om eenvoudig
	nieuwe gegevens aan een vorige opname toe te voegen.  De
	operatie bestaat uit het samenvoegen van een nieuwe sessie en
	de bestaande.  Het is geen multisessie-schrijven.
	&man.growisofs.1; laat het ISO 9660-bestandssysteem dat
	aanwezig is op het medium <emphasis>groeien</emphasis>.</para>

      <para>Om gegevens aan de vorige DVD+RW toe te voegen:</para>

      <screen>&prompt.root; <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/pad/naar/volgende gegevens</replaceable></userinput></screen>

      <para>Dezelfde opties van &man.mkisofs.8; die gebruikt werden om
	de initi&euml;le sessie te branden, dienen gebruikt te worden
	tijdens schrijfsessies.</para>

      <note>
	<para>De optie <option>-dvd-compat</option> kan gebruikt worden
	  als betere uitwisselbaarheid met DVD-ROM-stations gewenst is.
	  In het geval van een DVD+RW verhindert dit het toevoegen van
	  gegevens niet.</para>
      </note>

      <para>Om het medium te wissen:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable>=<replaceable>/dev/zero</replaceable></userinput></screen>
    </sect2>

    <indexterm>
      <primary>DVD</primary>

      <secondary>DVD-RW</secondary>
    </indexterm>

    <sect2>
      <title>DVD-RW gebruiken</title>

      <para>Een DVD-RW accepteert twee schijfformaten: de incrementele
	sequenti&euml;le en beperkt overschrijven.  Standaard zijn
	DVD-RW-schijven in het sequenti&euml;le formaat.</para>

      <para>Een nieuwe DVD-RW kan direct beschreven worden zonder deze
	te formatteren.  Een gebruikte DVD-RW in sequentieel formaat
	dient echter gewist te worden voordat het mogelijk is om een
	nieuwe initi&euml;le sessie te schrijven.</para>

      <para>Om een DVD-RW in sequenti&euml;le toestand te wissen, dient
	het volgende gedaan te worden:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>

      <note>
	<para>Volledig wissen (<option>-blank=full</option>) neemt
	  ongeveer &eacute;&eacute;n uur in beslag op een 1x-medium.
	  Het is mogelijk om snel te wissen door gebruik te maken van
	  de optie <option>blank</option> als de DVD-RW in
	  Disk-At-Once-modus (DAO) wordt opgenomen.  Om de DVD-RW in
	  DAO-modus te branden:</para>

	<screen>&prompt.root; <userinput>growisofs -use-the-force-luke=dao -Z <replaceable>/dev/cd0</replaceable>=<replaceable>beeldbestand.iso</replaceable></userinput></screen>

	<para>De optie <option>-use-the-force-luke=dao</option> is niet
	  nodig aangezien &man.growisofs.1; probeert om minimale (snel
	  gewiste) media te detecteren en gebruik te maken van
	  DAO-schrijven.</para>

	<para>Eigenlijk moet beperkt overschrijven gebruikt worden met
	  elke DVD-RW.  Dit formaat is flexibeler dan het standaard
	  incrementeel sequenti&euml;le.</para>
      </note>

      <para>Om gegevens op een sequenti&euml;le DVD-RW te schrijven,
	worden dezelfde instructies gebruikt als voor de andere
	DVD-formaten:</para>

      <screen>&prompt.root; <userinput>growisofs -Z <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/pad/naar/gegevens</replaceable></userinput></screen>

      <para>Om wat gegevens aan de vorige opname toe te voegen, dient
	de optie <option>-M</option> van &man.growisofs.1; gebruikt te
	worden.  Als echter gegevens aan een DVD-RW in incrementeel
	sequenti&euml;le modus worden toegevoegd, wordt een nieuwe
	sessie op de schijf aangemaakt wat resulteert in een
	multisessie schijf.</para>

      <para>Een DVD-RW in het beperkt overschrijven formaat hoeft niet
	gewist te worden v&oacute;&oacute;r een nieuwe initi&euml;le
	sessie.  Het is voldoende om de schijf te overschrijven met de
	optie <option>-Z</option>, wat analoog is aan het geval van de
	DVD+RW.  Het is ook mogelijk om een bestaand ISO
	9660-bestandssysteem te laten groeien op soortgelijke wijze als
	voor een DVD+RW met de optie <option>-M</option>.  Het
	resultaat is een enkelsessie DVD.</para>

      <para>Om een DVD-RW in het beperkt overschrijven-formaat te
	zetten:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format <replaceable>/dev/cd0</replaceable></userinput></screen>

      <para>Om terug te gaan naar het sequenti&euml;le formaat:</para>

      <screen>&prompt.root; <userinput>dvd+rw-format -blank=full <replaceable>/dev/cd0</replaceable></userinput></screen>
    </sect2>

    <sect2>
      <title>Multisessie</title>

      <para>Multisessie DVD's worden door zeer weinig DVD-ROM-stations
	geaccepteerd en meestal lezen ze hopelijk tenminste  de eerste
	sessie.  DVD+R, DVD-R en DVD-RW kunnen in het sequenti&euml;le
	formaat meerdere sessies accepteren.  Het idee van meerdere
	sessies bestaat niet voor de formaten DVD+RW en DVD-RW in
	beperkt overschrijven.</para>

      <para>Om een nieuwe sessie achter een initi&euml;le
	(niet-gesloten) sessie op een DVD+R, DVD-R of DVD-RW in
	sequentieel formaat toe te voegen:</para>

      <screen>&prompt.root; <userinput>growisofs -M <replaceable>/dev/cd0</replaceable> -J -R <replaceable>/pad/naar/volgende gegevens</replaceable></userinput></screen>

      <para>Het gebruik van dit commando met een DVD+RW of een DVD-RW
	in beperkt overschrijven-formaat voegt gegevens toe door de
	nieuwe sessie samen te voegen met de bestaande.  Dit leidt tot
	een enkelsessie schijf.  Deze manier kan gebruikt worden om
	gegevens achter een initi&euml;le sessie aan deze media toe te
	voegen.</para>

      <note>
	<para>Op deze media wordt wat ruimte gebruikt tussen elke
	  sessie om het einde en begin van de sessies aan te geven.
	  Daarom dienen sessies met grote hoeveelheden gegevens
	  toegevoegd te worden om de mediaruimte te optimaliseren.  Het
	  aantal sessies is beperkt tot 154 voor een DVD+R, ongeveer
	  2000 voor een DVD-R en 127 voor een dubbellaags DVD+R.</para>
      </note>
    </sect2>

    <sect2>
      <title>Meer informatie</title>

      <para>Om meer informatie over een DVD te verkrijgen kan het
	commando
	<command>dvd+rw-mediainfo <replaceable>/dev/cd0</replaceable></command>
	met de schijf in het station gebruikt worden.</para>

      <para>Meer informatie over
	<application>dvd+rw-tools</application> staat in de hulppagina
	&man.growisofs.1;, op de <ulink
	  url="http://fy.chalmers.se/~appro/linux/DVD+RW/">dvd+rw-tools
	  website</ulink> en in de archieven van de <ulink
	  url="http://lists.debian.org/cdwrite/">cdwrite mailing
	  list</ulink>.</para>

      <note>
	<para>De uitvoer van <command>dvd+rw-mediainfo</command> met
	  betrekking tot de resulterende opname of het medium met
	  problemen is verplicht voor elk probleemrapport.  Zonder deze
	  uitvoer volgt geen hulp.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 id="floppies">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Julio</firstname>
	  <surname>Merino</surname>
	  <contrib>Origineel werk door </contrib>
	</author>
      </authorgroup>
      <!-- 24 december 2001 -->
      <authorgroup>
	<author>
	  <firstname>Martin</firstname>
	  <surname>Karlsson</surname>
	  <contrib>Herschreven door </contrib>
	</author>
      </authorgroup>
      <!-- 27 april 2003 -->
    </sect1info>

    <title>Diskettes aanmaken en gebruiken</title>

    <para>Soms is het opslaan van gegevens op een diskette nuttig,
      bijvoorbeeld als er geen andere verwijderbare opslagmedia
      beschikbaar zijn of als kleine hoeveelheden gegevens naar een
      andere computer moeten worden overgedragen.</para>

    <para>In deze sectie wordt beschreven hoe diskettes in &os;
      gebruikt dienen te worden.  Hier worden hoofdzakelijk het
      formatteren en gebruik van 3,5&nbsp;inch DOS-diskettes behandeld,
      maar de concepten zijn vergelijkbaar voor andere
      disketteformaten.</para>

    <sect2>
      <title>Diskettes formatteren</title>

      <sect3>
	<title>Het apparaat</title>

	<para>Diskettes worden benaderd door ingangen in
	  <filename>/dev</filename>, net zoals andere apparaten.  Om de
	  rauwe diskette in 4.X en eerdere versies te benaderen, dient
	  <filename>/dev/fd<replaceable>N</replaceable></filename>,
	  waar <replaceable>N</replaceable> voor het stationsnummer
	  staat, gewoonlijk 0, of
	  <filename>/dev/fd<replaceable>NX</replaceable></filename>,
	  waar <replaceable>X</replaceable> voor een letter staat,
	  gebruikt te worden.</para>

	<para>In 5.0 en nieuwere versies dient simpelweg <filename>
	    /dev/fd<replaceable>N</replaceable></filename> gebruikt te
	  worden.</para>

	<sect4>
	  <title>Schijfgrootte in 4.X en eerdere versies</title>

	  <para>Er zijn ook apparaten
	    <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>grootte</replaceable></filename>
	    waar <replaceable>grootte</replaceable> een diskettegrootte
	    in kB is.  Deze ingangen worden tijdens het formatteren op
	    laag niveau gebruikt om de schijfgrootte te bepalen.  In de
	    volgende voorbeelden wordt 1440&nbsp;kB als grootte
	    gebruikt.</para>

	  <para>Soms is het nodig om de ingangen in
	    <filename>/dev</filename> (opnieuw) aan te maken:</para>

	  <screen>&prompt.root; <userinput>cd /dev && ./MAKEDEV "fd*"</userinput></screen>
	</sect4>

	<sect4>
	  <title>Schijfgrootte in 5.0 en latere versies</title>

	  <para>In 5.0 beheert &man.devfs.5; automatisch de
	    apparaatnodes in <filename>/dev</filename>, dus is het niet
	    nodig om <command>MAKEDEV</command> te gebruiken.</para>

	  <para>De gewenste schijfgrootte wordt met de vlag
	    <option>-f</option> doorgegeven aan &man.fdformat.1;.  De
	    ondersteunde groottes staan vermeld in &man.fdcontrol.8;,
	    maar 1440kB werkt het beste.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Formatteren</title>

	<para>Een diskette dient op laag niveau geformatteerd te worden
	  voordat deze kan worden gebruikt.  Dit wordt meestal door de
	  fabrikant gedaan, maar formatteren is een goede manier om de
	  integriteit van het medium te controleren.  Hoewel het
	  mogelijk is om grotere (of kleinere) schijfgroottes te
	  forceren, zijn de meeste diskettes ontworpen voor
	  1440kB.</para>

	<para>Een diskette kan op laag niveau geformatteerd worden met
	  &man.fdformat.1;.  Dit gereedschap verwacht de apparaatnaam
	  als parameter.</para>

	<para>Op basis van eventuele foutmeldingen kan bepaald worden
	  of een schijf goed of slecht is.</para>

	<sect4>
	  <title>Formatteren in 4.X en eerdere versies</title>

	  <para>Voor het formatteren van een diskette dienen de
	    apparaten
	    <filename>/dev/fd<replaceable>N</replaceable>.<replaceable>grootte</replaceable></filename>
	    gebruikt te worden.  Nadat een 3,5&nbsp;inch diskette in
	    het station is gestoken:</para>

	  <screen>&prompt.root; <userinput>/usr/sbin/fdformat /dev/fd0.1440</userinput></screen>
	</sect4>

	<sect4>
	  <title>Formatteren in 5.0 en latere versies</title>

	  <para>Voor het formatteren van de diskette dienen de
	    apparaten
	    <filename>/dev/fd<replaceable>N</replaceable></filename>
	    gebruikt te worden.  Nadat een 3,5&nbsp;inch diskette in
	    het station is gestoken:</para>

	  <screen>&prompt.root; <userinput>/usr/sbin/fdformat -f 1440 /dev/fd0</userinput></screen>
	</sect4>
      </sect3>
    </sect2>

    <sect2>
      <title>Schijflabels</title>

      <para>Nadat de diskette op laag niveau is geformatteerd, dient er
	schijflabel aan gekoppeld te worden.  Dit schijflabel wordt
	later vernietigd, maar het systeem heeft het nodig om later de
	grootte en de geometrie van de schijf te bepalen.</para>

      <para>Het nieuwe schijflabel neemt de gehele schijf over en bevat
	alle benodigde informatie over de geometrie van de diskette.
	De geometriewaarden van het schijflabel staan vermeld in
	<filename>/etc/disktab</filename>.</para>

      <para>Nu kan &man.disklabel.8; als volgt gedraaid worden:</para>

      <screen>&prompt.root; <userinput>/sbin/disklabel -B -r -w /dev/fd0 fd1440</userinput></screen>

      <note>
	<para>Sinds &os;&nbsp;5.1-RELEASE is het oude programma
	  &man.disklabel.8; vervangen door &man.bsdlabel.8;.  In
	  &man.bsdlabel.8; zijn een aantal overbodige opties en
	  parameters verwijderd.  In de bovenstaande voorbeelden
	  dient de optie <option>-r</option> met &man.bsdlabel.8;
	  weggelaten te worden.  Meer informatie staat in de
	  hulppagina van &man.bsdlabel.8;.</para>
      </note>
    </sect2>

    <sect2>
      <title>Bestandssystemen</title>

      <para>Nu is de diskette klaar om op hoog niveau geformatteerd te
	worden.  Hiermee wordt een nieuw bestandssysteem opgezet, wat
	&os; in staat stelt om naar de schijf te lezen en te schrijven.
	Nadat het nieuwe bestandssysteem is aangemaakt, wordt het
	schijflabel vernietigd, dus om de schijf te herformatteren is
	het noodzakelijk om het schijflabel opnieuw aan te
	maken.</para>

      <para>Het bestandssysteem voor diskettes kan zowel UFS als FAT
	zijn.  FAT is over het algemeen een betere keuze voor
	diskettes.</para>

      <para>Om een nieuw bestandssysteem op de diskettes te
	zetten:</para>

      <screen>&prompt.root; <userinput>/sbin/newfs_msdos /dev/fd0</userinput></screen>

      <para>De schijf is nu klaar voor gebruik.</para>
    </sect2>

    <sect2>
      <title>Diskettes gebruiken</title>

      <para>Om de diskette te gebruiken kan &man.mount.msdos.8; (in
	4.X en eerdere versies) of &man.mount.msdosfs.8; (in 5.0 en
	nieuwere versies) gebruikt worden om het medium te mounten.
	Ook kan <filename
	  role="package">emulators/mtools</filename> uit de
	Portscollectie worden gebruikt.</para>
    </sect2>
  </sect1>

  <sect1 id="backups-tapebackups">
    <title>Gegevensbanden aanmaken en gebruiken</title>

    <indexterm><primary>bandmedia</primary></indexterm>

    <para>De belangrijkste bandmedia zijn de 4mm, 8mm, QIC,
      mini-cartridge en DLT.</para>

    <sect2 id="backups-tapebackups-4mm">
      <title>4mm (DDS: Digital Data Storage)</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>DDS (4mm) banden</secondary>
      </indexterm>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>QIC banden</secondary>
      </indexterm>

      <para>4mm-banden vervangen steeds vaker QIC-banden als
	back-upmedium voor werkstations.  Deze trend werd versneld toen
	Connor Archive, een toonaangevende fabrikant van QIC-stations,
	overnam en daarna de productie van QIC-stations stopte.
	4mm-stations zijn klein en stil maar genieten niet de
	betrouwbaarheidsreputatie van 8mm-stations.  De cartridges zijn
	minder duur en kleiner (3 x 2 x 0,5 inch, 76 x 51 x 12 mm) dan
	8mm-cartridges.  Net zoals bij 8mm hebben de koppen bij 4mm een
	vergelijkbaar kort leven, omdat beiden gebruik maken van een
	helische scan.</para>

      <para>De gegevensdoorvoer op deze stations begint bij ongeveer
	150&nbsp;kB/s, met pieken van 500&nbsp;kB/s.  De
	opslagcapaciteit begint bij 1,3&nbsp;GB en eindigt bij
	2,0&nbsp;GB.  Hardwarecompressie, die voor de meeste stations
	beschikbaar is, zorgt voor ongeveer een verdubbeling van de
	capaciteit.  Bibliotheekeenheden van multi-station
	bandbiliotheken kunnen 6 stations in een enkel kabinet bevatten
	met automatische wisseling van de banden.  De capaciteit van
	een bibliotheek loopt op tot 240&nbsp;GB.</para>

      <para>Door de DDS-3-standaard worden bandcapaciteiten van
	12&nbsp;GB (of 24&nbsp;GB met compressie) ondersteund.</para>

      <para>Net als 8mm-drives gebruiken 4mm-drives helische scan.
	Alle voor- en nadelen van helische scan gelden voor zowel 4mm-
	als 8mm-stations.</para>

      <para>Banden dienen na 2.000 maal of 100 volledige back-ups
	afgedankt te worden.</para>
    </sect2>

    <sect2 id="backups-tapebackups-8mm">
      <title>8mm (Exabyte)</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>Exabyte (8mm) banden</secondary>
      </indexterm>

      <para>8mm-banden zijn de meest gebruikte SCSI-banden.  Ze vormen
	de beste keuze met betrekking tot het uitwisselen van banden.
	Bijna elk bedrijf heeft een Exabyte 2&nbsp;GB 8mm-bandstation.
	8mm-stations zijn betrouwbaar, gemakkelijk en stil.  Cartridges
	zijn niet duur en klein (4,8 x 3,3 x 0,6 inch; 122 x 84 x 15
	mm).  Een nadeel van 8mm-banden is de relatief korte levensduur
	van de kop en band vanwege de hoge mate van relatieve beweging
	tussen de band en de koppen.</para>

      <para>De gegevensdoorvoer varieert van ~250&nbsp;kB/s tot
	~500&nbsp;kB/s.  De gegevensomvang begint bij 300&nbsp;MB en
	kan oplopen tot 7&nbsp;GB.  Hardwarecompressie, waarmee de
	meeste stations van deze soort zijn uitgerust, zorgt voor
	ongeveer een verdubbeling van de capaciteit.  Deze stations
	zijn los of als multi-station bandbiliotheken met 6 stations en
	120 banden in een enkele kast beschikbaar.  In het laatste
	geval worden banden automatisch per stuk verwisseld.  De
	capaciteit van een bibliotheek kan oplopen tot meer dan
	840&nbsp;GB.</para>

      <para>Het model <quote>Mammoth</quote> van Exabyte ondersteunt
	een een capaciteit van 12&nbsp;GB (24&nbsp;GB met compressie)
	per band en kost ongeveer twee maal zoveel als een gewoon
	bandstation.</para>

      <para>Gegevens worden door middel van helische scan op de band
	gezet en de koppen zijn onder een hoek (ongeveer 6 graden) op
	het medium gepositioneerd.  De band wordt 270 graden om de
	spoel gewikkeld die de koppen vasthoudt.  Dit resulteert in een
	hoge gegevensdichtheid en dicht bij elkaar staande sporen die
	een hoek van de ene naar de andere kant van de band
	maken.</para>
    </sect2>

    <sect2 id="backups-tapebackups-qic">
      <title>QIC</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>QIC-150</secondary>
      </indexterm>

      <para>De banden en stations voor de QIC-150 zijn misschien de
	meest voorkomende bandstations en bandmedia.  QIC-bandstations
	zijn de minst dure <quote>serieuze</quote> back-upstations.
	Het nadeel is de prijs van de media.  QIC-banden zijn duur in
	vergelijking met 8mm- of 4mm-banden.  De prijs per GB
	opslagruimte kan tot 5 maal zo hoog zijn.  Indien een half
	dozijn banden toereikend is, zijn QIC-banden waarschijnlijk de
	juiste keuze.  QIC is het <emphasis>meest</emphasis>
	voorkomende bandstation.  Elk bedrijf heeft QIC-stations met
	een bepaalde capaciteit.  QIC heeft namelijk een groot aantal
	capaciteiten per type band, die fysiek vergelijkbaar (soms
	identiek) zijn.  QIC-banden zijn niet stil.  Deze stations
	maken een hoorbaar geluid tijdens het zoeken voordat ze
	beginnen met het opnemen van gegevens en zijn duidelijk
	hoorbaar tijdens het lezen, schrijven en zoeken.  QIC-banden
	zijn 6 x 4 x 0,7 inch of 152 x 102 x 17 mm groot.</para>

      <para>De gegevensdoorvoer varieert van ~150&nbsp;kB/s tot
	~500&nbsp;kB/s.  Hardwarecompressie is mogelijk met veel van de
	nieuwere bandstations.  QIC-stations worden steeds minder vaak
	ge&iuml;nstalleerd.  Ze worden vervangen door
	DAT-stations.</para>

      <para>Gegevens worden in sporen op de band gezet.  De sporen
	lopen parallel aan de lange as van het bandmedium van het ene
	naar het andere einde.  Het aantal sporen, en daarmee de
	breedte van een spoor, varieert met de capaciteit van de band.
	De meeste, zo niet alle, nieuwe stations bieden achterwaartse
	leescompatibiliteit (en vaak ook achterwaartse
	schrijfcompabiliteit).  QIC heeft een goede reputatie op het
	gebied van gegevensveiligheid (de mechanismen zijn eenvoudiger
	en robuuster dan die van helische scan-stations).</para>

      <para>Banden dienen na 5.000 back-ups afgedankt te worden.</para>
    </sect2>

    <sect2 id="backups-tapebackups-dlt">
      <title>DLT</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>DLT</secondary>
      </indexterm>

      <para>DLT-banden hebben de snelste gegevensdoorvoer van alle
	hiergenoemde bandstations.  De band van 1/2 inch (12,5 mm) zit
	in een cartridge (4 x 4 x 1 inch; 100 x 100 x 25 mm) op
	&eacute;&eacute;n enkele haspel.  De cartridge heeft een
	opklapbare opening aan &eacute;&eacute;n gehele kant van de
	cartridge.  Het mechanisme van het station opent deze opening
	om de bandleider eruit te halen.  De bandleider heeft een ovaal
	gat dat door het station gebruikt wordt om de band <quote>vast
	  te zetten</quote>.  De haspel die de band aanpakt is in het
	bandstation gesitueerd.  Bij alle andere bandcartridges die
	hier genoemd zijn (9-sporige banden zijn de enige uitzondering)
	zitten zowel de haspel die de band levert als de haspel die de
	band aanpakt in de bandcartridge zelf.</para>

      <para>De gegevensdoorvoer bedraagt ongeveer 1.5&nbsp;MB/s, drie
	maal de doorvoer van 4mm-, 8mm-, en QIC-bandstations.  De
	gegevenscapaciteit varieert van 10&nbsp;GB tot 20&nbsp;GB per
	stations.  Stations zijn als meerdere-bandwisselaars en als
	bibliotheken van meerdere banden en meerdere stations
	beschikbaar, die 5 tot 900 banden bevatten verspreid over 1 tot
	20 stations, waardoor een opslagcapaciteit van 50&nbsp;GB tot
	9&nbsp;TB geleverd wordt.</para>

      <para>Met compressie levert het formaat DLT Type IV tot
	70&nbsp;GB aan capaciteit.</para>

      <para>Gegevens worden in sporen die parallel aan de looprichting
	lopen op de band gezet (net als met QIC-banden).  Er worden
	twee sporen per keer geschreven.  De levensduur van de lees- en
	schrijfkoppen is relatief lang.  Als de band eenmaal stilstaat,
	is er geen relatieve beweging tussen de koppen en de
	band.</para>
    </sect2>

    <sect2>
      <title id="backups-tapebackups-ait">AIT</title>

      <indexterm>
	<primary>bandmedia</primary>

	<secondary>AIT</secondary>
      </indexterm>

      <para>AIT is een nieuw formaat van Sony dat (met compressie) tot
	50&nbsp;GB gegevens per band kan bevatten.  De band bevat
	geheugenchips die een index van de inhoud van de band bevatten.
	Deze index kan snel door het bandstation gelezen worden voor
	het bepalen van de positie van bestanden op de band, in plaats
	van de enkele minuten die nodig zijn voor andere banden.
	Software als <application>SAMS:Alexandria</application> kan
	meer dan veertig AIT-bandbibliotheken beheren, waarbij het
	direct met de geheugenchip van de band communiceert om de
	inhoud op het scherm te tonen, om te bepalen welke bestanden
	naar welke band zijn geback-upped en om de correcte band te
	vinden, laden en de gegevens ervan terug te zetten.</para>

      <para>Dit soort bibliotheken kosten rond de $&nbsp;20.000,
	waardoor ze enigszins boven het budget van de hobbyist
	liggen.</para>
    </sect2>

    <sect2>
      <title>Eerste gebruik van een nieuwe band</title>

      <para>Als de eerste keer van een nieuwe, geheel lege band wordt
	gelezen of ernaar wordt geschreven, mislukt dit.  Het bericht
	op de console zier er analoog aan het volgende uit:</para>

      <screen>sa0(ncr1:4:0): NOT READY asc:4,1
sa0(ncr1:4:0):  Logical unit is in process of becoming ready</screen>

      <para>De band bevat geen Identifier Block (bloknummer 0).  Alle
	QIC-bandstations sinds de adoptie van de standaard QIC-525
	schrijven een Identifier Block naar de band.  Er zijn twee
	oplossingen:</para>

      <itemizedlist>
	<listitem>
	  <para><command>mt fsf 1</command> zorgt ervoor dat het
	    bandstation een Identifier Block naar de band
	    schrijft.</para>
	</listitem>

	<listitem>
	  <para>De knop aan de voorkant van het paneel dient gebruikt
	    te worden om de band uit te werpen.</para>

	  <para>De band dient opnieuw in het station gestoken te worden
	    en met <command>dump</command> worden gegevens naar de band
	    gedumpt.</para>

	  <para><command>dump</command> geeft <errorname>DUMP: End of
	      tape detected</errorname> en de console laat het volgende
	    zien:<errorname>HARDWARE FAILURE info:280
	      asc:80,96</errorname>.</para>

	  <para>De band kan met <command>mt rewind</command>
	    teruggespoeld te worden.</para>

	  <para>Hierna zijn alle bandbewerkingen succesvol.</para>
	</listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1 id="backups-floppybackups">
    <title>Naar diskettes back-uppen</title>

    <sect2 id="floppies-using">
      <title>Kunnen diskettes gebruikt worden om gegevens te
	back-uppen?</title>

      <indexterm><primary>back-updiskettes</primary></indexterm>

      <indexterm><primary>diskettes</primary></indexterm>

      <para>Diskettes zijn niet bepaald een geschikt medium om
	back-ups mee te maken, omdat:</para>

      <itemizedlist>
	<listitem>
	  <para>Het medium onbetrouwbaar is, in het bijzonder op de
	    langere termijn;</para>
	</listitem>

	<listitem>
	  <para>Het back-uppen en terugzetten erg traag is;</para>
	</listitem>

	<listitem>
	  <para>Diskettes een zeer beperkte capaciteit hebben.  De
	    tijden dat een hele harde schijf naar een tiental diskettes
	    kon worden geback-upped zijn allang verstreken.</para>
	</listitem>
      </itemizedlist>

      <para>Maar als er geen andere manier beschikbaar is om de
	gegevens te back-uppen, is een back-up naar diskettes beter
	dan helemaal geen back-up.</para>

      <para>Gebruikte diskettes moet van goede kwaliteit zijn.
	Diskettes die al jaren op kantoor rondgeslingerd hebben, zijn
	een slechte keuze.  In het ideale geval dienen nieuwe diskettes
	van een reputabele fabrikant gebruikt te worden.</para>
    </sect2>

    <sect2 id="floppies-creating">
      <title>Hoe de gegevens naar diskettes back-uppen?</title>

      <para>Het beste kan naar diskettes worden geback-upped door
	gebruik te maken van &man.tar.1; met de optie
	<option>-M</option> (meerdere volumes), die back-ups over
	meerdere diskettes ondersteunt.</para>

      <para>Om alle bestanden in de huidige map en de submappen te
	back-uppen (als <username> root</username>):</para>

      <screen>&prompt.root; <userinput>tar Mcvf /dev/fd0 *</userinput></screen>

      <para>Als de eerste diskette vol is, vraagt &man.tar.1; om het
	volgende volume.  Omdat &man.tar.1; media-onafhankelijk is,
	refereert het aan volumes, in deze context diskettes.</para>

      <screen>Prepare volume #2 for /dev/fd0 and hit return:</screen>

      <para>Dit wordt herhaald (met oplopend volumenummer) totdat alle
	gespecificeerde bestanden zijn geback-upped.</para>
    </sect2>

    <sect2 id="floppies-compress">
      <title>Kunnen back-ups gecomprimeerd worden?</title>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <indexterm><primary><command>gzip</command></primary></indexterm>

      <indexterm><primary>compressie</primary></indexterm>

      <para>Helaas staat &man.tar.1; het gebruik van de optie
	<option>-z</option> niet toe voor archieven over meerdere
	volumes.  Het is uiteraard mogelijk om alle bestanden met
	&man.gzip.1; te comprimeren, ze met &man.tar.1; op diskettes te
	zetten en ze daarna met &man.gunzip.1; weer te
	decomprimeren!</para>
    </sect2>

    <sect2 id="floppies-restoring">
      <title>Hoe worden de back-ups teruggezet?</title>

      <para>Om een volledige archief terug te zetten:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0</userinput></screen>

      <para>Er zijn twee manieren om alleen specifieke bestanden terug
	te zetten.  Ten eerste kan met de eerste diskette begonnen
	worden:</para>

      <screen>&prompt.root; <userinput>tar Mxvf /dev/fd0 <replaceable>bestandsnaam</replaceable></userinput></screen>

      <para>Het programma &man.tar.1; vraagt om de vervolgdiskettes
	totdat het benodigde bestand is gevonden.</para>

      <para>Als alternatief kan, als bekend is op welke diskette het
	bestand staat, de betreffende diskette worden ingestoken en
	bovenstaand commando gebruikt worden.  Als het eerste bestand
	op de diskette een vervolg is van de vorige diskette,
	waarschuwt &man.tar.1; dat het bestand niet teruggezet kan
	worden, zelfs als hier niet om gevraagd is!</para>
    </sect2>
  </sect1>

  <sect1 id="backup-basics">
    <title>Back-upbeginselen</title>

    <para>De drie grote back-upprogramma's zijn &man.dump.8;,
      &man.tar.1; en &man.cpio.1;.</para>

    <sect2>
      <title>Dump en Restore</title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary>dump / restore</secondary>
      </indexterm>

      <indexterm><primary><command>dump</command></primary></indexterm>

      <indexterm><primary><command>restore</command></primary></indexterm>

      <para>De traditionele back-upprogramma's voor &unix; zijn
	<command>dump</command> en <command>restore</command>.  Deze
	zien het station als een verzameling van schijfblokken, onder
	de abstracties van bestanden, koppelingen en mappen die door de
	bestandssystemen worden aangemaakt.  <command>dump</command>
	verzorgt een back-up van een compleet bestandssysteem op een
	apparaat.  Het is niet in staat om slechts een gedeelte van een
	bestandssysteem of een mapstructuur die meer dan
	&eacute;&eacute;n bestandssysteem in beslag neemt te
	back-uppen.  <command>dump</command> schrijft geen bestanden en
	mappen naar band, maar de rauwe gegevensblokken waaruit de
	bestanden en mappen bestaan.</para>

      <note>
	<para>Indien <command>dump</command> op een hoofdmap wordt
	  gebruikt, wordt er geen back-up gemaakt van <filename>/home
	  </filename>, <filename>/usr</filename> of van de vele andere
	  mappen, aangezien dit typisch mountpunten voor andere
	  bestandssystemen of symbolische koppelingen binnen deze
	  bestandssystemen zijn.</para>
      </note>

      <para><command>dump</command> bevat eigenaardigheden die uit de
	begintijd in Versie 6 van AT&amp;T &unix; (circa 1975) zijn
	overgebleven.  De standaardparameters zijn geschikt voor banden
	met 9 sporen (6.250 bpi), niet voor de media met hoge dichtheid
	die vandaag beschikbaar zijn (tot 62.182 ftpi).  Deze
	standaardwaarden dienen op de opdrachtregel overschreven te
	worden om de capaciteit van de huidige bandstations te
	benutten.</para>

      <indexterm><primary><filename>.rhosts</filename></primary></indexterm>

      <para>Het is ook mogelijk om gegevens met
	<command>rdump</command> en <command>rrestore</command> over
	een netwerk naar een bandstation dat aan een andere computer
	gekoppeld is te back-uppen.  Beide programma's maken gebruik
	van &man.rcmd.3; en &man.ruserok.3; om toegang tot het
	bandstation op afstand te krijgen.  De gebruiker die de back-up
	uitvoert moet vermeld staat in het bestand
	<filename>.rhosts</filename> op de computer op afstand.  De
	argumenten die aan <command>rdump</command> en
	<command>rrestore</command> gegeven worden dienen geschikt te
	zijn voor gebruik op de computer op afstand.  Als
	<command>rdump</command> gebruikt wordt om een dump te maken
	van een &os; computer naar een Exabyte-bandstation dat
	met een Sun-computer genaamd <hostid>komodo</hostid> verbonden
	is:</para>

      <screen>&prompt.root; <userinput>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2>&amp;1</userinput></screen>

      <para>Let op: er kleven veiligheidsbezwaren aan het toestaan van
	authenticatie met <filename>.rhosts</filename>.  De situatie
	dient goed ge&euml;valueerd te worden.</para>

      <para>Het is ook mogelijk om <command>dump</command> en
	<command>restore</command> op een veiligere manier via
	<command>ssh</command> te gebruiken.</para>

      <example>
	<title>Het gebruik van <command>dump</command> via
	  <application>ssh</application></title>

	<screen>&prompt.root; <userinput>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
	  doelgebruiker@doelmachine.voorbeeld.com dd of=/mijngrotebestanden/dump-usr-10.gz</userinput></screen>
      </example>

      <para>Ook kan de ingebouwde manier van <command>dump</command>
	gebruikt worden, door de omgevingsvariabele <envar>RSH</envar>
	in te stellen:</para>

      <example>
	<title>Het gebruik van <command>dump</command> via
	  <application>ssh</application> met ingestelde
	  <envar>RSH</envar></title>

	<screen>&prompt.root; <userinput>RSH=/usr/bin/ssh /sbin/dump -0uan -f doelgebruiker@doelmachine.voorbeeld.com:/dev/sa0 /usr</userinput></screen>
      </example>
    </sect2>

    <sect2>
      <title><command>tar</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>tar</command></secondary>
      </indexterm>

      <para>&man.tar.1; stamt ook uit de tijd van Versie 6 van AT&amp;T
	&unix; (circa 1975).  <command>tar</command> werkt samen met
	het bestandssysteem.  <command>tar</command> schrijft bestanden
	en mappen naar band en ondersteunt niet het volledige scala aan
	opties dat beschikbaar is met &man.cpio.1;, maar
	<command>tar</command> heeft niet de ongebruikelijke
	opdrachtpijplijn nodig die <command>cpio</command>
	gebruikt.</para>

      <indexterm><primary><command>tar</command></primary></indexterm>

      <para>De meeste versies van <command>tar</command> bieden geen
	ondersteuning voor back-ups over het netwerk.  De GNU-versie
	van <command>tar</command>, die door &os; gebruikt wordt,
	ondersteunt apparaten op afstand waarbij gebruik wordt gemaakt
	van dezelfde syntaxis als die van <command>rdump</command>.  Om
	<command>tar</command> toe te passen op een Exabyte-bandstation
	die met een Sun genaamd <hostid>komodo</hostid> verbonden
	is:</para>

      <screen>&prompt.root; <userinput>/usr/bin/tar cf komodo:/dev/nsa8 . 2 >&amp;1</userinput></screen>

      <para>Voor versies zonder ondersteuning voor apparaten op afstand
	kan gebruik worden gemaakt van een pijplijn en
	<command>rsh</command> om gegevens naar een bandstation op
	afstand te zenden:</para>

      <screen>&prompt.root; <userinput>tar cf - . | rsh <replaceable>hostnaam</replaceable> dd of=<replaceable>bandapparaat</replaceable> obs=20b</userinput></screen>

      <para>Indien de veiligheid van back-uppen over een netwerk een
	punt is, dient gebruik te worden gemaakt van het commando
	<command>ssh</command> en niet van
	<command>rsh</command>.</para>
    </sect2>

    <sect2>
      <title><command>cpio</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>cpio</command></secondary>
      </indexterm>

      <para>&man.cpio.1; is het originele &unix; bandprogramma voor
	magnetische media om bestanden uit te wisselen.
	<command>cpio</command> heeft opties (naast vele anderen) om
	byte-swapping uit te voeren, een aantal verschillende
	archiefformaten te schrijven en de gegevens over een pijplijn
	naar andere programma's te voeren.  Deze laatste optie maakt
	<command>cpio</command> een uitstekende keuze voor
	installatiemedia.  <command>cpio</command> weet niet hoe het
	door een mapstructuur moet lopen.  Er dient een lijst met
	bestanden door <filename>stdin</filename> aangeleverd te
	worden.</para>

      <indexterm><primary><command>cpio</command></primary></indexterm>

      <para><command>cpio</command> biedt geen ondersteuning voor
	back-ups over het netwerk.  Er kan gebruik worden gemaakt van
	een pijplijn en <command>rsh</command> om de gegevens naar een
	banddrive op afstand te sturen.</para>

      <screen>&prompt.root; <userinput>for f in <replaceable>maplijst; </replaceable> do</userinput>
<userinput>find $f >> back-up.lijst</userinput>
<userinput>done</userinput>
&prompt.root; <userinput>cpio -v -o --format=newc < back-up.lijst | ssh <replaceable>gebruiker</replaceable>@<replaceable>host</replaceable> "cat > <replaceable>back-upapparaat</replaceable>"</userinput></screen>

      <para>Hier is <replaceable>maplijst</replaceable> een lijst van
	de mappen waarvan een back-up gemaakt dient te worden,
	<replaceable>gebruiker</replaceable>@<replaceable>host</replaceable>
	de gebruiker/hostnaam-combinatie die de back-ups uitvoert, en
	<replaceable>back-upapparaat</replaceable> het apparaat waar de
	back-ups naar toe geschreven te worden (bijvoorbeeld
	<filename>/dev/nsa0</filename>).</para>
    </sect2>

    <sect2>
      <title><command>pax</command></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><command>pax</command></secondary>
      </indexterm>

      <indexterm><primary><command>pax</command></primary></indexterm>

      <indexterm><primary>POSIX</primary></indexterm>

      <indexterm><primary>IEEE</primary></indexterm>

      <para>&man.pax.1; is het antwoord van IEEE en &posix; op
	<command>tar</command> en <command>cpio</command>.  In de loop
	der jaren zijn de verscheidene versies van
	<command>tar</command> en <command>cpio</command> licht
	incompatibel geworden.  Dus in plaats van dit uit te vechten en
	ze volledig te standaardiseren, heeft &posix; een nieuw
	archiveringsprogramma gemaakt.  <command>pax</command> poogt om
	veel van de verscheidene formaten van <command>cpio</command>
	en <command>tar</command> te lezen en te schrijven, met daarbij
	nog nieuwe, eigen formaten.  De commandoverzameling lijkt meer
	op die van <command>cpio</command> dan op die van
	<command>tar</command>.</para>
    </sect2>

    <sect2 id="backups-programs-amanda">
      <title><application>Amanda</application></title>

      <indexterm>
	<primary>back-upsoftware</primary>

	<secondary><application>Amanda</application></secondary>
      </indexterm>

      <indexterm><primary><application>Amanda</application></primary></indexterm>

      <para><application>Amanda</application> (Advanced Maryland
	Network Disk Archiver) is een client/server-back-upsysteem, in
	plaats van een enkel programma.  Een
	<application>Amanda</application> server back-upt elk aantal
	computers dat een <application>Amanda</application> client en
	een netwerkverbinding met de <application>Amanda</application>
	server heeft naar een enkel bandstation.  Een veelvoorkomend
	probleem bij bedrijven met een groot aantal schijven is dat de
	tijd die nodig is om de gegevens direct naar band te back-uppen
	langer is dan de tijd die voor de taak gereserveerd is.
	<application>Amanda</application> lost dit probleem op.
	<application>Amanda</application> kan gebruik maken van een
	<quote>tussenschijf</quote> om verschillende bestandssystemen
	tegelijkertijd te back-uppen.
	<application>Amanda</application> maakt
	<quote>archiefverzamelingen</quote> aan, een groep banden die
	  gedurende een tijd gebruikt wordt om volledige back-ups te
	  maken van alle bestandssystemen die in het
	  instellingenbestand van <application>Amanda</application>
	  vermeld staan.  De <quote>archiefverzameling</quote> bevat
	  ook incrementele (of differenti&euml;le) back-ups van alle
	  bestandssystemen.  Voor het herstellen van een beschadigd
	  bestandssysteem zijn de meest recente volledige back-up en de
	  incrementele back-ups nodig.</para>

      <para>Het instellingenbestand biedt verfijnde controle over de
	back-ups en het netwerkverkeer door
	<application>Amanda</application>.
	<application>Amanda</application> kan elk bovenstaand
	back-upprogramma gebruiken om de gegevens naar de band te
	schijven.  <application>Amanda</application> is &ograve;f als
	port &ograve;f als package beschikbaar.</para>
    </sect2>

    <sect2>
      <title>Nietsdoen</title>

      <para><quote>Nietsdoen</quote> is geen computerprogramma, maar de
	de meest gebruikte back-upstrategie.  Er zijn geen
	initi&euml;le kosten.  Er is geen back-upschema om te volgen.
	Zeg gewoon nee.  Als er iets met gegevens gebeurt, lach erom en
	leef ermee!</para>

      <para>Als tijd en gegevens weinig tot niets waard zijn, is
	<quote>Nietsdoen</quote> het meest geschikte back-upprogramma.
	Maar wees bedacht, &unix; is een nuttig stuk gereedschap en er
	is zo maar binnen zes maanden een verzameling bestanden die
	w&egrave;l van waarde is.</para>

      <para><quote>Nietsdoen</quote> is de juiste back-upmethode voor
	<filename>/usr/obj</filename> en andere mapstructuren die zo
	opnieuw aangemaakt kunnen worden.  Een voorbeeld zijn de
	bestanden waaruit de HTML- of &postscript; versie van dit
	Handboek bestaan.  Deze documentformaten zijn vanuit
	SGML-invoerbestanden aangemaakt.  Het back-uppen van de HTML-
	of &postscript; bestanden is niet nodig.  Van de SGML-bestanden
	dient regelmatig een back-up gemaakt te worden.</para>
    </sect2>

    <sect2>
      <title>Welk back-upprogramma is het beste?</title>

      <indexterm><primary>LISA</primary></indexterm>

      <para>&man.dump.8;.  <emphasis>Punt uit.</emphasis>.  Elizabeth
	D. Zwicky heeft stresstesten op alle hierboven besproken
	back-upprogramma's uitgevoerd.  De heldere keuze voor het
	behouden van alle gegevens en alle eigenaardigheden van &unix;
	bestandssystemen is <command>dump</command>.  Elizabeth heeft
	bestandssystemen aangemaakt met een grote verscheidenheid aan
	ongewone omstandigheden (en enkele minder ongebruikelijke) en
	heeft elk programma getest door een back-up van die
	bestandssystemen uit te voeren en ze te herstellen.  De
	eigenaardigheden omvatten bestanden met gaten, bestanden met
	gaten en een blok nullen, bestanden met vreemde tekens in hun
	namen, onleesbare en onschrijfbare bestanden, apparaten,
	bestanden waarvan de grootte verandert tijdens het back-uppen,
	bestanden die aangemaakt/verwijderd worden tijdens het
	back-uppen en meer.  Ze presenteerde de resultaten op LISA V in
	oktober 1991.  Zie <ulink
	  url="http://berdmann.dyndns.org/zwicky/testdump.doc.html">torture-testing
	  Backup and Archive Programs</ulink>.</para>
    </sect2>

    <sect2>
      <title>Noodterugzetprocedure</title>

      <sect3>
	<title>V&oacute;&oacute;r de ramp</title>

	<para>Er zijn slechts vier stappen om te volgen bij het
	  voorbereiden op elke ramp die voor kan komen.</para>

	<indexterm><primary><command>disklabel</command></primary></indexterm>

	<para>Het schijflabel van elke schijf dient afgedrukt te worden
	  (bijvoorbeeld met <command>disklabel da0 | lpr</command>), de
	  bestandssysteemtabel (<filename>/etc/fstab</filename>) en
	  alle opstartboodschappen, alles in tweevoud.</para>

	<indexterm><primary>fix-it diskettes</primary></indexterm>

	<para>De opstart- en fixit-diskettes
	  (<filename>boot.flp</filename> en
	  <filename>fixit.flp</filename>) moeten alle gewenste
	  apparaten bevatten.  De gemakkelijkste manier om dit te
	  controleren is om de machine opnieuw op te starten met de
	  opstartdiskette in het diskettestation en de opstartmeldingen
	  te controleren.  Als alle apparaten gemeld en functioneel
	  zijn, kan stap drie uitgevoerd worden.</para>

	<para>In het andere geval dienen twee eigen opstartbare
	  diskettes aangemaakt te worden die een kernel bevatten die
	  alle gewenste schijven kan mounten en toegang heeft tot het
	  bandstation.  Deze diskettes dienen het volgende te bevatten:
	  <command>fdisk</command>, <command>newfs</command>,
	  <command>mount</command> en het gebruikte back-upprogramma.
	  Deze programma's dienen statisch gelinkt te worden.  Als
	  <command>dump</command> gebruikt wordt, moet de diskette
	  <command>restore</command> bevatten.</para>

	<para>Ten derde dienen regelmatig back-upbanden aangemaakt te
	  worden.  Alle veranderingen die na de laatste back-up zijn
	  gemaakt kunnen onherroepelijk verloren zijn gegaan.  De
	  back-upbanden dienen beveiligd te worden tegen
	  overschrijven.</para>

	<para>Ten vierde dienen de diskettes (&ograve;fwel
	  <filename>boot.flp</filename> en
	  <filename>fixit.flp</filename>, &ograve;fwel de twee eigen
	  diskettes die in stap twee zijn aangemaakt) en de
	  back-upbanden getest te worden.  Van de handelingen dienen
	  aantekeningen gemaakt te worden.  De aantekeningen, de
	  opstartbare diskette, de afdrukken en de back-upbanden moeten
	  gezamenlijk bewaard te worden.  Tijdens het herstellen kunnen
	  de notities ervoor zorgen dat de back-upbanden vernietigd
	  worden.  Hoe?  In plaats van <command>tar xvf
	    /dev/sa0</command> kan per ongeluk <command>tar cvf
	    /dev/sa0</command> worden ingetypt, waardoor de back-upband
	  overschreven wordt.</para>

	<para>Als extra veiligheidsmaatregel dienen opstartbare
	  diskettes en telkens twee back-upbanden gemaakt te worden.
	  E&eacute;n van deze banden dient op een plaats op afstand
	  bewaard te worden.  Zo'n plaats is NIET de kelder van het
	  zelfde kantoorgebouw.  Een aantal bedrijven in het World
	  Trade Center heeft deze les op de harde manier geleerd.  Zo'n
	  plaats dient fysiek gescheiden te zijn van de computers en de
	  schijven door een significante afstand.</para>

	<example>
	  <title>Script voor het aanmaken van de
	    opstartdiskette</title>

	  <programlisting><![ CDATA [#!/bin/sh
#
# maak een hersteldiskette aan
#
# formatteer de diskette
#
PATH=/bin:/sbin:/usr/sbin:/usr/bin

fdformat -q fd0
if [ $? -ne 0 ]
then
	 echo "Slechte diskette, gebruik alstublieft een nieuwe"
	 exit 1
fi

# plaats opstartblokken op de diskette
#
disklabel -w -B /dev/fd0c fd1440

#
# newfs de enige echte partitie
#
newfs -t 2 -u 18 -l 1 -c 40 -i 5120 -m 5 -o space /dev/fd0a

#
# mount de nieuwe diskette
#
mount /dev/fd0a /mnt

#
# maak de benodigde mappen aan
#
mkdir /mnt/dev
mkdir /mnt/bin
mkdir /mnt/sbin
mkdir /mnt/etc
mkdir /mnt/root
mkdir /mnt/mnt			# voor de rootpartitie
mkdir /mnt/tmp
mkdir /mnt/var

#
# vul de mappen in
#
if [ ! -x /sys/compile/MINI/kernel ]
then
	 cat << EOM
De MINI kernel bestaat niet, maak er alstublieft een aan.
Hier volgt een voorbeeld van een configuratiebestand:
#
# MINI -- Een kernel om &os; op een schijf te krijgen.
#
machine         "i386"
cpu             "I486_CPU"
ident           MINI
maxusers        5

options         INET                    # nodig voor _tcp _icmpstat _ipstat
                                        #            _udpstat _tcpstat _udb
options         FFS                     #Berkeley Fast File System
options         FAT_CURSOR              #blokcursor in syscons of pccons
options         SCSI_DELAY=15           #Wees pessimistisch over SCSI-apparaat Jan
options         NCONS=2                 #1 virtuele console
options         USERCONFIG              #Sta gebruikersinstellingen toe met -c XXX

config          kernel	root on da0 swap on da0 and da1 dumps on da0

device          isa0
device          pci0

device          fdc0	at isa? port "IO_FD1" bio irq 6 drq 2 vector fdintr
device          fd0	at fdc0 drive 0

device          ncr0

device          scbus0

device          sc0	at isa? port "IO_KBD" tty irq 1 vector scintr
device          npx0	at isa? port "IO_NPX" irq 13 vector npxintr

device          da0
device          da1
device          da2

device          sa0

pseudo-device   loop            # nodig voor INET
pseudo-device   gzip            # Voer ge-gzip-te a.out's uit.
EOM
	 exit 1
fi

cp -f /sys/compile/MINI/kernel /mnt

gzip -c -best /sbin/init > /mnt/sbin/init
gzip -c -best /sbin/fsck > /mnt/sbin/fsck
gzip -c -best /sbin/mount > /mnt/sbin/mount
gzip -c -best /sbin/halt > /mnt/sbin/halt
gzip -c -best /sbin/restore > /mnt/sbin/restore

gzip -c -best /bin/sh > /mnt/bin/sh
gzip -c -best /bin/sync > /mnt/bin/sync

cp /root/.profile /mnt/root

cp -f /dev/MAKEDEV /mnt/dev
chmod 755 /mnt/dev/MAKEDEV

chmod 500 /mnt/sbin/init
chmod 555 /mnt/sbin/fsck /mnt/sbin/mount /mnt/sbin/halt
chmod 555 /mnt/bin/sh /mnt/bin/sync
chmod 6555 /mnt/sbin/restore

#
# maak de apparaatnodes aan
#
cd /mnt/dev
./MAKEDEV std
./MAKEDEV da0
./MAKEDEV da1
./MAKEDEV da2
./MAKEDEV sa0
./MAKEDEV pty0
cd /

#
# maak een minimale bestandssysteemtabel aan
#
cat > /mnt/etc/fstab <<EOM
/dev/fd0a    /    ufs    rw  1  1
EOM

#
# maak een minimaal passwd bestand aan
#
cat > /mnt/etc/passwd <<EOM
root:*:0:0:Charlie &:/root:/bin/sh
EOM

cat > /mnt/etc/master.passwd <<EOM
root::0:0::0:0:Charlie &:/root:/bin/sh
EOM

chmod 600 /mnt/etc/master.passwd
chmod 644 /mnt/etc/passwd
/usr/sbin/pwd_mkdb -d/mnt/etc /mnt/etc/master.passwd

#
# umount de diskette en informeer de gebruiker
#
/sbin/umount /mnt
echo "De diskette is gedismount en is nu klaar."]]></programlisting>
	</example>
      </sect3>

      <sect3>
	<title>Na de ramp</title>

	<para>De hamvraag is: heeft de hardware het overleefd?  Er zijn
	  regelmatig back-ups gemaakt, dus zorgen over de software
	  zijn niet nodig.</para>

	<para>Indien hardware beschadigd is, dienen kapotte onderdelen
	  vervangen te worden voordat gepoogd wordt om een computer te
	  gebruiken.</para>

	<para>Indien de hardware in orde is, dienen de diskettes
	  gecontroleerd te worden.  Als een eigen opstartdiskette
	  gebruikt wordt, start in enkele-gebruiker-modus op (type op
	  de opstartprompt <prompt>boot:</prompt> <literal>-s</literal>
	  in).  Sla dan de volgende paragraaf over.</para>

	<para>Lees verder als de diskettes
	  <filename>boot.flp</filename> en
	  <filename>fixit.flp</filename> gebruikt worden.  Steek de
	  diskette <filename>boot.flp</filename> als eerste in het
	  diskettestation en start de computer op.  Het originele
	  installatiemenu wordt op het scherm getoond.  Kies de optie
	  <literal>Fixit--Repair mode with CDROM or floppy</literal>.
	  Steek de diskette <filename>fixit.flp</filename> in als erom
	  gevraagd wordt.  <command>restore</command> en de andere
	  benodigde programma's staan in <filename
	    class="directory">/mnt2/rescue</filename> (<filename
	    class="directory">/mnt/stand</filename> voor &os; ouder dan
	  versie 5.2).</para>

	<para>Herstel elk bestandssysteem apart.</para>

	<indexterm><primary><command>mount</command></primary></indexterm>

	<indexterm><primary>rootpartitie</primary></indexterm>

	<indexterm><primary><command>disklabel</command></primary></indexterm>

	<indexterm><primary><command>newfs</command></primary></indexterm>

	<para>Probeer de rootpartitie van de eerste schijf te mounten
	  (bijvoorbeeld <command>mount /dev/da0a /mnt</command>).  Als
	  het schijflabel beschadigd is, gebruik dan
	  <command>disklabel</command> om de schijf opnieuw te
	  partitioneren en te labelen zodat deze overeenkomt met het
	  afgedrukte en bewaarde label.  Gebruik voor het opnieuw
	  aanmaken van de bestandssystemen <command>newfs</command>.
	  Hermount de rootpartitie van de diskette voor lezen en
	  schrijven (<command>mount -u -o rw /mnt</command>).  Gebruik
	  voor het herstellen van de gegevens van dit bestandssysteem
	  het back-upprogramma en de back-upbanden (bijvoorbeeld
	  <command>restore vrf /dev/sa0</command>).  Dismount nu het
	  bestandssysteem (bijvoorbeeld <command>umount
	    /mnt</command>).  Herhaal dit voor elk beschadigd
	    bestandssysteem.</para>

	<para>Back-up de gegevens naar nieuwe banden als het systeem
	  weer draait.  De omstandigheden die verantwoordelijk waren
	  voor de crash of het gegevensverlies kunnen weer voorkomen.
	  Nu een extra uur investeren, kan later grote zorgen
	  besparen.</para>
      </sect3>

      <![ %not.published; [

	<sect3>
	  <title>* Er zijn geen voorbereidingen voor de ramp getroffen,
	    wat nu?</title>

	  <para></para>
	</sect3>
]]>
    </sect2>
  </sect1>

  <sect1 id="disks-virtual">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Marc</firstname>
	  <surname>Fonvieille</surname>
	  <contrib>Geherstructureerd en verbeterd door </contrib>
	</author>
      </authorgroup>
    </sect1info>

    <title>Netwerk-, geheugen-, en bestandsgebaseerde
      bestandssystemen</title>

    <indexterm><primary>virtuele schijven</primary></indexterm>

    <indexterm>
      <primary>schijven</primary>

      <secondary>virtueel</secondary>
    </indexterm>

    <para>Naast de schijven die fysiek in de computer zitten,
      diskettes, CD's, harde schijven, enzovoort, worden er ook andere
      vormen van schijven door &os; begrepen: de <firstterm>virtuele
	schijven</firstterm>.</para>

    <indexterm><primary>NFS</primary></indexterm>

    <indexterm><primary>Coda</primary></indexterm>

    <indexterm>
      <primary>schijven</primary>

      <secondary>geheugen</secondary>
    </indexterm>

    <para>Dit omvat netwerkbestandssystemen zoals het <link
	linkend="network-nfs">Network File System</link> en Coda,
      geheugengebaseerde bestandssystemen en bestandsgebaseerde
      bestandssystemen.</para>

    <para>Nagelang de gebruikte versie van &os;, zijn er andere
      gereedschappen voor het aanmaken en gebruiken van
      bestandsgebaseerde en geheugengebaseerde bestandssystemen.</para>

    <note>
      <para>Gebruikers van &os;&nbsp;4.X kunnen &man.MAKEDEV.8;
	gebruiken om de benodigde apparaten aan te maken.
	&os;&nbsp;5.0 en nieuwer kennen &man.devfs.8; om de
	apparaatnodes transparant voor de gebruiker toe te
	wijzen.</para>
    </note>

    <sect2 id="disks-vnconfig">
      <title>Bestandsgebaseerd bestandssysteem onder
	&os;&nbsp;4.X</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>bestandsgebaseerd (4.X)</secondary>
      </indexterm>

      <para>Het commando &man.vnconfig.8; stelt vnode
	pseudo-schijf-apparaten in en zet ze aan.  Een
	<firstterm>vnode</firstterm> is een representatie van een
	bestand en is de focus van bestandsactiviteit.  Dit betekent
	dat &man.vnconfig.8; bestanden gebruikt om een bestandssysteem
	aan te maken en te bewerken.  Een mogelijk gebruik is het
	mounten van een beeld van een diskette of een CD dat in een
	bestand bewaard wordt.</para>

      <para>Om &man.vnconfig.8; te gebruiken, is ondersteuning voor
	&man.vn.4; nodig in het kernelinstellingenbestand:</para>

      <programlisting>pseudo-device vn</programlisting>

      <para>Om een bestaand beeld van een bestandssysteem te
	mounten:</para>

      <example>
	<title><command>vnconfig</command> gebruiken om een bestaand
	  beeld van een bestandssysteem te mounten onder
	  &os;&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>vnconfig vn<replaceable>0</replaceable> <replaceable>schijfbeeld</replaceable></userinput>
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Om een nieuw beeld van een bestandssysteem aan te maken met
	&man.vnconfig.8;:</para>

      <example>
	<title>Een nieuwe bestandsgebaseerde schijf aanmaken met
	  <command>vnconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nieuwbeeld</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>vnconfig -s labels -c vn<replaceable>0</replaceable> <replaceable>nieuwbeeld</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w vn<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs vn<replaceable>0</replaceable>c</userinput>
Warning: 2048 sector(s) in last cylinder unallocated
/dev/vn0c:     10240 sectors in 3 cylinders of 1 tracks, 4096 sectors
        5.0MB in 1 cyl groups (16 c/g, 32.00MB/g, 1280 i/g)
super-block backups (for fsck -b #) at:
 32
&prompt.root; <userinput>mount /dev/vn<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/vn0c        4927        1     4532     0%    /mnt</screen>
      </example>
    </sect2>

    <sect2 id="disks-mdconfig">
      <title>Bestandsgebaseerd bestandssysteem onder
	&os;&nbsp;5.X</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>bestandsgebaseerd (5.X)</secondary>
      </indexterm>

      <para>Met &man.mdconfig.8; kunnen geheugenschijven, &man.md.4;,
	ingesteld worden en aangezet worden onder &os;&nbsp;5.X.  Om
	&man.mdconfig.8; te gebruiken, moet de module &man.md.4;
	geladen worden of ondersteuning aan het
	kernelinstellingenbestand toegevoegd worden:</para>

      <programlisting>device md</programlisting>

      <para>Het commando &man.mdconfig.8; ondersteunt drie types
	geheugen-gebaseerde virtuele schijven: geheugenschijven die met
	&man.malloc.9; toegewezen zijn, geheugenschijven die een
	bestand als basis gebruiken en geheugenschijven die swapruimte
	als basis gebruiken.  Een mogelijk gebruik is het mounten van
	een beeld van een diskette of CD dat in een bestand bewaard
	wordt.</para>

      <para>Om een bestaand beeld van een bestandssysteem te
	mounten:</para>

      <example>
	<title><command>mdconfig</command> gebruiken om een bestaand
	  beeld van een bestandssysteem te mounten onder
	  &os;&nbsp;5.X</title>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>schijfbeeld</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput></screen>
      </example>

      <para>Om een nieuw beeld van een bestandssysteem aan te maken met
	&man.mdconfig.8;:</para>

      <example>
	<title>Nieuwe bestandsgebaseerde schijf aanmaken met
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nieuwbeeld</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdconfig -a -t vnode -f <replaceable>nieuwbeeld</replaceable> -u <replaceable>0</replaceable></userinput>
&prompt.root; <userinput>disklabel -r -w md<replaceable>0</replaceable> auto</userinput>
&prompt.root; <userinput>newfs md<replaceable>0</replaceable>c</userinput>
/dev/md0c: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>0</replaceable>c <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4846        2     4458     0%    /mnt</screen>
      </example>

      <para>Indien het eenheidsnummer niet met de optie
	<option>-u</option> gespecificeerd wordt, gebruikt
	&man.mdconfig.8; de automatische toewijzing van &man.md.4; om
	een ongebruikt apparaat te selecteren.  De naam van het
	toegewezen apparaat wordt op stdout weergegeven als
	<devicename>md4</devicename>.  Meer details staan in de
	hulppagina van &man.mdconfig.8;.</para>

      <note>
	<para>Sinds &os;&nbsp;5.1-RELEASE is het oude programma
	  &man.disklabel.8; vervangen door &man.bsdlabel.8;.  In
	  &man.bsdlabel.8; zijn een aantal overbodige opties en
	  parameters verwijderd.  In de bovenstaande voorbeelden
	  dient de optie <option>-r</option> met &man.bsdlabel.8;
	  weggelaten te worden.  Meer informatie staat in de
	  hulppagina van &man.bsdlabel.8;.</para>
      </note>

      <para>Het commando &man.mdconfig.8; is erg nuttig, hoewel het
	veel opdrachten vergt om een bestandsgebaseerd bestandssysteem
	aan te maken.  &os;&nbsp;5.0 wordt met een gereedschap
	&man.mdmfs.8; geleverd.  Dit programma stelt een
	&man.md.4;-schijf in door gebruik te maken van
	&man.mdconfig.8;, zet er een bestandssysteem op door gebruik te
	maken van &man.newfs.8; en mount het door gebruik te maken van
	&man.mount.8;.  Om hetzelfde bestandssysteembeeld als hierboven
	aan te maken en te mounten:</para>

      <example>
	<title>Instellen en mounten van een bestandsgebaseerde schijf
	  met <command>mdmfs</command></title>

	<screen>&prompt.root; <userinput>dd if=/dev/zero of=<replaceable>nieuwbeeld</replaceable> bs=1k count=<replaceable>5</replaceable>k</userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mdmfs -F <replaceable>nieuwbeeld</replaceable> -s <replaceable>5</replaceable>m md<replaceable>0</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>Als de optie <option>md</option> zonder eenheidsnummer
	gebruikt wordt, gebruikt &man.mdmfs.8; de automatische
	toewijzing van &man.md.4; om automatisch een ongebruikt
	apparaat te selecteren.  Meer details staan in de hulppagina
	van &man.mdmfs.8;.</para>
    </sect2>

    <sect2 id="disks-md-freebsd4">
      <title>Geheugengebaseerde bestandssystemen onder
	&os;&nbsp;4.X</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>geheugenbestandssysteem (4.X)</secondary>
      </indexterm>

      <para>Het stuurprogramma &man.md.4; is een eenvoudig,
	effici&euml;nt middel om geheugenbestandssystemen aan te maken
	onder &os;&nbsp;4.X.  &man.malloc.9; wordt gebruikt om het
	geheugen toe te wijzen.</para>

      <para>Om het te gebruiken, dient met een bestandssysteem dat met
	&man.vnconfig.8; voorbereid is het volgende gedaan te
	worden:</para>

      <example>
	<title>md geheugenschijf onder &os;&nbsp;4.X</title>

	<screen>&prompt.root; <userinput>dd if=<replaceable>nieuwbeeld</replaceable> of=/dev/md<replaceable>0</replaceable></userinput>
5120+0 records in
5120+0 records out
&prompt.root; <userinput>mount /dev/md<replaceable>0c</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4927        1     4532     0%    /mnt</screen>
      </example>

      <para>Meer details staan in de hulppagina van &man.md.4;.</para>
    </sect2>

    <sect2 id="disks-md-freebsd5">
      <title>Geheugengebaseerd bestandssysteem onder &os;&nbsp;5.X
      </title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>geheugenbestandssysteem (5.X)</secondary>
      </indexterm>

      <para>Voor geheugengebaseerde en bestandsgebaseerde
	bestandssystemen worden dezelfde gereedschappen gebruikt:
	&man.mdconfig.8; of &man.mdmfs.8;.  De opslagruimte voor
	geheugengebaseerde bestandssystemen wordt met &man.malloc.9;
	toegewezen.</para>

      <example>
	<title>Nieuwe geheugengebaseerde schijf aanmaken met
	  <command>mdconfig</command></title>

	<screen>&prompt.root; <userinput>mdconfig -a -t malloc -s <replaceable>5</replaceable>m -u <replaceable>1</replaceable></userinput>
&prompt.root; <userinput>newfs -U md<replaceable>1</replaceable></userinput>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
	using 4 cylinder groups of 1.27MB, 81 blks, 256 inodes.
	with soft updates
super-block backups (for fsck -b #) at:
 32, 2624, 5216, 7808
&prompt.root; <userinput>mount /dev/md<replaceable>1</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4846    2  4458     0%    /mnt</screen>
      </example>

      <example>
	<title>Nieuwe geheugengebaseerde schijf aanmaken met
	  <command>mdmfs</command></title>

	<screen>&prompt.root; <userinput>mdmfs -M -s <replaceable>5</replaceable>m md<replaceable>2</replaceable> <replaceable>/mnt</replaceable></userinput>
&prompt.root; <userinput>df <replaceable>/mnt</replaceable></userinput>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</screen>
      </example>

      <para>In plaats van een bestandssysteem dat gebaseerd is op
	&man.malloc.9;, is het ook mogelijk om swap te gebruiken.
	Hiervoor dient <option>malloc</option> in de opdrachtregel van
	&man.mdconfig.8; door <option>swap</option> vervangen te
	worden.  &man.mdmfs.8; maakt standaard (zonder
	<option>-M</option> een swap-gebaseerde schijf aan.  Meer
	details staan in de hulppagina's voor &man.mdconfig.8; en
	&man.mdmfs.8;.</para>
    </sect2>

    <sect2>
      <title>Geheugenschijf van het systeem afkoppelen</title>

      <indexterm>
	<primary>schijven</primary>

	<secondary>geheugenschijf afkoppelen</secondary>
      </indexterm>

      <para>Als een geheugen- of bestandsgebaseerd bestandssysteem
	niet gebruikt wordt, dienen alle bronnen aan het systeem
	vrijgegeven te worden.  Dismount als eerste het
	bestandssysteem, gebruikt daarna &man.mdconfig.8; om de schijf
	van een systeem los te koppelen en de bronnen vrij te
	geven.</para>

      <para>Om bijvoorbeeld alle bronnen die door
	<filename>/dev/md4</filename> gebruikt worden los te koppelen
	en vrij te geven:</para>

      <screen>&prompt.root; <userinput>mdconfig -d -u <replaceable>4
	</replaceable></userinput></screen>

      <para>Het is mogelijk om de informatie over ingestelde &man.md.4;
	apparaten weer te geven door gebruik te maken van
	<command>mdconfig -l</command>.</para>

      <para>Met &os;&nbsp;4.X wordt &man.vnconfig.8; gebruikt om het
	apparaat los te koppelen.  Om bijvoorbeeld alle bronnen die
	door <filename>/dev/vn4</filename> gebruikt worden los te
	koppelen en vrij te geven:</para>

      <screen>&prompt.root; <userinput>vnconfig -u vn<replaceable>4</replaceable></userinput></screen>
    </sect2>
  </sect1>

  <sect1 id="snapshots">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Bijgedragen door </contrib>
	</author>
      </authorgroup>
      <!-- 15 juli 2002 -->
    </sect1info>

    <title>Snapshots van bestandssystemen</title>

    <indexterm>
      <primary>bestandssystemen</primary>

      <secondary>snapshots</secondary>
    </indexterm>

    <para>&os;&nbsp;5.0 biedt een nieuwe mogelijkheid samen met <link
	linkend="soft-updates">Soft Updates</link>: snapshots van
      bestandssystemen.</para>

    <para>Snapshots bieden de mogelijkheid om beelden van een
      gespecificeerd bestandssysteem te maken en ze als bestand te
      behandelen.  Snapshotbestanden moeten aangemaakt worden in het
      bestandssysteem waarop de handeling wordt uitgevoerd en er mogen
      niet meer dan 20 snapshots per bestandssysteem worden aangemaakt.
      Actieve snapshots worden opgeslagen in het superblok zodat ze
      persistent zijn met dismount- en hermountbewerkingen en met het
      opnieuw opstarten van het systeem.  Als een snapshot niet langer
      nodig is, kan het met het standaardcommando &man.rm.1; worden
      verwijderd.  Snapshots kunnen in elke volgorde verwijderd
      worden, alhoewel misschien niet alle gebruikte ruimte
      teruggewonnen wordt omdat sommige vrijgegeven blokken mogelijk
      door een ander snapshot geclaimd worden.</para>

    <para>De onveranderlijke bestandsvlag <option>snapshot</option>
      wordt door &man.mksnap.ffs.8; ingesteld nadat het snapshotbestand
      initieel is aangemaakt.  Het commando &man.unlink.1; maakt een
      uitzondering voor snapshotbestanden aangezien het toestaat dat ze
      verwijderd worden.</para>

    <para>Snapshotbestanden worden aangemaakt met &man.mount.8;.  Om
      een snapshot van <filename>/var</filename> in het bestand
      <filename>/var/snapshot/snap</filename> te plaatsen:</para>

    <screen>&prompt.root; <userinput>mount -o -o snapshot /var/snapshot/snap /var</userinput></screen>

    <para>Als alternatief kan &man.mksnap.ffs.8; gebruikt worden om een
      snapshot aan te maken:</para>

    <screen>&prompt.root; <userinput>mksnap_ffs /var /var/snapshot/snap</userinput></screen>

    <para>Snapshotbestanden kunnen gezocht worden op een
      bestandssysteem (bijvoorbeeld <filename>/var</filename>) door
      gebruik te maken van het commando &man.find.1;:</para>

    <screen>&prompt.root; <userinput>find /var -flags snapshot</userinput></screen>

    <para>Nadat een snapshot is aangemaakt, kan het voor een aantal
      dingen gebruikt worden:</para>

    <itemizedlist>
      <listitem>
	<para>Sommige systeembeheerders gebruiken een snapshotbestand
	  voor back-updoeleinden, omdat het snapshot naar CD's of band
	  overgezet kan worden;</para>
      </listitem>

      <listitem>
	<para>Bestandsintegriteit.  op het snapshot kan &man.fsck.8;
	  gedraaid worden.  Ervan uitgaande dat het bestandssysteem
	  schoon was toen het werd gemount, zou dit altijd een schoon
	  (en onveranderlijk) resultaat moeten opleveren.  Dit is in
	  principe wat het &man.fsck.8;-achtergrondsproces doet;</para>
      </listitem>

      <listitem>
	<para>Het commando &man.dump.8; draaien op het snapshot.  Er
	  wordt een dump teruggegeven die consistent is met het
	  bestandssysteem en tijdsstempel van het snapshot.
	  &man.dump.8; kan ook in &eacute;&eacute;n commando een
	  snapshot maken, een dumpbeeld aanmaken en daarna het snapshot
	  verwijderen door gebruik te maken van de vlag
	  <option>-L</option>;</para>
      </listitem>

      <listitem>
	<para>Het snapshot kan met &man.mount.8; als bevroren beeld van
	  het bestandssysteem worden gemount.  Om het snapshot
	  <filename>/var/snapshot/snap</filename> te mounten:</para>

	<screen>&prompt.root; <userinput>mdconfig -a -t vnode -f /var/snapshot/snap -u 4</userinput>
&prompt.root; <userinput>mount -r /dev/md4 /mnt</userinput></screen>
      </listitem>
    </itemizedlist>

    <para>Het is nu mogelijk om door de structuur van het bevroren
      bestandssysteem <filename>/var</filename> te lopen dat gemount is
      op <filename>/mnt</filename>.  Alles zal initieel in dezelfde
      toestand verkeren als op het moment dat het snapshot werd
      aangemaakt.  De enige uitzondering hierop is dat eerdere
      snapshots als bestanden met lengte nul verschijnen.  Als een
      snapshot niet meer nodig is, kan het als volgt gedismount
      worden:</para>

    <screen>&prompt.root; <userinput>umount /mnt</userinput>
&prompt.root; <userinput>mdconfig -d -u 4</userinput></screen>

    <para>Meer informatie over <option>softupdates</option> en
      snapshots van bestandssystemen, inclusief technische documenten,
      staat op de website van Marshall Kirk McKusick op <ulink
	url="http://www.mckusick.com/"></ulink>.</para>
  </sect1>

  <sect1 id="quotas">
    <title>Bestandssysteemquota</title>

    <indexterm>
      <primary>accounten</primary>

      <secondary>schijfruimte</secondary>
    </indexterm>

    <indexterm><primary>schijfquota</primary></indexterm>

    <para>Quota zijn een optionele mogelijkheid van het
      besturingssysteem om de hoeveelheid schijfruimte en/of het aantal
      bestanden dat gebruikers of leden van een groep per
      bestandssysteem mogen gebruiken te beperken.  Dit wordt het
      meeste gebruikt op timesharing-systemen waar het wenselijk is om
      het aantal bronnen dat elke gebruiker of groep van gebruikers mag
      gebruiken te beperken.  Dit voorkomt dat &eacute;&eacute;n
      gebruiker of groep van gebruikers alle beschikbare schijfruimte
      in beslag neemt.</para>

    <sect2>
      <title>Schijfquota inschakelen</title>

      <para>Controleer alvorens te proberen om schijfquota te
	gebruiken of quota ingesteld zijn in de kernel.  Dit gebeurt
	door het toevoegen van de volgende regel aan het
	kernelinstellingenbestand:</para>

      <programlisting>options QUOTA</programlisting>

      <para>De standaardkernel <filename>GENERIC</filename> heeft deze
	optie niet aanstaan, dus is het nodig om een eigen kernel in te
	stellen, te bouwen en te installeren om gebruik te kunnen maken
	van schijfquota.  Meer informatie over het instellen van de
	kernel staat in <xref linkend="kernelconfig">.</para>

      <para>Vervolgens dienen schijfquota aangezet te worden in
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>enable_quotas="YES"</programlisting>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>controleren</secondary>
      </indexterm>

      <para>Voor fijnere controle over de opstartquota zijn extra
	instellingsvariabelen beschikbaar.  Normaalgesproken wordt de
	integriteit van de quota van elk bestandssysteem tijdens het
	opstarten door &man.quotacheck.8; gecontroleerd.
	&man.quotacheck.8; verzekert dat de gegevens in de
	quotadatabase een juiste afspiegeling vormen van de gegevens op
	het bestandssysteem.  Dit proces neemt erg veel tijd in beslag
	en be&iuml;nvloedt de tijd die een systeem nodig heeft om op te
	starten significant.  Om deze stap over te slaan, bestaat een
	variabele in <filename>/etc/rc.conf</filename>:</para>

      <programlisting>check_quotas="NO"</programlisting>

      <para>Als laatste dient <filename>/etc/fstab</filename> bewerkt
	te worden om schijfquota per bestandssysteem aan te zetten.
	Hier kunnen gebruiker- of groepquota of beide worden aangezet
	voor alle bestandssystemen.</para>

      <para>Om quota per gebruiker op een bestandssysteem aan te
	zetten, dient de optie <option>userquota</option> aan het
	optieveld toegevoegd te worden aan de regel in
	<filename>/etc/fstab</filename> voor het bestandssysteem waar
	quota worden aangezet.  Bijvoorbeeld:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota 1 2</programlisting>

      <para>Analoog, om groepquota aan te zetten, dient de optie
	<option>groupquota</option> in plaats van
	<option>userquota</option> gebruikt te worden.  Om zowel
	gebruikers- als groepsquota aan te zetten, dient de regel als
	volgt veranderd te worden:</para>

      <programlisting>/dev/da1s2g   /home    ufs rw,userquota,groupquota 1 2</programlisting>

      <para>Standaard worden de quotabestanden opgeslagen in de
	hoofdmap van het bestandssysteem onder de namen
	<filename>quota.user</filename> en
	<filename>quota.group</filename> voor respectievelijk
	gebruikers- en groepsquota.  Meer informatie staat in
	&man.fstab.5;.  Alhoewel de hulppagina &man.fstab.5; vermeld
	dat een alternatieve plaats voor de quotabestanden
	gespecificeerd kan worden, wordt dit niet aangeraden omdat de
	verschillende quotagereedschappen dit niet juist schijnen af te
	handelen.</para>

      <para>Hier aangekomen dient het systeem opnieuw opgestart te
	worden met de nieuwe kernel.  <filename>/etc/rc</filename>
	voert automatisch de juiste commando's uit om de initi&euml;le
	quotabestanden aan te maken voor alle quota die in
	<filename>/etc/fstab</filename> zijn aangezet.  Het is dus niet
	nodig om handmatig quotabestanden met lengte nul aan te
	maken.</para>

      <para>Tijdens normale bewerkingen moet het niet nodig zijn om de
	commando's &man.quotacheck.8;, &man.quotaon.8; of
	&man.quotaoff.8; handmatig te draaien.  Lees wel de betreffende
	hulppagina's om bekend te raken met de werking ervan.</para>
    </sect2>

    <sect2>
      <title>Quotalimieten instellen</title>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>limieten</secondary>
      </indexterm>

      <para>Indien het systeem ingesteld voor gebruik van quota,
	controleer dan of ze echt aanstaan.  Een eenvoudige
	manier om dit te doen is de volgende:</para>

      <screen>&prompt.root; <userinput>quota -v</userinput></screen>

      <para>Er hoort een eenregelige samenvatting te verschijnen over
	het schijfgebruik en de huidige quotalimieten voor elk
	bestandssysteem waarop quota aanstaan.</para>

      <para>Nu kunnen quotalimieten toegewezen worden met
	&man.edquota.8;.</para>

      <para>Er zijn verschillende opties om grenzen te stellen aan de
	hoeveelheid schijfruimte die een gebruiker of groep mag
	toewijzen en het aantal bestanden dat ze mogen aanmaken.
	Toewijzingen kunnen begrensd worden met betrekking tot
	schijfruimte (blokquota) of het aantal bestanden (inode-quota)
	of een combinatie van beide.  Elk van deze limieten is op zijn
	beurt weer opgesplitst in twee categori&euml;n: harde en zachte
	limieten.</para>

      <indexterm><primary>harde limiet</primary></indexterm>

      <para>Een harde limiet mag niet overschreden worden.  Indien een
	gebruiker de harde limiet bereikt, mag deze geen verdere
	toewijzingen maken op het betreffende bestandssysteem.  Indien
	een gebruiker bijvoorbeeld een harde limiet heeft van 500 kB
	op een bestandssysteem en er 490&nbsp;kB van gebruikt, kan deze
	nog slechts 10&nbsp;kB toewijzen.  Een poging om 11&nbsp;kB toe
	te wijzen zal mislukken.</para>

      <indexterm><primary>zachte limiet</primary></indexterm>

      <para>Zachte limieten kunnen voor een beperkte tijd overschreden
	worden.  Deze periode staat bekend als de gratieperiode, die
	standaard een week bedraagt.  Als een gebruiker de zachte
	limiet langer dan de gratieperiode overschrijdt, verandert de
	zachte limiet in een harde limiet en zijn er geen verdere
	toewijzingen toegestaan.  Als de gebruiker onder de zachte
	limiet komt, wordt de gratieperiode opnieuw ingesteld.</para>

      <para>Het volgende is een voorbeeld van een mogelijk gebruik van
	&man.edquota.8;.  Als het commando &man.edquota.8; gestart
	wordt, wordt de tekstverwerker opgestart die door de
	omgevingsvariabele <envar>EDITOR</envar> gespecificeerd is, of
	de tekstverwerker <application>vi</application> als de
	variabele <envar>EDITOR</envar> niet is ingesteld.  Nu kunnen
	de quotalimieten bewerkt worden.</para>

      <screen>&prompt.root; <userinput>edquota -u test</userinput></screen>

      <programlisting>Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</programlisting>

      <para>Normaalgesproken worden er twee regels weergegeven voor elk
	bestandssysteem waarvoor quota gelden: &eacute;&eacute;n regel
	voor de bloklimieten, en &eacute;&eacute;n voor de
	inode-limieten.  Om de quotalimieten te veranderen dient de
	waarde ervan veranderd te worden.  Om bijvoorbeeld de
	bloklimiet van een gebruiker te veranderen van een zachte
	limiet van 50 en een harde limiet van 75 in een zachte limiet
	van 500 en een harde limiet van 600, dient het volgende
	veranderd te worden:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</programlisting>

      <para>In:</para>

      <programlisting>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</programlisting>

      <para>De nieuwe quotalimieten gelden zodra de tekstverwerker
	verlaten wordt.</para>

      <para>Soms is het gewenst om quotalimieten in te stellen op een
	aantal UID's.  Dit kan gedaan worden door de optie
	<option>-p</option> van &man.edquota.8; te gebruiken.  Wijs
	eerst de gewenste quotalimiet aan een gebruiker toe en draai
	daarna <command>edquota -p protogebruiker
	  beginuid-einduid</command>.  Indien bijvoorbeeld gebruiker
	<username>test</username> de gewenste quotalimieten heeft, kan
	het volgende commando gebruikt worden om deze quotalimieten te
	dupliceren voor UID's 10.000 tot en met 19.999:</para>

      <screen>&prompt.root; <userinput>edquota -p test 10000-19999</userinput></screen>

      <para>Meer informatie staat in de hulppagina voor
	&man.edquota.8;.</para>
    </sect2>

    <sect2>
      <title>Quotalimieten en schijfgebruik controleren</title>

      <indexterm>
	<primary>schijfquota</primary>

	<secondary>controleren</secondary>
      </indexterm>

      <para>Zowel &man.quota.1; als &man.repquota.8; kunnen gebruikt
	worden om de quotalimieten en het schijfgebruik te controleren.
	Het commando &man.quota.1; kan gebruikt worden om de quota van
	zowel individuele gebruikers als groepen en het schijfgebruik
	te controleren.  Een gebruiker mag alleen de eigen quota en de
	quota van een groep waarvan deze lid is controleren.  Alleen de
	beheerder mag alle gebruikers- en groepsquota bekijken.  Het
	commando &man.repquota.8; kan gebruikt worden om een overzicht
	te krijgen van alle quota en gebruik van bestandssystemen
	waarvan quota aanstaan.</para>

      <para>Het volgende is een mogelijke uitvoer van het commando
	<command>quota -v</command> voor een gebruiker die
	quotalimieten heeft op twee bestandssystemen.</para>

      <programlisting>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</programlisting>

      <indexterm><primary>gratieperiode</primary></indexterm>

      <para>Voor het bestandssysteem <filename>/usr</filename> in
	bovenstaand voorbeeld overschrijdt deze gebruiker de zachte
	limiet van 50&nbsp;kB momenteel met 15&nbsp;kB en heeft deze 5
	dagen van de gratieperiode over.  De asterisk,
	<literal>*</literal> geeft aan dat de gebruiker momenteel de
	quotalimiet overschrijdt.</para>

      <para>Normaalgesproken worden bestandssystemen waarvan de
	gebruiker geen schijfruimte gebruikt niet weergegeven in de
	uitvoer van &man.quota.1;, zelfs niet als er de gebruiker een
	quotalimiet heeft voor dat bestandssysteem.  De optie
	<option>-v</option> geeft deze bestandssystemen weer, zoals het
	bestandssysteem <filename>/usr/var</filename> in bovenstaand
	voorbeeld.</para>
    </sect2>

    <sect2>
      <title>Quota over NFS</title>

      <indexterm><primary>NFS</primary></indexterm>

      <para>Quota worden afgedwongen door het quota-subsysteem op de
	NFS-server.  De daemon &man.rpc.rquotad.8; stelt
	quota-informatie beschikbaar aan het commando &man.quota.1; op
	de NFS-cli&euml;nts, wat de gebruikers op deze machines in
	staat stelt hun quota-statistieken in te zien.</para>

      <para><command>rpc.rquotad</command> dient als volgt in
	<filename>/etc/inetd.conf</filename> aangezet te worden:</para>

      <programlisting>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</programlisting>

      <para>Vervolgens dient <command>inetd</command> opnieuw gestart
	te worden:</para>

      <screen>&prompt.root; <userinput>kill -HUP `cat /var/run/inetd.pid`</userinput></screen>
    </sect2>
  </sect1>

  <sect1 id="disks-encrypting">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Lucky</firstname>
	  <surname>Green</surname>
	  <contrib>Bijgedragen door </contrib>
	  <affiliation>
	    <address>
	      <email>shamrock@cypherpunks.to</email>
	    </address>
	  </affiliation>
	</author>
      </authorgroup>
      <!-- 11 maart 2003 -->
    </sect1info>

    <title>Schijfpartities versleutelen</title>

    <indexterm>
      <primary>schijven</primary>

      <secondary>versleutelen</secondary>
    </indexterm>

    <para>&os; biedt uitstekende on-line bescherming tegen onbevoegde
      gegevenstoegang.  Bestandsrechten en Mandatory Access Control
      (MAC) (zie <xref linkend="mac">) helpen voorkomen dat onbevoegde
      derde partijen toegang tot de gegevens krijgen als het
      besturingssysteem actief is en de computer aanstaat.  De door het
      besturingssysteem afgedwongen rechten zijn echter niet relevant
      als een aanvaller fysieke toegang tot een computer heeft en deze
      de harde schijf van de computer in een ander systeem kan plaatsen
      om de gevoelige gegevens te kopi&euml;ren en te
      analyseren.</para>

    <para>Afgezien van hoe een aanvaller in het bezit van een harde
      schijf of een uitgezette computer gekomen is, kan
      <application>GEOM Based Disk Encryption (gbde)</application> de
      gegevens op het bestandssysteem van de computer zelfs tegen
      hooggemotiveerde aanvallers met aanzienlijke middelen beschermen.
      In tegenstelling tot lastige versleutelmethoden die alleen losse
      bestanden versleutelen, versleutelt
      <application>gbde</application> gehele bestandssystemen op een
      transparante manier.  De harde schijf komt nooit in aanraking met
      klare tekst.</para>

    <sect2>
      <title>gbde in de kernel aanzetten</title>

      <procedure>
	<step>
	  <title>Word <username>root</username></title>

	  <para>Het instellen van <application>gbde</application>
	    vereist beheerdersrechten.</para>

	  <screen>&prompt.user; <userinput>su -</userinput>
Password:</screen>
	</step>

	<step>
	  <title>Controleer de versie van het besturingssysteem</title>

	  <para>Voor &man.gbde.4; is &os;&nbsp;5.0 of hoger
	    nodig.</para>

	  <screen>&prompt.root; <userinput>uname -r</userinput>
5.0-RELEASE</screen>
	</step>

	<step>
	  <title>Voeg ondersteuning voor &man.gbde.4; aan het
	    kernelinstellingenbestand toe</title>

	  <para>Voeg de volgende regel aan het
	    kernelinstellingenbestand toe:</para>

	  <para><literal>options GEOM_BDE</literal></para>

	  <para>Compileer en installeer de &os; kernel opnieuw.  Dit
	    proces wordt beschreven in <xref
	      linkend="kernelconfig">.</para>

	  <para>Start op met de nieuwe kernel.</para>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Versleutelde harde schijf voorbereiden</title>

      <para>In het volgende voorbeeld wordt aangenomen dat er een
	nieuwe harde schijf aan het systeem wordt toegevoegd die een
	enkele versleutelde partitie zal bevatten.  Deze partitie wordt
	gemount als <filename>/private</filename>.
	<application>gbde</application> kan ook gebruikt worden om
	<filename>/home</filename> en <filename>/var/mail</filename> te
	versleutelen, maar daarvoor zijn complexere instructies nodig
	die buiten het bereik van deze inleiding vallen.</para>

      <procedure>
	<step>
	  <title>Voeg een nieuwe harde schijf toe</title>

	  <para>Voeg de nieuwe harde schijf toe zoals beschreven in
	    <xref linkend="disks-adding">.  In dit voorbeeld is een
	    nieuwe harde schijfpartitie toegevoegd als
	    <filename>/dev/ad4s1c</filename>.  De apparaten
	    <filename>/dev/ad0s1<replaceable>*</replaceable></filename>
	    stellen bestaande standaard &os; partities van het
	    voorbeeldsysteem voor.</para>

	  <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</screen>
	</step>

	<step>
	  <title>Maak een map aan voor gbde lockbestanden</title>

	  <screen>&prompt.root; <userinput>mkdir /etc/gbde</userinput></screen>

	  <para>Het lockbestand voor <application>gbde</application>
	    bevat informatie die <application>gbde</application> nodig
	    heeft om toegang te krijgen tot versleutelde partities.
	    Zonder toegang tot de lockbestand is
	    <application>gbde</application> niet in staat om de
	    gegevens die op de versleutelde partitie staan te
	    ontsleutelen zonder aanzienlijke handmatige tussenkomst die
	    niet door de software ondersteund wordt.  Elke versleutelde
	    partitie gebruikt een ander lockbestand.</para>
	</step>

	<step>
	  <title>Initialiseer de gbde-partitie</title>

	  <para>Een <application>gbde</application>-partitie dient
	    ge&iuml;nitialiseerd te worden voordat deze kan worden
	    gebruikt.  Deze initialisatie dient slechts eenmalig
	    uitgevoerd te worden:</para>

	  <screen>&prompt.root; <userinput>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c</userinput></screen>

	  <para>&man.gbde.8; opent een tekstverwerker om verschillende
	    instellingen in een sjabloon te kunnen instellen.  Stel de
	    sector_size in op 2048 als UFS of UFS2 wordt
	    gebruikt:</para>

	  <programlisting>$<!-- This is not the space you are looking
for-->FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size     =       2048
[...]
</programlisting>

	  <para>&man.gbde.8; vraagt twee keer om de wachtwoordzin voor
	    het beveiligen van de gegevens.  De wachtwoordzin dient
	    beide keren hetzelfde te zijn.  De mogelijkheid van
	    <application>gbde</application> om de gegevens te
	    beveiligen is geheel afhankelijk de gekozen wachtwoordzin.
	    <footnote>
	      <para>Tips met betrekking tot het kiezen van veilige
		wachtwoordzinnen die gemakkelijk te onthouden zijn
		staan op de website <ulink
		  url="http://world.std.com/~reinhold/diceware.html">Diceware
		  Passphrase</ulink>.</para>
	    </footnote>
	  </para>

	  <para>Het commando <command>gbde init</command> maakt een
	    lockbestand aan voor de
	    <application>gbde</application>-partitie die in dit
	    voorbeeld is opgeslagen als
	    <filename>/etc/gbde/ad4s1c</filename>.</para>

	  <caution>
	    <para><application>gbde</application> lockbestanden
	      <emphasis>moeten</emphasis> samen met de inhoud van
	      versleutelde partities geback-upped worden.  Hoewel het
	      verwijderen van een lockbestand op zich een gedreven
	      aanvaller er niet van weerhoudt een
	      <application>gbde</application> partitie te ontsleutelen,
	      is de wettige eigenaar zonder het lockbestand niet in
	      staat om de gegevens op de versleutelde partitie te
	      benaderen zonder een aanzienlijke hoeveelheid werk die in
	      het geheel niet ondersteund wordt door &man.gbde.8; of de
	      ontwerper ervan.</para>
	  </caution>
	</step>

	<step>
	  <title>Koppel de versleutelde partitie aan de kernel</title>

	  <screen>&prompt.root <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

	  <para>Er wordt om de wachtwoordzin gevraagd die gekozen is
	    tijdens de initialisatie van de versleutelde partitie.  Het
	    nieuwe versleutelde apparaat verschijnt in
	    <filename>/dev</filename> als
	    <filename>/dev/apparaatnaam.bde</filename>:</para>

          <screen>&prompt.root; <userinput>ls /dev/ad*</userinput>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</screen>
	</step>

	<step>
	  <title>Maak een bestandssysteem op het versleutelde
	    apparaat</title>

	  <para>Nu het versleutelde apparaat aan de kernel gekoppeld
	    is, kan een bestandssysteem op het apparaat aangemaakt
	    worden.  Met &man.newfs.8; kan een bestandssysteem op het
	    versleutelde apparaat aangemaakt wordne.  Aangezien het
	    veel sneller is om een nieuw UFS2 bestandssysteem te
	    initialiseren dan om een oud UFS1 bestandssysteem te
	    initialiseren, is het aan te raden om &man.newfs.8; met de
	    optie <option>-O2</option> te gebruiken.</para>

	  <note>
	    <para>De optie <option>-O2</option> is de standaard in
	      &os;&nbsp;5.1-RELEASE en nieuwer.</para>
	  </note>

	  <screen>&prompt.root; <userinput>newfs -U -O2 /dev/ad4s1c.bde</userinput></screen>

	  <note>
	    <para>Voer &man.newfs.8; uit op een aangekoppelde
	    <application>gbde</application>-partitie die
	    ge&iuml;ndificeerd wordt door de uitbreiding
	    <filename><replaceable>*</replaceable>.bde</filename> op
	    de apparaatnaam.</para>
	  </note>
	</step>

	<step>
	  <title>Mount de versleutelde partitie</title>

	  <para>Maak een mountpunt voor het versleutelde
	    bestandssysteem aan:</para>

	  <screen>&prompt.root; <userinput>mkdir /private</userinput></screen>

	  <para>Mount het versleutelde bestandssysteem:</para>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>
	</step>

	<step>
	  <title>Controleer of het versleutelde bestandssysteem
	    beschikbaar is</title>

	  <para>Het versleutelde bestandssysteem is nu zichtbaar
	    met &man.df.1; en gebruiksklaar:</para>

	  <screen>&prompt.user; <userinput>df -H</userinput>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</screen>
	</step>
      </procedure>
    </sect2>

    <sect2>
      <title>Bestaande versleutelde bestandssystemen mounten</title>

      <para>Elke keer nadat het systeem is opgestart dient elk
	versleuteld bestandssysteem opnieuw aan de kernel gekoppeld te
	worden, op fouten gecontroleerd te worden, en aangekoppeld te
	worden voordat de bestandssystemen gebruikt kunnen worden.  De
	benodigde commando's dienen als de gebruiker
	<username>root</username> uitgevoerd te worden.</para>

      <procedure>
	<step>
	  <title>Koppel de gbde-partitie aan de kernel</title>

	  <screen>&prompt.root <userinput>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</userinput></screen>

	  <para>Er wordt om de wachtwoordzin gevraagd die gekozen is
	    tijdens de initialisatie van de versleutelde
	    gbde-partitie.</para>
	</step>

	<step>
	  <title>Controleer het bestandssysteem op fouten</title>

	  <para>Aangezien het nog niet mogelijk is om versleutelde
	    bestandssystemen op te nemen in
	    <filename>/etc/fstab</filename> voor automatische controle,
	    dienen de bestandssystemen voordat ze gemount worden
	    handmatig op fouten gecontroleerd te worden door
	    &man.fsck.8; uit te voeren:</para>

	  <screen>&prompt.root; <userinput>fsck -p -t ffs /dev/ad4s1c.bde</userinput></screen>
	</step>

	<step>
	  <title>Mount het versleutelde bestandssysteem</title>

	  <screen>&prompt.root; <userinput>mount /dev/ad4s1c.bde /private</userinput></screen>

	  <para>Het versleutelde bestandssysteem is nu klaar voor
	    gebruik.</para>
	</step>
      </procedure>

      <sect3>
	<title>Versleutelde partities automatisch mounten</title>

	<para>Het is mogelijk om een script aan te maken om automatisch
	  een versleutelde partitie aan te koppelen, op fouten te
	  controleren en te mounten, maar vanwege veiligheidsredenen
	  dient het script niet het wachtwoord voor &man.gbde.8; te
	  bevatten.  In plaats hiervan wordt het aangeraden om zulke
	  scripts handmatig uit te voeren en het wachtwoord via de
	  console of &man.ssh.1; te geven.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Door gbde gebruikte cryptografische beschermingen</title>

      <para>&man.gbde.8; versleutelt de sectorlading door gebruik te
	maken van 128-bit AES in CBC-modus.  Elke sector op de schijf
	wordt met een andere AES-sleutel versleuteld.  Meer informatie
	over het cryptografische ontwerp van
	<application>gbde</application>, inclusief de methode die
	gebruikt wordt om de sectorsleutels van de door de gebruiker
	gegeven wachtwoordzin af te leiden, staan in
	&man.gbde.4;.</para>
    </sect2>

    <sect2>
      <title>Compatibiliteitspunten</title>

      <para>&man.sysinstall.8; is niet compatibel met apparaten die met
	<application>gbde</application> versleuteld zijn.  Alle
	<devicename><replaceable>*</replaceable>.bde</devicename>
	apparaten moeten van de kernel ontkoppeld worden voordat
	&man.sysinstall.8; gebruikt wordt om te voorkomen dat het
	crasht tijdens het initi&euml;le zoeken naar apparaten.  Om het
	versleutelde apparaat dat in dit voorbeeld gebruikt wordt te
	ontkoppelen:</para>

      <screen>&prompt.root; <userinput>gbde detach /dev/ad4s1c</userinput></screen>

      <para><application>gbde</application> kan niet met
	<application>vinum</application> volumes gebruikt worden, omdat
	&man.vinum.4; geen gebruik maakt van het subsysteem
	&man.geom.4;.</para>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
