<!--
     The FreeBSD Documentation Project

     $FreeBSD$

     %SOURCE%	en_US.ISO8859-1/books/handbook/virtualization/chapter.sgml
     %SRCID%	1.17
-->

<chapter id="virtualization">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Murray</firstname>
	<surname>Stokely</surname>
	<contrib>Bijgedragen door </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Ren&eacute;</firstname>
	<surname>Ladan</surname>
	<contrib>Vertaald door </contrib>
      </author>
    </authorgroup>
    <!-- Mar 2007 -->
  </chapterinfo>

  <title>Virtualisatie</title>

  <sect1 id="virtualization-synopsis">
    <title>Overzicht</title>

    <para>Virtualisatiesoftware maakt het mogelijk om meerdere
      besturingssystemen gelijktijdig op dezelfde computer te draaien.
      Zulke softwaresystemen voor PC's gebruiken vaak een
      gastheer-besturingssysteem dat de virtualisatiesoftware draait en
      dat elk aantal gast-besturingssystemen ondersteunt.</para>

    <para>Aan het einde van dit hoofdstuk weet de lezer:</para>

    <itemizedlist>
      <listitem>
	<para>Het verschil tussen een gastheer-besturingssysteem en een
	  gast-besturingssysteem.</para>
      </listitem>

      <listitem>
	<para>Hoe &os; op een &intel;-gebaseerde &apple; &macintosh;
	  computer te installeren.</para>
      </listitem>

      <listitem>
	<para>Hoe &os; op Linux te installeren met
	  <application>&xen;</application>.</para>
      </listitem>

      <listitem>
	<para>Hoe &os; op &microsoft.windows; te installeren met
	  <application>Virtual PC</application>.</para>
      </listitem>

      <listitem>
	<para>Hoe een &os;-systeem in te stellen voor de beste
	  prestaties tijdens virtualisatie.</para>
      </listitem>
    </itemizedlist>

    <para>Voordat het lezen van dit hoofdstuk, dient de lezer:</para>

    <itemizedlist>
      <listitem>
	<para>De beginselen van &unix; en &os; (<xref linkend="basics">)
	  te begrijpen.</para>
      </listitem>

      <listitem>
	<para>Te weten hoe &os; te installeren (<xref
	  linkend="install">).</para>
      </listitem>

      <listitem>
	<para>Te weten hoe een netwerkverbinding te installeren (<xref
	  linkend="advanced-networking">).</para>
      </listitem>

      <listitem>
	<para>Te weten hoe aanvullende software van derde partijen te
	  installeren (<xref linkend="ports">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="virtualization-guest">
    <title>&os; als een gast-besturingssysteem</title>

    <sect2 id="virtualization-guest-parallels">
      <title>Parallels op &macos;</title>

      <para><application>Parallels Desktop</application> voor &macos; is
	een commercieel softwareprodukt voor &intel;-gebaseerde &apple;
	&mac; computers die &macos; 10.4.6 of nieuwer draaien.  &os; is
	een volledig ondersteund gast-besturingssysteem.  Nadat
	<application>Parallels</application> is ge&iuml;nstalleerd op
	&macos; X dient de gebruiker een virtuele machine in te stellen
	en daarna het gewenste gast-besturingssysteem te installeren.
      </para>

      <sect3 id="virtualization-guest-parallels-install">
	<title>&os; installeren op Parallels/&macos; X</title>

	<para>De eerste stap in het installeren van &os; op &macos; X
	  <application>Parallels</application> is het aanmaken van een
	  nieuwe virtuele machine voor het installeren van &os;.
	  Selecteer <guimenuitem>&os;</guimenuitem> als het
	  <guimenuitem>Guest OS Type</guimenuitem> wanneer dit gevraagd
	  wordt:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd1">
	  </imageobject>
	</mediaobject>

	<para>Kies verder een hoeveelheid aan schijf- en geheugenruimte
	  afhankelijk van de plannen voor deze virtuele instantie van
	  &os;.  4GB aan schijfruimte en 512MB aan RAM werken goed voor
	  de meeste gebruikers van &os; onder <application>Parallels
	  </application>:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd2">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd3">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd4">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd5">
	  </imageobject>
	</mediaobject>

	<para>Selecteer het type netwerk en een netwerkinterface:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd6">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd7">
	  </imageobject>
	</mediaobject>

	<para>Bewaar de instellingen en sluit af:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd8">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd9">
	  </imageobject>
	</mediaobject>

	<para>Nadat de virtuele &os;-machine is aangemaakt, dient er
	  &os; op ge&iuml;nstalleerd te worden.  Dit gaat het beste met
	  een offici&euml;le &os; CDROM of met een ISO-beeld dat is
	  gedownload van een offici&euml;le FTP-site.  Wanneer het
	  juiste ISO-beeld op het plaatselijke &mac;-bestandssysteem of
	  een CDROM in de CD-drive van de &mac; aanwezig is, dient op
	  het schijfikoon in de rechteronderhoek van het &os;
	  <application>Parallels</application>-scherm geklikt te worden.
	  Dit zal een scherm tonen dat het mogelijk maakt om de
	  CDROM-drive in de virtuele machine te associ&euml;ren met een
	  ISO-bestand op schijf of met een echte CDROM-drive.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd11">
	  </imageobject>
	</mediaobject>

	<para>Nadat deze associatie met de CDROM-bron is gemaakt, dient
	  de virtuele &os;-machine herstart te worden door op het
	  herstart-icoon te klikken.  <application>Parallels
	  </application> zal herstarten met een speciale BIOS dat eerst
	  controleert of er een CDROM aanwezig is, net zoals een normale
	  BIOS zou doen.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd10">
	  </imageobject>
	</mediaobject>

	<para>In dit geval zal het de installatiemedia van &os; vinden
	  en een normale installatie gebaseerd op
	  <application>sysinstall</application> beginnen zoals
	  beschreven in <xref linkend="install">.  X11 kan nu
	  ge&iuml;nstalleerd, maar nog niet ingesteld, worden.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd12">
	  </imageobject>
	</mediaobject>

	<para>Nadat de installatie is voltooid, kan naar de nieuw
	  ge&iuml;nstalleerde virtuele &os;-machine herstart worden.
	</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/parallels-freebsd13">
	  </imageobject>
	</mediaobject>
      </sect3>

      <sect3 id="virtualization-guest-parallels-configure">
	<title>&os; instellen op &macos; X/Parallels</title>

	<para>Nadat &os; succesvol op &macos; X met
	  <application>Parallels</application> is ge&iuml;nstalleerd,
	  zijn er een aantal instellingen die gewijzigd kunnen worden
	  om het systeem voor virtuele werking te optimaliseren.</para>

	<procedure>
	  <step>
	    <title>De variabelen voor de bootloader instellen</title>

	    <para>De belangrijkste stap is om de tunable <option>kern.hz
	      </option> te verlagen om het CPU-gebruik van &os; onder de
	      <application>Parallels</application>-omgeving te
	      verminderen.  Dit kan bereikt worden door de volgende
	      regel aan <filename>/boot/loader.conf</filename> toe te
	      voegen:</para>

	    <programlisting>kern.hz=100</programlisting>

	    <para>Zonder deze instelling zal een rustend &os;
	      <application>Parallels</application>
	      gast-besturingssysteem ongeveer 15% van de CPU van een
	      enkele &imac;-processor gebruiken.  Na deze wijziging zal
	      het gebruik slechts ongeveer 5% zijn.</para>
	  </step>

	  <step>
	    <title>Een nieuw instellingenbestand voor de kernel aanmaken
	    </title>

	    <para>Alle stuurprogramma's voor SCSI, FireWire, en USB
	      kunnen verwijderd worden.
	      <application>Parallels</application> biedt een virtuele
	      netwerkadapter die door het stuurpogramma &man.ed.4;
	      wordt gebruikt, dus kunnen alle andere netwerkapparaten
	      behalve &man.ed.4; en &man.miibus.4; uit de kernel
	      verwijderd worden.</para>
	  </step>

	  <step>
	    <title>Het netwerk instellen</title>

	    <para>De eenvoudigste netwerkinstallatie omvat het gebruik
	      van DHCP om de virtuele machine met hetzelfde LAN te
	      verbinden als het &mac;-gastheer.  Dit kan bereikt worden
	      door <literal>ifconfig_ed0="DHCP"</literal> aan
	      <filename>/etc/rc.conf</filename> toe te voegen.  Meer
	      geavanceerde netwerkinstallaties staan beschreven in
	      <xref linkend="advanced-networking">.</para>
	  </step>
	</procedure>
      </sect3>
    </sect2>

    <sect2 id="virtualization-guest-xen">
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Fukang</firstname>
	    <surname>Chen (Loader)</surname>
	    <contrib>Bijgedragen door </contrib>
	  </author>
	</authorgroup>
	<!-- Mar/Apr 2007 -->
      </sect2info>

      <title>&os; met &xen; op Linux</title>

      <para>De hypervisor van <application>&xen;</application> is een
	open-source paravirtualisatieproduct dat nu wordt ondersteund
	door het commerci&euml;le bedrijf XenSource.
	Gast-besturingssystemen staan bekend als domU-domeinen, en het
	gastheer-besturingssysteem staat bekend als dom0.  De eerste
	stap in het virtueel draaien van &os; op Linux is om
	<application>&xen;</application> voor Linux dom0 te installeren.
	Het gastheer-besturingssysteem zal een Slackware
	Linux-distributie zijn.</para>

      <sect3 id="xen-slackware-dom0">
	<title>&xen; 3 op Linux dom0 installeren</title>

	<procedure>
	  <step>
	    <title>&xen; 3.0 van XenSource downloaden</title>

	    <para>Download <ulink
		url="http://bits.xensource.com/oss-xen/release/3.0.4-1/src.tgz/xen-3.0.4_1-src.tgz">xen-3.0.4_1-src.tgz</ulink>
		van <ulink url="http://www.xensource.com/"></ulink>.
	    </para>
	  </step>

	  <step>
	    <title>De tarball uitpakken</title>

	    <screen>&prompt.root; <userinput>cd xen-3.0.4_1-src</userinput>
&prompt.root; <userinput>KERNELS="linux-2.6-xen0 linux-2.6-xenU" make world</userinput>
&prompt.root; <userinput>make install</userinput></screen>

	    <note>
	      <para>Om de kernel voor dom0 opnieuw te compileren:</para>

	      <screen>&prompt.root; <userinput>cd xen-3.0.4_1-src/linux-2.6.16.33-xen0</userinput>
&prompt.root; <userinput>make menuconfig</userinput>
&prompt.root; <userinput>make</userinput>
&prompt.root; <userinput>make install</userinput></screen>

	      <para>Voor oudere versies van <application>&xen;
		</application> kan het nodig zijn om
		<command>make ARCH=xen menuconfig</command> te
		specificeren.</para>
	    </note>
	  </step>

	  <step>
	    <title>Een menuregel voor menu.lst van Grub toevoegen
	    </title>

	    <para>Voeg de volgende regels aan
	      <filename>/boot/grub/menu.lst</filename> toe:</para>

	    <programlisting>title Xen-3.0.4
root (hd0,0)
kernel /boot/xen-3.0.4-1.gz dom0_mem=262144
module /boot/vmlinuz-2.6.16.33-xen0 root=/dev/hda1 ro</programlisting>
	  </step>

	  <step>
	    <title>De computer naar &xen; opstarten</title>

	    <para>Voeg als eerste de volgende regel toe aan
	      <filename>/etc/xen/xend-config.sxp</filename> toe:</para>

	    <programlisting>(network-script 'network-bridge netdev=eth0')</programlisting>

	    <para>Nu kan <application>&xen;</application> gestart
	      worden:</para>

	    <screen>&prompt.root; <userinput>/etc/init.d/xend start</userinput>
&prompt.root; <userinput>/etc/init.d/xendomains start</userinput></screen>

	    <para>dom0 draait:</para>

	    <screen>&prompt.root; <userinput>xm list</userinput>
Name                                      ID   Mem VCPUs      State   Time(s)
Domain-0                                   0   256     1     r-----  54452.9</screen>
	  </step>
	</procedure>
      </sect3>

      <sect3>
	<title>&os; 7-CURRENT domU</title>

	<para>Download de &os; domU-kernel voor <application>&xen; 3.0
	  </application> en het schijfimage van <ulink
	    url="http://www.fsmware.com/">http://www.fsmware.com</ulink>
	</para>

	<itemizedlist>
	  <listitem>
	    <para><ulink url="http://www.fsmware.com/xenofreebsd/7.0/download/kernel-current">kernel-current</ulink></para>
	  </listitem>

	  <listitem>
	    <para><ulink url="http://www.fsmware.com/xenofreebsd/7.0/download/mdroot-7.0.bz2">mdroot-7.0.bz2</ulink></para>
	  </listitem>

	  <listitem>
	    <para><ulink url="http://www.fsmware.com/xenofreebsd/7.0/download/config/xmexample1.bsd">xmexample1.bsd</ulink></para>
	  </listitem>
	</itemizedlist>

	<para>Sla het instellingenbestand
	  <filename>xmexample1.bsd</filename> op in
	  <filename>/etc/xen</filename> en pas de regels over waar de
	  kernel en het schijfimage zijn opgeslagen aan.  Het dient er
	  als volgt uit te zien:</para>

	<programlisting>kernel = "/opt/kernel-current"
memory = 256
name = "freebsd"
vif = [ '' ]
disk = [ 'file:/opt/mdroot-7.0,hda1,w' ]
#on_crash    = 'preserve'
extra = "boot_verbose"
extra += ",boot_single"
extra += ",kern.hz=100"
extra += ",vfs.root.mountfrom=ufs:/dev/xbd769a"</programlisting>

	<para>Het <filename>mdroot-7.0.bz2</filename> dient uitgepakt te
	  worden.</para>

	<para>Vervolgens dient de sectie over __xen_guest in
	  <filename>kernel-current</filename> aangepast te worden om de
	  VIRT_BASE dat <application>&xen; 3.0.3</application> nodig
	  heeft toe te voegen:</para>

	<screen>&prompt.root; <userinput>objcopy kernel-current -R __xen_guest</userinput>
&prompt.root; <userinput>perl -e 'print "LOADER=generic,GUEST_OS=freebsd,GUEST_VER=7.0,XEN_VER=xen-3.0,BSD_SYMTAB,VIRT_BASE=0xC0000000\x00"' &gt; tmp</userinput>
&prompt.root; <userinput>objcopy kernel-current --add-section __xen_guest=tmp</userinput></screen>

	<screen>&prompt.root; <userinput>objdump -j __xen_guest -s kernel-current</userinput>

kernel-current:     file format elf32-i386

Contents of section __xen_guest:
 0000 4c4f4144 45523d67 656e6572 69632c47  LOADER=generic,G
 0010 55455354 5f4f533d 66726565 6273642c  UEST_OS=freebsd,
 0020 47554553 545f5645 523d372e 302c5845  GUEST_VER=7.0,XE
 0030 4e5f5645 523d7865 6e2d332e 302c4253  N_VER=xen-3.0,BS
 0040 445f5359 4d544142 2c564952 545f4241  D_SYMTAB,VIRT_BA
 0050 53453d30 78433030 30303030 3000      SE=0xC0000000. </screen>

	<para>Nu kan onze eigen domU aangemaakt en gestart worden:
	</para>

	<screen>&prompt.root; <userinput>xm create /etc/xen/xmexample1.bsd -c</userinput>
Using config file "/etc/xen/xmexample1.bsd".
Started domain freebsd
WARNING: loader(8) metadata is missing!
Copyright (c) 1992-2006 The FreeBSD Project.
Copyright (c) 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994
The Regents of the University of California. All rights reserved.
FreeBSD 7.0-CURRENT #113: Wed Jan  4 06:25:43 UTC 2006
    kmacy@freebsd7.gateway.2wire.net:/usr/home/kmacy/p4/freebsd7_xen3/src/sys/i386-xen/compile/XENCONF
WARNING: DIAGNOSTIC option enabled, expect reduced performance.
Xen reported: 1796.927 MHz processor.
Timecounter "ixen" frequency 1796927000 Hz quality 0
CPU: Intel(R) Pentium(R) 4 CPU 1.80GHz (1796.93-MHz 686-class CPU)
  Origin = "GenuineIntel"  Id = 0xf29  Stepping = 9
  Features=0xbfebfbff&lt;FPU,VME,DE,PSE,TSC,MSR,PAE,MCE,CX8,APIC,SEP,MTRR,PGE,MCA,CMOV,PAT,PSE36,CLFLUSH,
  DTS,ACPI,MMX,FXSR,SSE,SSE2,SS,HTT,TM,PBE&gt;
  Features2=0x4400&lt;CNTX-ID,&lt;b14&gt;&gt;
real memory  = 265244672 (252 MB)
avail memory = 255963136 (244 MB)
xc0: &lt;Xen Console&gt; on motherboard
cpu0 on motherboard
Timecounters tick every 10.000 msec
[XEN] Initialising virtual ethernet driver.
xn0: Ethernet address: 00:16:3e:6b:de:3a
[XEN]
Trying to mount root from ufs:/dev/xbd769a
WARNING: / was not properly dismounted
Loading configuration files.
No suitable dump device was found.
Entropy harvesting: interrupts ethernet point_to_point kickstart.
Starting file system checks:
/dev/xbd769a: 18859 files, 140370 used, 113473 free (10769 frags, 12838 blocks, 4.2% fragmentation)
Setting hostname: demo.freebsd.org.
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
	  inet6 ::1 prefixlen 128
	  inet6 fe80::1%lo0 prefixlen 64 scopeid 0x2
	  inet 127.0.0.1 netmask 0xff000000
Additional routing options:.
Mounting NFS file systems:.
Starting syslogd.
/etc/rc: WARNING: Dump device does not exist.  Savecore not run.
ELF ldconfig path: /lib /usr/lib /usr/lib/compat /usr/X11R6/lib /usr/local/lib
a.out ldconfig path: /usr/lib/aout /usr/lib/compat/aout /usr/X11R6/lib/aout
Starting usbd.
usb: Kernel module not available: No such file or directory
Starting local daemons:.
Updating motd.
Starting sshd.
Initial i386 initialization:.
Additional ABI support: linux.
Starting cron.
Local package initialization:.
Additional TCP options:.
Starting background file system checks in 60 seconds.

Sun Apr  1 02:11:43 UTC 2007

FreeBSD/i386 (demo.freebsd.org) (xc0)

login: </screen>

	<para>De domU zou nu de kernel van &os;&nbsp;7.0-CURRENT moeten
	  draaien:</para>

	<screen>&prompt.root; <userinput>uname -a</userinput>
FreeBSD demo.freebsd.org 7.0-CURRENT FreeBSD 7.0-CURRENT #113: Wed Jan  4 06:25:43 UTC 2006
kmacy@freebsd7.gateway.2wire.net:/usr/home/kmacy/p4/freebsd7_xen3/src/sys/i386-xen/compile/XENCONF  i386</screen>

	<para>Het netwerk kan nu op de domU ingesteld worden.  Het domU
	  van &os; zal het interface <devicename>xn0</devicename>
	  gebruiken:</para>

	<screen>&prompt.root; <userinput>ifconfig xn0 10.10.10.200 netmask 255.0.0.0</userinput>
&prompt.root; <userinput>ifconfig</userinput>
xn0: flags=843&lt;UP,BROADCAST,RUNNING,SIMPLEX&gt; mtu 1500
    inet 10.10.10.200 netmask 0xff000000 broadcast 10.255.255.255
    ether 00:16:3e:6b:de:3a
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
      inet6 ::1 prefixlen 128
      inet6 fe80::1%lo0 prefixlen 64 scopeid 0x2
      inet 127.0.0.1 netmask 0xff000000 </screen>

	<para>Op dom0 Slackware zouden nu afhankelijke netwerkinterfaces
	  te zien moeten zijn:</para>

	<screen>&prompt.root; <userinput>ifconfig</userinput>
eth0      Link encap:Ethernet  HWaddr 00:07:E9:A0:02:C2
          inet addr:10.10.10.130  Bcast:0.0.0.0  Mask:255.0.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:815 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1400 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:204857 (200.0 KiB)  TX bytes:129915 (126.8 KiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:99 errors:0 dropped:0 overruns:0 frame:0
          TX packets:99 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:9744 (9.5 KiB)  TX bytes:9744 (9.5 KiB)

peth0     Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:1853349 errors:0 dropped:0 overruns:0 frame:0
          TX packets:952923 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:2432115831 (2.2 GiB)  TX bytes:86528526 (82.5 MiB)
          Base address:0xc000 Memory:ef020000-ef040000

vif0.1    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:1400 errors:0 dropped:0 overruns:0 frame:0
          TX packets:815 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:129915 (126.8 KiB)  TX bytes:204857 (200.0 KiB)

vif1.0    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:3 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2 errors:0 dropped:157 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:140 (140.0 b)  TX bytes:158 (158.0 b)

xenbr1    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:4 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:112 (112.0 b)  TX bytes:0 (0.0 b)</screen>

	<screen>&prompt.root; <userinput>brctl show</userinput>
bridge name     bridge id           STP enabled         interfaces
xenbr1          8000.feffffffffff   no                  vif0.1
                                                        peth0
                                                        vif1.0</screen>
      </sect3>
    </sect2>

    <sect2 id="virtualization-guest-virtualpc">
      <title>Virtual PC op &windows;</title>

      <para><application>Virtual PC</application> voor &windows; is een
	softwareprodukt van &microsoft; dat gratis gedownload kan worden
	.  Zie <ulink
	url="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx">systeemeisen</ulink>.
	Nadat <application>Virtual PC</application> is
	ge&iuml;nstalleerd op &microsoft.windows;, dient de gebruiker
	een virtuele machine in te stellen en daarna het gewenste
	gast-besturingssysteem te installeren.</para>

      <sect3 id="virtualization-guest-virtualpc-install">
	<title>&os; installeren op Virtual PC/&microsoft.windows;
	</title>

	<para>De eerste stap in het installeren van &os; op
	  &microsoft.windows;/<application>Virtual PC</application> is
	  het aanmaken van een nieuwe virtuele machine voor het
	  installeren van &os;.  Kies <guimenuitem>Create a virtual
	    machine</guimenuitem> wanneer daarom wordt gevraagd:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd1">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd2">
	  </imageobject>
	</mediaobject>

	<para>Selecteer <guimenuitem>Other</guimenuitem> als het
	  <guimenuitem>Operating system</guimenuitem> wanneer dat
	  gevraagd wordt:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd3">
	  </imageobject>
	</mediaobject>

	<para>Kies vervolgens een gepaste hoeveelheid aan schijf- en
	  geheugenruimte afhankelijk van de plannen voor deze virtuele
	  instantie van &os;.  4GB aan schijfruimte en 512MB aan RAM
	  werken goed voor de meeste gebruikers van &os; onder
	  <application>Virtual PC</application>:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd4">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd5">
	  </imageobject>
	</mediaobject>

	<para>Bewaar de instellingen en sluit ze af:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd6">
	  </imageobject>
	</mediaobject>

	<para>Selecteer de virtuele &os;-machine en klik op
	 <guimenu>Settings</guimenu>, stel daarna het type netwerk en
	 een netwerkinterface in:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd7">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd8">
	  </imageobject>
	</mediaobject>

	<para>Nadat de virtuele &os;-machine is aangemaakt, dient &os;
	  erop ge&iuml;nstalleerd te worden.  Dit gaat het beste met een
	  offici&euml;le &os;-CDROM of met een ISO-beeld dat van een
	  offici&euml;le FTP-site is gedownload.  Wanneer het juiste
	  ISO-beeld op het lokale bestandssysteem van &windows; staat
	  of er een CDROM in de CD-drive zit, dubbelklik dan op de
	  virtuele &os;-machine om op te starten.  Klik daarna op
	  <guimenu>CD</guimenu> en kies <guimenu>Capture ISO Image...
	  </guimenu> in het venster van <application>Virtual PC
	  </application>.  Dit toont een scherm dat het mogelijk maakt
	  om de CDROM-drive in de virtuele machine te associ&euml;ren
	  met een ISO-bestand op schijf of met een echte CDROM-drive.
	</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd9">
	  </imageobject>
	</mediaobject>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd10">
	  </imageobject>
	</mediaobject>

	<para>Start, nadat deze associatie met de CDROM-bron is gemaakt,
	  de virtuele &os;-machine opnieuw op zoals gewoonlijk door op
	  <guimenu>Action</guimenu> en <guimenu>Reset</guimenu> te
	  klikken.  <application>Virtual PC</application> zal herstarten
	  met een speciale BIOS dat eerst controleert of er een CDROM
	  aanwezig is, net zoals eeen normale BIOS dat zou doen.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd11">
	  </imageobject>
	</mediaobject>

	<para>In dit geval zal het de installatiemedia van &os; vinden
	  en een normale installatie gebaseerd op
	  <application>sysinstall</application> beginnen zoals
	  beschreven in <xref linkend="install">.  X11 kan nu
	  ge&iuml;nstalleerd, maar nog niet ingesteld, worden.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd12">
	  </imageobject>
	</mediaobject>

	<para>Denk eraan om de CDROM of het ISO-beeld te verwijderen
	  nadat de installatie voltooid is.  Start als laatste op naar
	  de nieuw ge&iuml;nstalleerde virtuele &os;-machine.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/virtualpc-freebsd13">
	  </imageobject>
	</mediaobject>
      </sect3>

      <sect3 id="virtualization-guest-virtualpc-configure">
	<title>&os; instellen op &microsoft.windows;/Virtual PC</title>

	<para>Nadat &os; succesvol is ge&iuml;nstalleerd op
	  &microsoft.windows; met <application>Virtual PC</application>
	  zijn er een aantal instellingen die aangepast kunnen worden om
	  het system te optimaliseren voor virtueel gebruik.</para>

	<procedure>
	  <step>
	    <title>De variabelen voor de bootloader instellen</title>

	    <para>De belangrijkste stap is om de tunable <option>kern.hz
	      </option> te verlagen om zo het CPU-gebruik van &os; in de
	      omgeving van <application>Virtual PC</application> te
	      verminderen.  Dit kan bereikt worden door de volgende
	      regel aan <filename>/boot/loader.conf</filename> toe te
	      voegen:</para>

	    <programlisting>kern.hz=100</programlisting>

	    <para>Zonder deze instelling zal een &os; als
	      gast-besturingssysteem voor <application>Virtual PC
	      </application> in rust ongeveer 40% van de CPU van een
	      computer met een enkele processor gebruiken.  Na deze
	      verandering zal het gebruik slechts rond de 3% liggen.
	    </para>
	  </step>

	  <step>
	    <title>Een nieuw instellingenbestand voor de kernel aanmaken
	    </title>

	    <para>Alle stuurprogramma's voor SCSI, FireWire, en USB
	      kunnen verwijderd worden.  <application>Virtual PC
	      </application> beidt een virtuele netwerkadapter dat door
	      het stuurprogramma &man.de.4; gebruikt wordt, dus kunnen
	      alle netwerkapparaten behalve &man.de.4; en &man.miibus.4;
	      uit de kernel verwijderd worden.</para>
	  </step>

	  <step>
	    <title>Het netwerk instellen</title>

	    <para>De eenvoudigste netwerkinstallatie omvat het gebruik
	      van DHCP om de virtuele machine met het zelfde LAN te
	      verbinden als de &microsoft.windows;-gastheer.  Dit kan
	      bereikt worden door <literal>ifconfig_de0="DHCP"</literal>
	      toe te voegen aan <filename>/etc/rc.conf</filename>.
	      Geavanceerdere netwerkinstallaties staan beschreven in
	      <xref linkend="advanced-networking">.</para>
	  </step>
	</procedure>
      </sect3>
    </sect2>

    <sect2 id="virtualization-guest-vmware">
      <title>VMWare op &macos;</title>

      <para><application>VMWare Fusion</application> voor &mac; is een
	comercieel softwareprodukt beschikbaar voor op &intel;
	gebaseeerde &mac;-computers die &macos; 10.4.9 of nieuwer
	draaien.  &os; is een volledig ondersteund
	gast-besturingssysteem.  Nadat <application>VMWare Fusion
	</application> is ge&iuml;nstalleerd op &macos; X dient de
	gebruiker een virtuele machine in te stellen en daarna het
	gewenste gast-besturingssysteem te installeren.</para>

      <sect3 id="virtualization-guest-vmware-install">
	<title>&os; installeren op VMWare/&macos; X</title>

	<para>De eerste stap is om VMWare Fusion te laden, de Virtual
	  Machine Library zal geladen worden.  Klik op "New" om de
	  VM aan te maken:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd01">
	  </imageobject>
	</mediaobject>

	<para>Dit laadt de New Virtual Machine Assistant dat helpt om
	  de VM aan te maken, klik op Continue om verder te gaan:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd02">
	  </imageobject>
	</mediaobject>

	<para>Selecteer <guimenuitem>Other</guimenuitem> als het
	  <guimenuitem>Operating System</guimenuitem> en
	  <guimenuitem>&os;</guimenuitem> of <guimenuitem>&os; 64-bit
	  </guimenuitem>, afhankelijk van de wens voor ondersteuning
	  voor 64-bit, als de <guimenuitem>Version</guimenuitem>
	  wanneer dat gevraagd wordt:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd03">
	  </imageobject>
	</mediaobject>

	<para>Kies de naam van het VM-beeld en de map waarin het bewaard
	  dient te worden:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd04">
	  </imageobject>
	</mediaobject>

	<para>Kies de grootte van de virtuele harde schijf voor de VM:
	</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd05">
	  </imageobject>
	</mediaobject>

	<para>Kies de manier om de VM te installeren, van een ISO-beeld
	  of van een CD:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd06">
	  </imageobject>
	</mediaobject>

	<para>Nadat op Finish is geklikt, zal de VM opstarten:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd07">
	  </imageobject>
	</mediaobject>

	<para>Installeer &os; zoals gewoonlijk, of door de aanwijzingen
	  in <xref linkend="install"> op te volgen:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd08">
	  </imageobject>
	</mediaobject>

	<para>Nadat de installatie voltooid is kunnen de instellingen
	  van de VM aangepast worden, zoals het geheugengebruik:</para>

	<note>
	  <para>De instellingen van de systeemhardware van de VM kunnen
	    niet veranderd worden zolang de VM draait.</para>
	</note>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd09">
	  </imageobject>
	</mediaobject>

	<para>Het aantal CPU's waartoe de VM toegang heeft:</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd10">
	  </imageobject>
	</mediaobject>

	<para>De status van het CD-ROM-apparaat.  Gewoonlijk kan de
	  CD-ROM of het ISO-beeld van de VM worden losgekoppeld wanneer
	  het niet meer nodig is.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd11">
	  </imageobject>
	</mediaobject>

	<para>Het laatste om te veranderen is de manier waarop de VM
	  verbinding met het netwerk maakt.  Indien verbindingen naar de
	  VM van andere machines naast de gastheer gewenst zijn, dient
	  <guimenuitem>Connect directly to the physical network
	  (Bridged)</guimenuitem> gekozen te worden.  In andere
	  situaties is <guimenuitem>Share the host's internet connection
	  (NAT)</guimenuitem> te verkiezen, zodat de VM toegang kan
	  hebben tot het Internet, maar dat het netwerk geen toegang
	  heeft tot de VM.</para>

	<mediaobject>
	  <imageobject>
	    <imagedata fileref="virtualization/vmware-freebsd12">
	  </imageobject>
	</mediaobject>

	<para>Herstart de nieuw ge&iuml;nstalleerde virtuele
	  &os;-machine nadat alle instellingen zijn aangepast.</para>
      </sect3>

      <sect3 id="virtualization-guest-vmware-configure">
	<title>&os; instellen op &macos; X/VMWare</title>

	<para>Nadat &os; succesvol is ge&iuml;nstalleerd op &macos; X
	  met <application>VMWare</application>, zijn er een aantal
	  instellingen die gewijzigd kunnen worden op het systeem te
	  optimaliseren voor virtueel gebruik.</para>

	<procedure>
	  <step>
	    <title>De variabelen voor de bootloader instellen</title>

	    <para>De belangrijkste stap is het verlagen van de
	      tunable <option>kern.hz</option> om het CPU-gebruik van
	      &os; in de omgeving van <application>VMWare</application>
	      te verminderen.  Dit kan bereikt worden door de volgende
	      regel aan <filename>/boot/loader.conf</filename> toe te
	      voegen:</para>

	    <programlisting>kern.hz=100</programlisting>

	    <para>Zonder deze instelling gebruikt &os; als <application>
	      VMWare</application> gast-besturingssysteem ongeveer 15%
	      van de CPU van een enkele &imac;-processor.  Na deze
	      verandering zal het gebruik dichter bij 5% liggen.</para>
	  </step>

	  <step>
	    <title>Een nieuw instellingenbestand voor de kernel aanmaken
	    </title>

	    <para>Alle stuurprogramma's voor FireWire en USB kunnen
	      verwijderd worden.  <application>VMWare</application>
	      biedt een virtuele netwerkadapter dat door het
	      stuurpogramma &man.em.4; gebruikt wordt, dus alle
	      netwerkapparaten behalve &man.em.4; kunnen uit de kernel
	      verwijderd worden.</para>
	  </step>

	  <step>
	    <title>Het netwerk instellen</title>

	    <para>De eenvoudigste netwerkinstallatie omvat het gebruik
	      van DHCP om de virtuele machine met hetzelfde LAN te
	      verbinden als de &mac;-gastheer.  Dit kan bereikt worden
	      door <literal>ifconfig_em0="DHCP"</literal> toe te voegen
	      aan <filename>/etc/rc.conf</filename>.  Geavanceerdere
	      netwerkinstallaties staan beschreven in <xref
		linkend="advanced-networking">.</para>
	  </step>
	</procedure>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="virtualization-host">
    <title>&os; als een gastheer-besturingssysteem</title>

    <para>&os; wordt momenteel niet officieel ondersteund als
      gastheer-besturingssysteem door virtualisatiepakketten,
      maar veel mensen gebruiken hiervoor oudere versies van
      <application>VMware</application>.  Er wordt ook gewerkt om
      <application>&xen;</application> als gastheeromgeving voor &os;
      werkend te krijgen.</para>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
