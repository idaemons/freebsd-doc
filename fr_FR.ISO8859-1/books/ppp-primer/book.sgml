<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE book PUBLIC "-//FreeBSD//DTD DocBook XML V4.2-Based Extension//EN"
	"../../../share/sgml/freebsd42.dtd" [
<!ENTITY % entities PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Entity Set//FR" "../../share/sgml/entities.ent">
%entities;
]>

<!--
     The FreeBSD Documentation Project
     The FreeBSD French Documentation Project

     $FreeBSD$
     $Id: book.sgml,v 1.2 2003-02-15 10:13:49 blackend Exp $
     Original revision: n.nn
-->

<book lang="fr">
<bookinfo>
<title>Pédants Principes PPP</title>

<authorgroup>
<author>
<firstname>Frédéric</firstname>
<surname>Haby</surname>
<affiliation>
<address><email>Frédéric.haby@freebsd-fr.org</email></address>
</affiliation>
</author>
</authorgroup>

<releaseinfo>$FreeBSD$</releaseinfo>

<abstract><para>Ce document est un guide pas &agrave; pas pour la configuration de FreeBSD dans le cadre de son utilisation
comme routeur/passerelle de connexions &agrave la demande dans un réseau local.  Toutes les commandes fonctionnent avec un système FreeBSD 2.2 ou ultérieur, sauf indication contraire.</para>

&trans.a.haby;
</abstract>
</bookinfo>

<preface>
<title>Introduction</title>
<para>Le protocole de connexion PPP en mode utilisateur de la version 2.2 de
FreeBSD (appelé aussi &ldquo;IIJ-PPP&rdquo;) supporte maintenant
la réécriture de paquets pour les connexions &agrave; l'Internet. Cette possibilité,
connue aussi sous le nom de &ldquo;<emphasis remap="it">Mascarade (Masquerading)</emphasis>&rdquo;,
&ldquo;<emphasis remap="it">Alias IP (IP Aliasing)</emphasis>&rdquo;, ou &ldquo;<emphasis remap="it">Traduction d'Adresse
Réseau (Network Adresse Translation)</emphasis>&rdquo;, permet &agrave; un système FreeBSD
d'interagir comme routeur de connexion &agrave; la demande entre un réseau local
et un fournisseur d'accès &agrave; Internet. Les machines du réseau local peuvent
utiliser l'unique connexion de la machine FreeBSD &agrave; l'Internet pour échanger
des informations avec ce dernier.</para>

<para>But de ce document</para>
<para>Ce document<footnote><para>N.d.T: Si vous souhaitez consulter le document
original en langue anglaise, il se trouve sur
<ulink url="http://www.FreeBSD.org/tutorials/ppp/ppp.html">http://www.FreeBSD.org/ppp/ppp.html</ulink>.</para></footnote>
vous explique comment:
<itemizedlist>
<listitem><para>Configurer le système FreeBSD pour permettre les connexions
vers l'extérieur,</para>
</listitem>

<listitem>
<para>Partager une seule connexion vers l'extérieur avec les autres
machines du réseau,</para>
</listitem>

<listitem>
<para>Configurer les machines Windows pour utiliser la machine
FreeBSD comme passerelle vers l'Internet.</para>
</listitem>

</itemizedlist>
</para>

<para>Bien que l'objectif de ce document soit avant tout d'expliquer comment
configurer la traduction d'adresses IP, il fournit aussi des exemples
d'installation et de configuration des autres composants. Chaque section
est indépendante et peut être utilisée pour configurer divers aspects d'une
passerelle FreeBSD entre plusieurs réseaux.</para>

</preface>

<chapter id="lan">
<title>Mise en oeuvre du réseau local</title>

<para>Bien que le programme <command>ppp</command> puisse, et soit généralement
utilisé pour fournir des services &agrave; la <emphasis>seule</emphasis> machine
FreeBSD, il peut aussi servir &agrave; en faire une &ldquo;passerelle&rdquo; ou
&ldquo;routeur&rdquo; entre les autres dispositifs reliés au réseau local
et l'Internet ou tout autre service connecté.</para>

<sect1>
<title>Topologie classique du réseau</title>

<para>Ce document s'applique &agrave; un réseau local dont la
topologie est&nbsp;-&nbsp;classiquement&nbsp;-&nbsp;la suivante:</para>
<programlisting>

+=========+      =======> Connexion &agrave; Internet ( Wanadoo, AOL, etc. )
|         |      \
| FreeBSD |=======
| "Curly" |
|         |
+====+====+
     |
|=================+============+====|  <== Réseau Local Ethernet
     |            |            |
+====+====+  +====+====+  +====+====+
|         |  |         |  |         |
|  Win95  |  |   WFW   |  |  WinNT  |
| "Larry" |  |  "Moe"  |  | "Shemp" |
|         |  |         |  |         |
+=========+  +=========+  +=========+

</programlisting>
</sect1>

<sect1>
<title>Hypothèses sur le réseau local</title>

<para>Pour les besoins de notre exemple, nous supposerons que :</para>
<para>Il y a trois stations et un serveur reliés par le réseau Ethernet
local:
<itemizedlist>
<listitem>
<para>un serveur FreeBSD (&ldquo;Curly&rdquo;) avec un contrôleur
Ethernet NE-2000 configuré sur &ldquo;ed0&rdquo;,</para>
</listitem>

<listitem>
<para>une station de travail Windows 95 (&ldquo;Larry&rdquo;) avec
les pilotes TCP/IP 32-bits natifs de Microsoft,</para>
</listitem>

<listitem>
<para>une station de travail Windows for Workgroups
(&ldquo;Larry&rdquo;) avec les extension TCP/IP 16-bits de
Microsoft,</para>
</listitem>

<listitem>
<para>une station de travail Windows NT (&ldquo;Larry&rdquo;) avec
les pilotes TCP/IP 32-bits natifs de Microsoft.</para>
</listitem>

</itemizedlist>
</para>

<para>Les adresses IP du réseau Ethernet sur lequel se base notre exemple
ont été attribuées dans l'espace d'adresses privées défini par la RFC-1597,
comme suit:</para>
<!-- Mise en forme remise à l'identique du PPP-Primer-->
<!-- FP le 19/04/2001
<programlisting>
Nom       Adresse IP
"Curly"   192.168.1.1   # La machine FreeBSD
"Larry"   192.168.1.2   # La machine Windows 95
"Moe"     192.168.1.3   # La machine Windows for Workgroups
"Shemp"   192.168.1.4   # La machine Windows NT
</programlisting>
-->

<informaltable>
  <tgroup cols="3">
    <thead>
      <row>
        <entry>Nom</entry>
	<entry>Adresse IP</entry>
	<entry>Commentaire</entry>
      </row>
    </thead>

    <tbody>
      <row>
        <entry><hostid>Curly</hostid></entry>
        <entry><hostid role="ipaddr">192.168.1.1</hostid></entry>
        <entry>La machine FreeBSD</entry>
      </row>

      <row>
        <entry><hostid>Larry</hostid></entry>
        <entry><hostid role="ipaddr">192.168.1.2</hostid></entry>
        <entry>La machine Windows 95</entry>
      </row>

      <row>
        <entry><hostid>Moe</hostid></entry>
        <entry><hostid role="ipaddr">192.168.1.3</hostid></entry>
        <entry>La machine Windows for Workgroups</entry>
      </row>

      <row>
        <entry><hostid>Shemp</hostid></entry>
        <entry><hostid role="ipaddr">192.168.1.4</hostid></entry>
        <entry>La machine Windows NT</entry>
      </row>
    </tbody>
  </tgroup>
</informaltable>

<para>Nous supposerons aussi que le modem est connecté sur le premier port série
<!--Mise à jour de la tipographie
    FP le 19/04/2001
-->
(<filename>/dev/cuaa0</filename> ou <emphasis remap="tt">COM1:</emphasis> selon la
terminologie DOS) de la machine FreeBSD.</para>
<para>Enfin, nous supposerons que notre fournisseur d'accès Internet nous
fournit automatiquement les adresses IP des deux extrémités de la liaison PPP
(point &agrave; point) : celle de notre machine FreeBSD et celle de la machine du côté
du fournisseur (adressage dynamique). Les détails de configuration de la
connexion de la machine FreeBSD &agrave; l'extérieur sont donnés dans le chapître 2, "Configuration du système FreeBSD".</para>

</sect1>
</chapter>

<chapter id="system-config">
<title>Configuration du système FreeBSD</title>

<para>Il y a trois informations &agrave; fournir au système FreeBSD avant de le relier
au réseau local de notre exemple:</para>

<para>
<itemizedlist>

<listitem>
<para>Son nom de machine (<filename>hostname</filename>),
&ldquo;Curly&rdquo; dans notre exemple,</para>
</listitem>

<listitem>
<para>La configuration de son interface réseau,</para>
</listitem>

<listitem>
<para>Le fichier <filename>/etc/hosts</filename> (qui liste les noms
et les adresses IP des autres machines du réseau).</para>
</listitem>

</itemizedlist>
</para>

<para>Si vous avez installé FreeBSD via une connexion réseau, il
est possible que certaines de ces informations soient déj&agrave; définies.</para>

<para>Même si vous pensez que votre système FreeBSD a déj&agrave; été correctement
configuré au moment de l'installation, il vous mieux vous assurer de la
validité de chacune de ces informations pour vous éviter des ennuis par la
suite.</para>

<sect1>
<title>Contrôler le nom de la machine FreeBSD</title>

<para>Il est possible que le nom de la machine FreeBSD ait été défini et
enregistré lors de l'installation du système. Pour le vérifier, entrez,
&agrave; l'invite du système, la commande suivante:</para>

<para>
<userinput>
<prompt>#</prompt> hostname
</userinput>
</para>

<para>Le nom de la machine FreeBSD sera affiché sur une seule ligne. Si ce nom
paraît correct (c'est très subjectif :-), vous pouvez passer au paragraphe
<link linkend="verify-ether-if-config">Contrôler la configuration de l'interface Ethernet</link>.</para>

<para>Dans notre exemple, le résultat de la commande <command>hostname</command>
devrait être &ldquo;curly.my.domain&rdquo; si le nom de la machine a été
correctement défini &agrave; l'installation, ou ensuite. (A ce stade, ne vous
préoccupez pas du suffixe &ldquo;.my.domain&rdquo;, nous verrons cela par la
suite. Ce qui compte maintenant est le nom qui précède le premier
&ldquo;.&rdquo;)</para>

<para>Si le nom de machine n'a pas été défini &agrave; l'installation, la réponse de
<command>hostname</command> sera probablement &ldquo;myname.my.domain&rdquo;.
Vous devez alors éditer le fichier <filename>/etc/rc.conf</filename> pour
définir le nom du système.</para>

<sect2>
<title>Définir le nom de la machine FreeBSD</title>
<note>
<para>Vous devez être en session sous &ldquo;root&rdquo; pour éditer les
fichiers de configuration du système.</para>
</note>

<note>
<para>Si vous introduisez des erreurs dans les fichiers de configuration, il y
a de fortes chances que votre système <emphasis>ne redémarre</emphasis> pas
correctement! Soyez prudents !</para>
</note>

<para>Le nom de machine du système FreeBSD est défini au démarrage par le
fichier <filename>/etc/rc.conf</filename>. Utilisez l'éditeur par défaut
(&ldquo;ee&rdquo;) pour éditer ce fichier.</para>

<para>Sous une session &ldquo;root&rdquo;, visualisez le fichier dans l'éditeur
avec la commande:</para>
<para>
<userinput>
<prompt>#</prompt> ee /etc/rc.conf
</userinput>
</para>

<para>Avec les touches flèches, allez jusqu'&agrave; la ligne qui définit le nom de
machine du système FreeBSD. Par défaut, vous y trouvez:</para>
<!-- Mise en forme issu du PPP Primer
     FP le 19/04/2001-->
<!--
<literallayout>
-
### Basic network options: ###
hostname="myname.my.domain"     # Set this !
-
</literallayout>
-->
<informalexample>
<screen>---
### Basic network options: ###
hostname="myname.my.domain"	# Set this!
---</screen>
</informalexample>

<para>Remplacez ces lignes, par exemple, par:
<!--
<literallayout>
-
### Basic network options: ###
hostname="curly.my.domain"     # Set this !
-
</literallayout>
-->

<informalexample>
<screen>---
### Basic network options: ###
hostname="curly.my.domain"	# Set this!
---</screen>
</informalexample>
</para>

<para>Une fois la modification faite, appuyez sur la touche
<keycap>Echap</keycap> pour aller dans le menu de commandes de
l'éditeur. Choisissez
&ldquo;leave editor&rdquo; (quitter l'éditeur) et sélectionnez bien l'option
&ldquo;save changes&rdquo; (enregistrer les modifications) quand la question
vous est posée.</para>


</sect2>
</sect1>

<sect1 id="verify-ether-if-config">
<title>Contrôler la configuration de l'interface Ethernet</title>

<para>Rappelons nos hypothèses : l'interface Ethernet de la machine s'appelle
&ldquo;ed0&rdquo;. C'est la valeur par défaut pour les contrôleurs NE-1000,
NE-2000, WD/SMC modèles 8003, 8013 et Elite Ultra (8216).</para>

<para>Les fichiers d'interface d'autres modèles de contrôleurs peuvent
avoir d'autres noms sous FreeBSD. Si vous n'êtes pas certain du nom
correspondant &agrave; votre contrôleur, consultez les Questions Fréquemment Posées
&agrave; propos de
FreeBSD (&ldquo;FAQ&rdquo;) et substituez la bonne
<!-- Ajout d'une liste de valeurs
	FP le 19/04/2001	-->
valeur (par ex.: '<emphasis remap="tt">de0</emphasis>','<emphasis remap="tt">zp0</emphasis>', ou équivalent) dans les exemples
suivants.</para>

<para>De la même façon que pour le nom de la machine, l'interface Ethernet du
système FreeBSD a peut-être été configurée &agrave; l'installation.</para>

<para>Pour consulter la configuration des interfaces (Ethernet et autres) de
votre système FreeBSD), utilisez la commande suivante:</para>
<screen>
<prompt>#</prompt> <userinput>ifconfig -a</userinput>
</screen>

<para>Soit en clair: "Donnes-moi la <acronym>CONFIG</acronym>uration des <emphasis remap="bf">I</emphasis>nter<emphasis remap="bf">F</emphasis>aces de mes
périphériques réseau."</para>

<para>Par exemple:
<informalexample>
<screen>
<prompt>#</prompt> <userinput>ifconfig -a</userinput>
ed0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> mtu 1500
inet 192.168.1.1 netmask 0xffffff00 broadcast 192.168.1.255
ether 01:02:03:04:05:06
lp0: flags=8810&lt;POINTOPOINT,SIMPLEX,MULTICAST> mtu 1500
tun0: flags=8050&lt;POINTOPOINT,RUNNING, MULTICAST> mtu 1500
l0: flags=c010&lt;OINTOPOINT,LINK2,MULTICAST> mtu 552
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST> mtu 1500
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST> mtu 16384
inet 127.0.0.1 netmask 0xff000000
<prompt>#</prompt>
</screen>
</informalexample>
</para>

<para>Sur cet exemple, les périphériques suivants sont reconnus :</para>
<itemizedlist>
<listitem>
<para><filename>ed0</filename>: l'interface
Ethernet,</para>
</listitem>

<listitem>
<para><filename>lp0</filename>: l'interface parallèle
(que nous n'utiliserons pas ici),</para>
</listitem>

<listitem>
<para><filename>tun0</filename>: l'interface "tunnel"; <emphasis>Il s'agit de celle utilisée par le PPP utilisateur</emphasis></para>
</listitem>

<listitem>
<para><filename>ppp0</filename>: un autre interface PPP
(pour le module <command>ppp</command> intégré au noyau, que n'utiliserons pas
ici),</para>
</listitem>

<listitem>
<para><filename>lo0</filename>: l'interface
"en boucle"&nbsp;-&nbsp;"loopback"&nbsp;-&nbsp;que
nous n'utiliserons pas non plus).</para>
</listitem>

</itemizedlist>
<para>Dans l'exemple, l'interface &ldquo;ed0&rdquo; est active
(&ldquo;UP&rdquo;) et fonctionne (&ldquo;RUNNING&rdquo;). Les indications
importantes sont:
<orderedlist>

<listitem>
<para>L'interface est active (son status est &ldquo;UP&rdquo;),</para>
</listitem>

<listitem>
<para>Elle a une adresse Ethernet (&ldquo;inet&rdquo;), dans notre
cas: 192.168.1.1,</para>
</listitem>

<listitem>
<para>Elle a un masque de sous-réseau (&ldquo;netmask&rdquo;;
0xffffff00 qui équivaut &agrave; 255.255.255.0) correct,</para>
</listitem>

<listitem>
<para>Elle a une adresse de diffusion (&ldquo;broadcast&rdquo;;
ici, 192.168.1.255) valide.</para>
</listitem>

</orderedlist>
</para>

<para>Si la ligne décrivant l'interface Ethernet mentionne quelque chose
comme:
<!-- Mise à jour
	FP le 19/04/2001-->
<!--<programlisting>-->
<informalexample>
<screen>
ed0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST> mtu 1500
ether 01:02:03:04:05:06
</screen>
</informalexample>
<!--</programlisting>-->
</para>

<para>c'est que cette interface n'est pas encore configurée.</para>

<para>Si l'interface Ethernet est déj&agrave; configurée, vous pouvez passer
directement au paragraphe <link linkend="list-lan-hosts">Renseigner la liste des
autres machines du réseau</link>.
Sinon, continuez en séquence.</para>

<sect2>
<title>Configurer votre interface Ethernet</title>

<note>
<para>Vous devez être en session sous &ldquo;root&rdquo; pour éditer les
fichiers de configuration du système.</para>
</note>

<note>
<para>Si vous introduisez des erreurs dans les fichiers de configuration, il y
a de fortes chances que votre système <emphasis>ne redémarre</emphasis> pas
correctement! Soyez prudents !</para>
</note>

<para>Les paramètres de configuration des interfaces réseau sont définis au
démarrage par le fichier <filename>/etc/rc.conf</filename>. Utilisez l'éditeur
par défaut (&ldquo;ee&rdquo;) pour éditer ce fichier.</para>

<para>Sous une session &ldquo;root&rdquo;, visualisez le fichier dans l'éditeur
avec la commande:</para>
<para>
<userinput>
<prompt>#</prompt> ee /etc/rc.conf
</userinput>
</para>

<para>Vers la vingtième ligne environ du fichier, se trouve la section qui
définit quelles interfaces réseau doivent être mises en service au
démarrage. Le fichier de configuration par défaut contient la ligne :</para>

<programlisting>
network_interfaces="lo0"        # List of network interfaces (lo0 is loopback)
</programlisting>

<para>que vous devrez modifier pour dire &agrave; FreeBSD que vous voulez ajouter un
autre périphérique, en l'occurence l'interface &ldquo;ed0&rdquo;, en:</para>

<programlisting>
network_interfaces="lo0 ed0"    # List of network interfaces (lo0 is loopback)
</programlisting>

<para>(Faites attention &agrave; l'espace entre la définition de l'interface en boucle
&ldquo;lo0&rdquo; et l'interface Ethernet &ldquo;ed0&rdquo;.)</para>

<note>
<para>Si le nom correspondant &agrave; votre interface n'est pas &ldquo;ed0&rdquo;,n'oubliez pas de mettre la valeur adéquate &agrave; la place.</para>
</note>

<para>Si vous avez installé FreeBSD via une connexion réseau, la ligne
<!-- Modif du type de Tag sur network_interfaces -->
<!-- FP le 19/04/2001 -->
&ldquo;<literal>network_interfaces</literal>&rdquo; comporte peut-être
déj&agrave; un référence &agrave; votre carte Ethernet. Dans ce cas, assurez vous que son nom
soit correct.</para>

<para>Les lignes qui suivent celles où sont listées les interfaces &agrave; mettre en
service décrivent les paramètres de chacune de ces interfaces. Dans le fichier
<filename>/etc/rc.conf</filename> par défaut, il n'y a qu'un seule ligne qui
dit:</para>
<programlisting>
ifconfig_lo0="inet 127.0.0.1"   # default loopback device configuration
</programlisting>

<para>Vous devrez ajouter une ligne qui définisse les caractéristiques de
votre interface &ldquo;ed0&rdquo;.</para>

<para>Si vous avez installé FreeBSD via une connexion réseau, la ligne
<!-- Modif de tag FP le 19/04/2001-->
&ldquo;<literal>ifconfig_ed0=</literal>&rdquo; existe peut-être
déj&agrave;. Vérifiez alors qu'elle contienne bien les bonnes valeurs.</para>
<para>En nous référant &agrave; notre exemple, nous insérerons la ligne suivante,
immédiatement après la définition de l'interface
&ldquo;en boucle&rdquo;:</para>

<programlisting>
ifconfig_ed0="inet 192.168.1.1 netmask 255.255.255.0"
</programlisting>

<para>Après modification, cette section du fichier
<filename>/etc/rc.conf</filename> doit ressembler &agrave;:</para>
<programlisting>
---
network_interfaces="lo0 ed0"    # List of network interfaces (lo0 is loopback)
ifconfig_lo0="inet 127.0.0.1"   # default loopback device configuration
ifconfig_ed0="inet 192.168.1.1 netmask 255.255.255.0"
---
</programlisting>

<para>Un fois que vous avez fait toutes les modifications nécessaires,
appuyez sur la touche
<keycap>Echap</keycap> pour aller dans le menu de commandes de
l'éditeur. Choisissez
&ldquo;leave editor&rdquo; (quitter l'éditeur) et sélectionnez bien l'option
&ldquo;save changes&rdquo; (enregistrer les modifications) quand la question
vous est posée.</para>

</sect2>
</sect1>

<sect1>
<title>Autoriser la transmission de paquets</title>

<para>Par défaut, FreeBSD n'active pas le transmission de paquets
entre les différentes interfaces réseau d'une machine. En d'autres
termes, les fonctions de routage (aussi appelées de passerelle)
ne sont pas disponibles.</para>

<para>Si vous voulez utiliser le programme <command>ppp</command>
comme poste Internet autonome et non comme passerelle entre le
réseau local et votre fournisseur d'accès &agrave; Internet, vous pouvez
passer directement au paragraphe
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>.</para>

<para>Si vous voulez utiliser le programme <command>ppp</command>
pour connecter &agrave; la fois votre machine FreeBSD (pour servir de
routeur) et les autres postes du réseau local, vous devez autoriser
la transmission de paquets IP.</para>

<para>Pour cela, vous devez éditer le fichier
<filename>/etc/rc.conf</filename>. Visualisez le fichier dans l'éditeur
avec la commande:</para>
<para>
<userinput>
<prompt>#</prompt> ee /etc/rc.conf
</userinput>
</para>
<para>Vers la quatre-vingt-cinquième ligne environ, vous trouverez la section
qui contrôle la transmission de paquets. Elle ressemblera a ceci:</para>
<literallayout>
---
gateway_enable="NO"		# Set to YES if the host will be a gateway
---
</literallayout>
<para>Modifiez-la en:</para>
<para>
<literallayout>
---
gateway_enable="YES"		# Set to YES if the host will be a gateway
---
</literallayout>
</para>
<para>et quittez l'éditeur (en enregistrant vos modifications!).</para>
<note>
<para>Cette ligne contient peut-être déj&agrave;
<command>gateway_enable="YES"</command>
si la transmission de paquets IP a été autorisée au moment de l'installation
du système FreeBSD.</para>
</note>
</sect1>

<sect1 id="list-lan-hosts">
<title>Renseigner la liste des autres machines du réseau
(<filename>/etc/hosts</filename>)</title>

<para>La dernière étape de la configuration du réseau local vu de la machine
FreeBSD consiste &agrave; créer la liste des noms et des adresses TCP/IP des
différentes machines raccordées au réseau local. Cette liste est définie dans le
fichier <filename>/etc/hosts</filename>.</para>
<para>Par défaut, ce fichier ne contient qu'une ligne: le nom et l'adresse
de l'interface &ldquo;en boucle&rdquo;. Par convention, ce nom est toujours
&ldquo;localhost&rdquo; et son adresse 127.0.0.1. (Reportez-vous &agrave; l'exemple
de configuration des interfaces au paragraphe
<link linkend="verify-ether-if-config">Contrôler la configuration de l'interface Ethernet</link>.)</para>

<para>Pour éditer le fichier <filename>/etc/hosts</filename>, tapez la
commande:</para>
<para>
<userinput>
<prompt>#</prompt> ee /etc/hosts
</userinput>
</para>

<para>Allez jusqu'&agrave; la fin du fichier (en lisant au passage les commentaires,
ce sont des informations utiles!) et ajoutez (toujours dans le cas du
réseau de notre exemple) les noms et les adresses IP suivantes:</para>
<programlisting>
192.168.1.1   curly   curly.my.domain # machine FreeBSD
192.168.1.2   larry   larry.my.domain # machine Windows 95
192.168.1.3   moe     moe.my.domain   # machine Windows for Workgroups
192.168.1.4   shemp   shemp.my.domain # machine Windows NT
</programlisting>

<para>(Vous ne devez pas modifier la ligne
&ldquo;<command>127.0.0.1 localhost</command>&rdquo;.)</para>
<para>Une fois que vous avez ajouté ces lignes, appuyez sur la touche
<keycap>Echap</keycap> pour aller dans le menu de commandes de
l'éditeur. Choisissez
&ldquo;leave editor&rdquo; (quitter l'éditeur) et sélectionnez bien l'option
&ldquo;save changes&rdquo; (enregistrer les modifications) quand la question
vous est posée.</para>
</sect1>

<sect1>
<title>Tester le système FreeBSD</title>

<para>Félicitations! Une fois que vous en êtes arrivé l&agrave;, votre machine
FreeBSD est maintenant une machine UNIX connectée au réseau! Si vous avez
dû modifier votre fichier <filename>/etc/rc.conf</filename>, il faut
redémarrer votre machine FreeBSD. Cela va faire deux choses importantes:
<itemizedlist>

<listitem>
<para>Appliquer les modifications de configuration des interfaces,
et:</para>
</listitem>

<listitem>
<para>Vérifier que le système redémarre sans erreur de configuration
flagrante.</para>
</listitem>

</itemizedlist>
</para>

<para>Une fois que le système a redémarré, vous devriez tester vos interfaces réseaux.</para>

<sect2>
<title>Vérifier le bon fonctionnement de l'interface
&ldquo;en boucle&rdquo;</title>

<para>Pour vérifier que l'interface &ldquo;en boucle&rdquo; est correctement
configurée, ouvrez une session sous &ldquo;root&rdquo; et tapez:</para>
<para>
<userinput><prompt>#</prompt> ping localhost</userinput>
</para>
<para>Vous devriez voir défiler des messages du type:</para>
<para>
<userinput><prompt>#</prompt> ping localhost</userinput>
<screen>
PING localhost.my.domain. (127.0.0.1): 56 bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=255 time=0.219 ms
64 bytes from 127.0.0.1: icmp_seq=1 ttl=255 time=0.200 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=255 time=0.187 ms
[...]
</screen>
</para>

<para>jusqu'&agrave; ce que vous tapiez
<keycombo><keycap>Ctrl</keycap><keycap>C</keycap></keycombo>
pour arrêter ce délire.</para>
</sect2>

<sect2>
<title>Vérifier le bon fonctionnement de l'interface Ethernet</title>

<para>Pour vérifier que l'interface Ethernet est correctement
configurée, tapez:</para>

<para>
<userinput><prompt>#</prompt> ping curly</userinput>
</para>
<para>Vous devriez voir:</para>
<para>
<userinput><prompt>#</prompt> ping curly</userinput>
<screen>
PING curly.my.domain. (192.168.1.1): 56 bytes
64 bytes from 192.168.1.1: icmp_seq=0 ttl=255 time=0.219 ms
64 bytes from 192.168.1.1: icmp_seq=1 ttl=255 time=0.200 ms
64 bytes from 192.168.1.1: icmp_seq=2 ttl=255 time=0.187 ms
[...]
</screen>
</para>

<para>L'information importante dans ces deux exemples est que les noms
(&ldquo;localhost&rdquo; et &ldquo;curly&rdquo;) correspondent bien
&agrave; leurs adresses IP (127.0.0.1 et 192.168.1.1). Cela confirme que le fichier
<filename>/etc/hosts</filename> est correct.</para>

<para>Si l'adresse IP pour "curly" n'est pas 192.168.1.1 ou que l'adresse pour "localhost" n'est pas 127.0.0.1, retournez au paragraphe <link linkend="list-lan-hosts">Pouet Pouet</link>.</para>

<para>Si les noms et les adresses apparaîssent correctement dans les résultats
de la commande <command>ping</command> mais que des messages d'erreur sont
affichés, quelque chose ne va pas dans la configuration des interfaces.
Retournez au paragraphe <link linkend="system-config">Contrôler le nom de la machine FreeBSD</link> et
vérifiez de nouveau votre configuration.</para>

<para>Si maintenant, tout va bien, passez &agrave; la section suivante.</para>

</sect2>
</sect1>

</chapter>

<chapter>
<title>Configurer la liaison PPP vers l'extérieur</title>

<para>Il y a deux façons d'utiliser le programme <command>ppp</command>: en
mode &ldquo;Interactif&rdquo; et en mode &ldquo;Automatique&rdquo;.</para>
<para>En mode Interactif, vous:</para>

<para>
<itemizedlist>

<listitem>
<para>Etablissez manuellement la connexion avec votre fournisseur d'accès
Internet,</para>
</listitem>

<listitem>
<para>Surfez, transférez des fichiers et envoyez du courrier
électronique, etc.</para>
</listitem>

<listitem>
<para>Coupez manuellement la connexion avec votre fournisseur d'accès
Internet.</para>
</listitem>

</itemizedlist>
</para>

<para>En mode Automatique, le programme <command>ppp</command> surveille
silencieusement les opérations du système FreeBSD et se connecte et se
déconnecte automagiquement &agrave; votre fournisseur d'accès selon le besoin,
intégrant de façon transparente l'Internet &agrave; votre réseau.</para>

<para>Dans cette section, les configurations pour les deux modes seront étudiées avec un approfondissement sur la configuration du mode Automatique.</para>

<sect1>
<title>Sauvegarder vos fichiers de configuration <command>ppp</command>
d'origine</title>

	<note>
	  <para>Les versions les plus récentes de FreeBSD possèdent des fichiers d'exemple dans <filename>/usr/share/examples/ppp</filename>, aussi, cette étape peut ne pas être nécessaire.</para>
	</note>

<para>Avant de modifier les fichiers qu'utilise <command>ppp</command>, il
est bon de sauvegarder les fichiers par défaut créés &agrave; l'installation de
FreeBSD.</para>

<para>Ouvrez une session sous le compte &ldquo;root&rdquo;, et suivez la
procédure ci-dessous:</para>

<para>Allez dans le répertoire <filename>/etc</filename>:</para>
<para>
<userinput>
<prompt>#</prompt> cd etc
</userinput>
</para>
<para>Faites un copie des fichiers d'origine du répertoire
<filename>ppp</filename>:</para>

<para>
<userinput>
<prompt>#</prompt> cp -R ppp ppp.ORIGINAL
</userinput>
</para>

<para>Vous devriez maintenant avoir un répertoire <filename>ppp</filename>
et un répertoire <filename>ppp.ORIGINAL</filename> dans le répertoire
<filename>etc</filename>.</para>

</sect1>

<sect1>
<title>Créer vos propres fichiers de configuration de
<command>ppp</command></title>

<para>Par défaut, la procédure d'installation de FreeBSD crée un certain
nombre de fichiers d'exemple de configuration dans le répertoire <filename>/etc/ppp</filename>.
Prenez un peu de temps pour parcourir ces fichiers. Ce sont des exemples
empruntés &agrave; des systèmes qui fonctionnent et ils illustrent les différentes
possibilités du programme <command>ppp</command>.</para>
<para>Je vous encourage <emphasis>fortement</emphasis> &agrave; étudier ces exemples
et &agrave; les adapter &agrave; votre configuration.</para>
<para>Pour plus d'informations sur le programme <command>ppp</command>, lisez
les pages de manuel:</para>
<para>
<userinput>
<prompt>#</prompt> man ppp
</userinput>
</para>

<para>Pour plus d'informations sur le langage <command>chat</command>, utilisé
par <command>ppp</command> pour établir la connexion, lisez les pages de
manuel:</para>
<para>
<userinput>
<prompt>#</prompt> man chat
</userinput>
</para>

<para>La suite de cette section décrit le contenu recommandé des fichiers
de configurations de <command>ppp</command>.</para>

<sect2>
<title>Le fichier <filename>/etc/ppp/ppp.conf</filename></title>

<para>Le fichier <filename>/etc/ppp/ppp.conf</filename> contient les
informations et les paramètres nécessaires pour établir une connexion
vers l'extérieur. Le
<ulink url="&url.handbook;index.html">Manuel
FreeBSD</ulink> décrit en détail le contenu et la syntaxe de ce fichier.</para>

<para>N'est décrite ici que la configuration minimale nécessaire pour arriver
&agrave; établir une connexion.</para>

<para>Voici le fichier <filename>/etc/ppp/ppp.conf</filename> que nous
utiliserons sur notre passerelle entre le réseau local et l'Internet:</para>
<para>
<programlisting>
####################################################################
# Fichier de Configuration de PPP ('/etc/ppp/ppp.conf')
#
# Paramètres par défaut: Ces commandes sont toujours exécutées
# quand PPP est appelé et s'appliquent &agrave; toutes les configurations
####################################################################
default:
set device /dev/cuaa0
set speed 57600
disable pred1
deny pred1
disable lqr
deny lqr
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" ATE1Q0M0
OK-AT-OK\\dATDT\\T TIMEOUT 40 CONNECT"
set redial 3 10
#
#
####################################################################
#
# Configuration utilisée en mode interactif :
#
# appelée par: `ppp -alias interactive`
#
####################################################################
interactive:
set authname Your_User_ID_On_Remote_System
set authkey Your_Password_On_Remote_System
set phone 1-800-123-4567
set timeout 300
set openmode active
accept chap
#
####################################################################
#
# Configuration utilisée en mode &agrave; la demande ( automatique)
#
# appelée par: 'ppp -auto -alias demand'
#
####################################################################
demand:
set authname Your_User_ID_On_Remote_System
set authkey Your_Password_On_Remote_System
set phone 1-800-123-4567
set timeout 300
set openmode active
accept chap
set ifaddr 127.1.1.1/0 127.2.2.2/0 255.255.255.0
add 0 0 127.2.2.2
################################################################
# Fin de /etc/ppp/ppp.conf
</programlisting>
</para>
<para>Ce fichier, recopié tel quel d'un système opérationnel, comporte trois
parties:</para>


<sect3>
<title>La section &ldquo;default&rdquo;</title>

<para> La section &ldquo;default:&rdquo; contient les informations et
paramètres utilisés par toutes les autres sections du fichier. Cette section
est donc implicitement ajoutée &agrave; toutes les autres.</para>

<para>C'est l'endroit idéal pour définir les valeurs par défaut qui s'appliquent
&agrave; toutes les connexions vers l'extérieur; en particulier, la configuration
du modem et le dialogue d'initialisation de la connexion, qui ne changent
pas, quel que soit le système distant auquel vous vous connectez.</para>

<para>Voici le détail de chacune des lignes de la section
&ldquo;default:&rdquo; du fichier
<filename>/etc/ppp/ppp.conf</filename>:</para>
<para>
<programlisting>
set device /dev/cuaa0
</programlisting>
</para>

<para>Cette instruction dit au programme <command>ppp</command> d'utiliser le
premier port série. Sous FreeBSD, le périphérique &ldquo;/dev/cuaa0&rdquo;
correspond au port appelé &ldquo;COM1:&rdquo; de DOS, Windows, Windows 95,
etc.</para>

<para>Si votre modem est sur le port &ldquo;COM2&rdquo;: vous devrez mettre
&ldquo;/dev/cuaa1&rdquo;. &ldquo;/dev/cuaa2&rdquo; serait le port
&ldquo;COM3:&rdquo;.</para>

<para>
<programlisting>
set speed 57600
</programlisting>
</para>

<para>Cette ligne indique au programme <command>ppp</command> la vitesse
en émission et en réception entre le port série et le modem. Bien que le modem
de notre configuration fonctionne &agrave; 28.8 Kbps, donner la valeur 57600 permet
&agrave; la liaison série de fonctionner suffisamment vite pour gérer la compression de
données intégrée aux modems les plus récents.</para>

<para>Si vous avez des problèmes pour dialoguer avec votre modem &agrave; cette
vitesse, descendez &agrave; une valeur inférieure: 38400, voir aussi faible que
19200.</para>

<para>
<programlisting>
disable pred1
deny pred1
</programlisting>
</para>
<para>Ces deux lignes désactivent la compression &ldquo;CCP/Predictor 1&rdquo;
dont est capable le programme <command>ppp</command>. La version actuelle
de <command>ppp</command> supporte la compression de données selon la
définition provisoire des standards Internet. Malheureusement, de nombreux
fournisseurs d'accès ont des équipements qui n'offrent pas cette possibilité.
Comme la plupart des modems récents sont capables de compression &agrave; la volée,
vous ne perdrez probablement pas grand-chose en termes de performances en
désactivant cette possibilité sur votre machine FreeBSD et en interdisant
au site distant de vous la réclamer.</para>

<para>
<programlisting>
disable lqr
deny lqr
</programlisting>
</para>

<para>Ces deux lignes contrôlent l'&ldquo;audit de la qualité de la
liaison (Link Quality Reporting)&rdquo; qui est partie intégrante des
spécifications du protocole PPP.
(Voyez la RFC-1989 pour plus de détails.)</para>

<para>La première ligne, &ldquo;disable lqr&rdquo; instruit le programme
<command>ppp</command> de ne pas émettre de demandes de contrôle de la
qualité de la liaison &agrave; la machine distante.</para>

<para>La seconde ligne, &ldquo;deny lqr&rdquo; instruit le progamme
<command>ppp</command> de ne pas accepter de demandes de contrôle de la
qualité de la liaison de la machine distante.</para>

<para>Comme la plupart des modems ont des procédures intégrées de détection et
de correction d'erreur et que l'audit LQR est rarement intégralement
implémentée par les constructeurs, il vaut en général mieux ne pas utiliser
cette possibilité.</para>
<para>
<programlisting>
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\
" ATE1Q0M0 OK-AT-OK\\dATADT\\T TIMEOUT 40 CONNECT"
</programlisting>
</para>
<note><para>(Cette instruction doit être écrite sur une seule ligne; ne tenez
pas compte du formatage sur deux lignes, si elle se présente ainsi dans ce
document.)</para>
</note>

<para>Cette ligne décrit le dialogue entre le programme <command>ppp</command>
et le modem qui doit permettre d'établir la connexion et fournit des
instructions rudimentaires sur la marche &agrave; suivre:
<itemizedlist>

<listitem>
<para>Une tentative d'appel échoue si le modem renvoie le code d'erreur
&ldquo;BUSY (occupé)&rdquo;,</para>
</listitem>

<listitem>
<para>Une tentative d'appel échoue aussi si le modem renvoie le code d'erreur
&ldquo;NO CARRIER (pas de porteuse),&rdquo;,</para>
</listitem>

<listitem>
<para>Le programme <command>ppp</command> doit constater, avec
un délai maximum de cinq secondes entre chaque événement, la séquence
d'événements suivants:
<itemizedlist>

<listitem>
<para>Initialement, le programme <command>ppp</command> n'attend pas de
réponse du modem (c'est le sens de la chaîne <literal>\"\"</literal> dans
l'instruction),</para>
</listitem>

<listitem>
<para>Le programme enverra au modem la chaîne &ldquo;ATE1Q0M0&rdquo; et
attendra la réponse &ldquo;OK&rdquo;. Si cette réponse n'arrive pas, il enverra
la commande d'interrogation &ldquo;AT&rdquo; et attendra &agrave; nouveau une réponse
&ldquo;OK&rdquo;,</para>
</listitem>

<listitem>
<para>Le programme devra attendre une seconde (c'est le sens de la chaîne
&ldquo;\\d&rdquo; dans l'instruction), et envoyer la séquence d'appel au
modem. Le préfixe &ldquo;ATDT&rdquo; est la commande d'appel standard pour
les lignes téléphoniques &agrave; fréquences vocales. Si vous n'avez pas de ligne
&agrave; fréquence vocale, remplacez &ldquo;ATDT&rdquo; par &ldquo;ATDP&rdquo;.
La chaîne &ldquo;\\T&rdquo; sera remplacée par le numéro
de téléphone réel (qui sera défini plus loin par la ligne
&ldquo;set dial&rdquo;).</para>
</listitem>

</itemizedlist>
</para>

</listitem>

<listitem>
<para>Pour finir, avec un délai d'attente de quarante secondes au maximum,
le programme <command>ppp</command> doit recevoir un code d'acquittement
&ldquo;CONNECT&rdquo; du modem.</para>
</listitem>

</itemizedlist>
</para>

<para>Un échec &agrave; une phase quelconque de ce dialogue sera interpreté comme
un échec d'appel et la connexion ne sera pas établie.</para>

<para>(Pour avoir une description détaillée du mini-langage de commande
utilisé par <command>ppp</command>, reportez-vous aux pages de manuel de
<command>chat</command>.)</para>

<para>
<programlisting>
set redial 3 10
</programlisting>
</para>

<para>Cette ligne indique au programme <command>ppp</command> qu'en cas d'échec,
il peut faire jusqu'&agrave; trois nouvelles tentatives avec un temps d'attente de dix
secondes entre chaque nouvel appel.</para>

</sect3>
<sect3>
<title>La section &ldquo;interactive&rdquo;</title>

<para>La section &ldquo;interactive:&rdquo; contient les valeurs et les
paramètres utilisés par les connexions PPP interactives avec un système
distant particulier. Les lignes de la section &ldquo;default:&rdquo; sont
automatiquement incluses dans cette section.</para>

<para>L'exemple donné ci-dessous suppose que vous vous connectiez &agrave; un système
qui sait identifier un utilisateur sans avoir &agrave; utiliser une série de commandes
baroques. Nous supposerons que le protocole CHAP est utilisé pour initialiser
la session.</para>

<para>A priori, si un système Windows 95 peut établir la connexion d'un simple
clic sur le bouton &ldquo;Connecter&rdquo;, la configuration donnée en exemple
devrait fonctionner.</para>

<para>Si, &agrave; l'inverse, quand vous vous connectez chez votre fournisseur d'accès
avec les utilitaires de Microsoft Windows 95, vous devez utiliser l'option
&ldquo;Utiliser des procédures de connexion&rdquo;<footnote><para>N.d.T: ne
disposant du matériel nécessaire au contrôle de certains de ces libellés dans
les versions françisées de Windows, ils ont été traduits du document en langue
anglaise. En cas d'inexactitude, le lecteur voudra bien rectifier de
lui-même.</para></footnote>. il vous faudra alors
lire les pages de manuel de <command>ppp</command> pour trouver des exemples
de fichiers de configuration de PPP comportant des procédures
&ldquo;expect / reponse&rdquo; pour établir votre connexion et vous devrez
utiliser la commande &ldquo;set login&rdquo; &agrave; cet effet.</para>

<para>Ou mieux, trouvez-vous un fournisseur d'accès qui offre l'authentification
par PAP ou CHAP!</para>

<para>La configuration donnée en exemple a été utilisée avec succès pour se
connecter:
<itemizedlist>

<listitem>
<para>&agrave; Divers Shiva LanRovers,</para>
</listitem>

<listitem>
<para>au réseau IBM
(<ulink url="http://www.ibm.net">http://www.ibm.net</ulink>),</para>
</listitem>

<listitem>
<para>&agrave; AT&amp;T WorlNet
(<ulink url="http://www.att.com/worldnet">http://www.att.com/worldnet</ulink>),</para>
</listitem>

<listitem>
<para>&agrave; Erol's
(<ulink url="http://www.erols.com">http://www.erols.com</ulink>).</para>
</listitem>

</itemizedlist>
</para>

<para>Voici la description de chacune des lignes de la section
&ldquo;interactive:&rdquo; du fichier <filename>/etc/ppp/ppp.conf</filename>
de l'exemple:</para>

<para>
<programlisting>
set authname Votre_Nom_d_Utilisateur_du_Système_Distant
</programlisting>
</para>

<para>Cette ligne définit avec quel nom d'utilisateur vous vous connectez au
système distant.</para>

<para>
<programlisting>
set authkey Votre_Mot_de_Passe_Utilisateur_du_Système_Distant
</programlisting>
</para>

<para>Cette ligne définit le mot de passe que vous utilisez pour vous connecter
au système distant.</para>
<para>
<programlisting>
set phone 012345678789
</programlisting>
</para>

<para>C'est le numéro de téléphone avec lequel vous joignez le système
distant.</para>
<para>
<programlisting>
set timeout 300
</programlisting>
</para>

<para>Cette ligne indique au programme <command>ppp</command> de couper la ligne
s'il n'y a aucun échange pendant cinq minutes (300 secondes). Vous pouvez
adapter cette ligne &agrave; votre besoin particulier.</para>

<para>
<programlisting>
set openmode active
</programlisting>
</para>

<para>Cette ligne dit au programme <command>ppp</command> de négocier la
connexion dès que la liaison entre les modems est établie. Certains sites
distants le font automatiquement, d'autres non. Cette instruction permet
&agrave; votre site d'initialiser la négociation.</para>

<para>
<programlisting>
accept chap
</programlisting>
</para>

<para>Cette ligne dit au programme <command>ppp</command> d'utiliser le
protocole CHAP &ldquo;Challenge Handsake Autentification Protocole
(protocole d'authentification par poignée de main avec défi de
décryptage)&rdquo; pour vous authentifier. Les valeurs échangées entre le
système local et le système distant pour transmettre le nom d'utilisateur
et le mot de passe sont définies par les lignes &ldquo;authname&rdquo; et
&ldquo;authkey&rdquo;.</para>

</sect3>

<sect3>
<title>La section &ldquo;demand&rdquo;</title>

<para>La section &ldquo;demand:&rdquo; contient les valeurs et les
paramètres utilisés par les connexions PPP automatiques avec un système
distant particulier. Les lignes de la section &ldquo;default:&rdquo; sont
automatiquement incluses dans cette section.</para>

<para>A l'exception des deux dernières lignes, cette section est identique &agrave;
la section qui définit la configuration &ldquo;interactive&rdquo;.</para>

<para>Comme indiqué plus tôt, les exemples donnés
dans cette section suppose que vous vous connectiez &agrave; un système
qui comprenne le protocole CHAP pour initialiser
la session.</para>

<para>Voici la description de chacune des lignes de la section
&ldquo;demand:&rdquo; du fichier <filename>/etc/ppp/ppp.conf</filename>
de l'exemple:</para>

<para>
<programlisting>
set authname Votre_Nom_d_Utilisateur_du_Système_Distant
</programlisting>
</para>

<para>Cette ligne définit avec quel nom d'utilisateur vous vous connectez au
système distant.</para>

<para>
<programlisting>
set authkey Votre_Mot_de_Passe_Utilisateur_du_Système_Distant
</programlisting>
</para>

<para>Cette ligne définit le mot de passe que vous utilisez pour vous connecter
au système distant.</para>

<para>
<programlisting>
set phone 012345678789
</programlisting>
</para>

<para>C'est le numéro de téléphone avec lequel vous joignez le système
distant.</para>

<para>
<programlisting>
set timeout 300
</programlisting>
</para>

<para>Cette ligne indique au programme <command>ppp</command> de couper la ligne
s'il n'y a aucun échange pendant cinq minutes (300 secondes). Vous pouvez
adapter cette ligne &agrave; votre besoin particulier.</para>

<para>
<programlisting>
set openmode active
</programlisting>
</para>

<para>Cette ligne dit au programme <command>ppp</command> de négocier la
connexion dès que la liaison entre les modems est établie. Certains sites
distants le font automatiquement, d'autres non. Cette instruction permet
&agrave; votre site d'initialiser la négociation.</para>

<para>
<programlisting>
accept chap
</programlisting>
</para>

<para>Cette ligne dit au programme <command>ppp</command> d'utiliser le
protocole CHAP &ldquo;Challenge Handsake Autentification Protocole
(protocole d'authentification par poignée de
main avec défi de décryptage)&rdquo;
pour vous authentifier. Les valeurs échangées entre le système local et le
système distant pour transmettre le nom d'utilisateur et le mot de passe
sont définies par les lignes &ldquo;authname&rdquo; et
&ldquo;authkey&rdquo;</para>

<para>
<programlisting>
set ifaddr 127.1.1.1/0 127.2.2.2/0 255.255.255.0
</programlisting>
</para>

<para>Cette commande définit une paire d'adresses IP fictives pour les deux
extrémités de la liaison point-&agrave;-point. Elle dit au programme
<command>ppp</command> d'utiliser l'adresse 127.1.1.1 pour l'extrémité locale
de la liaison gérée par le pilote de périphérique
&ldquo;tun0 (tunnel)&rdquo;(Reportez-vous au <ulink url="&url.handbook;index.html">manuel FreeBSD</ulink> pour une
description de ce pilote) et l'adresse 127.2.2.2 pour l'extrémité distante.
Le &ldquo;/0&rdquo; qui les suit précise le nombre de digits significatifs de
ces adresses, qui peuvent, (et doivent en fait) être négociées entre les
deux systèmes une fois la liaison établie. 255.255.255.0 est le masque de
sous-réseau qui s'applique &agrave; ces deux pseudo-interfaces.</para>

<para>Rappelez-vous, nous avons supposé que votre fournisseur d'accès vous
assigne les adresses des deux extrémités de la ligne! Si votre fournisseur
vous a donné une adresse particulière, vous pouvez la mentionner sur cette
ligne <emphasis>&agrave; la place</emphasis> de l'adresse 127.1.1.1.</para>

<para>Inversement, si votre fournisseur vous a donné une adresse particulière
pour son côté de la liaison, vous pouvez la mentionner sur cette
ligne <emphasis>&agrave; la place</emphasis> de l'adresse 127.2.2.2.</para>

<para>Dans les deux cas, il vaut mieux conserver le &ldquo;/0&rdquo; après les
deux adresses. Cela laisse la possibilité au programme <command>ppp</command>
de changer d'adresse(s) <emphasis>s'il en a besoin</emphasis>.</para>

<para>
<programlisting>
add 0 0 127.2.2.2
</programlisting>
</para>

<para>Cette dernière ligne dit au programme <command>ppp</command> d'ajouter une
route par défaut pour le trafic vers l'adresse (fictive) 127.2.2.2 du
fournisseur d'accès.</para>

<note>
<para>Si vous avez donnée l'adresse que vous a indiqué votre fournisseur d'accès
&agrave; la place de l'adresse 127.2.2.2 &agrave; la ligne &ldquo;set ifaddr&rdquo;, vous
devez utiliser la même adresse ici, &agrave; la place de 127.2.2.2.</para>
</note>

<para>En ajoutant cette route &ldquo;fictive&rdquo; pour le trafic IP, le
programme <command>ppp</command> peut, successivement, avant et au moment
d'établir la liaison:
<itemizedlist>

<listitem>
<para>Accepter des paquets que FreeBSD ne sait pas encore comment
rediriger,</para>
</listitem>

<listitem>
<para>Etablir la connexion avec votre fournisseur d'accès &ldquo;&agrave; la volé&rdquo;,</para>
</listitem>

<listitem>
<para>Reconfigurer les adresses IP des deux côtés de la ligne,</para>
</listitem>

<listitem>
<para>Transmettre les paquets entre votre sytème local et votre fournisseur
d'accès,</para>
</listitem>

</itemizedlist>
automatiquement!</para>

<para>Une fois le nombre de secondes défini par l'instruction
&ldquo;timeout&rdquo; de la section &ldquo;default&rdquo; écoulé sans
trafic TCP/IP, le programme <command>ppp</command> coupe automatiquement la
connexion, et le processus peut recommencer.</para>

</sect3>
</sect2>

<sect2>
<title>Le fichier <filename>/etc/ppp/ppp.linkup</filename></title>

<para>L'autre fichier nécessaire &agrave; la configuration de <command>ppp</command>
est <filename>/etc/ppp/ppp.linkup</filename>. Ce fichier contient les
instructions qui définissent ce que <command>ppp</command> doit faire une
fois que la connexion est établie.</para>

<para>Dans le cas d'une connexion &agrave; la demande, le programme
<command>ppp</command> doit supprimer la route par défaut vers l'adresse IP
fictive du système distant (127.2.2.2 dans notre exemple plus haut) et
définir une nouvelle route vers l'adresse IP réelle de ce système (obtenue
&agrave; l'établissement de la connexion).</para>

<para>Voici un bon exemple de fichier
<filename>/etc/ppp/ppp.linkup</filename>:</para>
<para>
<programlisting>
#########################################################################=
#
# Fichier PPP Link Up ('/etc/ppp/ppp.linkup')
#
#  Ce fichier est consulté une fois que PPP a établi une connexion
#
#  Ce fichier est lu dans l'ordre suivant :
#
#  1) En premier, l'adresse IP qui nous a été assignée est recherchée
#     et la/les commande(s) associée(s) exécutée(s)
#
#  2) Si l'adresse IP n'est pas trouvée, alors l'étiquette donnée au
#     démarrage de PPP est recherchée, et la/les commande(s) associée(s)
#     exécutée(s)
#
#  3) Si ni l'une ni l'autre n'ont été trouvées, les commandes associées
#     &agrave; l'étiquette 'MYADDR:' sont exécutées.
#
#########################################################################=

#
# Cette section correspond &agrave; la configuration "demand" de
#    /etc/ppp/ppp.conf:
demand:
delete ALL
add 0 0 HISADDR
#
# Toutes les autres configurations de /etc/ppp/ppp.conf utilisent
#    ce qui suit:
#
MYADDR:
add 0 0 HISADDR
########################################################################
# Fin de /etc/ppp/ppp.linkup
</programlisting>
</para>

<para>Remarquez qu'une section de ce fichier s'appelle &ldquo;demand:&rdquo;,
tout comme dans le fichier <filename>/etc/ppp/ppp.conf</filename>. Cette section
dit au programme <command>ppp</command> ce qu'il doit faire, une fois la
connexion &agrave; la demande établie:
<orderedlist>

<listitem>
<para>Supprimer toutes les informations de routage qu'il a déj&agrave; créées,</para>
</listitem>

<listitem>
<para>Ajouter une route par défaut vers l'adresse réelle de la machine
distante.</para>
</listitem>

</orderedlist>
</para>

<para>Il est capital que les configurations définies dans le fichier
<filename>/etc/ppp/ppp.conf</filename> et qui comportent les lignes
&ldquo;set ifaddr&rdquo; et &ldquo;add 0 0&rdquo; (i.e.: les configurations
de connexion &agrave; la demande) exécutent les instructions &ldquo;delete ALL&rdquo;
et &ldquo;add 0 0 HISADDR&rdquo; du fichier
<filename>/etc/ppp/ppp.linkup.</filename></para>

<para><emphasis><emphasis remap="bf">C'est le mécanisme qui contrôle la configuration de la liaison
dans le cas d'une connexion &agrave; la demande.</emphasis></emphasis></para>

<para>Toutes les configurations qui ne sont pas explicitement définies dans
le fichier <filename>/etc/ppp/ppp.linkup</filename> utiliseront les commandes
listées dans la section &ldquo;MYADDR:&rdquo; de ce fichier. C'est ce que
feront les connexions manuelles (comme dans notre exemple
&ldquo;interactive:&rdquo;). Cette section ajoute simplement une route par
défaut vers l'adresse IP du fournisseur d'accès (&agrave; l'autre extrémité de la
ligne).</para>

</sect2>
</sect1>

<sect1>
<title>Alias IP</title>

<para>Toutes les étapes précédentes s'appliquent &agrave; un systeme FreeBSD utilisé
pour se connecter &agrave; la demande &agrave; un fournisseur d'accès Internet.</para>

<para>Si vous cherchez simplement, en lisant ce guide, &agrave; connecter votre
systeme FreeBSD &agrave; l'Internet, vous pouvez passer directement au chapitre
<link linkend="testing-the-network">Tester le réseau</link>.</para>

<para>Une possibilité très intéressante du programme <command>ppp</command>
en mode &ldquo;connexion &agrave; la demande&rdquo; est sa capacité &agrave; aiguiller
automatiquement le trafic vers les autres systèmes du réseau local. On donne
&agrave; cela des noms divers &ldquo;alias IP (IP Aliasing)&rdquo;,
&ldquo;traduction d'adresse réseau (Network Adress Translation)&rdquo;,
&ldquo;mascarade d'adresse (Adress Masquerading)&rdquo; ou
&ldquo;mandatement transparent (Transparent Proxying)&rdquo;.</para>

<para>Quelle que soit la terminologie employée, ce fonctionnement n'est
cependant pas automatique. Si le programme <command>ppp</command> est démarré
de façon habituelle, il ne fera pas transiter de paquets entre l'interface avec
le réseau local et la liaison vers l'extérieur. En effet, seul le système
FreeBSD est connecté &agrave; l'Internet; les autres systèmes ne peuvent pas partager
la même connexion.</para>

<para>Par exemple, si le programme <command>ppp</command> est lancé par:</para>
<para>
<userinput>
<prompt>#</prompt> ppp interactive
</userinput>
</para>
<para>ou:</para>
<para>
<userinput>
<prompt>#</prompt> ppp -auto demand
</userinput>
</para>

<para>correspondant respectivement aux modes manuel et automatique, alors
il établira une connexion &agrave; l'Internet pour la <emphasis>seule</emphasis>
machine FreeBSD.</para>

<para>Pour démarrer le programme <command>ppp</command> pour l'utiliser comme
passerelle entre le réseau local et l'Internet, il faut utiliser l'une des
commandes suivantes:</para>
<para>
<userinput>
<prompt>#</prompt> ppp -alias interactive
</userinput>
</para>
<para>ou:</para>
<para>
<userinput>
<prompt>#</prompt> ppp -auto -alias demand
</userinput>
</para>

<para>Alternativement, vous pouvez utiliser l'instruction &ldquo;alias enable
yes&rdquo; dans votre fichier de configuration de <command>ppp</command>
(Reportez-vous aux pages de manuel pour plus de  détails).</para>

<para>Gardez cela présent &agrave; l'esprit si vous passez maintenant au chapitre
<link linkend="config-windows-system">Configurer les systèmes Windows</link>.</para>

</sect1>
</chapter>

<chapter id="config-windows-system">
<title>Configurer les Systèmes Windows</title>

<para>Comme indiqué au Chapitre <link linkend="lan">Mise en oeuvre du réseau local</link>,
le réseau de notre exemple
comporte un système FreeBSD (&ldquo;Curly&rdquo;) qui sert de passerelle
(ou routeur) pour un réseau local composé de trois moutures différentes
de systèmes Windows. Pour que ces stations puissent utiliser Curly comme
routeur, elles doivent être correctement configurées. Notez bien que l'on
ne vous explique pas ici comment configurer les postes Windows pour qu'ils
puissent se connecter eux-mêmes. Si vous cherchez de bonnes explications sur
le sujet, voyez
<ulink url="http://www.aladdin.co.uk/techweb">http://www.aladdin.co.uk/techweb</ulink>.</para>

<sect1>
<title>Configurer Windows 95</title>

<para>Il est relativement simple de configurer Windows 95 pour relier un poste
&agrave; votre réseau local. Le configuration réseau Windows 95 doit être légérement
modifiée pour pouvoir utiliser le système FreeBSD comme passerelle par défaut
vers votre fournisseur d'accès. Effectuez les étapes suivantes:</para>

<para><emphasis remap="bf">Créer le fichier Windows 95 <filename>hosts</filename></emphasis></para>

<para>Pour vous connecter aux autres postes TCP/IP du réseau local, vous devrez
installer une copie du fichier <filename>hosts</filename> que vous avez créé
sur votre système FreeBSD au paragraphe
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>.
<itemizedlist>

<listitem>
<para>Cliquez sur le bouton &ldquo;Démarrer&rdquo;, choisissez
&ldquo;Exécuter ...&rdquo;, lancez
<userinput>notepad \WINDOWS\HOSTS</userinput>
et cliquez sur &ldquo;OK&rdquo;,</para>
</listitem>

<listitem>
<para>Sous l'éditeur, entrez les noms et les adresses des machines
recopiés du fichier <filename>hosts</filename> du paragraphe
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>,</para>
</listitem>

<listitem><para>Une fois que c'est fait, quittez <command>notepad</command>
(assurez-vous d'avoir enregistré le fichier!).</para>
</listitem>

</itemizedlist>
</para>

<para><emphasis remap="bf">Définir le configuration réseau TCP/IP Windows 95</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur le bouton &ldquo;Démarrer&rdquo; de la barre de
tâches, Choisissez &ldquo;Paramètres&rdquo; et
&ldquo;Panneau de Configuration&rdquo;,</para>
</listitem>

<listitem>
<para>Double-cliquez sur l'icône réseau pour
l'ouvrir.</para>

<para>Les paramètres des éléments du réseau sont tous
affichés.</para>
</listitem>

<listitem>
<para>Sélectionnez l'option &ldquo;Configuration&rdquo; et faites
défiler la liste des composants installés pour choisir la ligne
&ldquo;TCP/IP -><replaceable>votre interface</replaceable>&rdquo; (où
<replaceable>votre interface</replaceable> est le nom ou le modèle de
votre contrôleur Ethernet),</para>

<para>Si &ldquo;TCP/IP&rdquo; ne figure pas dans la liste des composants
réseau installés, cliquez sur le bouton &ldquo;Ajouter&rdquo; pour
l'installer avant de continuer</para>

<tip>
<para>Ajouter | Protocoles | Microsoft | TCP/IP | OK.</para>
</tip>
</listitem>

<listitem>
<para>Cliquez sur le bouton &ldquo;Propriétés&rdquo; pour afficher
la liste des paramètres associés au composant TCP.</para>
</listitem>

</itemizedlist>
</para>

<para><emphasis remap="bf">Configurer les informations relatives &agrave; l'adresse IP</emphasis>
<itemizedlist>

<listitem>
<para>Choisissez l'onglet &ldquo;Adresse IP&rdquo;</para>
</listitem>

<listitem>
<para>Enfoncez le bouton &ldquo;Spécifier une adresse
IP&rdquo;.</para>

<para>(Dans notre exemple, le système Windows 95 est celui que nous avons
appelé &ldquo;Larry&rdquo;.)</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Adresse IP&rdquo;, entrez
&ldquo;192.168.1.2&rdquo;,</para>
</listitem>

<listitem>
<para>Entrez &ldquo;255.255.255.0&rdquo; dans le zone
&ldquo;Masque de Sous-réseau&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para><emphasis remap="bf">Configurer les informations relatives &agrave; la passerelle</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur l'onglet &ldquo;Passerelle&rdquo;.</para>

<para>Dans le réseau de notre exemple, c'est le système FreeBSD qui sera notre
passerelle vers l'Internet (routant les paquets entre le réseau local Ethernet
et la connexion PPP). Entrez l'adresse IP de l'interface Ethernet de la
machine FreeBSD, &ldquo;192.168.1.1&rdquo;, dans la zone
&ldquo;Nouvelle Passerelle&rdquo; et cliquez sur le bouton
&ldquo;Ajouter&rdquo;. S'il y a d'autres passerelles définies dans les
&ldquo;Passerelles Installées&rdquo;, peut-être devrez-vous les
supprimer.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives au DNS</emphasis></para>

<para>Nous supposons que votre fournisseur d'accès Internet vous a donné une
liste de serveurs de noms de domaines (Domain Name Servers)&nbsp;-&nbsp;ou
&ldquo;Serveurs DNS&rdquo;&nbsp;-&nbsp;que vous devez utiliser. Si vous voulez
mettre en service un serveur DNS sur votre machine FreeBSD, reportez-vous au
chapitre
<link linkend="exercices">Exercices pour l'étudiant intéressé</link> pour avoir des indications sur
l'installation d'un serveur DNS sur une machine FreeBSD.</para>

<para>
<itemizedlist>

<listitem>
<para>Cliquez sur l'onglet &ldquo;Configuration DNS&rdquo;,</para>
</listitem>

<listitem>
<para>Assurez-vous que l'option &ldquo;Activer DNS&rdquo; est
bien sélectionnée,</para>

<para>(Si cette option n'est pas sélectionnée, seules les machines définies dans
votre fichier <filename>hosts</filename> seront accessibles et vous ne pourrez
pas &ldquo;surfer&rdquo; comme vous le souhaitez!)</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Hôte&rdquo;, entrez le nom du poste
Windows 95, dans notre cas : &ldquo;Larry&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Domaine&rdquo;, entrez le nom du réseau
local, dans notre cas : &ldquo;my.domain&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Ordre de recherche DNS&rdquo;,
entrez les adresses
IP des serveurs DNS que votre fournisseur vous a données, cliquez sur
&ldquo;Ajouter&rdquo; &agrave; chaque adresse que vous définissez. Répétez l'opération
autant de fois que nécessaire pour entrer toutes les adresses que votre
fournisseur vous a indiquées.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Autres options TCP/IP Windows 95</emphasis></para>

<para>Pour nos besoins, les paramètres des sections &ldquo;Avancées&rdquo;,
&ldquo;Configuration WINS&rdquo; et &ldquo;Liens&rdquo; sont inutiles.</para>

<para>Si vous souhaitez utiliser le service de noms Internet de Windows
(Windows Internet Naming Service&nbsp;-&nbsp;&ldquo;WINS&rdquo;), vous trouverez
plus d'informations sur
<ulink url="http://www.localnet.org">http://www.localnet.org</ulink>,
en particulier en ce qui concerne le partage de fichiers de façon transparente
&agrave; travers l'Internet.</para>

<para>
<emphasis remap="bf">Pour finir</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Propriétés TCP/IP&rdquo;,</para>
</listitem>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Panneau de Contrôle Réseau&rdquo;,</para>
</listitem>

<listitem>
<para>Redémarrez votre ordinateur si on vous le demande.</para>
</listitem>

</itemizedlist>
</para>

<para>C'est tout!</para>

</sect1>

<sect1>
<title>Configurer Windows NT</title>

<para>Il est relativement simple de configurer Windows NT pour relier un poste
&agrave; votre réseau local. Les procédures sont semblables &agrave; celles suivies pour
Windows 95 &agrave; quelques différences près quant &agrave; l'interface utilisateur.</para>

<para>Les étapes décrites ci-dessous s'appliquent &agrave; Windows NT 4.0 Workstation,
mais les principes sont les mêmes pour Windows NT 3.5x. Si vous installez un
poste Windows NT 3.5x, vous pouvez vous référer
au paragraphe <link linkend="workgroups">Configurer Windows for Workgroups</link>, en
effet, l'interface utilisateur est la même pour NT 3.5x et WfW.</para>

<para>Effectuez les opérations suivantes:</para>

<para>
<emphasis remap="bf">Créer le fichier Windows NT <filename>hosts</filename></emphasis>
</para>

<para>Pour vous connecter aux autres postes TCP/IP du réseau local, vous devrez
installer une copie du fichier <filename>hosts</filename> que vous avez créé
sur votre système FreeBSD au paragraphe
<link linkend="workgroups">Configurer Windows for Workgroups</link>.
<itemizedlist>

<listitem>
<para>Cliquez sur le bouton &ldquo;Démarrer&rdquo;, choisissez
&ldquo;Exécuter ...&rdquo;, lancez
<userinput>notepad \WINDOWS\SYSTEM\DRIVERS\ETC\HOSTS</userinput>
et cliquez sur &ldquo;OK&rdquo;,</para>
</listitem>

<listitem>
<para>Sous l'éditeur, entrez les noms et les adresses des machines
recopiés du fichier <filename>hosts</filename> du paragraphe
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>,</para>
</listitem>

<listitem>
<para>Une fois que c'est fait, quittez <command>notepad</command>
(assurez-vous d'avoir enregistré le fichier!).</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Définir le configuration réseau TCP/IP Windows NT</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur le bouton &ldquo;Démarrer&rdquo; de la barre de
tâches, Choisissez &ldquo;Paramètres&rdquo; et
&ldquo;Panneau de Configuration&rdquo;,</para>
</listitem>

<listitem>
<para>Double-cliquez sur l'icône réseau pour
l'ouvrir,</para>
</listitem>

<listitem>
<para>Dans l'onglet &ldquo;Identification&rdquo;,
vérifiez les informations des zones &ldquo;Nom d'Ordinateur&rdquo; et
&ldquo;Workgroup&rdquo;. Dans notre exemple, &ldquo;Shemp&rdquo; sera
le nom de la machine, et &ldquo;Stooges&rdquo; celui du groupe de travail.
Choisissez &ldquo;Modifier&rdquo; pour corriger ces valeurs au
besoin,</para>
</listitem>

<listitem>
<para>Choisissez l'onglet &ldquo;Protocoles&rdquo;.</para>

<para>Les Protocoles Réseau installés seront affichés. Il peut y en avoir un
certain nombre, mais le seul qui nous intéresse ici est le
&ldquo;Protocole TCP/IP&rdquo;. Si le &ldquo;Protocole TCP/IP&rdquo;
n'apparaît pas dans la liste, cliquez sur le bouton &ldquo;Ajouter&rdquo;
pour l'installer.</para>

<tip>
<para>Ajouter | Protocole TCP/IP | OK.</para>
</tip>
</listitem>

<listitem>
<para>Sélectionnez &ldquo;Protocole TCP/IP&rdquo; et cliquez sur le
bouton &ldquo;Propriétés&rdquo;.</para>

<para>Les différentes propriétés associées &agrave; TCP/IP apparaîtront.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives &agrave; l'adresse IP</emphasis></para>

<para>Vérifiez que l'interface Ethernet est bien définie dans la zone
&ldquo;Carte Réseau&rdquo;; si ce n'est pas le cas, parcourez la
liste des contrôleurs jusqu'&agrave; ce que l'interface adéquate soit affichée.
<itemizedlist>

<listitem>
<para>Choisissez l'option &ldquo;Spécifier une Adresse IP&rdquo;
pour activer les trois zones de texte,</para>

<para>Dans notre exemple, le poste Windows NT est celui qui s'appele
&ldquo;Shemp&rdquo;.</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Adresse IP&rdquo;, entrez
&ldquo;192.168.1.4&rdquo;,</para>
</listitem>

<listitem>
<para>Entrez &ldquo;255.255.255.0&rdquo; dans le zone
&ldquo;Masque de Sous-réseau.&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives &agrave; la passerelle</emphasis></para>

<para>Dans le réseau de notre exemple, c'est le système FreeBSD qui sera notre
passerelle vers l'Internet (routant les paquets entre le réseau local Ethernet
et la connexion PPP).</para>
<itemizedlist>

<listitem>
<para>S'il n'y a rien encore dans la zone &ldquo;Nouvelle
Passerelle&rdquo;, entrez l'adresse IP de l'interface Ethernet de la
machine FreeBSD, &ldquo;192.168.1.1&rdquo;, dans cette zone
et cliquez sur le bouton &ldquo;Ajouter&rdquo;. Sinon, utilisez le bouton
"Avancées" et la fonction &ldquo;Ajouter&rdquo; pour ajouter cette nouvelle
passerelle.</para>

<para>S'il y a d'autres passerelles définies dans les
&ldquo;Passerelles Installées&rdquo;, peut-être devrez-vous les
supprimer.</para>
</listitem>

</itemizedlist>

<para>
<emphasis remap="bf">Configurer les informations relatives au DNS</emphasis></para>

<para>Nous supposons que votre fournisseur d'accès Internet vous a donné une
liste de serveurs de noms de domaines (Domain Name Servers)&nbsp;-&nbsp;ou
&ldquo;Serveurs DNS&rdquo;&nbsp;-&nbsp;que vous devez utiliser.</para>

<para>Si vous voulez
mettre en service un serveur DNS sur votre machine FreeBSD, reportez-vous
au chapitre
<link linkend="exercices">Exercices pour l'étudiant intéressé</link> pour avoir des indications sur
l'installation d'un serveur DNS sur une machine FreeBSD.
<itemizedlist>

<listitem>
<para>Cliquez sur le bouton &ldquo;DNS&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Nom d'Hôte&rdquo;, entrez le nom du poste
Windows NT, dans notre cas : &ldquo;Shemp&rdquo;,</para>
</listitem>

<listitem><para>Dans la zone &ldquo;Domaine&rdquo;, entrez le nom du réseau
local, dans notre cas : &ldquo;my.domain&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Ordre de recherche du service DNS&rdquo;,
entrez les adresses
IP des serveurs DNS que votre fournisseur vous a données, cliquez sur
&ldquo;Ajouter&rdquo; &agrave; chaque adresse que vous définissez. Répétez l'opération
autant de fois que nécessaire pour entrer toutes les adresses que votre
fournisseur vous a indiquées.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Autres options TCP/IP Windows NT</emphasis></para>

<para>Pour nos besoins, les paramètres des sections
&ldquo;Adresses WINS&rdquo; et &ldquo;Routage&rdquo; sont inutiles.</para>

<para>Si vous souhaitez utiliser le service de noms Internet de Windows
(Windows Internet Naming Service&nbsp;-&nbsp;&ldquo;WINS&rdquo;), vous trouverez
plus d'informations sur
<ulink url="http://www.localnet.org">http://www.localnet.org</ulink>,
en particulier en ce qui concerne le partage de fichiers de façon transparente
&agrave; travers l'Internet.</para>

<para>
<emphasis remap="bf">Pour finir</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Propriétés TCP/IP&rdquo;,</para>
</listitem>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Panneau de Contrôle Réseau&rdquo;,</para>
</listitem>

<listitem>
<para>Redémarrez votre ordinateur si on vous le demande.</para>
</listitem>

</itemizedlist>
</para>

<para>C'est tout!</para>

</sect1>

<sect1 id="workgroups">
<title>Configurer Windows for Workgroups</title>

<para>Pour qu'un poste Windows for Workgroups puisse être utilisé en réseau, il
faut avoir installé les pilotes qui sont sur la disquette Microsoft TCP/IP. Ces
pilotes ne sont pas inclus avec WfW et les disquettes qui vont avec. S'il vous
en faut une copie, ils sont disponibles sur
<ulink url="ftp://ftp.microsoft.com/peropsys/windows/public/tcpip">ftp://ftp.microsoft.com/peropsys/windows/public/tcpip.</ulink></para>

<para>Une fois que les pilotes TCP/IP ont été installés, effectuez les
opérations suivantes:</para>

<para>
<emphasis remap="bf">Créer le fichier Windows for Workgroups
<filename>hosts</filename></emphasis></para>

<para>Pour vous connecter aux autres postes TCP/IP du réseau local, vous devrez
installer une copie du fichier <filename>hosts</filename> que vous avez créé
sur votre système FreeBSD au paragraphe
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>.</para>
<itemizedlist>

<listitem>
<para>Dans le Gestionnaire de Programmes, cliquez sur le bouton
&ldquo;Fichier&rdquo;, choisissez &ldquo;Exécuter ...&rdquo;, lancez
<userinput>notepad \WINDOWS\HOSTS</userinput>
et cliquez sur &ldquo;OK&rdquo;,</para>
</listitem>

<listitem>
<para>Sous l'éditeur, entrez les noms et les adresses des machines
recopiés du fichier <filename>hosts</filename> de
<link linkend="list-lan-hosts">Renseigner la liste des autres machines du réseau</link>,</para>
</listitem>

<listitem>
<para>Une fois que c'est fait, quittez <command>notepad</command>
(assurez-vous d'avoir enregistré le fichier!).</para>
</listitem>

</itemizedlist>

<para>
<emphasis remap="bf">Définir le configuration réseau TCP/IP Windows for Workgroups</emphasis>
<itemizedlist>

<listitem>
<para>Dans le Gestionnaire de Programmes, ouvrez le groupe
&ldquo;Réseau&rdquo; en double-cliquant sur l'icône,</para>
</listitem>

<listitem>
<para>Double-cliquez sur l'icône &ldquo;Paramètres
Réseau&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la boîte de dialogue &ldquo;Pilotes Réseau&rdquo;,
double-cliquez sur l'option &ldquo;Microsoft TCP/IP-32&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives &agrave; l'adresse IP</emphasis></para>

<para>Vérifiez que l'interface Ethernet est bien définie dans la liste
&ldquo;Carte Réseau&rdquo;; si ce n'est pas le cas, parcourez la
liste des contrôleurs jusqu'&agrave; ce que l'interface adéquate soit affichée
et sélectionnez-la en cliquant dessus.
<itemizedlist>

<listitem>
<para>Vérifiez que l'option &ldquo;Activer la Configuration DHCP
Automatique&rdquo; n'est pas sélectionnée. Si c'est le cas, cliquez dessus
pour effacer le &ldquo;X&rdquo;.</para>
</listitem>

<listitem>
<para>Dans notre exemple, le poste Windows for Workgroups est celui
qui s'appelle &ldquo;Moe&rdquo;; dans la zone &ldquo;Adresse IP&rdquo;, entrez
&ldquo;192.168.1.3&rdquo;,</para>
</listitem>

<listitem>
<para>Entrez &ldquo;255.255.255.0&rdquo; dans le zone
&ldquo;Masque de Sous-réseau&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives &agrave; la passerelle</emphasis></para>

<para>Dans le réseau de notre exemple, c'est le système FreeBSD qui sera notre
passerelle vers l'Internet (routant les paquets entre le réseau local Ethernet
et la connexion PPP).
<itemizedlist>

<listitem>
<para>Entrez l'adresse IP de l'interface Ethernet de la
machine FreeBSD, &ldquo;192.168.1.1&rdquo;, dans la zone
&ldquo;Passerelle par Défaut&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Configurer les informations relatives au DNS</emphasis></para>

<para>Nous supposons toujours que votre fournisseur d'accès Internet vous a
donné une liste de serveurs de noms de domaines (Domain Name Servers)&nbsp;-&nbsp;ou
&ldquo;Serveurs DNS&rdquo;&nbsp;-&nbsp;que vous devez utiliser.</para>
<para>Si vous voulez
mettre en service un serveur DNS sur votre machine FreeBSD, reportez-vous
au chapitre
<link linkend="exercices">Exercices pour l'étudiant intéressé</link> pour avoir des indications sur
l'installation d'un serveur DNS sur une machine FreeBSD.
<itemizedlist>

<listitem>
<para>Cliquez sur l'onglet &ldquo;Configuration DNS&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Hôte&rdquo;, entrez le nom du poste
Windows for Workgroups, dans notre cas : &ldquo;Moe&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Domaine&rdquo;, entrez le nom du réseau
local, dans notre cas : &ldquo;my.domain&rdquo;,</para>
</listitem>

<listitem>
<para>Dans la zone &ldquo;Ordre de recherche DNS&rdquo;,
entrez les adresses
IP des serveurs DNS que votre fournisseur vous a données, cliquez sur
&ldquo;Ajouter&rdquo; &agrave; chaque adresse que vous définissez. Répétez l'opération
autant de fois que nécessaire pour entrer toutes les adresses que votre
fournisseur vous a indiquées,</para>
</listitem>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Configuration DNS&rdquo;.</para>
</listitem>

</itemizedlist>
</para>

<para>
<emphasis remap="bf">Pour finir</emphasis>
<itemizedlist>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Propriétés TCP/IP&rdquo;,</para>
</listitem>

<listitem>
<para>Cliquez sur &ldquo;OK&rdquo; pour fermer la fenêtre
&ldquo;Panneau de Contrôle Réseau&rdquo;,</para>
</listitem>

<listitem>
<para>Redémarrez votre ordinateur si on vous le demande.</para>
</listitem>

</itemizedlist>
</para>

<para>C'est tout!</para>

</sect1>
</chapter>

<chapter id="testing-the-network">
<title>Tester le réseau</title>

<para>Une fois que vous aurez terminé les opérations nécessaires décrites plus
haut, votre passerelle PPP vers l'Internet devrait être opérationnelle.</para>

<sect1>
<title>Tester la connexion vers l'extérieur</title>

<para>La première chose &agrave; vérifier est que la connexion s'établisse entre votre
modem et votre fournisseur d'accès.</para>

</sect1>

<sect1>
<title>Tester le réseau local</title>

<para>*** &agrave; faire ***</para>

</sect1>
</chapter>

<chapter id="exercices">
<title>Exercices pour l'étudiant intéressé</title>

<sect1>
<title>Gérer un mini-DNS</title>

<para>Bien que gérer une hiérarchie du service de noms de domaines
(&ldquo;Domain Name Service&rdquo;&nbsp;-&nbsp;DNS) puisse être une tâche
diabolique, il est tout &agrave; fait faisable d'installer un mini-serveur
DNS sur le sytème FreeBSD qui vous sert aussi de passerelle vers votre
fournisseur d'accès.</para>

<para>A partir des fichiers existants dans <filename>/etc/namedb</filename>
après installation de FreeBSD, il est possible de définir un serveur DNS qui
ait autorité sur le réseau de notre exemple et serve d'interface avec
l'architecture DNS de l'Internet.</para>

<para>Pour cette configuration minimale, il suffit de trois fichiers:</para>
<itemizedlist>
<listitem>
<para><filename>/etc/namedb/named.boot</filename></para>
</listitem>
<listitem>
<para><filename>/etc/namedb/named.root</filename></para>
</listitem>
<listitem>
<para><filename>/etc/namedb/mydomain.db</filename></para>
</listitem>

</itemizedlist>

<para>Le fichier <filename>/etc/namedb/named.root</filename> est automatiquement
initialisé &agrave; l'installation de FreeBSD, les deux autres fichiers doivent être
renseignés manuellement.</para>


<sect2>
<title>Le fichier <filename>/etc/namedb/named.boot</filename></title>

<para>Le fichier <filename>/etc/namedb/named.boot</filename> décrit la
configuration initiale du serveur DNS. Essentiellement, il indique au
serveur de noms:
<orderedlist>

<listitem>
<para>Où sont les fichiers de configuration,</para>
</listitem>

<listitem>
<para>De quels &ldquo;noms de domaines&rdquo; il a la
responsabilité,</para>
</listitem>

<listitem>
<para>Où trouver les autres serveurs DNS.</para>
</listitem>

</orderedlist>
</para>

<para>Avec l'éditeur <command>ee</command>, créez un fichier
<filename>/etc/namedb/named.boot</filename> comme suit:
<programlisting>

; fichier de démarrage pour un mini-serveur de noms de domaines

directory       /etc/namedb

; type    domain             source machine/fichier   fichier de sauvegarde

cache     .                  named.root
primary   my.domain.         mydomain.db
</programlisting>
</para>

<para>Les lignes qui commencent par un point-virgule sont des commentaires.
Voici la signification des autres lignes:
<itemizedlist>

<listitem>
<programlisting>
directory /etc/namedb
</programlisting>

<para>Dit au serveur de noms où trouver les fichiers de configuration référencés
dans la suite du fichier <filename>/etc/namedb/named.boot</filename>.</para>
</listitem>

<listitem>
<para>
<programlisting>
cache . named.root
</programlisting>
</para>

<para>Dit au serveur de noms que la liste des serveurs de la racine (&ldquo;Root
Servers&rdquo;) se trouve dans le fichier <filename>named.root</filename>. (Ce
fichier est inclus dans l'installation standard et n'est pas décrit ici.)</para>
</listitem>

<listitem>
<para>
<programlisting>
primary my.domain mydomain.db
</programlisting>
</para>

<para>Dit au serveur de noms qu'il a &ldquo;autorité&rdquo; sur un domaine DNS
appelé &ldquo;my.domain&rdquo; et que la liste des adresses IP des machines
du domaine &ldquo;my.domain&rdquo; (le réseau local) se trouve dans le fichier
<filename>/etc/namedb/mydomain.db</filename>.
</para>
</listitem>

</itemizedlist>
</para>

<para>Une fois créé et sauvegardé le fichier
<filename>/etc/namedb/named.boot</filename>, passez &agrave; l'étape suivante pour
créer le fichier <filename>/etc/namedb/named.db</filename>.</para>

</sect2>

<sect2>
<title>Le fichier <filename>/etc/namedb/named.db</filename></title>

<para>Le fichier <filename>/etc/namedb/named.boot</filename> liste les noms
et les adresses IP de <emphasis>toutes</emphasis> les machines du réseau
local.</para>

<para><emphasis>Pour une description détaillée des instructions de ce fichier,
reportez-vous aux pages de manuel de <command>named</command>.</emphasis></para>

<para>Le fichier <filename>/etc/namedb/named.boot</filename> de notre serveur
DNS minimum contient les lignes suivantes:</para>
<para>
<programlisting>
@       IN SOA  my.domain. root.my.domain.  (
			       961230  ; Serial
			       3600    ; Refresh
			       300     ; Retry
			       3600000 ; Expire
			       3600 )  ; Minimum
       IN NS   curly.my.domain.

curly.my.domain.        IN A    192.168.1.1     # The FreeBSD box
larry.my.domain.        IN A    192.168.1.2     # The Win'95 box
moe.my.domain.          IN A    192.168.1.3     # The WfW box
shemp.my.domain.        IN A    192.168.1.4     # The Windows NT box

$ORIGIN 1.168.192.IN-ADDR.ARPA
  	        IN NS   curly.my.domain.
1               IN PTR  curly.my.domain.
2               IN PTR  larry.my.domain.
3               IN PTR  moe.my.domain.
4               IN PTR  shemp.my.domain.

$ORIGIN 0.0.127.IN-ADDR.ARPA
	        IN NS   curly.my.domain.
1               IN PTR  localhost.my.domain.
</programlisting>
</para>

<para>Brièvement, ce fichier déclare que le serveur DNS local est:
<itemizedlist>

<listitem>
<para>Le &ldquo;Début d'Autorité&rdquo; (Start Of Authority) pour
le domaine appelé &ldquo;my.domain&rdquo;,</para>
</listitem>

<listitem>
<para>Le serveur de noms (Name Server&nbsp;-&nbsp;&ldquo;NS&rdquo;) pour
&ldquo;my.domain&rdquo;,</para>
</listitem>

<listitem>
<para>Responsable de la résolution inverse des adresses IP qui
commencent par &ldquo;192.168.1&rdquo; et &ldquo;127.0.0&rdquo;
(&ldquo;$ORIGIN ...&rdquo;).</para>
</listitem>

</itemizedlist>
</para>

<para>Pour ajouter de nouvelles machines, vous devez ajouter deux lignes pour
chaque système; une dans la section du haut où les noms des systèmes sont
associés aux adresses Internet (&ldquo;IN A&rdquo;), et une autre ligne qui
associe inversement l'adresse au nom de la machine (&ldquo;IN PTR&rdquo;),
dans la section
&ldquo;$ORIGIN 1.168.192.IN-ADDR.ARPA&rdquo;.</para>

</sect2>

<sect2>
<title>Démarrer le serveur DNS</title>

<para>Par défaut, le serveur DNS (<filename>/etc/sbin/named</filename>) n'est
pas lancé au démarrage du système. Vous pouvez modifier ce comportement en
rectifiant une seule ligne dans le fichier <filename>/etc/rc.conf</filename>,
comme suit:</para>

<para>Avec l'éditeur <command>ee</command>, visualisez le fichier
<filename>/etc/rc.conf</filename>. Descendez d'une quarantaine de lignes jusqu'&agrave;
ce que vous trouviez la section qui dit:</para>
<para>
<programlisting>
---
named_enable="NO"                       # Run named, the DNS server (or NO).
named_flags="-b /etc/namedb/named.boot" # Flags to named (if enabled).
---
</programlisting>
</para>

<para>et modifiez-la en:</para>
<para>
<programlisting>
---
named_enable="YES"                      # Run named, the DNS server (or NO).
named_flags="-b /etc/namedb/named.boot" # Flags to named (if enabled).
---
</programlisting>
</para>

<para>Sauvegardez le fichier et redémarrez le système.</para>

<para>Vous pouvez aussi démarrer le serveur DNS avec la commande
suivante:</para>

<para>
<userinput>
<prompt>#</prompt> named -b /etc/namedb/named.boot
</userinput>
</para>
<para>Chaque fois que vous modifiez les fichiers du répertoire
<filename>/etc/namedb/named.boot</filename>, vous devez faire relire ces
modifications par le serveur DNS avec la commande suivante:</para>

<para>
<userinput>
<prompt>#</prompt> kill -HUP `cat /var/run/named.pid`
</userinput>
</para>

</sect2>
</sect1>

<sect1>
<title>Essayer les filtres PPP</title>

<para>Le programme <command>ppp</command> a la capacité d'appliquer des règles
de filtrage au trafic qu'il route. Bien que cela ne soit pas aussi sécurisé
qu'un véritable coupe-feu, cela autorise quelques contrôles d'accès &agrave; la
liaison.</para>

<para>(&ldquo;<filename>man ipfw</filename>&rdquo; pour plus
d'informations sur la configuration d'un système FreeBSD plus sécurisé.)</para>

<para>La documentation complète des différents filtres et règles utilisables
avec le programme <command>ppp</command> se trouve dans les pages de manuel
de <command>ppp</command>.</para>

<para>Il y a quatre classes de filtres qui s'appliquent au programme
<command>ppp</command>:
<itemizedlist>

<listitem>
<para><filename>alive</filename>&nbsp;-&nbsp;filtre compteur d'accès
(ou &ldquo;Keep Alive&rdquo;&nbsp;-&nbsp;garder en vie)</para>

<para>Ils définissent quels événements sont ignorés par l'instruction
<filename>set timeout=</filename>.</para>
</listitem>

<listitem>
<para><filename>dial</filename>&nbsp;-&nbsp;filtre d'appel</para>

<para>Ils définissent quels événements sont ignorés par <command>ppp</command>
en mode connexion &agrave; la demande.</para>
</listitem>

<listitem>
<para><filename>in</filename>&nbsp;-&nbsp;filtre d'entrée</para>

<para>Ils définissent quels paquets entrants sont acceptés ou
refusés par le programme <command>ppp</command>.</para>
</listitem>

<listitem>
<para><filename>out</filename>&nbsp;-&nbsp;filtre de sortie</para>
<para>Ils définissent quels paquets sortants sont acceptés ou
refusés par le programme <command>ppp</command>.</para>
</listitem>

</itemizedlist>
</para>

<para>L'exemple qui suit est un extrait de la configuration d'un système
opérationnel qui donne une bonne base pour un fonctionnement Internet
&ldquo;normal&rdquo;, tout en empêchant que <command>ppp</command> accepte
n'importe quoi sur la liaison. Les commentaires décrivent la logique de
chaque jeu de règles.:</para>
<para>
<programlisting>
       #
       # filtres KeepAlive
       # ne pa prendre en compte les paquets ICMP,DNS et RIP
       #
        set filter alive 0 deny icmp
        set filter alive 1 deny udp src eq 53
        set filter alive 2 deny udp dst eq 53
        set filter alive 3 deny udp src eq 520
        set filter alive 4 deny udp dst eq 520
        set filter alive 5 permit 0/0 0/0
       #
       # filtre d'appel:
       #  Note:  ICMP établira la connexion dans cette configuration!
       #
        set filter dial 0 permit 0/0 0/0
       #
       # autoriser les paquets ident
       #
        set filter in 0 permit tcp dst eq 113
        set filter out 0 permit tcp src eq 113
       #
       # autoriser les connexions telnet &agrave; l'Internet
       #
        set filter in 1 permit tcp src eq 23 estab
        set filter out 1 permit tcp dst eq 23
       #
       # autoriser l'accès ftp &agrave; l'Internet
       #
        set filter in 2 permit tcp src eq 21 estab
        set filter out 2 permit tcp dst eq 21
        set filter in 3 permit tcp src eq 20 dst gt 1023
        set filter out 3 permit tcp dst eq 20
       #
       # autoriser les requêtes DNS
       #
        set filter in 4 permit udp src eq 53
        set filter out 4 permit udp dst eq 53
       #
       # autoriser les transferts de zone DNS
       #
        set filter in 5 permit tcp src eq 53
        set filter out 5 permit tcp dst eq 53
       #
       # autoriser l'accès depuis/vers le réseau local
       #
        set filter in 6 permit 0/0 192.168.1.0/24
        set filter out 6 permit 192.168.1.0/24 0/0
       #
       # autoriser les réponses au ping et traceroute
       #
        set filter in 7 permit icmp
        set filter out 7 permit icmp
        set filter in 8 permit udp dst gt 33433
        set filter out 9 permit udp dst gt 33433
       #
       # autoriser cvsup
       #
        set filter in 9 permit tcp src eq 5998
        set filter out 9 permit tcp dst eq 5998
        set filter in 10 permit tcp src eq 5999
        set filter out 10 permit tcp dst eq 5999
       #
       # autoriser NTP pour la synchronization des horloges
       #
        set filter in 11 permit tcp src eq 123 dst eq 123
        set filter out 11 permit tcp src eq 123 dst eq 123
        set filter in 12 permit udp src eq 123 dst eq 123
        set filter out 12 permit udp src eq 123 dst eq 123
       #
       # SMTP serait une bonne idée!
       #
        set filter in 13 permit tcp src eq 25
        set filter out 13 permit tcp dst eq 25
       #
       #
       # nous utilisons beaucoup whois, donc nous le laissons passer
       #
        set filter in 14 permit tcp src eq 43
        set filter out 14 permit tcp dst eq 43
        set filter in 15 permit udp src eq 43
        set filter out 15 permit udp dst eq 43
       #
       # si aucune des conditions ci-dessus n'est remplie, le paquet est refusé
       #-------
</programlisting>
</para>
<para>Il peut y avoir jusqu'&agrave; vingt règles dans chaque classe de filtres. Dans
chaque classe, les règles sont numérotées séquentiellement de 0 &agrave; 20,
<emphasis>mais aucune règle dans une classe particulière n'est appliquée tant
que la règle &ldquo;0&rdquo; n'est pas définie!</emphasis></para>
<para>Si vous décidez de <emphasis>ne pas</emphasis> utiliser de règles de
filtrage dans votre configuration du programme <command>ppp</command>, alors
<emphasis>TOUT</emphasis> le trafic de/vers votre système sera accepté lorsqu'il
est connecté &agrave; votre fournisseur d'accès.</para>
<para>Si vous décidez d'appliquer des règles de filtrages, ajoutez les lignes
précédentes &agrave; votre fichier <filename>/etc/ppp/ppp.conf</filename> dans l'une
des sections &ldquo;default&rdquo;, &ldquo;demand&rdquo; ou
&ldquo;interactive&rdquo; (ou &agrave; toutes&nbsp;-&nbsp;c'est &agrave; vous de voir).</para>

</sect1>
</chapter>
</book>
