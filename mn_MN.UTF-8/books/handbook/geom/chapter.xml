<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!--
     The FreeBSD Mongolian Documentation Project

     Original revision 39988

     $FreeBSD$
-->

<chapter id="GEOM">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Том</firstname>
	<surname>Рөүдс</surname>
	<contrib>Бичсэн  </contrib>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Цагаанхүүгийн</firstname>
	<surname>Ганболд</surname>
	<contrib>Орчуулсан  </contrib>
 	<!-- Nov 2006 -->
      </author>
    </authorgroup>
  </chapterinfo>

  <title>GEOM: Модульчлагдсан Диск Хувиргах Тогтолцоо</title>

  <sect1 id="GEOM-synopsis">
    <title>Ерөнхий агуулга</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>GEOM Дискний Тогтолцоо</primary>
      <see>GEOM</see>
    </indexterm>

    <para>Энэ бүлэг нь &os; дээр GEOM тогтолцооны хүрээнд дискийг хэрхэн хэрэглэх талаар
	хамарсан. Энэ нь тохиргоонд зориулж тогтолцоог ашигладаг гол <acronym
      	role="Redundant Array of Inexpensive Disks">RAID</acronym>
	хянагч хэрэгслүүдийг багтаадаг. Энэ бүлэг нь I/O, доор нь байгаа дэд
	систем, эсвэл кодыг GEOM хэрхэн зохицуулж эсвэл хянадаг талаар гүнзгий
	хэлэлцэхгүй. Энэхүү мэдээлэл нь &man.geom.4; гарын авлагын хуудас болон
	төрөл бүрийн SEE ALSO баримтуудын тусламжтай хангагддаг. Бас энэ бүлэг нь
	<acronym>RAID</acronym> тохиргоонуудын дэлгэрэнгүй заавар биш юм.
	Зөвхөн GEOM-дэмжигдсэн <acronym>RAID</acronym> ангиллуудын талаар
	хэлэлцэх болно.</para>

    <para>Энэ бүлгийг уншсаны дараа, та дараах зүйлсийг мэдэх болно:</para>

    <itemizedlist>
      <listitem>
	<para>Ямар төрлийн <acronym>RAID</acronym> дэмжлэг GEOM-ийн хүрээнд
	байдаг талаар.</para>
      </listitem>

      <listitem>
	<para>Хэрхэн үндсэн хэрэгслүүдийг ашиглаж тохиргоо хийх, ажиллагааг хангах, болон
	төрөл бүрийн <acronym>RAID</acronym> түвшнүүдийг удирдах талаар.</para>
      </listitem>

      <listitem>
        <para>Хэрхэн толин тусгал болон судал үүсгэх, шифрлэх, алсаас GEOM-ийн хүрээнд
	диск төхөөрөмжүүдийг холбох талаар.</para>
      </listitem>

      <listitem>
	<para>GEOM тогтолцоонд хавсаргасан дискнүүдийн алдааг хэрхэн олж засварлах талаар.</para>
      </listitem>
    </itemizedlist>

    <para>Энэ бүлгийг уншихаасаа өмнө, та дараах зүйлсийг мэдэх шаардлагатай:</para>

    <itemizedlist>
      <listitem>
	<para>&os; диск төхөөрөмжүүдийг хэрхэн үздэг талаар ойлгох
	(<xref linkend="disks"/>).</para>
      </listitem>

      <listitem>
	<para>Шинэ &os; цөм хэрхэн тохируулж суулгах талаар мэдэх
	  (<xref linkend="kernelconfig"/>).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="GEOM-intro">
    <title>GEOM-ийн Танилцуулга</title>

    <para>GEOM нь Мастер Ачаалалтын Бичлэгүүд (MBR), <acronym>BSD</acronym> хаягууд,
	гэх мэт &mdash; ангиллуудад тухайн ангиллын дэмжигчид (providers) эсвэл
	<filename class="directory">/dev</filename> дахь тусгай файлуудын
	тусламжтайгаар хандах хандалт ба хяналтыг уг ангилалд зөвшөөрдөг.
	GEOM нь төрөл бүрийн програм хангамжийн <acronym>RAID</acronym> тохиргоонуудыг
	ашиглаж үйлдлийн систем болон үйлдлийн системийн хэрэгслүүдэд саадгүйгээр
	хандах боломж олгодог.</para>
  </sect1>

  <sect1 id="GEOM-striping">
  <sect1info>
    <authorgroup>
      <author>
	<firstname>Том</firstname>
	<surname>Рөүдс</surname>
	<contrib>Бичсэн  </contrib>
      </author>
      <author>
	<firstname>Мюррей</firstname>
	<surname>Стөүкли</surname>
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Цагаанхүүгийн</firstname>
	<surname>Ганболд</surname>
	<contrib>Орчуулсан  </contrib>
 	<!-- Nov 2006 -->
      </author>
    </authorgroup>
  </sect1info>

    <title>RAID0 - Судал үүсгэх</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>Судал үүсгэх</primary>
    </indexterm>

    <para>Судал үүсгэх нь хэд хэдэн дискнүүдийг нэг эзлэхүүн болгодог арга юм.
	Олон тохиолдолд энэ нь тоног төхөөрөмжийн хянагчуудыг ашиглан хийгддэг.
	GEOM дэд систем нь диск судал үүсгэх гэж бас нэрлэгддэг
	<acronym>RAID</acronym>0-д зориулсан програмыг хангаж өгдөг.</para>

    <para><acronym>RAID</acronym>0 системд, дараалсан дискнүүдэд байгаа өгөгдлүүд
      нь багц болж хуваагддаг. Систем дээр нэг диск рүү 256k-ийг
      бичихийг хүлээснээс 64k-ийг 4 өөр диск рүү зэрэг бичих дээд зэргийн I/O буюу
      оруулах гаргах ажиллагааг <acronym>RAID</acronym>0 систем нь санал болгодог. Энэ ажиллагааг
      олон дискний хянагчуудыг ашиглан нэмэгдүүлж болдог.</para>

    <para>Багцалсан олон дискнүүдээс I/O хүсэлтүүд нь зэрэгцэж унших болон
      бичигддэг учраас <acronym>RAID</acronym>0 дискний хуваагдал нь бүгд ижил хэмжээтэй байх ёстой.</para>

      <mediaobject>
        <imageobject>
          <imagedata fileref="geom/striping" align="center"/>
        </imageobject>

        <textobject>
          <phrase>Диск судал үүсгэж байгаа зураг</phrase>
        </textobject>
      </mediaobject>

    <procedure>
      <title>Хэлбэржүүлэгдээгүй ATA дискнүүдийн судал үүсгэх</title>

      <step><para><filename>geom_stripe.ko</filename>
        	модулийг ачаална:</para>

    <screen>&prompt.root; <userinput>kldload geom_stripe</userinput></screen>
	</step>

      <step><para>Тохирох холболтын цэг байгааг шалгаарай. Хэрэв энэ эзлэхүүн нь root хуваалт
	болох ёстой бол түр зуур өөр <filename
        class="directory">/mnt</filename> гэх мэт холболтын цэгийг ашиглаарай:</para>

        <screen>&prompt.root; <userinput>mkdir /mnt</userinput></screen>
      </step>

      <step><para>Судал үүсгэх дискнүүдэд зориулсан төхөөрөмжийн нэрийг тодорхойлоод шинэ судал
	төхөөрөмж үүсгэ. Жишээ нь хоёр ашиглагдаагүй, хуваалт хийгдээгүй
	<filename>/dev/ad2</filename> болон <filename>/dev/ad3</filename> гэсэн
	<acronym>ATA</acronym> дискнүүдэд судал үүсгэхийн тулд:</para>

        <screen>&prompt.root; <userinput>gstripe label -v st0 /dev/ad2 /dev/ad3</userinput>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</screen>

      </step>

      <step><para>Хуваалтын хүснэгт гэгддэг стандарт хаягийг шинэ эзлэхүүн дээр бичээд
	анхдагч ачаалагдах кодыг суулгаарай:</para>

        <screen>&prompt.root; <userinput>bsdlabel -wB /dev/stripe/st0</userinput></screen>

      </step>

      <step><para>Энэ процесс хоёр төхөөрөмжийг <devicename>st0</devicename>
	төхөөрөмжийн хамт <filename class="directory">/dev/stripe</filename>
	санд үүсгэх ёстой. Тэдгээр нь <devicename>st0a</devicename> болон
        <devicename>st0c</devicename> юм. Ингэсний дараа файлын системийг
	<devicename>st0a</devicename> төхөөрөмж дээр <command>newfs</command>
	хэрэгслийн тусламжтайгаар үүсгэж болно:</para>

      <screen>&prompt.root; <userinput>newfs -U /dev/stripe/st0a</userinput></screen>

      <para>Олон тоонууд дэлгэц дээр урсан өнгөрөх бөгөөд хэдхэн хормын дараа процесс төгсөнө.
	Ингээд эзлэхүүн үүсэж холболт хийгдэхэд бэлэн болно.</para>
    </step>
  </procedure>

  <para>Гараар үүсгэсэн дискний судлаа холбохын тулд:</para>

  <screen>&prompt.root; <userinput>mount /dev/stripe/st0a /mnt</userinput></screen>

  <para>Энэ судал үүсгэсэн файлын системдээ ачаалах үед автоматаар холболт хийхийн
	тулд эзлэхүүний мэдээллийг <filename>/etc/fstab</filename> файлд
	хийгээрэй. For this purpose, a permanent mount
    point, named <filename class="directory">stripe</filename>, is
    created:</para>

  <screen>&prompt.root; <userinput>mkdir /stripe</userinput>
&prompt.root; <userinput>echo "/dev/stripe/st0a /stripe ufs rw 2 2" \</userinput>
    <userinput>&gt;&gt; /etc/fstab</userinput></screen>

  <para><filename>/boot/loader.conf</filename> файлд мөр нэмж <filename>geom_stripe.ko</filename> модулийг
	систем эхлэхэд автоматаар ачаалагдахаар болгох ёстой:</para>

  <screen>&prompt.root; <userinput>echo 'geom_stripe_load="YES"' &gt;&gt; /boot/loader.conf</userinput></screen>

  </sect1>

  <sect1 id="GEOM-mirror">
    <title>RAID1 - Толин тусгал үүсгэх</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>Disk Mirroring</primary>
    </indexterm>
    <indexterm>
      <primary>RAID1</primary>
    </indexterm>

    <para><acronym>RAID1</acronym>, буюу 
      <firstterm>mirroring</firstterm> нь 
      нэг өгөгдлийг нэгээс илүү диск дээр бичих техникийг хэлдэг. 
      Толин тусгал нь диск ажиллахаа байсан үед өгөгдлийг алдагдахаас 
      хамгаалахад ихэвчлэн хэрэглэгддэг. Толин тусгал дахь диск бүр 
      өгөгдлийн ижил хуулбарыг агуулж байдаг. Тухайн диск ажиллахаа 
      больсон үед ажиллаж байгаа дискнүүд дэх өгөгдлөөр ханган 
      толин тусгал ажилласан хэвээр байна. Компьютер энэ үед ажилласаар 
      байх бөгөөд администратор нь ажиллахаа больсон дискийг хэрэглэгчийн 
      оролцоогүйгээр солих боломжтой болдог.</para>

    <para>Эдгээр жишээнүүд дээр хоёр түгээмэл тохиолдлыг харуулсан байгаа. 
      Эхнийх дээр нь хоёр шинэ дискнээс бүтэх толин тусгал үүсгэж одоо 
      байгаа нэг дискний оронд ашиглаж байгаа талаар бичсэн. Хоёр дахь 
      жишээ нь нэг шинэ диск дээр толин тусгал үүсгэж хуучин дискний 
      өгөгдлийг хуулж дараа нь хуучин дискийг толин тусгал руу оруулж 
      байгаа талаар болно. Энэ процедур нь илүү төвөгтэй боловч зөвхөн 
      ганц диск шаарддаг.</para>

    <para>Уламжлалаар толин тусгал дахь хоёр диск нь модел болон 
      хэмжээний хувьд ижил байдаг боловч &man.gmirror.8; нь тийм байхыг 
      шаарддаггүй. Өөр дискнүүдээс тогтсон толин тусгал нь хамгийн бага 
      дискний хэмжээтэй ижил байдаг. Илүү том диск дээрх илүүдэл зай нь
      ашиглагддаггүй. Толин тусгал руу сүүлд нэмэх диск нь толин тусгал 
      дахь хамгийн бага хэмжээтэй дискний хэмжээтэй ижил байх 
      ёстой.</para>

    <warning>
      <para>Энд үзүүлсэн толин тусгал болгож байгаа процедур эвдлэх 
      шинж чанаргүй боловч дискний үйл ажиллагаатай холбоотой учраас 
      бүрэн хэмжээний нөөцлөлтийг эхлээд хийгээрэй.</para>
    </warning>

    <sect2 id="GEOM-mirror-metadata">
      <title>Мета өгөгдөлтэй холбоотой асуудлууд</title>

      <para>Дискний олон систем мета өгөгдлийг диск бүрийн төгсгөлд 
      хадгалдаг. Дискийг толин тусгалд дахин ашиглахын тулд хуучин 
      мета өгөгдлийг устгах ёстой. Ихэнх асуудал хуучин үлдсэн 
      мета өгөгдлийн хоёр төрлөөс болж үүсдэг: GPT хуваалтын хүснэгтүүд,
      болон өмнөх толин тусгалын хуучин &man.gmirror.8; мета өгөгдөл юм.</para>

      <para>GPT мета өгөгдлийг &man.gpart.8; ашиглан устгаж болно. 
      Энэ жишээн дээр анхдагч болон нөөц GPT хуваалтын хүснэгтийг 
      <devicename>ada8</devicename> дискнээс устгаж байна:</para>

      <screen>&prompt.root; <userinput>gpart destroy -F ada8</userinput></screen>

      <para>&man.gmirror.8; нь ажиллаж байгаа толин тусгалаас дискийг 
      салгаж мета өгөгдлийг арилгахыг нэг алхмаар хийж чаддаг. 
      Энд жишээ диск <devicename>ada8</devicename>-г ажиллаж байгаа 
      толин тусгал <devicename>gm4</devicename>-с салгаж байна:</para>

      <screen>&prompt.root; <userinput>gmirror remove gm4 ada8</userinput></screen>

      <para>Хэрэв толин тусгал ажиллахгүй байгаа бөгөөд хуучин 
      толин тусгалын мета өгөгдөл диск дээр байгаа хэвээр бол 
      <command>gmirror clear</command> тушаал ашиглан устгаж 
      болно:</para>

      <screen>&prompt.root; <userinput>gmirror clear ada8</userinput></screen>

      <para>&man.gmirror.8; нь мета өгөгдлийн нэг блокийг дискний төгсгөлд 
      хадгалдаг. GPT хуваалтын схем нь мета өгөгдлийг бас дискний 
      төгсгөлд хадгалдаг учраас бүтэн GPT дискүүдийг &man.gmirror.8; 
      ашиглан толин тусгал хийхийг зөвлөдөггүй. Энд MBR хуваалтыг 
      ашигладаг, учир нь энэ хуваалт нь хуваалтын хүснэгтийг дискний 
      зөвхөн эхэнд хадгалдаг бөгөөд &man.gmirror.8;-той харшилддаггүй.</para>
    </sect2>

    <sect2>
      <title>Хоёр шинэ дискнээс толин тусгал үүсгэх</title>

      <para>Энэ жишээн дээр &os; нь <devicename>ada0</devicename> гэсэн 
      нэг диск дээр суулгасан байгаа. <devicename>ada1</devicename> ба
	<devicename>ada2</devicename> гэсэн хоёр шинэ диск систем 
	рүү холбогдсон байгаа. Энэ хоёр диск дээр шинэ толин тусгал 
	үүсгэх бөгөөд нэг хуучин дискийг солиход ашиглагдах 
	болно.</para>

      <para>&man.gmirror.8; нь цөмд цуг бүтээгдсэн эсвэл ачаалах 
      буюу ажиллах үед дуудагдах <filename>geom_mirror.ko</filename> 
      цөмийн модулийг шаарддаг. Цөмийн модулийг гараар одоо 
      дуудна:</para>

      <screen>&prompt.root; <userinput>gmirror load</userinput></screen>

      <para>Хоёр шинэ дискээс тогтох толин тусгал үүсгэнэ.</para>

      <screen>&prompt.root; <userinput>gmirror label -v gm0 /dev/ada1 /dev/ada2</userinput></screen>

      <para><devicename>gm0</devicename> нь шинэ толин тусгалд өгсөн 
      хэрэглэгчийн сонгосон төхөөрөмжийн нэр юм. Толин тусгал 
      эхэлсний дараа төхөөрөмжийн нэр <filename>/dev/mirror/</filename> 
      санд гарч ирнэ.</para>

      <para>MBR болон bsdlabel хуваалтын хүснэгтүүдийг толин тусгал
      дээр &man.gpart.8;-н тусламжтай үүсгэж болно. Энд бид 
      <filename>/</filename>, swap, <filename>/var</filename>,
	<filename>/tmp</filename>, ба <filename>/usr</filename> гэсэн 
	хуваалтуудтай уламжлалт хуваалттай файлын системийн бүтцийг 
	харуулж байна. Ганц <filename>/</filename> болон swap 
	хуваалт байж бас болно.</para>

      <para>Толин тусгал дахь хуваалтууд нь одоо байгаа дискнүүд 
      шиг ижил хэмжээтэй 
      байх албагүй боловч <devicename>ada0</devicename> дээр байгаа 
      бүх өгөгдлийг агуулах хэмжээтэй байх ёстой.</para>

      <screen>&prompt.root; <userinput>gpart create -s MBR mirror/gm0</userinput>
&prompt.root; <userinput>gpart add -t -a 4k mirror/gm0</userinput>
&prompt.root; <userinput>gpart show mirror/gm0</userinput>
=>       63  156301423  mirror/gm0  MBR  (74G)
         63         63                    - free -  (31k)
        126  156301299                 1  freebsd  (74G)
  156301425         61                    - free -  (30k)</screen>

      <screen>&prompt.root; <userinput>gpart create -s BSD mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart add -t freebsd-swap -a 4k -s 4g mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart add -t freebsd-ufs  -a 4k -s 1g mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart add -t freebsd-ufs  -a 4k       mirror/gm0s1</userinput>
&prompt.root; <userinput>gpart show mirror/gm0s1</userinput>
=>        0  156301299  mirror/gm0s1  BSD  (74G)
          0          2                      - free -  (1.0k)
          2    4194304                   1  freebsd-ufs  (2.0G)
    4194306    8388608                   2  freebsd-swap  (4.0G)
   12582914    4194304                   4  freebsd-ufs  (2.0G)
   16777218    2097152                   5  freebsd-ufs  (1.0G)
   18874370  137426928                   6  freebsd-ufs  (65G)
  156301298          1                      - free -  (512B)</screen>

      <para>Ачаалах кодыг MBR болон bsdlabel-д суулган 
      идэвхтэй зүсмэлийг тохируулж толин тусгалыг ачаалах 
      боломжтой болгоно:</para>

      <screen>&prompt.root; <userinput>gpart bootcode -b /boot/mbr mirror/gm0</userinput>
&prompt.root; <userinput>gpart set -a active -i 1 mirror/gm0</userinput>
&prompt.root; <userinput>gpart bootcode -b /boot/boot mirror/gm0s1</userinput></screen>

      <para>Зөөлөн шинэчлэлийг идэвхжүүлэн шинэ толин тусгал дээрх 
      файлын системийг формат хийнэ.</para>

      <screen>&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1a</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1d</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1e</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1f</userinput></screen>

      <para>Эх диск (<devicename>ada0</devicename>) дээрх файлын 
      системийг толин тусгал руу &man.dump.8; ба &man.restore.8;
      тушаалыг ашиглан хуулж болно.</para>

      <screen>&prompt.root; <userinput>mount /dev/mirror/gm0s1a /mnt</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - / | (cd /mnt && restore -rf -)</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1d /mnt/var</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1e /mnt/tmp</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1f /mnt/usr</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var && restore -rf -)</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /tmp | (cd /mnt/tmp && restore -rf -)</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr && restore -rf -)</userinput></screen>

      <para><filename>/mnt/etc/fstab</filename>-г шинэ толин 
      тусгал файлын систем рүү заагдсан байхаар засварлах 
      ёстой:</para>

      <programlisting># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/tmp		ufs	rw	2	2
/dev/mirror/gm0s1f	/usr		ufs	rw	2	2</programlisting>

      <para>Хэрэв &man.gmirror.8; цөмийн модул цөмд цуг бүтээгдээгүй 
      бол модулийг ачаалахад дуудахын тулд <filename>/mnt/boot/loader.conf</filename>
      файлыг засах ёстой:</para>

      <programlisting>geom_mirror_load="YES"</programlisting>

      <para>Шинэ толин тусгалыг тест хийхийн тулд системийг 
      дахин ачаалж бүх өгөгдөл хуулагдсан эсэхийг шалгаарай. 
      BIOS толин тусгалыг толин тусгал гэж харахгүй, харин 
      хоёр тусдаа диск гэж харна. Дискнүүд ижил учраас 
      аль нь ачаалахаар сонгогдсон нь чухал биш юм.</para>

      <para>Ачаалахад асуудалтай байгаа бол 
      <link linkend="gmirror-troubleshooting">Алдааг олж засварлах</link>
      хэсгийг үзээрэй. Унтраагаад эхний <devicename>ada0</devicename> 
      дискийг салгаснаар уг дискийг нөөц маягаар байх боломжийг 
      бүрдүүлдэг.</para>

      <para>Ашиглаж байгаа үед толин тусгал нь 
      яг л анхны ганц диск шиг л ажиллах болно.</para>
    </sect2>

    <sect2>
      <title>Байгаа дискүүд ашиглан толин тусгал үүсгэх</title>

      <para>Энэ жишээн дээр &os; <devicename>ada0</devicename> гэсэн 
      нэг диск дээр суусан байгаа. Шинэ диск <devicename>ada1</devicename>-г  
      системд холбосон байгаа. Нэг дискээс тогтох толин тусгалыг 
      шинэ диск дээр үүсгэж байгаа системийг түүн рүү хуулж 
      дараа нь хуучин дискийг толин тусгал руу оруулна. Энэ илүү 
      төвөгтэй процедур нь зайлшгүй шаардлагатай байдаг, учир нь &man.gmirror.8; нь
      512 байт блок бүхий мета өгөгдлийг диск бүрийн төгсгөлд 
      нэмэх хэрэгтэй байдаг бөгөөд байгаа <devicename>ada0</devicename>-н 
      бүх зай ихэвчлэн ашиглагдчихсан байдаг.</para>

      <para>&man.gmirror.8; цөмийн модулийг дуудна.</para>

      <screen>&prompt.root; <userinput>gmirror load</userinput></screen>

      <para>&man.diskinfo.8; ашиглан эхний дискний хэмжээг 
      шалгана.</para>

      <screen>&prompt.root; <userinput>diskinfo -v ada0 | head -n3</userinput>
/dev/ada0
	512             # sectorsize
	1000204821504   # mediasize in bytes (931G)</screen>

      <para>Шинэ диск дээр толин тусгалыг үүсгэнэ. Эхний дискнээс 
      толин тусгалын хэмжээ их биш гэдгийг шалгахын тулд 
      &man.gnop.8; ашиглан ижил хэмжээтэй хуурамч диск үүсгэж үзнэ.
      Энэ диск нь ямар ч өгөгдөл хадгалахгүй бөгөөд толин тусгалын 
      хэмжээг хязгаарлахад зөвхөн ашиглагдана. &man.gmirror.8; нь 
      толин тусгал үүсгэхдээ хэдийгээр шинэ диск 
      (<devicename>ada1</devicename>) илүү зайтай байсан ч гэсэн 
      <devicename>gzero.nop</devicename>-н хэмжээгээр багтаамжийг 
      хязгаарлана. Хоёр дахь мөрөн дээр байгаа 
      <replaceable>1000204821504</replaceable> утга нь дээрх 
      &man.diskinfo.8;-р харуулсантай адил 
      <devicename>ada0</devicename>-н хэмжээтэй ижил байх 
      ёстой.</para>

      <screen>&prompt.root; <userinput>geom zero load</userinput>
&prompt.root; <userinput>gnop create -s 1000204821504 gzero</userinput>
&prompt.root; <userinput>gmirror label -v gm0 gzero.nop ada1</userinput>
&prompt.root; <userinput>gmirror forget gm0</userinput></screen>

      <para><devicename>gzero.nop</devicename> нь ямар ч өгөгдөл 
      хадгалдаггүй учраас толин тусгал холбогдсон гэж хардаггүй. 
      <devicename>gzero.nop</devicename>-той 
      холбоотой мэдээллийг устган холбогдоогүй 
      байгаа зүйлийг <quote>март</quote> гэж толин тусгалд 
      хэлдэг гэсэн үг юм. Үүний үр дүнд толин тусгал нь 
      зөвхөн ганц диск <devicename>ada1</devicename>-с тогтоно.</para>

      <para><devicename>gm0</devicename>-г үүсгэсний дараа 
      <devicename>ada0</devicename> дээрх хуваалтын хүснэгтийг харна.</para>

      <para>Эндэх гаралт нь 1&nbsp;TB дискнээс юм. Дискний 
      төгсгөлд хуваарилагдаагүй зай байгаа бол өгөгдөл 
      <devicename>ada0</devicename>-с шууд шинэ толин тусгал руу 
      хуулагдаж болно.</para>

      <para>Гэхдээ гаралт нь дараах жагсаалт дээрх шиг диск дээрх 
      бүх зай бүхлээрээ хуваарилагдсан байгаагаар харуулж байгаа бол 
      512 байт &man.gmirror.8; мета өгөгдлийн хувьд дискний төгсгөлд 
      зай байхгүй гэсэн үг юм.</para>

      <screen>&prompt.root; <userinput>gpart show ada0</userinput>
=>        63  1953525105        ada0  MBR  (931G)
          63  1953525105           1  freebsd  [active]  (931G)</screen>

      <para>Энэ тохиолдолд <devicename>mirror/gm0</devicename> дээрх 
      багтаамжийг нэг сектороор багасгахын тулд хуваалтын хүснэгтийг 
      засварлах хэрэгтэй. Уг процедурыг дараа тайлбарлах болно.</para>

      <para>Аль ч тохиолдолд анхдагч диск дээрх хуваалтын 
      хүснэгтүүдийг эхэлж хуулах хэрэгтэй. Үүнийг &man.gpart.8;
	<command>backup</command> ба <command>restore</command> дэд тушаалуудыг 
	ашиглан гүйцэтгэнэ.</para>

      <screen>&prompt.root; <userinput>gpart backup ada0 &gt; table.ada0</userinput>
&prompt.root; <userinput>gpart backup ada0s1 &gt; table.ada0s1</userinput></screen>

      <para>Эдгээр тушаал нь 
      <filename>table.ada0</filename> ба
	<filename>table.ada0s1</filename> гэсэн хоёр
	файл үүсгэнэ. Энэ жишээ нь 1&nbsp;TB дискнээс юм:</para>

      <screen>&prompt.root; <userinput>cat table.ada0</userinput>
MBR 4
1 freebsd         63 1953525105   [active]</screen>

      <screen>&prompt.root; <userinput>cat table.ada0s1</userinput>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640881</screen>

      <para>Хэрэв &man.gpart.8;	<command>show</command> тушаалын 
      гаралтад бүтэн диск ашиглагдаж байгаа бол эдгээр хуваалтын 
      хүснэгтүүд дээрх багтаамжийг нэг сектороор багасгах хэрэгтэй.
      Зүсмэл болон сүүлийн хуваалтын зайг нэгээр багасган хоёр 
      файлыг засварлах хэрэгтэй. Эдгээр нь жагсаалт бүрийн сүүлийн 
      тоонууд юм.</para>

      <screen>&prompt.root; <userinput>cat table.ada0</userinput>
MBR 4
1 freebsd         63 <emphasis>1953525104</emphasis>   [active]</screen>

      <screen>&prompt.root; <userinput>cat table.ada0s1</userinput>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  <emphasis>984640880</emphasis></screen>

      <para>Дискний төгсгөлд хамгийн багадаа нэг сектор хуваарилагдаагүй 
      байгаа бол эдгээр хоёр файлыг засварлалгүйгээр ашиглаж болно.</para>

      <para>Одоо хуваалтын хүснэгтийг 
      <devicename>mirror/gm0</devicename> руу сэргээнэ.</para>

      <screen>&prompt.root; <userinput>gpart restore mirror/gm0 &lt; table.ada0</userinput>
&prompt.root; <userinput>gpart restore mirror/gm0s1 &lt; table.ada0s1</userinput></screen>

      <para>&man.gpart.8; <command>show</command> тушаалаар 
      хуваалтын хүснэгтийг шалгана.  Энэ жишээ нь 
	<devicename>gm0s1a</devicename>-г <filename>/</filename>,
	<devicename>gm0s1d</devicename>-г <filename>/var</filename>,
	<devicename>gm0s1e</devicename>-г <filename>/usr</filename>,
	<devicename>gm0s1f</devicename>-г 
	<filename>/data1</filename>, ба
	<devicename>gm0s1g</devicename>-г 
	<filename>/data2</filename>-д ашиглана.</para>

      <screen>&prompt.root; <userinput>gpart show mirror/gm0</userinput>
=>        63  1953525104  mirror/gm0  MBR  (931G)
          63  1953525042           1  freebsd  [active]  (931G)
  1953525105          62              - free -  (31k)

&prompt.root; <userinput>gpart show mirror/gm0s1</userinput>
=>         0  1953525042  mirror/gm0s1  BSD  (931G)
           0     2097152             1  freebsd-ufs  (1.0G)
     2097152    16777216             2  freebsd-swap  (8.0G)
    18874368    41943040             4  freebsd-ufs  (20G)
    60817408    20971520             5  freebsd-ufs  (10G)
    81788928   629145600             6  freebsd-ufs  (300G)
   710934528  1242590514             7  freebsd-ufs  (592G)
  1953525042          63                - free -  (31k)</screen>

      <para>Зүсмэл болон сүүлийн хуваалт диск бүрийн төгсгөлд 
      сул зайтай байх ёстой.</para>

      <para>Энэ шинэ хуваалтууд дээр файлын систем үүсгэнэ. 
      Хэдэн хуваалт байх нь эх диск <devicename>ada0</devicename> 
      дээрх хуваалтуудаас хамаарч янз бүр байна.</para>

      <screen>&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1a</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1d</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1e</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1f</userinput>
&prompt.root; <userinput>newfs -U /dev/mirror/gm0s1g</userinput></screen>

      <para>Идэвхтэй зүсмэлийг тохируулж MBR болон bsdlabel дээр 
      ачаалах кодыг суулгаж толин тусгалыг ачаалах боломжтой 
      болгоно:</para>

      <screen>&prompt.root; <userinput>gpart bootcode -b /boot/mbr mirror/gm0</userinput>
&prompt.root; <userinput>gpart set -a active -i 1 mirror/gm0</userinput>
&prompt.root; <userinput>gpart bootcode -b /boot/boot mirror/gm0s1</userinput></screen>

      <para>Толин тусгал дээрх шинэ хуваалтыг ашиглахаар 
      болгож <filename>/etc/fstab</filename> файлыг тохируулна. 
      <filename>/etc/fstab.orig</filename> руу хуулж энэ файлыг 
      эхлээд нөөцөлж авах хэрэгтэй.</para>

      <screen>&prompt.root; <userinput>cp /etc/fstab /etc/fstab.orig</userinput></screen>

      <para><devicename>/dev/ada0</devicename>-г 
      <devicename>mirror/gm0</devicename>-р сольж 
      <filename>/etc/fstab</filename> файлыг засварлана.</para>

      <programlisting># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/usr		ufs	rw	2	2
/dev/mirror/gm0s1f	/data1		ufs	rw	2	2
/dev/mirror/gm0s1g	/data2		ufs	rw	2	2</programlisting>

      <para>Хэрэв &man.gmirror.8; цөмийн модул цөмд цуг бүтээгдээгүй 
      бол <filename>/boot/loader.conf</filename>-г засварлаж түүнийг
      дуудна:</para>

      <programlisting>geom_mirror_load="YES"</programlisting>

      <para>Эх диск дээрх файлын системүүдийг одоо 
      &man.dump.8; ба &man.restore.8; тушаалуудыг ашиглан толин тусгал 
      руу хуулж болно. <command>dump -L</command> тушаалаар авагдсан 
      файл систем бүрийн хувьд хормын хувилбар үүсгэхэд хугацаа 
      шаардагдаж магадгүйг санаарай.</para>

      <screen>&prompt.root; <userinput>mount /dev/mirror/gm0s1a /mnt</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /    | (cd /mnt && restore -rf -)</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1d /mnt/var</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1e /mnt/usr</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1f /mnt/data1</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1g /mnt/data2</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr && restore -rf -)</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var && restore -rf -)</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /data1 | (cd /mnt/data1 && restore -rf -)</userinput>
&prompt.root; <userinput>dump -C16 -b64 -0aL -f - /data2 | (cd /mnt/data2 && restore -rf -)</userinput></screen>

      <para><devicename>ada1</devicename>-с ачаалж 
      системийг дахин ачаална. Бүгд ажиллаж байгаа бол 
      систем <devicename>mirror/gm0</devicename>-с ачаалах бөгөөд 
      энэ нь <devicename>ada0</devicename>-н өмнө агуулж байсан 
      өгөгдлийг бас агуулах болно. Ачаалахтай холбоотой асуудал 
      байгаа бол <link linkend="gmirror-troubleshooting">Алдааг олж засварлах</link>
      хэсгийг харна уу.</para>

      <para>Энд хүрэхэд толин тусгал нь зөвхөн ганц диск 
      <devicename>ada1</devicename>-с тогтох болно.</para>

      <para><devicename>mirror/gm0</devicename>-с амжилттай 
      ачаалсны дараа сүүлийн алхам бол <devicename>ada0</devicename>-г 
      толин тусгал руу оруулах явдал юм.</para>

      <important>
	<para><devicename>ada0</devicename>-г толин тусгал руу 
	оруулах үед хуучин агуулга нь толин тусгал дээрх агуулгаар 
	дарагдаж бичигддэг. <devicename>ada0</devicename>-г 
	толин тусгал руу нэмэхээсээ өмнө <devicename>mirror/gm0</devicename> нь 
	<devicename>ada0</devicename>-н өгөгдлийг яг агуулж байгаа 
	эсэхийг шалгаарай. &man.dump.8; ба &man.restore.8;-г 
	ашиглан хуулсан агуулгатай холбоотой ямар нэг асуудал үүссэн бол 
	файлын системийг <devicename>ada0</devicename>-с холбохоор 
	болгож <filename>/etc/fstab</filename>-г тохируулж дахин 
	ачаалан дээрх алхмуудыг дахин эхнээс нь хийж үзэх хэрэгтэй.</para>
      </important>

      <screen>&prompt.root; <userinput>gmirror insert gm0 ada0</userinput>
GEOM_MIRROR: Device gm0: rebuilding provider ada0</screen>

      <para>Хоёр дискний хоорондох синхрончлол шууд эхэлнэ.
      &man.gmirror.8; <command>status</command> тушаал явцыг 
      харуулна.</para>

      <screen>&prompt.root; <userinput>gmirror status</userinput>
      Name    Status  Components
mirror/gm0  DEGRADED  ada1 (ACTIVE)
                      ada0 (SYNCHRONIZING, 64%)</screen>

      <para>Тодорхой хугацааны дараа синхрончлол дуусна.</para>

      <screen>GEOM_MIRROR: Device gm0: rebuilding provider ada0 finished.
&prompt.root; <userinput>gmirror status</userinput>
      Name    Status  Components
mirror/gm0  COMPLETE  ada1 (ACTIVE)
                      ada0 (ACTIVE)</screen>

      <para><devicename>mirror/gm0</devicename> нь одоо 
      <devicename>ada0</devicename> ба <devicename>ada1</devicename> гэсэн 
      хоёр дискээс тогтох бөгөөд агуулгууд нь нэг нэгэнтэйгээ 
      автоматаар синхрончлогдсон байна. Ашиглагдаж байгаа үед 
      <devicename>mirror/gm0</devicename> нь яг л эхний ганц диск 
      шиг ажиллах болно.</para>
    </sect2>

    <sect2 id="gmirror-troubleshooting">
      <title>Алдааг олж засварлах</title>

      <sect3>
	<title>Ачаалахтай холбоотой асуудлууд</title>

	<sect4>
	  <title>BIOS тохиргоо</title>

	  <para>BIOS тохиргоог шинээр толин тусгал болгосон 
	  дискнүүдийн аль нэгнээс ачаалахаар болгож тохируулах
	  хэрэгтэй байж магадгүй юм. Аль ч дискийг ачаалахад 
	  ашиглаж болно. Толин тусгалын нэг хэсэг учраас тэдгээр нь 
	  ижил өгөгдөлтэй байдаг.</para>
	</sect4>

	<sect4>
	  <title>Ачаалах үеийн асуудлууд</title>

	  <para>Хэрэв ачаалалт ийм мэдэгдэлтэй зогссон бол 
	  толин тусгал төхөөрөмж асуудалтай байж болох юм:</para>

	  <screen>Mounting from ufs:/dev/mirror/gm0s1a failed with error 19.

Loader variables:
  vfs.root.mountfrom=ufs:/dev/mirror/gm0s1a
  vfs.root.mountfrom.options=rw

Manual root filesystem specification:
  &lt;fstype&gt;:&lt;device&gt; [options]
      Mount &lt;device&gt; using filesystem &lt;fstype&gt;
      and with the specified (optional) option list.

    eg. ufs:/dev/da0s1a
        zfs:tank
        cd9660:/dev/acd0 ro
          (which is equivalent to: mount -t cd9660 -o ro /dev/acd0 /)

  ?               List valid disk boot devices
  .               Yield 1 second (for background tasks)
  &lt;empty line&gt;    Abort manual input

mountroot&gt;</screen>

           <para><filename>geom_mirror</filename> модулийг
	   <filename>/boot/loader.conf</filename>-т оруулж дуудахаа
	   мартсан бол энэ асуудал гарна. Үүнийг засахын тулд 
	   &os;-9 эсвэл түүнээс хойшхи хувилбарын CD эсвэл USB дискнээс 
	   ачаалаад эхний асуулт дээр <literal>Shell</literal>-г 
	   сонгох хэрэгтэй. Дараа нь толин тусгалын модулийг дуудаж 
	   толин тусгал төхөөрөмжийг холбох хэрэгтэй:</para>

	  <screen>&prompt.root; <userinput>gmirror load</userinput>
&prompt.root; <userinput>mount /dev/mirror/gm0s1a /mnt</userinput></screen>

	  <para>Толин тусгалын модулийг дуудах мөрийг 
	  <filename>/mnt/boot/loader.conf</filename>-д оруулж 
	  засварлана:</para>

	  <programlisting>geom_mirror_load="YES"</programlisting>

	  <para>Файлыг хадгалж дахин ачаална.</para>

	  <para><literal>error 19</literal> гаргаж байгаа 
	  бусад асуудлуудыг засварлахад илүү хүч зарах 
	  шаардлагатай. Асууж лавлах дэлгэц дээр 
	  <literal>ufs:/dev/ada0s1a</literal> гэж оруулж өгнө. 
	  Систем хэдийгээр <devicename>ada0</devicename>-с 
	  ачаалах ёстой боловч бүрхүүл сонгох асууж лавлах дэлгэц 
	  дахин гарч ирнэ. <filename>/etc/fstab</filename> 
	  файл буруу байгаа учраас тэр юм. Оруулах товчийг энэ 
	  үед дарах хэрэгтэй. Толин тусгалын оронд эх дискнээс 
	  (<devicename>ada0</devicename>) файлын системийг холбохоор 
	  болгож <filename>/etc/fstab</filename>-г тохируулж өөрчлөлтийг 
	  буцаах хэрэгтэй. Системийг дахин ачаалж алхмуудыг дахин 
	  оролдож үзэх хэрэгтэй.</para>

	  <screen>Enter full pathname of shell or RETURN for /bin/sh:
&prompt.root; <userinput>cp /etc/fstab.orig /etc/fstab</userinput>
&prompt.root; <userinput>reboot</userinput></screen>
	</sect4>
      </sect3>
    </sect2>

    <sect2>
      <title>Диск ажиллахаа болиход сэргээх</title>

      <para>Толин тусгалын гайхамшигтай тал бол аль нэг диск ажиллахаа 
      байхад толин тусгал дээрх өгөгдөл алдагддаггүй явдал 
      юм.</para>

      <para><devicename>ada0</devicename> нь дээрх жишээн дээр толин тусгал 
      үүсгэж байгаа дискнүүдийн нэг юм. Хэрэв <devicename>ada0</devicename>
      ажиллахаа боливол нөгөө ажиллаж байгаа диск болох <devicename>ada1</devicename>-с 
      өгөгдлөө өгөн толин тусгал ажилласан хэвээр байх болно.</para>

      <para>Ажиллахаа больсон дискийг солихын тулд компьютерыг 
      унтрааж эвдэрсэн дискийг ижил эсвэл илүү хэмжээтэй дискээр 
      солих хэрэгтэй. Үйлдвэрлэгчид дискний хэмжээг гигабайтаар 
      хэмжихдээ дурын утга ашигладаг бөгөөд итгэлтэй байхын тулд 
      зөвхөн <command>diskinfo -v</command> тушаалаар харагдах 
      секторын тоог харьцуулах явдал юм. Толин тусгалын хэмжээнээс том 
      диск болох боловч шинэ диск дээрх илүү зай ашиглагдахгүй.</para>

      <para>Компьютер ассаны дараа толин тусгал <quote>degraded</quote> 
      буюу <quote>ажиллагаа саарсан</quote> горимд нэг дисктэйгээр 
      ажиллах болно. Толин тусгал нь залгагдаагүй байгаа дискийг 
      мартаж ажиллана:</para>

      <screen>&prompt.root; <userinput>gmirror forget gm0</userinput></screen>

      <para>Хуучин мета өгөгдлийг <link
	  linkend="GEOM-mirror-metadata">сольсон дискээс арилгах
        хэрэгтэй</link>. Дараа нь энэ жишээн дээрх 
	<devicename>ada4</devicename> дискийг толин тусгал руу оруулна:</para>

      <screen>&prompt.root; <userinput>gmirror insert gm0 /dev/ada4</userinput></screen>

      <para>Шинэ диск толин тусгалд ороход дахин синхрончлол
      хийгдэж эхэлнэ. Толин тусгалын өгөгдлийг шинэ диск рүү хуулах 
      процесс удаж болно. Толин тусгалын үйл ажиллагаа хуулж байх явцад 
      удаашрах учраас компьютерын хэрэглээ бага үед шинэ дискийг 
      хийх нь зүйтэй.</para>

      <para>Үйл явцыг <command>gmirror status</command> тушаалаар 
      монитор хийж болох бөгөөд синхрончлол хийгдэж байгаа дискнүүд 
      болон ажиллаж байгаа хувийг энэ тушаал харуулдаг. Дахин синхрончлолын 
      үед төлөв <computeroutput>DEGRADED</computeroutput> байж байгаад 
      процесс дуусахдаа <computeroutput>COMPLETE</computeroutput> болж 
      өөрчлөгдөнө.</para>
    </sect2>
  </sect1>

  <sect1 id="GEOM-raid3">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Марк</firstname>
	  <surname>Глэдмэн</surname>
	  <contrib>Бичсэн </contrib>
	</author>
	<author>
	  <firstname>Дахиел</firstname>
	  <surname>Гэрзо</surname>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Том</firstname>
	  <surname>Рөүдс</surname>
	  <contrib>Анхлан бичсэн </contrib>
	</author>
	<author>
	  <firstname>Мюррэй</firstname>
	  <surname>Стөүкли</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title><acronym>RAID</acronym>3 - Parity бүхий байтын түвшний
      тусдаа судалжуулалт (Striping)</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>RAID3</primary>
    </indexterm>

    <para><acronym>RAID</acronym>3 нь хэд хэдэн дискийн хөтчийг нэг
      эзлэхүүн рүү тусгайлан зориулагдсан parity бүхий дискийн хамтаар
      нэгтгэхэд хэрэглэгддэг арга юм. <acronym>RAID</acronym>3 систем
      дээр өгөгдөл нь хуваагдан тодорхой тооны байтаар массив дахь бүх
      хөтчүүд рүү бичигддэг бөгөөд ингэхдээ тусгайлан зориулагдсан нэг
      parity диск рүү бичигддэггүй. Энэ нь <acronym>RAID</acronym>3-аас
      1024KB уншихад массив дахь бүх диск рүү хандана гэсэн үг юм.
      Үйл ажиллагааг сайжруулахын тулд олон диск контроллер ашиглаж
      болно. <acronym>RAID</acronym>3 массив нь массив дахь бүх хөтчийн
      хэмжээний 1 - 1/n бүхий хэмжээгээр хангаж 1 хөтчийн найдвартай
      ажиллагааг хангадаг. n нь массив дахь хатуу хөтчүүдийн тоо юм.
      Ийм тохиргоо нь том хэмжээтэй өгөгдөл буюу мультимедиа файлууд
      хадгалахад зохимжтой байдаг.</para>

    <para><acronym>RAID</acronym>3 массивыг бүтээхэд
      хамгийн багадаа 3 хатуу хөтчийг шаарддаг. Диск бүр ижил хэмжээтэй
      байх ёстой бөгөөд учир нь I/O хүсэлт бүр олон диск рүү
      зэрэг хандалт хийн унших бичих хэрэгтэй байдаг. Бас
      <acronym>RAID</acronym>3-н онцлогоос хамаараад хөтчийн тоо
      3, 5, 9, 17, гэх мэтээр (2^n + 1) байх ёстой байдаг.</para>

    <sect2>
      <title>Тусдаа <acronym>RAID</acronym>3 массив үүсгэх</title>

      <para>&os; дээр <acronym>RAID</acronym>3-н дэмжлэг
	&man.graid3.8; <acronym>GEOM</acronym> классаар шийдэгдсэн
	байдаг. Тусдаа <acronym>RAID</acronym>3 массивыг &os; дээр
	үүсгэхийн тулд дараах алхмууд шаардлагатай.</para>

      <note>
	<para>&os; дээр <acronym>RAID</acronym>3 массиваас онолын
	  хувьд ачаалах боломжтой хэдий ч тохиргооны хувьд ховор
	  бас тэгж хийхийг зөвлөдөггүй.</para>
      </note>

      <procedure>
	<step>
	  <para>Эхдээд дараах тушаалыг ашилаад <filename>geom_raid3.ko</filename>
	    цөмийн модулийг ачаална:</para>

	  <screen>&prompt.root; <userinput>graid3 load</userinput></screen>

	  <para>Мөн өөрөөр гараар <filename>geom_raid3.ko</filename>
	    модулийг ачаалж болно:</para>

	  <screen>&prompt.root; <userinput>kldload geom_raid3.ko</userinput></screen>
	</step>

	<step>
	  <para>Тохирох холбох цэг үүсгэх юм уу эсвэл байгаа эсэхийг
	    шалгана:</para>

	  <screen>&prompt.root; <userinput>mkdir <replaceable>/multimedia/</replaceable></userinput></screen>
	</step>

	<step>
	  <para>Массив руу нэмэгдэх дискүүдийн хувьд
	    хөтчийн нэрийг тогтоогоод <acronym>RAID</acronym>3
	    төхөөрөмж үүсгэнэ. Сүүлд жагсаагдсан төхөөрөмж
	    тусгайлан зориулагдсан parity диск байх болно.
	    Энэ жишээн дээр гурван хуваагдаагүй
	    <acronym>ATA</acronym> хөтчийг ашиглаж байна:
	    <devicename><replaceable>ada1</replaceable></devicename>
	    ба <devicename><replaceable>ada2</replaceable></devicename>-г
	    өгөгдөлд,
	    <devicename><replaceable>ada3</replaceable></devicename>-г
	    parity-г зориулж байна.</para>

	  <screen>&prompt.root; <userinput>graid3 label -v gr0 /dev/ada1 /dev/ada2 /dev/ada3</userinput>
Metadata value stored on /dev/ada1.
Metadata value stored on /dev/ada2.
Metadata value stored on /dev/ada3.
Done.</screen>
	</step>

	<step>
	  <para>Шинэ үүсгэсэн <devicename>gr0</devicename>
	    төхөөрөмжийг хуваагаад түүн дээр UFS файлын
	    систем үүсгэнэ:</para>

	  <screen>&prompt.root; <userinput>gpart create -s GPT /dev/raid3/gr0</userinput>
&prompt.root; <userinput>gpart add -t freebsd-ufs /dev/raid3/gr0</userinput>
&prompt.root; <userinput>newfs -j /dev/raid3/gr0p1</userinput></screen>

	  <para>Дэлгэц дээгүүр олон тоо урсах бөгөөд
	    хэсэг хугацааны дараа процесс дуусах болно. Эзлэхүүн
	    үүсч холбох боломжтой болно.</para>
	</step>

	<step>
	  <para>Сүүлийн алхам бол файлын системийг холбох явдал юм:</para>

	  <screen>&prompt.root; <userinput>mount /dev/raid3/gr0p1 /multimedia/</userinput></screen>

	  <para><acronym>RAID</acronym>3 массивыг одоо ашиглаж
	    болно.</para>
	</step>
      </procedure>

      <para>Дээрх тохиргоог систем дахин ачаалахад алдагдуулахгүйн
	тулд нэмэлт тохиргоо хэрэгтэй.</para>

      <procedure>
	<step>
	  <para>Массивыг холбохоос өмнө <filename>geom_raid3.ko</filename>
	    модулийг ачаалах ёстой. Систем эхлэхэд цөмийн модулийг
	    автоматаар ачаалахын тулд дараах мөрийг
	    <filename>/boot/loader.conf</filename> файлд нэмж өгнө:</para>

	  <programlisting>geom_raid3_load="YES"</programlisting>
	</step>

	<step>
	  <para>Систем ачаалах процессын явцад массивын
	    файлын системийг автоматаар холбохын тулд
	    дараах эзлэхүүний мэдээллийг
	    <filename>/etc/fstab</filename> файлд нэмэх
	    хэрэгтэй:</para>

	  <programlisting>/dev/raid3/gr0p1	/multimedia	ufs	rw	2	2</programlisting>
	</step>
      </procedure>
    </sect2>
  </sect1>

  <sect1 id="geom-ggate">
    <title>GEOM Хаалга Сүлжээний Төхөөрөмжүүд</title>

    <para>GEOM нь хаалга хэрэгслүүдийг ашиглан дискнүүд, CD-ROM-ууд,
	файлууд гэх мэт төхөөрөмжүүдийг алсаас ашиглахыг дэмждэг.
	Энэ нь <acronym>NFS</acronym>-тэй адил юм.</para>

    <para>Экспортын файл эхэлж үүсгэх шаардлагатай. Энэ файл нь
	экспорт хийгдсэн эх үүсвэрүүдэд хэнийг хандахыг зөвшөөрсөн болон
	ямар түвшний хандалтыг тэд өгч байгааг тусгадаг. Жишээ нь эхний
	<acronym>SCSI</acronym> диск дээр 4 дэх зүсмэлийг экспорт
	хийхийн тулд дараах
	<filename>/etc/gg.exports</filename>
	нь хангалттай:</para>

    <programlisting>192.168.1.0/24 RW /dev/da0s4d</programlisting>

    <para>Энэ нь дотоод сүлжээний бүх хостууд <devicename>da0s4d</devicename>
	хуваалт дээрх файлын системд хандах хандалтыг зөвшөөрнө.</para>

    <para>Энэ төхөөрөмжийг экспорт хийхдээ тухайн үед холболт хийгдээгүй эсэхийг шалгаад
	&man.ggated.8; сервер дэмонг ажиллуулаарай:</para>

    <screen>&prompt.root; <userinput>ggated</userinput></screen>

    <para>Хэрэглэх машинаас уг экспортлогдсон төхөөрөмжид <command>холболт</command> хийхдээ
	дараах тушаалыг өгнө үү:</para>

    <screen>&prompt.root; <userinput>ggatec create -o rw 192.168.1.1 /dev/da0s4d</userinput>
ggate0
&prompt.root; <userinput>mount /dev/ggate0 /mnt</userinput></screen>

    <para>Эндээс эхлэн төхөөрөмжид <filename class="directory">/mnt</filename>
	холболтын цэгийг ашиглан хандаж болно.</para>

    <note>
      <para>Хэрэв төхөөрөмж тухайн үед сервер машин эсвэл сүлжээн дэх өөр бусад машин
	дээр холболт хийгдсэн байсан бол энэ нь амжилтгүй болохыг сануулъя.</para>
    </note>

    <para>Төхөөрөмж дахин шаардлагагүй болоход бусад дискний төхөөрөмжүүдийн нэгэн адил
	&man.umount.8; тушаалын тусламжтайгаар салгаж болно.</para>
  </sect1>

  <sect1 id="geom-glabel">
    <title>Дискний төхөөрөмжүүдийг хаяглах нь</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>Дискний хаяг/шошгонууд</primary>
    </indexterm>

    <para>Системийг эхлүүлэх явцад &os; цөм төхөөрөмжүүдийг олж төхөөрөмжийн
	цэгүүдийг үүсгэдэг. Төхөөрөмжүүдийг илрүүлэх энэ арга нь зарим нэг
	асуудлуудтай байдаг, жишээ нь шинэ дискний төхөөрөмж <acronym>USB</acronym>-ээр
	нэмэгдсэн бол яах вэ? Флэш төхөөрөмжид <devicename>da0</devicename> гэсэн
	төхөөрөмжийн нэр өгөгдөж хуучин байсан <devicename>da0</devicename> нь
	<devicename>da1</devicename> болж өөрчлөгдөх болов уу. Энэ нь хэрэв
	файлын системүүд <filename>/etc/fstab</filename>-д жагсаагдсан
	бол тэдгээрийг холбоход асуудал гаргах бөгөөд бүр системийг ачаалахгүй
	байдалд хүргэж болох юм.</para>

    <para>Энэ асуудлын нэг шийдэл нь <acronym>SCSI</acronym> карт руу нэмэгдсэн
	шинэ төхөөрөмжид төхөөрөмжийн ашиглагдаагүй дугаарууд өгөгдөхөөр болгож
	<acronym>SCSI</acronym> төхөөрөмжүүдийг гинжин цуваа болгох явдал юм.
	Гэхдээ анхдагч <acronym>SCSI</acronym> дискийг сольж болзошгүй
	<acronym>USB</acronym> төхөөрөмжүүдийн хувьд яах вэ? Яагаад гэвэл <acronym>USB</acronym>
	төхөөрөмжүүд нь ихэвчлэн <acronym>SCSI</acronym> картнуудаас өмнө
	шалгагддаг. Үүний нэг шийдэл нь эдгээр төхөөрөмжүүдийг системийг ачаалсны
	дараа залгах явдал юм. Өөр нэг арга нь зөвхөн ганц <acronym>ATA</acronym>
	хөтөч ашиглаж <acronym>SCSI</acronym> төхөөрөмжүүдийг
	<filename>/etc/fstab</filename> файлд хэзээ ч жагсаахгүй байх тийм
	шийдэл байж болох юм.</para>

    <para>Илүү сайн шийдэл байдаг. <command>glabel</command> хэрэгсэл ашиглан
	администратор эсвэл хэрэглэгч өөрсдийн дискний төхөөрөмжүүдийг хаяглаж эдгээр
	хаяг/шошгонуудыг <filename>/etc/fstab</filename> файлд ашиглаж болох
	юм. <command>glabel</command> нь өгөгдсөн үзүүлэгчийн сүүлийн секторт
	хаяг/шошгыг хадгалдаг болохоор хаяг/шошго нь дахин ачаалахад хэвээр байх
	болно. Энэ хаяг/шошгыг төхөөрөмж маягаар ашигласнаар ямар төхөөрөмжийн
	цэгээр дамжин хандаж байгаагаас үл хамааран файлын систем нь үргэлж холбогдох
	юм.</para>

    <note>
      <para>Хаяг/шошгыг байнгын болгохыг энд дурдсангүй. <command>glabel</command>
	хэрэгсэл нь түр зуурын болон байнгын хаяг/шошгыг үүсгэхэд ашиглагдаж болно.
	Зөвхөн байнгын хаяг/шошго нь дахин ачаалахад хэвээр үлдэх болно. Хаяг/шошгонуудын
	ялгаануудын тухай дэлгэрэнгүй мэдээллийг &man.glabel.8; гарын авлагын хуудаснаас
	үзнэ үү.</para>
    </note>

    <sect2>
      <title>Хаяг/шошгоны төрлүүд болон жишээнүүд</title>

      <para>Ерөнхий ба файлын системийн гэсэн хоёр төрлийн хаяг/шошго байдаг.
	Хаяг, шошгонууд нь байнгын эсвэл түр зуурын байж болно. Байнгын хаягийг
	&man.tunefs.8; эсвэл &man.newfs.8; тушаалаар үүсгэж болно. Эдгээр
	хаяг/шошгонуудад тэдгээрийн файлын системийн төрөл дээр суурилсан нэр
	бүхий тусгай сан <filename class="directory">/dev</filename>
	сан дотор үүсгэгддэг. Жишээ нь <acronym>UFS</acronym>2 файлын системийн
	хаяг/шошгонууд <filename class="directory">/dev/ufs</filename> санд
	үүсгэгддэг. Байнгын хаягийг бас <command>glabel label</command> тушаалаар
	үүсгэж болдог. Эдгээр нь файлын системтэй хамааралгүй бөгөөд <filename
	  class="directory">/dev/label</filename> санд үүсгэгдэх болно.</para>

      <para>Түр зуурын хаяг/шошго нь дараагийн удаа ачаалахад арилдаг. Эдгээр хаяг/шошгонууд
	нь <filename class="directory">/dev/label</filename> санд үүсгэгдэх
	бөгөөд туршилтад сайн тохирсон байдаг. Түр зуурын хаягийг <command>glabel create</command>
	тушаалаар үүсгэж болно. Дэлгэрэнгүй мэдээллийг &man.glabel.8;-ийн гарын авлагын
	хуудаснаас уншина уу.</para>

<!-- XXXTR: How do you create a file system label without running newfs
            or when there is no newfs (e.g.: cd9660)? -->

      <para>Өгөгдлийг устгалгүйгээр <acronym>UFS</acronym>2 файлын системийн хувьд байнгын
	хаяг/шошго үүсгэхийн тулд доор дурдсан тушаалуудыг ажиллуулна:</para>

      <screen>&prompt.root; <userinput>tunefs -L <replaceable>home</replaceable> <replaceable>/dev/da3</replaceable></userinput></screen>

      <warning>
	<para>Хэрэв файлын систем дүүрэн бол энэ нь өгөгдлийн эвдрэлд хүргэж
	болох юм; гэхдээ хэрэв файлын систем дүүрэн бол гол зорилго нь
	хуучирсан файлуудыг устгаж хаяг/шошгонуудыг нэмэхгүй байх
	явдал юм.</para>
      </warning>

      <para>Хаяг/шошго одоо <filename class="directory">/dev/ufs</filename> санд
	үүссэн байх ёстой бөгөөд түүнийг <filename>/etc/fstab</filename> файлд нэмж
	болох юм:</para>

      <programlisting>/dev/ufs/home		/home            ufs     rw              2      2</programlisting>

      <note>
	<para><command>tunefs</command>-г ажиллуулахдаа файлын системийг
	холбох ёсгүй.</para>
      </note>

      <para>Одоо файлын системийг ердийнхөөрөө холбож болно:</para>

      <screen>&prompt.root; <userinput>mount /home</userinput></screen>

      <para>Эндээс эхлэн ачаалах явцад <filename>/boot/loader.conf</filename> файлын
	тусламжтайгаар <filename>geom_label.ko</filename> цөмийн модуль дуудагдсан байхад
	эсвэл  <literal>GEOM_LABEL</literal> цөмийн тохируулга байхад
	төхөөрөмжийн цэг системд ямар нэгэн буруу нөлөөлөлгүйгээр өөрчлөгдөж болох
	юм.</para>

      <para>Файлын систем нь <command>newfs</command> тушаалд
	өгөгдсөн <option>-L</option> тугны тусламжтайгаар анхдагч хаяг/шошготой
	үүсгэгдэж бас болно. Дэлгэрэнгүй мэдээллийг &man.newfs.8; гарын авлагын хуудаснаас
	үзнэ үү.</para>

      <para>Доор дурдсан тушаалыг хаяг/шошгыг устгахдаа ашиглаж болно:</para>

      <screen>&prompt.root; <userinput>glabel destroy home</userinput></screen>

      <para>Ачаалах дискийн хуваалтуудыг хэрхэн хаяглахыг дараах жишээ
	харуулж байна.</para>

      <example>
	<title>Ачаалах диск дээрх хуваалтуудыг хаяглах нь</title>

	<para>Ачаалах диск дээрх хуваалтуудыг байнгын байдлаар хаягласнаар
	  дискийг өөр хянагч руу эсвэл өөр систем рүү шилжүүлсэн ч
	  гэсэн систем хэвийнээр ачаалж чаддаг болох юм. Энэ жишээний хувьд
	  системээр <devicename>ad0</devicename> гэж танигдсан ганц
	  <acronym>ATA</acronym> диск хэрэглэгдэж байгаа болно.
	  Бас <filename class="directory">/</filename>,
	  <filename class="directory">/var</filename>,
	  <filename class="directory">/usr</filename> ба
	  <filename class="directory">/tmp</filename> файлын системүүд
	  болон swap хуваалттай &os;-ийн стандарт хуваалтын хэлбэрийг
	  ашиглаж байгаа болно.</para>

	<para>Системийн дахин ачаалж ганц хэрэглэгчийн горимд ачаалж орохын тулд
	  &man.loader.8; тушаал хүлээх мөрөнд <keycap>4</keycap> товчлуурыг дарна.
	  Дараа нь дараах тушаалуудыг ажиллуулна:</para>

	<screen>&prompt.root; <userinput>glabel label rootfs /dev/ad0s1a</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
&prompt.root; <userinput>glabel label var /dev/ad0s1d</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
&prompt.root; <userinput>glabel label usr /dev/ad0s1f</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
&prompt.root; <userinput>glabel label tmp /dev/ad0s1e</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
&prompt.root; <userinput>glabel label swap /dev/ad0s1b</userinput>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
&prompt.root; <userinput>exit</userinput></screen>

	<para>Систем нь олон хэрэглэгчийн ачаалах горимоор үргэлжлэх болно.
	  Ачаалж дууссаны дараа <filename>/etc/fstab</filename> файлыг
	  засварлаж ердийн төхөөрөмжийн нэрсийг тохирох хаягуудаар солиорой.
	  Төгсгөлийн <filename>/etc/fstab</filename> файл доорхтой адил
	  харагдах болно:</para>

	<programlisting># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</programlisting>

	<para>Системийг одоо дахин ачаалж болно. Хэрэв бүгд зөв болсон бол энэ нь
	  хэвийн гарч ирэх бөгөөд <command>mount</command> тушаал дараахийг харуулах
	  болно:</para>

	<screen>&prompt.root; <userinput>mount</userinput>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</screen>
      </example>

      <para>&os;&nbsp;7.2-оос эхлэн &man.glabel.8; ангилал
	<acronym>UFS</acronym> файлын системийн хувьд давхардахгүй
	файлын системийн id <literal>ufsid</literal> дээр тулгуурлан
	шинэ хаягийн төрлийг дэмждэг. Эдгээр хаягууд нь
	<filename class="directory">/dev/ufsid</filename> санд байрлах
	бөгөөд системийн эхлэх явцад автоматаар үүсдэг.
	Хуваалтуудыг <filename>/etc/fstab</filename> боломжийг
	ашиглан холбохын тулд <literal>ufsid</literal> хаягийг
	ашиглах боломжтой байдаг. Файлын системийн жагсаалт болон
	тэдгээр файл системийн харгалзах <literal>ufsid</literal>
	хаягуудыг авахын тулд <command>glabel status</command> тушаал
	ашиглана:</para>

      <screen>&prompt.user; <userinput>glabel status</userinput>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</screen>

      <para>Дээрхи жишээн дээр <devicename>ad4s1d</devicename> нь
	<filename class="directory">/var</filename> файлын системийг
	илэрхийлж байгаа бол <devicename>ad4s1f</devicename> нь
	<filename class="directory">/usr</filename> файлын системийг
	илэрхийлж байна. Үзүүлсэн <literal>ufsid</literal> утгуудыг
	ашиглан эдгээр хуваалтуудыг <filename>/etc/fstab</filename>
	дахь дараах оруулгуудын тусламжтайгаар холбож болох юм:</para>

      <programlisting>/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</programlisting>

      <para><literal>ufsid</literal> хаягтай ямар ч хуваалтыг энэ
	аргаар холбож болох юм. Ингэснээр тэдгээрийн хувьд байнгын
	хаягийг үүсгэх шаардлагагүйгээс гадна төхөөрөмжийн нэрнээс үл
	хамаарах холболтын ашигтай талыг авсан хэвээр байх болно.</para>
    </sect2>
  </sect1>

  <sect1 id="geom-gjournal">
    <title>GEOM-ийн тусламжтай UFS тэмдэглэл</title>

    <indexterm>
      <primary>GEOM</primary>
    </indexterm>
    <indexterm>
      <primary>Journaling</primary>
    </indexterm>

    <para>&os;&nbsp;7.0 хувилбар гарснаар удаан хүсэн хүлээсэн
	journals буюу тэмдэглэлийн боломж бүрдсэн билээ.
	Энэхүү шийдэл нь өөрөө <acronym>GEOM</acronym> дэд системийн
	тусламжтайгаар хийгдсэн бөгөөд &man.gjournal.8; хэрэгслийн
	тусламжтай хялбар тохируулж болдог.</para>

    <para>Journaling буюу тэмдэглэл гэж юу вэ?  Тэмдэглэх чадвар
	нь файлын системийн шилжүүлгүүдийн бүртгэлийг хадгалдаг, өөрөөр
	хэлбэл мета өгөгдөл болон файлын бичилтүүд дискэнд зөвөөр хийгдэхээс
	өмнө дискний бүрэн гүйцэд бичих үйлдлийг бүтээдэг өөрчлөлтүүдийн
	бүртгэлийг хадгалдаг. Файлын системийн бүрэн бус байдлаас
	хамгаалахын тулд файлын системийн шилжүүлгүүдийг дахин гүйцэтгэхийн
	тулд энэхүү шилжүүлгүүдийн бүртгэлийг дараа нь дахин
	ажиллуулж болдог.</para>

    <para>Энэхүү арга нь файлын системийн бүрэн бус байдал болон өгөгдлийн
	алдагдлын эсрэг хамгаалах өөр нэг арга зам юм. Мета өгөгдлийн
	шинэчлэлүүд болон файлын системийн дүрс болох Хормын хувилбаруудыг
	хянаж мөрдүүлж байдаг Зөөлөн Шинэчлэлүүдээс ялгаатай нь бүртгэлийн
	файл нь энэ үйлдэлд тусгайлан зориулсан дискийн талбарт хадгалагддаг
        бөгөөд зарим тохиолдолд өөр диск дээр тэр чигээрээ хадгалагдаж болдог.</para>

    <para>Өөр бусад файлын системийн тэмдэглэлийн шийдлүүдээс ялгаатай нь
	<command>gjournal</command> арга нь блок дээр тулгуурласан бөгөөд
	файлын системийн хэсэг болж хийгдээгүй, зөвхөн <acronym>GEOM</acronym>
	өргөтгөлийн хүрээнд хийгдсэн.</para>

    <para><command>gjournal</command>-д зориулсан дэмжлэгийг идэвхжүүлэхийн
	тулд &os; цөм нь 7.0 болон түүнээс хойшхи системүүд дээр анхдагчаар байдаг доор дурдсан
	тохируулгатай байх ёстой:</para>

    <programlisting>options	UFS_GJOURNAL</programlisting>

    <para>Хэрэв тэмдэглэл үүсгэгдсэн эзлэхүүнүүдийг ачаалж эхлэхэд холбох
      шаардлагатай бол <filename>/boot/loader.conf</filename> файлд
      дараах мөрийг нэмж цөмийн <filename>geom_journal.ko</filename>
      модулийг бас дуудах хэрэгтэй болно:</para>

    <programlisting>geom_journal_load="YES"</programlisting>

    <para>Мөн дараах мөрийг цөмийн тохиргооны файлд нэмж үүнийг өөрчлөн
      тохируулсан цөмд бас бүтээж болох юм:</para>

    <programlisting>options	GEOM_JOURNAL</programlisting>

    <para><devicename>da4</devicename> нь шинэ <acronym>SCSI</acronym> диск
	гэж тооцвол чөлөөтэй файлын систем дээр тэмдэглэл үүсгэхийн тулд
	одоо доор дурдсан алхмуудыг ашиглан хийж
	болно:</para>

    <screen>&prompt.root; <userinput>gjournal load</userinput>
      &prompt.root; <userinput>gjournal label /dev/da4</userinput></screen>

    <para>Энэ үед <devicename>/dev/da4</devicename> төхөөрөмжийн цэг
	болон <devicename>/dev/da4.journal</devicename> төхөөрөмжийн цэг
	үүссэн байх ёстой. Одоо энэ төхөөрөмж дээр файлын системийг
	үүсгэж болно:</para>

    <screen>&prompt.root; <userinput>newfs -O 2 -J /dev/da4.journal</userinput></screen>

    <para>Өмнө ажиллуулсан тушаал <acronym>UFS</acronym>2
	файлын системийг тэмдэгдэл идэвхжсэн төхөөрөмж дээр үүсгэх
	болно.</para>

    <para>Төхөөрөмжийг хүссэн цэгтээ доор дурдсан тушаалаар
	<command>mount</command> хийнэ:</para>

    <screen>&prompt.root; <userinput>mount /dev/da4.journal <replaceable>/mnt</replaceable></userinput></screen>

    <note>
      <para>Хэд хэдэн зүсмэлүүдийн тухайд тэмдэглэл нь зүсмэл бүр
	дээр үүсгэгдэх болно. Жишээ нь хэрэв <devicename>ad4s1</devicename> болон <devicename>ad4s2</devicename> нь
	хоёулаа зүсмэл бол <command>gjournal</command> нь
	<devicename>ad4s1.journal</devicename> болон <devicename>ad4s2.journal</devicename> үүсгэх болно.</para>
    </note>

    <para>Хурдан ажиллагаатай байхын тулд тэмдэглэлийг өөр диск дээр байлгах нь
	зүйтэй байдаг. Энэ тохиолдолд тэмдэглэл хангагч эсвэл
	хадгалалтын төхөөрөмж нь тэмдэглэлийг идэвхжүүлэхийн тулд
	уг төхөөрөмжийнхөө дараа жагсаагдах ёстой. <command>tunefs</command>
	тушаал ашиглан тухайн байгаа файлын систем дээр тэмдэглэлийг
	идэвхжүүлж болдог; гэхдээ файлын системийг өөрчлөхөөсөө өмнө
	нөөц үргэлж хийж байх хэрэгтэй. Ихэнх тохиолдолд
	<command>gjournal</command> нь яг тэмдэглэлийг үүсгэж
	чадаагүй бол амжилтгүй болох бөгөөд гэхдээ энэ нь
	<command>tunefs</command>-ийг буруугаар ашигласнаас болоод
	үүссэн өгөгдлийн алдагдлаас хамгаалж чадахгүй юм.</para>

    <para>&os; системийн эхлүүлэх дискийг тэмдэглэх бас боломжтой байдаг.
      Үүний талаарх дэлгэрэнгүй зааврыг <ulink
	url="&url.articles.gjournal-desktop;">Ширээний PC дээр UFS тэмдэглэлийг
	хийх нь</ulink> гэсэн нийтлэлээс үзнэ үү.</para>
  </sect1>
</chapter>
