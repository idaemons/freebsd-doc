<?xml version="1.0" encoding="koi8-r"?>
<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/users/chapter.xml,v 1.19 2008/05/13 13:46:29 den Exp $

     Original revision: r43126
-->

<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="users">
  <info>
    <title>Пользователи и основы управления учетными записями</title>

    <authorgroup>
      <author><personname><firstname>Neil</firstname><surname>Blakey-Milner</surname></personname><contrib>Предоставил </contrib></author>
    </authorgroup>
    
    <authorgroup>
      <author><personname><firstname>Денис</firstname><surname>Пеплин</surname></personname><contrib>Перевод на русский язык: </contrib></author>
    </authorgroup>
  </info>

  <sect1 xml:id="users-synopsis">
    <title>Краткий обзор</title>

    <para>&os; позволяет одновременную работу множества пользователей на одном
      компьютере.  В то время, как только один пользователь может сидеть
      за клавиатурой и перед экраном в один момент времени, любое количество
      пользователей может войти в систему через сеть.  Для использования
      системы у каждого пользователя должна быть учетная запись.</para>

    <para>После прочтения этой главы вы будете знать:</para>

    <itemizedlist>
      <listitem>
	<para>Различия между разнообразными учетными записями в системе
	  &os;.</para>
      </listitem>

      <listitem>
	<para>Как добавлять и удалять учетные записи пользователей.</para>
      </listitem>

      <listitem>
	<para>Как изменять данные учетных записей пользователей, такие
	  как полное имя пользователя, или предпочитаемую оболочку.</para>
      </listitem>

      <listitem>
	<para>Как устанавливать ограничения для учетных записей или групп
	  учетных записей на использование ресурсов, таких как память и время
	  ЦПУ.</para>
      </listitem>

      <listitem>
	<para>Как использовать группы для упрощения управлением учетными
	  записями.</para>
      </listitem>
    </itemizedlist>

    <para>Перед прочтением этой главы вам потребуется:</para>

    <itemizedlist>
      <listitem>
	<para>Понимание <link linkend="basics">основ &unix;
	    и &os;</link>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="users-introduction">
    <title>Введение</title>

    <para>Так как доступ к системе &os; осуществляется через учетные записи,
      и все процессы запускаются пользователями, то управление пользователями
      и учетными записями является важным аспектом администрирования.</para>

    <para>С каждой учетной записью в системе &os; связана определенная
      идентификационная информация.</para>

    <variablelist>
      <varlistentry>
	<term>Имя пользователя</term>

	<listitem>
	  <para>Имя пользователя вводится в приглашение
	    <prompt>login:</prompt>.  Имена пользователей должны быть уникальны
	    в пределах одной системы.  Существует множество правил для создания
	    допустимых имен пользователей, документированных в &man.passwd.5;.
	    Обычно имена пользователей состоят из восьми или меньшего
	    количества символов в нижнем регистре, чтобы поддерживать обратную
	    совместимость с приложениями.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Пароль</term>

	<listitem>
	  <para>С каждой учетной записью связан пароль.  Пароль может быть
	    пустым, однако это настоятельно не рекомендуется.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>ID пользователя (User ID, <acronym>UID</acronym>)</term>

	<listitem>
	  <para>Идентификатор пользователя (<acronym>UID</acronym>) &mdash;
	    это номер, традиционно от 0 до
	    65535<footnote xml:id="users-largeuidgid">
	      <para>Возможно использование
		<acronym>UID</acronym>/<acronym>GID</acronym> вплоть до
		4294967295, но эти ID могут вызвать серьезные проблемы с
		программами, делающими предположения о значениях
		ID.</para>
	    </footnote>, используемый для однозначной идентификации
	    пользователя в системе.  Сама система &os; для идентификации
	    пользователей использует <acronym>UID</acronym>.  Любая команда
	    &os;, принимающая в качестве аргумента имя пользователя, первым
	    делом преобразует его к <acronym>UID</acronym>.  Маловероятно,
	    но возможно иметь несколько учетных записей с различными именами
	    пользователей и с одним <acronym>UID</acronym>.  &os; будет
	    воспринимать эти учетные записи как одного пользователя.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Идентификатор группы (Group ID, <acronym>GID</acronym>)</term>

	<listitem>
	  <para>Идентификатор группы (<acronym>GID</acronym>) &mdash;
	    это номер, традиционно от 0 до
	    65535<footnoteref linkend="users-largeuidgid"/>, используемый
	    для однозначной идентификации главной группы, к которой
	    принадлежит пользователь.  Группы это механизм для контроля
	    доступа к ресурсам на основе <acronym>GID</acronym> пользователя
	    вместо его <acronym>UID</acronym>.  Это может значительно уменьшить
	    размер некоторых файлов настройки.  Кроме того, пользователь может
	    быть включен более чем в одну группу.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Класс логина</term>

	<listitem>
	  <para>Классы логинов это расширение к механизму групп,
	    позволяющее системе более гибко управлять различными
	    пользователями.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Время изменения пароля</term>

	<listitem>
	  <para>По умолчанию &os; не принуждает пользователей менять пароли.
	    Однако, есть возможность ограничить срок действия текущего пароля
	    пользователя, и тем самым обязать его обновить пароль.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Время истечения действия учетной записи</term>

	<listitem>
	  <para>По умолчанию во &os; время действия учетных записей не
	    ограничено.  При создании учетных записей ограниченного срока
	    действия, например для студентов в учебном заведении,
	    укажите дату истечения действия учетной записи.  После наступления
	    указанной даты учетная запись становится непригодной для входа
	    в систему, хотя каталоги и файлы этой учетной записи останутся
	    нетронутыми.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Полное имя пользователя</term>

	<listitem>
	  <para>Имя пользователя является уникальным идентификатором
	    учетной записи в &os;, но недостаточно для сопоставления
	    с реальным именем пользователя.  Эта информация может быть
	    добавлена в учетную запись.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Домашний каталог</term>

	<listitem>
	  <para>Домашний каталог определяется полным путем в системе.
	    С него пользователь начнет работу после входа в систему.  По
	    общепринятому соглашению все домашние каталоги пользователей
	    помещаются в <filename>/home/username</filename> или
	    <filename>/usr/home/username</filename>.  Пользователи хранят
	    личные файлы и подкаталоги в своих домашних каталогах.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Оболочка пользователя</term>

	<listitem>
	  <para>Оболочка необходима пользователям как средство взаимодействия
	    с системой.  Существует множество различных видов
	    оболочек, опытные пользователи работают с собственными
	    настройками, которые могут быть отражены в установках их учетных
	    записей.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Существует три основных типа учетных записей:
      <link linkend="users-superuser">суперпользователь</link>,
      <link linkend="users-system">системные учетные записи</link>, и
      <link linkend="users-user">учетные записи пользователей</link>.
      Учетная запись суперпользователя, обычно называемая
      <systemitem class="username">root</systemitem>, используется для
      управления системой без ограничения привилегий.  Системные учетные записи
      создаются для работы сервисов.  Наконец, учетные записи пользователей
      необходимы обычным людям для входа в систему, чтения почты, и так
      далее.</para>

    <sect2 xml:id="users-superuser">
    <title>Учетная запись суперпользователя</title>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary>суперпользователь (root)</secondary>
    </indexterm>
    <para>Учетная запись суперпользователя, обычно называемая
      <systemitem class="username">root</systemitem>, существует
      для целей системного администрирования, и не должна использоваться
      для повседневных задач, таких как получение и отправка почты,
      общее исследование системы или программирование.</para>

    <para>Причина в том, что суперпользователь, в отличие от обычных
      пользователей, может работать без ограничений и неправильное
	использование учетной записи суперпользователя может привести к полному
	уничтожению системы.  Учетные записи пользователей не способны
	уничтожить систему вследствие ошибки, поэтому если нет необходимости
	в привилегиях суперпользователя, то лучше использовать учетные записи
	обычных пользователей везде, где это возможно.</para>

      <para>Всегда перепроверяйте и переперепроверяйте команды, выполняемые под
	учетной записью суперпользователя, поскольку даже один лишний пробел
	или отсутствующий символ может привести к безвозвратной потере
	данных.</para>

      <para>Всегда создавайте учетную запись пользователя для системного
	администратора и используйте ее для повседневной работы.
	Это правило одинаково применимо как к многопользовательской, так и
	к однопользовательской системе.  В последующих разделах будет описано
	как создать дополнительные учетные записи, и как менять уровень
	привилегий между нормальным пользователем и суперпользователем.</para>
    </sect2>

    <sect2 xml:id="users-system">
    <title>Системные учетные записи</title>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary>системные</secondary>
    </indexterm>
      <para>Системные учетные записи предназначены для запуска сервисов, таких
	как DNS, почта, веб серверы.  Это необходимо по соображениям
	безопасности; если бы все сервисы работали от суперпользователя, они
	могли бы действовать без ограничений.</para>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary><systemitem class="username">daemon</systemitem></secondary>
    </indexterm>
    <indexterm>
      <primary>учетные записи</primary>
      <secondary><systemitem class="username">operator</systemitem></secondary>
    </indexterm>
      <para>Примеры системных учетных записей:
	<systemitem class="username">daemon</systemitem>,
	<systemitem class="username">operator</systemitem>,
	<systemitem class="username">bind</systemitem>,
	<systemitem class="username">news</systemitem> и
	<systemitem class="username">www</systemitem>.</para>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary><systemitem class="username">nobody</systemitem></secondary>
    </indexterm>
    <para><systemitem class="username">nobody</systemitem> это общепринятая
	непривилегированная системная учетная запись.  Однако, чем больше
	сервисов используют
	<systemitem class="username">nobody</systemitem>, тем больше файлов
	и процессов связано с этим пользователем, и следовательно
	тем больше прав появляется у этого пользователя.</para>
    </sect2>

    <sect2 xml:id="users-user">
    <title>Учетные записи пользователей</title>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary>пользователей</secondary>
    </indexterm>
      <para>Учетные записи пользователей служат для предоставления доступа
	к системе обычным людям.  Эти учетные записи изолируют пользователей и
	их рабочую среду, предотвращая возможность повреждения ими системы или
	данных других пользователей, и позволяя пользователям настраивать свою
	рабочую среду без влияния на других пользователей.</para>

      <para>Каждая персона, получающая доступ к системе, должна иметь
	уникальную учетную запись пользователя.  Это позволит администратору
	выяснить кто что делает, предотвращая сбивание одним пользователем
	настроек других пользователей, чтение чужой почты и так далее.</para>

    <para>Каждый пользователь может настраивать свою собственную рабочую
	среду для приспособления системы под свои нужды выбирая оболочки,
	редакторы, привязки клавиш и настройки языка.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="users-modifying">
    <title>Изменение учетных записей</title>

    <indexterm>
      <primary>учетные записи</primary>
      <secondary>изменение</secondary>
    </indexterm>

    <para>&os; предоставляет различные команды для работы с учетными
      записями пользователей.  Наиболее часто используемые команды приведены
      в таблице, ниже находятся более детальные примеры их
      использования.</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="2">
	<colspec colwidth="1*"/>
	<colspec colwidth="2*"/>
	<thead>
	  <row>
	    <entry>Команда</entry>
	    <entry>Краткое описание</entry>
	  </row>
	</thead>
	<tbody>
	  <row>
	    <entry>&man.adduser.8;</entry>
	    <entry>Рекомендуемое приложение командной строки для добавления
	      новых пользователей.</entry>
	  </row>
	  <row>
	    <entry>&man.rmuser.8;</entry>
	    <entry>Рекомендуемое приложение командной строки для удаления
	      пользователей.</entry>
	  </row>
	  <row>
	    <entry>&man.chpass.1;</entry>
	    <entry>Гибкий инструмент для изменения информации в базе данных
	      пользователей.</entry>
	  </row>
	  <row>
	    <entry>&man.passwd.1;</entry>
	    <entry>Простой инструмент командной строки для изменения паролей
	      пользователей.</entry>
	  </row>
	  <row>
	    <entry>&man.pw.8;</entry>
	    <entry>Мощный и гибкий инструмент для изменения любой информации,
	      связанной с учетными записями пользователей.</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <sect2 xml:id="users-adduser">
      <title><command>adduser</command></title>

      <indexterm>
	<primary>учетные записи</primary>
	<secondary>добавление</secondary>
      </indexterm>
      <indexterm>
	<primary><command>adduser</command></primary>
      </indexterm>
      <indexterm>
	<primary><filename>/usr/share/skel</filename></primary>
      </indexterm>
      <indexterm><primary>каталог шаблонов</primary></indexterm>
      <indexterm><primary>skeleton directory</primary></indexterm>
      <para>&man.adduser.8; это простая программа для добавления новых
	пользователей.  Во время добавления нового пользователя программа
	автоматически обновляет <filename>/etc/passwd</filename> и
	<filename>/etc/group</filename>.  Она также создает домашний каталог
	для нового пользователя, копируя файлы настройки по умолчанию из
	<filename>/usr/share/skel</filename>, и может отправлять новому
	пользователю приветственное сообщение электронной почтой.</para>

      <example>
	<title>Добавление пользователя в &os;</title>

	<screen>&prompt.root; <userinput>adduser</userinput>
Username: <userinput>jru</userinput>
Full name: <userinput>J. Random User</userinput>
Uid (Leave empty for default):
Login group [jru]:
Login group is jru. Invite jru into other groups? []: <userinput>wheel</userinput>
Login class [default]:
Shell (sh csh tcsh zsh nologin) [sh]: <userinput>zsh</userinput>
Home directory [/home/jru]:
Home directory permissions (Leave empty for default):
Use password-based authentication? [yes]:
Use an empty password? (yes/no) [no]:
Use a random password? (yes/no) [no]:
Enter password:
Enter password again:
Lock out the account after creation? [no]:
Username   : jru
Password   : ****
Full Name  : J. Random User
Uid        : 1001
Class      :
Groups     : jru wheel
Home       : /home/jru
Shell      : /usr/local/bin/zsh
Locked     : no
OK? (yes/no): <userinput>yes</userinput>
adduser: INFO: Successfully added (jru) to the user database.
Add another user? (yes/no): <userinput>no</userinput>
Goodbye!
&prompt.root;</screen>
      </example>

      <note>
	<para>Так как вводимый текст не отображается, убедитесь, что не было
	  допущено опечаток в пароле при создании учетной записи.</para>
      </note>
    </sect2>

    <sect2 xml:id="users-rmuser">
      <title><command>rmuser</command></title>

      <indexterm><primary><command>rmuser</command></primary></indexterm>
      <indexterm>
	<primary>учетные записи</primary>
	<secondary>удаление</secondary>
      </indexterm>

      <para>Для полного удаления пользователя из системы воспользуйтесь
	&man.rmuser.8;.  Эта программа выполняет следующие действия:</para>

      <procedure>
	<step>
	  <para>Если в &man.crontab.1; существуют записи пользователя, то они
	    удаляются.</para>
	</step>

	<step>
	  <para>Удаляются принадлежащие пользователю задачи &man.at.1;.</para>
	</step>

	<step>
	  <para>Уничтожаются все процессы, принадлежащие пользователю.</para>
	</step>

	<step>
	  <para>Удаляется запись пользователя из локального файла
	    паролей.</para>
	</step>

	<step>
	  <para>Если домашний каталог принадлежит пользователю, то каталог
	    удаляется.</para>
	</step>

	<step>
	  <para>Удаляется принадлежащая пользователю входящая почта из
	    <filename>/var/mail</filename>.</para>
	</step>

	<step>
	  <para>Удаляются все файлы, принадлежащие пользователю, из каталогов
	    с временными файлами, например
	    <filename>/tmp</filename>.</para>
	</step>

	<step>
	  <para>Наконец, в <filename>/etc/group</filename> из всех групп
	    удаляется имя пользователя.</para>

	    <note>
	      <para>Если после этого удаления группа остается пустой и
		имя группы совпадает с именем пользователя, она удаляется.
		Это необходимо для удаления пользовательских уникальных
		групп, создаваемых &man.adduser.8;.</para>
	    </note>
	</step>
      </procedure>

      <para>&man.rmuser.8; не может использоваться для удаления учетной
	записи суперпользователя, поскольку это почти всегда означает
	разрушение системы.</para>

      <para>По умолчанию используется интерактивный режим, это показано
	в следующем примере.</para>

      <example>
	<title>Интерактивное удаление учетной записи с помощью
	  <command>rmuser</command></title>

	<screen>&prompt.root; <userinput>rmuser jru</userinput>
Matching password entry:
jru:*:1001:1001::0:0:J. Random User:/home/jru:/usr/local/bin/zsh
Is this the entry you wish to remove? <userinput>y</userinput>
Remove user's home directory (/home/jru)? <userinput>y</userinput>
Updating password file, updating databases, done.
Updating group file: trusted (removing group jru -- personal group is empty) done.
Removing user's incoming mail file /var/mail/jru: done.
Removing files belonging to jru from /tmp: done.
Removing files belonging to jru from /var/tmp: done.
Removing files belonging to jru from /var/tmp/vi.recover: done.
&prompt.root;</screen>
      </example>
    </sect2>

    <sect2 xml:id="users-chpass">
      <title><command>chpass</command></title>

      <indexterm><primary><command>chpass</command></primary></indexterm>
      <para>&man.chpass.1; может быть использована для изменения информации
	в базе данных пользователей: пароли, оболочки, персональные
	данные.</para>

      <para>Только суперпользователь может изменять информацию и пароли других
	пользователей с помощью &man.chpass.1;.</para>

      <para>При запуске без параметров (кроме опционального имени
	пользователя), &man.chpass.1; вызывает редактор, содержащий
	информацию о пользователе.  Когда пользователь выходит из редактора,
	база данных пользователей обновляется новой информацией.</para>

      <note>
	<para>Если вы не суперпользователь, то после выхода из редактора будет
	  запрошен пароль.</para>
      </note>

      <example>
	<title>Интерактивная работа с <command>chpass</command>
	  суперпользователя</title>

	<screen>#Changing user database information for jru.
Login: jru
Password: *
Uid [#]: 1001
Gid [# or name]: 1001
Change [month day year]:
Expire [month day year]:
Class:
Home directory: /home/jru
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</screen>
      </example>

      <para>Пользователи могут изменять лишь небольшую часть этой
	информации, и только для своей учетной записи.</para>

      <example>
	<title>Интерактивная работа с <command>chpass</command> обычного
	  пользователя</title>

	<screen>#Changing user database information for jru.
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</screen>
      </example>

      <note>
	<para>&man.chfn.1; и &man.chsh.1; это ссылки на
	  &man.chpass.1;, как и &man.ypchpass.1;, &man.ypchfn.1; и
	  &man.ypchsh.1;.  <acronym>NIS</acronym> поддерживается автоматически,
	  так что указание <literal>yp</literal> перед командой не обязательно.
	  Настройка <acronym>NIS</acronym> будет рассмотрена в
	  <xref linkend="network-servers"/>.</para>
      </note>
    </sect2>
    <sect2 xml:id="users-passwd">
      <title><command>passwd</command></title>

      <indexterm><primary><command>passwd</command></primary></indexterm>
      <indexterm>
	<primary>учетные записи</primary>
	<secondary>изменение пароля</secondary>
      </indexterm>
      <para>&man.passwd.1; это обычный способ изменения собственного пароля
	пользователя, или пароля другого пользователя
	суперпользователем.</para>

      <note>
	<para>Для предотвращения случайного или неавторизованного изменения,
	  пользователь обязан ввести текущий пароль перед установкой нового
	  пароля.  Текущий пароль не спрашивается, если изменение выполняет
	  суперпользователь.</para>
      </note>

      <example>
	<title>Изменение пароля</title>

	<screen>&prompt.user; <userinput>passwd</userinput>
Changing local password for jru.
Old password:
New password:
Retype new password:
passwd: updating the database...
passwd: done</screen>
      </example>

      <example>
	<title>Изменение пароля другого пользователя
	  суперпользователем</title>

	<screen>&prompt.root; <userinput>passwd jru</userinput>
Changing local password for jru.
New password:
Retype new password:
passwd: updating the database...
passwd: done</screen>
      </example>

      <note>
	<para>Как и в случае с &man.chpass.1;, &man.yppasswd.1; это всего лишь
	  ссылка на &man.passwd.1;, так что NIS работает с обеими
	  командами.</para>
      </note>
    </sect2>

    <sect2 xml:id="users-pw">
      <title><command>pw</command></title>
      <indexterm><primary><command>pw</command></primary></indexterm>

      <para>&man.pw.8; это утилита командной строки для создания, удаления,
	модифицирования и отображения пользователей и групп.  Она
	функционирует как внешний интерфейс к системным файлам пользователей
	и групп.  У &man.pw.8; очень мощный набор параметров командной строки,
	что делает это программу подходящей для использования в shell
	скриптах, но новым пользователям она может показаться более сложной,
	чем другие представленные здесь команды.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="users-limiting">
    <title>Ограничение пользователей</title>

    <indexterm><primary>ограничение пользователей</primary></indexterm>
    <indexterm>
      <primary>учетные записи</primary>
      <secondary>ограничение</secondary>
    </indexterm>
    <para>&os; предоставляет администратору несколько способов ограничения
      количества занимаемых пользователями системных ресурсов.  Существует два
      вида ограничений: дисковые квоты и другие ограничения ресурсов.</para>

    <indexterm><primary>квоты</primary></indexterm>
    <indexterm>
      <primary>ограничение пользователей</primary>
      <secondary>квоты</secondary>
    </indexterm>
    <indexterm><primary>дисковые квоты</primary></indexterm>
    <para>Дисковые квоты ограничивают объем дискового пространства, занимаемого
      пользователями, а также предоставляют способ быстрой проверки занимаемого
      объема без пересчета его каждый раз.  Квоты обсуждаются в
      <xref linkend="quotas"/>.</para>

    <para>Другие ограничения ресурсов включают способы ограничения
      использования CPU, памяти и других ресурсов, которые могут потребляться
      пользователем.  Ограничения накладываются с помощью классов учетных
      записей и обсуждаются в этом разделе.</para>

    <indexterm>
      <primary><filename>/etc/login.conf</filename></primary>
    </indexterm>
    <para>Классы учетных записей определяются в
      <filename>/etc/login.conf</filename>, они детально описаны на странице
      справочника &man.login.conf.5;.  Каждой учетной записи присвоен класс
      (<literal>default</literal> по умолчанию), и каждому классу присвоен
      набор характеристик.  Характеристика определяется в виде пары
      <literal>имя=значение</literal>,
      где <replaceable>имя</replaceable> это определенный идентификатор,
      а <replaceable>значение</replaceable> это произвольная строка,
      обрабатываемая в зависимости от <replaceable>имени</replaceable>.
      Настройка классов и характеристик довольно проста, и также описана в
      &man.login.conf.5;.</para>

    <note>
      <para>&os;, как правило, не читает настройки в
	<filename>/etc/login.conf</filename> непосредственно,
	вместо этого она обращается к файлу базы данных
	<filename>/etc/login.conf.db</filename> для ускорения доступа к данным.
	Всякий раз после редактирования <filename>/etc/login.conf</filename>
	необходимо обновить <filename>/etc/login.conf.db</filename> при помощи
	следующей команды:</para>

      <screen>&prompt.root; <userinput>cap_mkdb /etc/login.conf</userinput></screen>
    </note>

    <para>Ограничения на ресурсы отличаются от обычных характеристик:
      во-первых, для каждого ограничения существует <quote>мягкое</quote>
      (текущее) и <quote>жесткое</quote> ограничение.  Мягкое ограничение
      может настраиваться пользователем или приложением, но не может
      превышать жесткое ограничение.  Последнее может быть уменьшено
      пользователем, а увеличено &mdash; лишь суперпользователем.  Во-вторых,
      большинство ограничений ресурсов накладываются на каждый процесс
      определенного пользователя, а не к пользователю вообще.  Эти различия
      диктуются особенностями обработки ограничений, а не реализацией
      структуры характеристик учетных записей.</para>

    <para>Ниже приведен список наиболее часто используемых ограничений
      на ресурсы.  Остальные, вместе с другими характеристиками,
      можно найти в &man.login.conf.5;.</para>

    <variablelist>
      <varlistentry>
	<term><literal>coredumpsize</literal></term>

	<listitem>
	  <para>Ограничение на размер файла дампа
	    памяти<indexterm><primary>coredumpsize</primary></indexterm>,
	    генерируемого программой, подчиняющееся другим
	    ограничениям<indexterm><primary>ограничение пользователей</primary><secondary>coredumpsize</secondary></indexterm>
	    на используемое
	    дисковое пространство, таким как <literal>filesize</literal>, или
	    дисковым квотам.  Это ограничение часто используется как менее
	    строгий метод контролирования потребления дискового пространства.
	    Поскольку пользователь не создает файлы дампов памяти
	    самостоятельно, и зачастую не удаляет их, установка этого параметра
	    может предохранить пользователя от выхода за пределы ограничений
	    на дисковое пространство, в случае если большая программа создаст
	    файл аварийного дампа памяти.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>cputime</literal></term>

	<listitem>
	  <para>Это максимальное количество
	    времени<indexterm><primary>cputime</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>cputime</secondary></indexterm>
	    ЦПУ, потребляемого пользователем.  Превысившие это время процессы
	    будут уничтожены ядром.</para>

	    <note>
	      <para>Это ограничение потребляемого <emphasis>времени</emphasis>
		ЦПУ, а не процентов использования ЦПУ, которые отображаются
		в некоторых полях &man.top.1; и &man.ps.1;.</para>
	    </note>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>filesize</literal></term>

	<listitem>
	  <para>Это максимальный размер
	    файла<indexterm><primary>filesize</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>filesize</secondary></indexterm>,
	    которым может владеть пользователь.  В отличие от
	    <link linkend="quotas">дисковых квот</link>, это ограничение
	    применяется к отдельным файлам, а не ко всему набору принадлежащих
	    пользователю файлов.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>maxproc</literal></term>

	<listitem>
	  <para>Это максимальное число
	    процессов<indexterm><primary>maxproc</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>maxproc</secondary></indexterm>,
	    которые могут быть запущены пользователем.  В это число включаются
	    и консольные, и фоновые процессы.  Это ограничение не может
	    превышать системный лимит, указываемый через переменную
	    &man.sysctl.8; <varname>kern.maxproc</varname>.  Что установка
	    слишком жестких ограничений может стать помехой работе
	    пользователя: зачастую пользователю удобно входить в систему
	    с нескольких консолей или использовать каналы.  Некоторые задачи,
	    такие как компиляция большой программы, порождают множество
	    процессов.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>memorylocked</literal></term>

	<listitem>
	  <para>Это максимальный объем
	    памяти<indexterm><primary>memorylocked</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>memorylocked</secondary></indexterm>,
	    блокировка которого может быть запрошена процессом при помощи
	    &man.mlock.2;.  Некоторые критически важные для системы программы,
	    такие как &man.amd.8;, блокируют отведенную процессу память так,
	    что в случае <quote>пробуксовывания</quote> системы (system
	    thrashing) они не усугубляют проблему.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>memoryuse</literal></term>

	<listitem>
	  <para>Это максимальный объем
	    памяти<indexterm><primary>memoryuse</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>memoryuse</secondary></indexterm>,
	    которая может быть занята процессом в любой момент времени.  Сюда
	    входит основная память и использование подкачки.  Это ограничение
	    не снимает все вопросы, связанные с использованием памяти, но для
	    начала это подходящее ограничение.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>openfiles</literal></term>

	<listitem>
	  <para>Это максимальное количество файлов, которые могут быть
	    открыты<indexterm><primary>openfiles</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>openfiles</secondary></indexterm>
	    процессами.  В &os; файлы также используются для
	    представления сокетов и каналов IPC, поэтому не устанавливайте
	    слишком маленькое значение.  Ограничение этого параметра,
	    устанавливаемое для всей системы, определяется переменной
	    &man.sysctl.8; <varname>kern.maxfiles</varname>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>sbsize</literal></term>

	<listitem>
	  <para>Это ограничение на объем сетевой памяти, т.е.
	    mbufs<indexterm><primary>sbsize</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>sbsize</secondary></indexterm>,
	    которую может занять пользователь.  В общем, это ограничение может
	    быть использовано для ограничения сетевых взаимодействий.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term><literal>stacksize</literal></term>

	<listitem>
	  <para>Это максимальный размер сегмента
	    стека<indexterm><primary>stacksize</primary></indexterm><indexterm><primary>ограничение пользователей</primary><secondary>stacksize</secondary></indexterm>
	    процесса.  Сам по себе этот параметр не может ограничить
	    размер используемой программой памяти, следовательно,
	    его необходимо использовать вместе с другими ограничениями.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para>Существуют несколько других аспектов, которые необходимо учитывать
      при установке ограничений ресурсов.  Ниже приведены некоторые общие
      подсказки, советы и различные комментарии.</para>

    <itemizedlist>
      <listitem>
	<para>Процессам, загружаемым при старте системы скриптами
	  <filename>/etc/rc</filename> присваивается класс
	  <literal>daemon</literal>.</para>
      </listitem>

      <listitem>
	<para>Хотя поставляемый с системой <filename>/etc/login.conf</filename>
	  &mdash; это хороший источник корректных значений для большинства
	  ограничений, сами ограничения могут не подходить для конкретной
	  системы.  Установка слишком слабых ограничений
	  может повлечь злоупотребления системой, а установка слишком
	  сильных ограничений может стать помехой производительности.</para>
      </listitem>

      <listitem>
	<para>Пользователи <application>&xorg;</application> возможно должны
	  получить больше ресурсов, чем другие пользователи.
	  <application>&xorg;</application> сама по себе
	  потребляет много ресурсов, а также провоцирует пользователей
	  на одновременный запуск большего количества программ.</para>
      </listitem>

      <listitem>
	<para>Многие ограничения применяются к отдельным
	  процессам, а не к пользователю вообще.  Например, установка
	  <varname>openfiles</varname> в 50 означает, что каждый
	  процесс, запущенный пользователем, может открывать до 50
	  файлов.  Общее количество файлов, которые могут
	  быть открыты пользователем, вычисляется как
	  <literal>openfiles</literal>, умноженное на
	  <literal>maxproc</literal>.  Это также применимо к потребляемой
	  памяти.</para>
      </listitem>
    </itemizedlist>

    <para>За дальнейшей информацией по ограничениям на ресурсы, классам
      учетных записей и характеристикам, обращайтесь к &man.cap.mkdb.1;,
      &man.getrlimit.2;, и &man.login.conf.5;.</para>
  </sect1>

  <sect1 xml:id="users-groups">
    <title>Группы</title>

    <indexterm><primary>группы</primary></indexterm>
    <indexterm>
      <primary><filename>/etc/groups</filename></primary>
    </indexterm>
    <indexterm>
      <primary>учетные записи</primary>
      <secondary>группы</secondary>
    </indexterm>
    <para>Группа это список пользователей.  Группа идентифицируется по имени и
      <acronym>GID</acronym> (Group ID).  В &os; для определения прав процесса
      ядро использует <acronym>UID</acronym> процесса, а также список групп,
      которым он принадлежит.  В большинстве случаев, <acronym>GID</acronym>
      пользователя означает первую группу из списка.</para>

    <para>Имена групп связываются с <acronym>GID</acronym> в файле
      <filename>/etc/group</filename>.  Это текстовый файл с четырьмя
      разделенными двоеточием полями.  Первое поле это имя группы, второе это
      зашифрованный пароль, третье это <acronym>GID</acronym>, а четвертое
      это разделенный запятыми список членов группы.  За более полным описанием
      синтаксиса обратитесь к &man.group.5;.</para>

    <para>Суперпользователь может редактировать <filename>/etc/group</filename>
      при помощи текстового редактора.  Как вариант, можно задействовать
      &man.pw.8; для добавления и редактирования групп.  Например, для
      добавления группы, называемой <systemitem
      class="groupname">teamtwo</systemitem>, и проверки ее существования
      вы можете использовать:</para>

    <example>
      <title>Добавление группы с использованием &man.pw.8;</title>

      <screen>&prompt.root; <userinput>pw groupadd teamtwo</userinput>
&prompt.root; <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:</screen>
    </example>

    <para>В этом примере число <literal>1100</literal> это
      <acronym>GID</acronym> группы <systemitem
      class="groupname">teamtwo</systemitem>.  На данный момент в
      <systemitem class="groupname">teamtwo</systemitem> нет членов.  Следующая
      команда добавит <systemitem class="username">jru</systemitem> в группу
      <systemitem class="groupname">teamtwo</systemitem>.</para>

    <example>
      <title>Добавление пользователей в новую группу при помощи
	&man.pw.8;</title>

      <screen>&prompt.root; <userinput>pw groupmod teamtwo -M jru</userinput>
&prompt.root; <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:jru</screen>
    </example>

    <para>Аргумент к параметру <option>-M</option> это разделенный
      запятыми список пользователей, которые добавляются в новую (пустую)
      группу или заменяют существующих членов группы.  Что касается
      пользователя &mdash; это членство в группе отличается от первичной группы
      пользователя, указанного в файле паролей.  Это значит, что пользователь
      не будет показан как член группы при использовании &man.pw.8;
      <option>groupshow</option>, но будет отображен при использовании
      &man.id.1; или похожего инструмента.  Когда программа &man.pw.8;
      задействована для добавления пользователя в группу, то она работает
      только с файлом <filename>/etc/group</filename> и не ищет дополнительную
      информацию в файле <filename>/etc/passwd</filename>.</para>

    <example>
      <title>Добавление нового члена группы с использованием &man.pw.8;</title>

      <screen>&prompt.root; <userinput>pw groupmod teamtwo -m db</userinput>
&prompt.root; <userinput>pw groupshow teamtwo</userinput>
teamtwo:*:1100:jru,db</screen>
    </example>

    <para>В этом примере аргументом к опции <option>-m</option> является
      разделенный запятыми список пользователей, добавляемых в группу.  В
      отличие от предыдущего примера, пользователи добавляются в группу, а не
      замещают имеющийся список пользователей группы.</para>

    <example>
      <title>Использование &man.id.1; для определения принадлежности к
	группам</title>

      <screen>&prompt.user; <userinput>id jru</userinput>
uid=1001(jru) gid=1001(jru) groups=1001(jru), 1100(teamtwo)</screen>
    </example>

    <para>В этом примере <systemitem class="username">jru</systemitem> является
      членом групп <systemitem class="groupname">jru</systemitem> и
      <systemitem class="groupname">teamtwo</systemitem>.</para>

    <para>За дальнейшей информацией об этой команде и о формате файла
      <filename>/etc/group</filename> обратитесь к &man.pw.8; и
      &man.group.5;.</para>
  </sect1>
</chapter>
