<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD$
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/kernelconfig/chapter.sgml,v 1.13 2004/08/26 05:43:39 den Exp $

     Original revision: 1.129
-->

<chapter id="kernelconfig">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Обновлено и реструктуризовано </contrib>
	<!-- Mar 2000 -->
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Jake</firstname>
	<surname>Hamby</surname>
	<contrib>Предоставлено </contrib>
	<!-- 6 Oct 1995 -->
      </author>
    </authorgroup>
    <authorgroup>
      <author>
	<firstname>Александром</firstname>
	<surname>Коваленко</surname>
	<contrib>Переведено </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Настройка ядра FreeBSD</title>

  <sect1 id="kernelconfig-synopsis">
    <title>Краткий обзор</title>

    <indexterm>
      <primary>kernel</primary>
      <secondary>сборка собственного ядра</secondary>
    </indexterm>

    <para>Ядро - это основная часть операционной системы &os;.  Оно
      ответственно за управление памятью, параметры безопасности, работу с
      сетью, доступ к дискам и многое другое.  Несмотря на то, что &os;
      становится всё более динамически конфигурируемой, иногда приходится
      собирать собственное ядро.</para>

    <para>После прочтения этой главы вы узнаете:</para>

    <itemizedlist>
      <listitem>
	<para>Почему вам может понадобиться сборка собственного ядра.</para>
      </listitem>

      <listitem>
	<para>Как написать файл конфигурации ядра или изменить
	  существующий.</para>
      </listitem>

      <listitem>
	<para>Как использовать файл конфигурации ядра для того, чтобы создать и
	  собрать новое ядро.</para>
      </listitem>

      <listitem>
	<para>Как установить новое ядро.</para>
      </listitem>

      <listitem>
	<para>Как создать записи в <filename>/dev</filename>, которые могут
	  оказаться необходимы.</para>
      </listitem>

      <listitem>
	<para>Что делать, если что-то не работает или работает не так, как
	  должно.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="kernelconfig-custom-kernel">
    <title>Зачем собирать собственное ядро?</title>

    <para>Традиционно в &os; использовалось так называемое
      <quote>монолитное</quote> ядро.  Это означает, что ядро - это одна
      большая программа, которая поддерживает фиксированный набор устройств и в
      случае, если необходимо изменить его поведение, требуется сборка нового
      ядра и перезагрузка компьютера уже с новым ядром.</para>

    <para>На сегодняшний день &os; быстро продвигается к модели, в которой
      большая часть функциональности содержится в модулях, которые могут быть
      при необходимости динамически загружены и выгружены из ядра.  Это
      позволяет ядру использовать устройства, которые <quote>внезапно</quote>
      появились в системе (например, устройства PCMCIA в лэптопе) или добавлять
      новую функциональность в ядро, которая не была необходима в момент
      первоначальной сборки ядра.  Такой подход известен как модульность ядра.
      Для краткости модули ядра называют KLD.</para>

    <para>Несмотря на это, всё ещё иногда бывает необходимо, чтобы некоторая
      функциональность была вкомпилирована в ядро статически.  В некоторых
      случаях это продиктовано тем, что эта функциональность настолько сильно
      привязана к ядру, что не может быть динамически загружаемой.  В других
      случаях это может быть просто потому, что никто ещё не уделил время
      написанию динамически загружаемого модуля для этой
      функциональности.</para>

    <para>Сборка собственного ядра - один из наиболее важных ритуалов, через который
      должен пройти практически любой пользователь &unix;.  Несмотря на
      длительность этого процесса, ваша &os; останется только в выигрыше.  В
      отличие от ядра <filename>GENERIC</filename>, которое должно поддерживать
      широкий спектр аппаратного обеспечения, собственное ядро содержит поддержку
      аппаратного обеспечения только <emphasis>вашего</emphasis> компьютера.
      Это может давать следующие плюсы:</para>

    <itemizedlist>
      <listitem>
	<para>Меньшее время загрузки.  Поскольку ядро будет пытаться определить
	  только то аппаратное обеспечение, которое установлено в вашем
	  компьютере, время, которое потребуется системе для загрузки,
	  значительно уменьшится.</para>
      </listitem>

      <listitem>
	<para>Меньшее использование памяти.  Собственное ядро часто использует меньше
	  памяти, чем ядро <filename>GENERIC</filename>, что очень важно,
	  поскольку ядро всегда находиться в физической памяти.  Именно по этой
	  причине собственное ядро особенно полезно при использовании систем с малым
	  объемом оперативной памяти.</para>
      </listitem>

      <listitem>
	<para>Поддержка дополнительного аппаратного обеспечения.  Собственное ядро
	  позволяет вам добавить поддержку таких устройств, как, например,
	  звуковая карта, поддержка которых отсутствует в ядре
	  <filename>GENERIC</filename>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="kernelconfig-building">
    <title>Сборка и установка собственного ядра</title>
    <indexterm>
      <primary>kernel</primary>
      <secondary>сборка / установка</secondary>
    </indexterm>

    <para>Во-первых, давайте сделаем краткий обзор каталога, в котором будет
      происходить сборка ядра.  Все каталоги, которые будут упоминаться, будут
      относительными по отношению к основному каталогу
      <filename>/usr/src/sys</filename>, который также доступен как
      <filename>/sys</filename>.  Этот каталог содержит множество подкаталогов,
      представляющих собой различные части ядра, но наиболее важным для нас
      будет каталог <filename><replaceable>arch</replaceable>/conf</filename>,
      в котором вы будете редактировать конфигурационный файл ядра и в котором
      находится каталог <filename>compile</filename>, где будет
      собираться ваше ядро.  <replaceable>arch</replaceable> может быть
      <filename>i386</filename>, <filename>alpha</filename> или
      <filename>pc98</filename> (альтернативная ветвь аппаратного обеспечения,
      популярная в Японии).  Все, что находится внутри каталога определенной
      архитектуры, относится только к этой архитектуре; остальной код является
      общим для всех платформ, на которые &os; может быть потенциально
      портирована.  Обратите внимание на логическую структуру каталогов, в
      которой каждое поддерживаемое устройство, каждая файловая система и
      каждая опция размещается в своём собственном каталоге.  &os; 5.X и выше
      поддерживает архитектуру <filename>sparc64</filename> и несколько других
      архитектур в процессе разработки.</para>

    <note>
      <para>Если в вашей системе <emphasis>отсутствует</emphasis> каталог
	<filename>/usr/src/sys</filename>, это означает, что исходные тексты
	ядра не были установлены.  Наиболее простой способ установить их -
	запустить <command>/stand/sysinstall</command> как
	<username>root</username>, выбрать
	<guimenuitem>Configure</guimenuitem>, потом
	<guimenuitem>Distributions</guimenuitem>, потом
	<guimenuitem>src</guimenuitem>, потом <guimenuitem>sys</guimenuitem>.
	Если вы испытываете отвращение к <application>sysinstall</application> и
	у вас есть доступ к <quote>официальному</quote> &os; CDROM, вы также
	можете установить исходные тексты при помощи командной строки:</para>

      <screen>&prompt.root; <userinput>mount /cdrom</userinput>
&prompt.root; <userinput>mkdir -p /usr/src/sys</userinput>
&prompt.root; <userinput>ln -s /usr/src/sys /sys</userinput>
&prompt.root; <userinput>cat /cdrom/src/ssys.[a-d]* | tar -xzvf -</userinput></screen>
    </note>

    <para>Затем, перейдите в каталог
      <filename><replaceable>arch</replaceable>/conf</filename>
      и скопируйте файл конфигурации <filename>GENERIC</filename> в
      в файл с выбранным вами именем. Например:</para>

    <screen>&prompt.root; <userinput>cd /usr/src/sys/i386/conf</userinput>
&prompt.root; <userinput>cp GENERIC MYKERNEL</userinput></screen>

    <para>По традиции имя состоит из букв в верхнем регистре, и если
      вы поддерживаете несколько компьютеров &os; на различном оборудовании,
      хорошая идея добавлять это имя к имени хоста.  Мы назвали ядро
      <filename>MYKERNEL</filename> в этом примере.</para>

    <tip>
      <para>Помещение файла конфигурации ядра в <filename>/usr/src</filename>
	может быть плохой идеей.  Если вы испытываете проблемы,
	их можно решить удалив <filename>/usr/src</filename> и начав
	все с начала.  Через пять секунд после того, как вы это сделаете,
	вы поймете, что удалили собственный файл настройки ядра.  Не
	редактируйте непосредственно <filename>GENERIC</filename>, он может
	быть перезаписан при следующем <link
	linkend="cutting-edge">обновлении дерева исходных текстов</link>,
	и изменения ядра будут потеряны.</para>

      <para>Вы можете сохранить файл конфигурации ядра в другом месте,
	а затем создать символическую ссылку на этот файл в каталоге
	<filename>i386</filename>.</para>

      <para>Например:</para>

      <screen>&prompt.root; <userinput>cd /usr/src/sys/i386/conf</userinput>
&prompt.root; <userinput>mkdir /root/kernels</userinput>
&prompt.root; <userinput>cp GENERIC /root/kernels/<replaceable>MYKERNEL</replaceable></userinput>	
&prompt.root; <userinput>ln -s /root/kernels/<replaceable>MYKERNEL</replaceable></userinput></screen>
    </tip>

    <note>
      <para>Вы должны выполнять эти и все последующие команды от пользователя
	<username>root</username>, в противном случае вы будете получать ошибки
	<errortype>permission denied</errortype>.</para>
    </note>

    <para>Теперь отредактируйте файл <filename>MYKERNEL</filename> в своём
      любимом текстовом редакторе.  Если вы только начинаете, единственным
      доступным редактором скорее всего будет <application>vi</application>,
      который слишком сложен для того, чтобы объяснить, как им пользоваться,
      здесь, но в <link linkend="bibliography">библиографии</link> перечислено
      множество книг, в которых его использование хорошо освещено.  Однако &os;
      предоставляет более простой редактор <application>ee</application>,
      который, если вы - новичок, подойдёт вам больше всего.  Не стесняйтесь
      изменять строки комментариев в начале файла, с тем, чтобы отобразить вашу
      конфигурацию или изменения, которые вы сделали по сравнению с
      <filename>GENERIC</filename>.</para>
    <indexterm><primary>SunOS</primary></indexterm>

    <para>Если вам приходилось собирать ядро для &sunos; или какой-либо другой
      операционной системы типа BSD, многое из того, что содержится в этом
      файле будет очень знакомо вам.  Если же вы, напротив, использовали другую
      операционную систему, такую как DOS, файл конфигурации
      <filename>GENERIC</filename> может показаться вам крайне сложным, поэтому
      следуйте инструкциям в разделе <link
      linkend="kernelconfig-config">Конфигурационный файл</link> медленно и
      внимательно.</para>

    <note>
      <para>Не забывайте всегда проверять файл
	<filename>/usr/src/UPDATING</filename> перед тем, как выполнять любое
	обновление, в случае если вы <link
	linkend="cutting-edge">синхронизируете дерево исходных текстов</link> с
	деревом проекта &os;.  В этом файле перечислены все важнейшие
	<quote>подводные камни</quote> обновления &os;.
	<filename>/usr/src/UPDATING</filename> всегда соответствует версии
	ваших исходных текстов &os;, поэтому является более точным источником
	новой информации, чем Руководство пользователя.</para>
    </note>

    <para>Теперь вы должны скомпилировать ядро.  Существует два способа, которые
      позволяют это сделать.  Какой из них выбрать, зависит от того, почему вам
      понадобилось пересобирать ядро и версии &os;, которую вы
      используете.</para>

    <itemizedlist>
      <listitem>
	<para>Если вы установили <emphasis>только</emphasis> исходные тексты
	  ядра, используйте способ 1.</para>
      </listitem>

      <listitem>
	<para>Если вы используете &os; версии более ранней, чем 4.0 и вы
	  <emphasis>не</emphasis> обновляете систему до &os;&nbsp;4.0 или выше,
	  используя <maketarget>make world</maketarget>, используйте способ
	  1.</para>
      </listitem>

      <listitem>
	<para>Если вы собираете новое ядро, не обновляя исходные тексты
	  (возможно, для того, чтобы добавить новую опцию, например
	  <literal>IPFIREWALL</literal>), вы можете использовать любой
	  способ.</para>
      </listitem>

      <listitem>
	<para>Если вы пересобираете ядро как часть процесса
	  <maketarget>make world</maketarget>, используйте способ 2.</para>
      </listitem>
    </itemizedlist>

    <procedure>
      <title>Способ 1.  Сборка ядра <quote>традиционным</quote> способом</title>

      <step>
	<para>Запустите &man.config.8; для того, чтобы сгенерировать исходные
	  тексты ядра.</para>

    <screen>&prompt.root; <userinput>/usr/sbin/config <replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Перейдите в каталог, в котором будет собираться ядро.  Путь к
	  нему будет выведен на экран после запуска предыдущей команды.</para>

    <screen>&prompt.root; <userinput>cd ../compile/<replaceable>MYKERNEL</replaceable></userinput></screen>

	<para>Для &os; версии более ранней, чем 5.0, используйте:</para>

    <screen>&prompt.root; <userinput>cd ../../compile/<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Соберите ядро.</para>

    <screen>&prompt.root; <userinput>make depend</userinput>
&prompt.root; <userinput>make</userinput></screen>
      </step>

      <step>
	<para>Установите новое ядро.</para>

    <screen>&prompt.root; <userinput>make install</userinput></screen>
      </step>
    </procedure>

    <procedure>
      <title>Способ 2.  Сборка ядра <quote>новым</quote> способом.</title>

      <step>
	<para>Перейдите в каталог <filename>/usr/src</filename>.</para>

    <screen>&prompt.root; <userinput>cd /usr/src</userinput></screen>
      </step>

      <step>
	<para>Соберите ядро.</para>

    <screen>&prompt.root; <userinput>make buildkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>

      <step>
	<para>Установите новое ядро.</para>

    <screen>&prompt.root; <userinput>make installkernel KERNCONF=<replaceable>MYKERNEL</replaceable></userinput></screen>
      </step>
    </procedure>

    <note>
      <para>В &os;&nbsp;4.2 и в более ранних, вам будет необходимо заменить
	<literal>KERNCONF=</literal> на <literal>KERNEL=</literal>.  4.2-STABLE,
	исходные тексты которой были обновлены до 2 февраля 2001 года, не
	понимает параметра <literal>KERNCONF=</literal>.</para>
    </note>

    <indexterm>
      <primary><command>cvsup</command></primary>
    </indexterm>
    <indexterm><primary>анонимный CVS</primary></indexterm>
    <indexterm><primary>CTM</primary></indexterm>
    <indexterm>
      <primary>CVS</primary>
      <secondary>анонимный</secondary>
    </indexterm>

    <para>Если вы <emphasis>не</emphasis> обновляли дерево исходных
      текстов (не запускали <application>CVSup</application>,
      <application>CTM</application> или не использовали
      <application>anoncvs</application>), вы должны использовать
      последовательность <command>config</command>, <maketarget>make
      depend</maketarget>, <command>make</command>, <maketarget>make
      install</maketarget>.</para>

    <indexterm>
      <primary><filename>kernel.old</filename></primary>
    </indexterm>

    <para>Новое ядро будет скопировано в корневой каталог как
      <filename>/kernel</filename>, а старое ядро будет перемещено в
      <filename>/kernel.old</filename>.  Теперь перезагрузите систему для того,
      чтобы использовать новое ядро.  В случае, если что-то пойдёт не так, вы
      можете обратиться к разделу <link linkend="kernelconfig-trouble">Если
      что-то пошло не так</link> в конце этой главы.  Не забудьте прочитать
      раздел, который объясняет как исправить то, что ядро <link
      linkend="kernelconfig-noboot">не загружается</link>.</para>

    <note>
      <para>Начиная с &os; 5.0 ядро устанавливается вместе с его модулями в
	каталог <filename>/boot/kernel</filename>, а старое ядро сохраняется в
	<filename>/boot/kernel.old</filename>.  Другие файлы, относящиеся к
	процессу загрузки, такие как загрузчик (&man.loader.8;) и его
	конфигурационные файлы также размещаются в <filename>/boot</filename>.
	Модули сторонних производителей могут быть помещены в
	<filename>/boot/modules</filename>, хотя пользователи должны знать, что
	очень важно, чтобы модули были синхронизированы с собранным ядром.
	Модули, не рассчитанные на работу с собранным ядром, могут вызвать
	нестабильность и некорректность работы.</para>
    </note>

    <note>
      <para>Если вы добавили новые устройства (такие, как звуковая карта) и
	используете &os;&nbsp;4.X или более ранние версии, то, возможно, вам
	понадобится создать некоторые файлы устройств в каталоге
	<filename>/dev</filename> перед тем, как вы сможете их использовать.
	За дополнительной информацией вы можете обратиться к разделу <link
	linkend="kernelconfig-nodes">Создание файлов устройств</link> далее в
	этой главе.</para>
    </note>
  </sect1>

  <sect1 id="kernelconfig-config">
    <title>Конфигурационный файл</title>
    <indexterm>
      <primary>kernel</primary>
      <secondary>LINT</secondary>
    </indexterm>
    <indexterm><primary>LINT</primary></indexterm>
    <indexterm>
      <primary>kernel</primary>
      <secondary>конфигурационный файл</secondary>
    </indexterm>

    <para>Формат конфигурационного файла достаточно прост.  Каждая строка
      представляет собой ключевое слово и один или более аргументов.  Для
      простоты большинство строк содержат только один аргумент.  Всё, что
      следует за символом <literal>#</literal> является комментарием и
      игнорируется.  Следующие разделы описывают каждый параметр, в основном в
      порядке, в котором они появляются в <filename>GENERIC</filename>, хотя
      некоторые родственные параметры сгруппированы вместе в одном разделе
      (например Работа с сетью), даже если на самом деле они разбросаны по
      всему файлу <filename>GENERIC</filename>.  <anchor
      id="kernelconfig-options"> Полный список всех опций и более детальные
      описания к ним находится в файле <filename>LINT</filename>, который
      размещается в том же каталоге, что и <filename>GENERIC</filename>.  Если
      вы не уверены в назначении или необходимости какой-либо строки, вначале
      найдите её описание в <filename>LINT</filename>.</para>

    <note><para>В &os; 5.X и более поздних <filename>LINT</filename>
      отсутствует.  Пользуйтесь файлом <filename>NOTES</filename>, он содержит
      архитектурно-зависимые опции.  Некоторые параметры, в основном
      архитектурно-независимые, находятся в файле
      <filename>/usr/src/sys/conf/NOTES</filename>.  Рекомендуется
      просматривать и эти опции.</para></note>

    <indexterm>
      <primary>kernel</primary>
      <secondary>пример конфигурационного файла</secondary>
    </indexterm>

    <para>Это пример конфигурационного файла ядра,
      <filename>GENERIC</filename>, с различными дополнительными комментариями,
      которые могут понадобиться для ясности.  Этот пример должен совпадать с вашей
      копией в <filename>/usr/src/sys/i386/conf/GENERIC</filename> практически
      полностью.  За дополнительной информацией о всех возможных параметрах
      ядра, обратитесь к
      <filename>/usr/src/sys/i386/conf/LINT</filename>.</para>

    <programlisting>#
# GENERIC -- Generic kernel configuration file for &os;/i386
#
# For more information on this file, please read the handbook section on
# Kernel Configuration Files:
#
#    http://www.&os;.org/doc/en_US.ISO8859-1/books/handbook/kernelconfig-config.html
#
# The handbook is also available locally in /usr/share/doc/handbook
# if you've installed the doc distribution, otherwise always see the
# &os; World Wide Web server (http://www.FreeBSD.org/) for the
# latest information.
#
# An exhaustive list of options and more detailed explanations of the
# device lines is also present in the ../../conf/NOTES and NOTES files.
# If you are in doubt as to the purpose or necessity of a line, check first
# in NOTES.
#
# &dollar;FreeBSD: src/sys/i386/conf/GENERIC,v 1.380 2003/03/29 13:36:41 mdodd Exp $</programlisting>

    <para>Следующие параметры обязательны для <emphasis>любого</emphasis> ядра,
      которое вы будете собирать:</para>
    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>machine</secondary>
    </indexterm>

    <programlisting>machine        i386</programlisting>

    <para>Этот параметр - архитектура машины.  Он должен быть одним из
      следующих: <literal>i386</literal>, <literal>pc98</literal>,
      <literal>sparc64</literal>, <literal>alpha</literal>,
      <literal>ia64</literal>, <literal>amd64</literal> или
      <literal>powerpc</literal>.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>cpu</secondary>
    </indexterm>
    <programlisting>cpu          I486_CPU
cpu          I586_CPU
cpu          I686_CPU</programlisting>

    <para>Эта опция указывает тип процессора, который используется в вашей
      системе.  В конфигурационном файле может быть несколько вхождений этой
      опции (например, если вы не уверены, какой из типов процессора необходимо
      использовать - <literal>I586_CPU</literal> или
      <literal>I686_CPU</literal>), хотя, для собственного ядра лучше указывать
      только тот тип процессора, который установлен в вашей системе.  Если вы
      не уверены, какой тип необходимо использовать вам, вы можете
      воспользоваться файлом <filename>/var/run/dmesg.boot</filename>, чтобы
      увидеть протокол загрузки системы.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>cpu type</secondary>
    </indexterm>
    <para>Поддержка типа <literal>I386_CPU</literal> все ещё существует в
      исходных текстах &os;, но по умолчанию отключена в ветках -STABLE и
      -CURRENT.  Это означает, что для того, чтобы установить &os; на систему с
      процессором i386, вы можете использовать следующие способы:</para>

    <itemizedlist>
      <listitem>
	<para>Установить более раннюю версию &os; и пересобрать систему из
	  исходных текстов в соответствии с
	  <xref linkend="kernelconfig-building">.</para>
      </listitem>

      <listitem>
	<para>Собрать мир и ядро на более новой машине и установить на
	  386 используя уже собранные файлы в <filename>/usr/obj</filename>
	  (за дополнительной информацией можете обратиться к <xref
	  linkend="small-lan">).</para>
      </listitem>

      <listitem>
	<para>Сделать собственный релиз FreeBSD, который включает поддержку
	  <literal>I386_CPU</literal> в ядре установочного CD-ROM.</para>
      </listitem>
    </itemizedlist>

    <para>Первый из этих способов, возможно, наиболее простой из всех
     предложенных, но вам понадобится много дискового пространства, что может
     быть затруднительно для систем класса 386.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>ident</secondary>
    </indexterm>

    <programlisting>ident          GENERIC</programlisting>

    <para>Этот параметр определяет <quote>метку</quote> ядра.  Необходимо,
      чтобы она соответствовала названию файла конфигурации ядра, например
      <literal>MYKERNEL</literal>, если вы следовали инструкциям в предыдущих
      примерах.  Значение, которое вы присвоите параметру
      <literal>ident</literal> будет выводиться в процессе загрузки, поэтому
      полезно давать новым ядрам другие имена для того, чтобы отличать их от
      обычного ядра (например, если вы хотите собрать экспериментальное
      ядро).</para>
    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>maxusers</secondary>
    </indexterm>

    <programlisting>maxusers          <replaceable>n</replaceable></programlisting>

    <para>Параметр <literal>maxusers</literal> определяет размеры многих важных
      системных таблиц.  Это число должно быть приблизительно равно количеству
      пользователей, одновременно использующих вашу систему.</para>

    <para>Начиная с &os;&nbsp;4.5, система автоматически настроит этот параметр
      если в конфигурационном файле вы установили его в значение
      <literal>0</literal><footnote><para>Алгоритм автоматической настройки
      устанавливает <literal>maxusers</literal> равным количеству памяти в
      системе, минимум 32 и максимум 384.</para></footnote>.
      В &os;&nbsp;5.X, <literal>maxusers</literal> по умолчанию равен
      <literal>0</literal>, если не установлено другое значение.  Если вы
      используете &os; версии более ранней, чем 4.5 или хотите самостоятельно
      управлять этим значением, рекомендуется устанавливать значение
      <literal>maxusers</literal> равным минимум 4, особенно если вы
      используете X Window System или компиляторы.  Причина этого кроется в
      том, что одной из основных таблиц, размер которой определяет
      <literal>maxusers</literal>, является максимальное количество процессов,
      которое устанавливается равным <literal>20 + 16 * maxusers</literal>,
      таким образом, если вы установите <literal>maxusers</literal> равным 1,
      то получите возможность выполнять максимум 36 одновременных процессов,
      включая 18, или около того, процессов, которые система запускает при
      загрузке, и 15, или около того, вы создадите, когда запустите X Window
      System.  Даже такая простая задача, как чтение страницы справочной
      системы (&man.man.1;), потребует запуска девяти процессов, для того,
      чтобы использовать фильтры, распаковать и просмотреть её.  Установка
      <literal>maxusers</literal> в значение 64 позволит запускать до 1044
      одновременных процессов, что должно быть достаточно для большинства
      применений.  Однако, если вы видите ошибку <errortype>proc table
      full</errortype>, когда пытаетесь запустить программу или поддерживаете
      сервер с большим количеством пользователей (таким как <hostid
      role="fqdn">ftp.FreeBSD.org</hostid>), вы всегда можете увеличить это
      число и пересобрать ядро.</para>

    <note>
      <para><literal>maxusers</literal> <emphasis>не ограничивает</emphasis>
	количество пользователей, которые могут зайти на вашу машину.  Он
	просто устанавливает размеры различных таблиц в разумные значения,
	учитывая максимальное количество пользователей, которое будет у вас в
	системе и как много процессов будет запускать каждый из них.  Параметр
	ядра который <emphasis>действительно ограничивает</emphasis> количество
	одновременных <emphasis>удалённых сессий и окон X терминала</emphasis>
	- это <link linkend="kernelconfig-ptys"><literal>pseudo-device pty
	16</literal></link>.</para>
    </note>

    <programlisting># Floating point support - do not disable.
device          npx0     at nexus? port IO_NPX irq 13</programlisting>

    <para><literal>npx0</literal> - это интерфейс к модулю операций с плавающей
      точкой в &os;, который может использовать как аппаратный сопроцессор, так
      и программную эмуляцию.  Этот параметр <emphasis>является
      обязательным</emphasis>.</para>

    <programlisting># Pseudo devices - the number indicates how many units to allocate.
pseudo-device   loop          # Network loopback</programlisting>

    <para>Стандартное устройство обратной связи для TCP/IP.  Если вы запускаете
      telnet или FTP на <hostid>localhost</hostid> (он же - <hostid
      role="ipaddr">127.0.0.1</hostid>, то соединение пройдёт через это
      псевдоустройство.  Этот параметр <emphasis>обязателен</emphasis>.</para>

    <para>Все остальные параметры более или менее опциональны.  Обращайте
      внимание на информацию о каждой опции, которая размещается рядом с
      ней.</para>

    <programlisting>#To statically compile in device wiring instead of /boot/device.hints
#hints          "GENERIC.hints"         #Default places to look for devices.</programlisting>

    <para>В &os; 5.X и более поздних &man.device.hints.5; используются для
      настройки параметров драйверов устройств.  Путь по умолчанию, который
      &man.loader.8; будет проверять при загрузке -
      <filename>/boot/device.hints</filename>.  Используя опцию
      <literal>hints</literal> вы можете вкомпилировать эти параметры
      статически в ваше ядро.  В этом случае не требуется создавать файл
      <filename>device.hints</filename> в каталоге
      <filename>/boot</filename>.</para>

    <!-- XXX: Add a comment here that explains when compiling hints into the kernel is a good idea and why. -->

    <programlisting>#makeoptions     DEBUG=-g          #Build kernel with gdb(1) debug symbols</programlisting>

    <para>Обычный процесс сборки &os; не включает генерацию отладочной
      информации при сборке ядра и удаляет большую часть вспомогательной
      информации (symbols) после того как ядро слинковано для того, чтобы
      сэкономить немного места.  Если вы собираетесь проводить тестирование
      ядер в ветви -CURRENT или разрабатывать собственные правки для ядра &os;,
      возможно вам будет нужно раскомментировать эту строку.  Тем самым вы
      включите использования опции <option>-g</option>, которая включает
      генерацию отладочной информации &man.gcc.1;.  Того же самого эффекта
      можно добиться используя опцию &man.config.8; <option>-g</option>, в
      случае, если вы используете <quote>традиционный</quote> способ сборки
      ядра (Обратитесь к <xref linkend="kernelconfig-building"> за
      дополнительной информацией.).</para>

    <programlisting>options          MATH_EMULATE      #Support for x87 emulation</programlisting>

    <para>Эта строка позволяет ядру эмулировать математический сопроцессор в
      случае, если в вашем компьютере такового нет (386 или 486SX).  Если у вас
      486DX, 386 или 486SX (с отдельным чипом 387 или 487), или выше (&pentium;,
      &pentium;&nbsp;II и т.п.), вы можете закомментировать эту строку.</para>

    <note>
      <para>Стандартные процедуры, эмулирующие сопроцессор, которые
	используются в &os; по умолчанию, не являются достаточно точными.  Если
	у вас нет математического сопроцессора и вы хотите получить наивысшую
	точность, рекомендуется использовать вместо этой опции опцию
	<literal>GPL_MATH_EMULATE</literal>, чтобы использовать математическую
	библиотеку GNU, которая не включена в поставку по лицензионным
	причинам.</para>

      <para>В &os; 5.X эмуляцию математического сопроцессора выключена по
	умолчанию, поскольку более старые процессоры, которые не имеют
	поддержки операций с плавающей точкой намного менее распространены и в
	большинстве случаев не поддерживаются ядром
	<filename>GENERIC</filename> без дополнительных
	параметров.</para></note>

    <programlisting>options          INET          #InterNETworking</programlisting>

    <para>Поддержка сетевых возможностей.  Оставьте эту опцию включенной, даже
      если вы не планируете подключаться к сети.  Большинство программ требуют,
      чтобы работал хотя бы интерфейс обратной связи (loopback) (т.е.
      создание сетевых соединений внутри вашего ПК), так что эта опция в
      принципе является обязательной.</para>

    <programlisting>options          INET6          #IPv6 communications protocols</programlisting>

    <para>Включает поддержку коммуникационных протоколов IPv6.</para>

    <programlisting>options          FFS          #Berkeley Fast Filesystem
options          FFS_ROOT     #FFS usable as root device [keep this!]</programlisting>

    <para>Включает поддержку основной файловой системы.  Не удаляйте эту опцию,
      если вы планируете загружаться с жесткого диска.</para>

    <note><para>Опция <literal>FFS_ROOT</literal> больше не требуется для &os;
      5.X.</para></note>

    <programlisting>options          UFS_ACL      #Support for access control lists</programlisting>

    <para>Этот параметр, присутствующий только в &os;&nbsp;5.X, включает в ядре
      поддержку списков управления доступом (ACL).  Основывается на
      использовании расширенных атрибутов и <acronym>UFS2</acronym>, детальное
      описание вы сможете найти в <xref linkend="fs-acl">.
      <acronym>ACL</acronym> включены по умолчанию и не должны выключаться в
      случае если они ранее использовались на файловой системе, так как это
      удалит списки управления доступом и изменит то, как защищены файлы,
      непредсказуемым образом.</para>

    <programlisting>options          UFS_DIRHASH  #Improve performance on big directories</programlisting>

    <para>Эта опция включает функциональность, которая повышает скорость
      дисковых операций на больших каталогах в обмен на использование
      дополнительной памяти.  Для большого сервера или рабочей станции
      рекомендуется оставить ее включенной, и выключить для системы, для
      которой более приоритетна память, чем скорость доступа к дискам, например
      сетевой экран (firewall).</para>

    <programlisting>options          SOFTUPDATES  #Enable FFS Soft Updates support</programlisting>

    <para>Этот параметр включает в ядре технологию Soft Updates, которая
      повышает скорость записи на диски.  Несмотря на то, что эта технология
      включена в ядре, она должна быть включена для отдельных дисков.
      Просмотрите вывод команды &man.mount.8; чтобы определить, включены ли
      Soft Updates для дисков вашей системы.  Если вы не увидите параметр
      <literal>soft-updates</literal>, вам будет необходимо активировать его
      при помощи команды &man.tunefs.8; (для существующих файловых систем) или
      команды &man.newfs.8; (для новых файловых систем).</para>

    <programlisting>options          MFS          #Memory Filesystem
options          MD_ROOT      #MD is a potential root device</programlisting>

    <para>Файловая система, отображаемая в память.  В основном это файловая
      система в памяти для быстрых операций с временными файлами, полезная в
      том случае, если у вас большой раздел подкачки памяти (swap), который вы
      хотите использовать для получения этого прироста скорости.  Отличное
      место для монтирования раздела MFS - каталог <filename>/tmp</filename>,
      так как большое количество приложений используют его как хранилище
      временных файлов.  Для того, чтобы смонтировать диск MFS в каталог
      <filename>/tmp</filename>, добавьте следующую строку в
      <filename>/etc/fstab</filename>:</para>

    <informalexample>
      <programlisting>/dev/ad1s2b    /tmp mfs rw 0 0</programlisting>
    </informalexample>

    <para>Теперь вам необходимо либо перезагрузить компьютер, либо выполнить
      команду <command>mount /tmp</command>.</para>

    <note><para>В &os; 5.X для создания файловых
      систем UFS в памяти используется драйвер &man.md.4;, а не MFS.
      Информацию о настройке файловых систем в
      памяти вы можете найти на справочных страницах &man.mdconfig.8;,
      &man.mdmfs.8; и в <xref linkend="disks-virtual">.  В результате, опция
      <literal>MFS</literal> более не поддерживается.</para></note>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>NFS</secondary>
    </indexterm>
    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>NFS_ROOT</secondary>
    </indexterm>
    <programlisting>options          NFS          #Network Filesystem
options          NFS_ROOT     #NFS usable as root device, NFS required</programlisting>

    <para>Сетевая файловая система.  Если вы не планируете монтировать разделы
      с файлового сервера &unix; через TCP/IP, вы можете исключить этот
      параметр из конфигурационного файла ядра.</para>

    <indexterm>
      <primary>параметры ядра</primary>
      <secondary>MSDOSFS</secondary>
    </indexterm>
    <programlisting>options          MSDOSFS      #MSDOS Filesystem</programlisting>

    <para>Файловая система &ms-dos;.  Если вы не собираетесь монтировать
      форматированный в DOS раздел жесткого диска в момент загрузки, вы можете
      безопасно закомментировать этот параметр.  Необходимый модуль будет
      автоматически загружен когда вы в первый раз смонтируете раздел DOS, так,
      как это описано ниже.  Также, замечательный пакет
      <application>mtools</application> (в коллекции портов) позволяет получить
      доступ к DOS дискетам без необходимости монтировать и размонтировать их
      (и не требует наличия <literal>MSDOSFS</literal>).</para>

    <programlisting>options          CD9660       #ISO 9660 Filesystem
options          CD9660_ROOT  #CD-ROM usable as root, CD9660 required</programlisting>

    <para>Файловая система ISO 9660 для компакт-дисков.  Если у вас нет привода
      CDROM или вы будете лишь изредка монтировать компакт-диски с данными,
      закомментируйте эту строку, так как необходимый модуль будет загружен
      автоматически при первом монтировании компакт-диска с данными.  Для
      использования звуковых компакт-дисков эта файловая система не
      потребуется.</para>

    <programlisting>options          PROCFS       #Process filesystem</programlisting>

    <para>Файловая система процессов.  Это <quote>виртуальная</quote> файловая
      система монтируемая в <filename>/proc</filename>, которая позволяет таким
      приложениям, как &man.ps.1; выдавать вам больше информации о запущенных
      процессах.  В &os; 5.X, использование <literal>PROCFS</literal> не
      требуется, так как большинство мониторинговых и отладочных инструментов
      было адаптировано для работы без <literal>PROCFS</literal>.  Более того,
      ядра 5.X-CURRENT, которые используют <literal>PROCFS</literal>, должны
      также включать поддержку <literal>PSEUDOFS</literal>:</para>

    <programlisting>options          PSEUDOFS     #Pseudo-filesystem framework</programlisting>

    <para><literal>PSEUDOFS</literal> недоступна в &os; 4.X.  В отличие от &os;
      4.X, новые установки &os; 5.X по умолчанию не будут монтировать файловую
      систему процессов.</para>

    <programlisting>options          COMPAT_43    #Compatible with BSD 4.3 [KEEP THIS!]</programlisting>

    <para>Совместимость с 4.3BSD.  Не выключайте эту опцию; некоторые
      приложения будут вести себя странно, если этой опции не будет в
      ядре.</para>

    <programlisting>options          COMPAT_FREEBSD4     #Compatible with &os;4</programlisting>

    <para>Эта опция требуется в &os;&nbsp;5.X для платформ &i386; и Alpha для
      поддержки приложений, собранных на более старых версиях &os;, которые
      используют старые интерфейсы вызовов.  Рекомендуется использовать данную
      опцию на всех системах на платформах &i386; и Alpha, на которых могут
      запускаться старые приложения; платформы, поддержка которых появилась
      только в &os;&nbsp;5.X, например ia64 и &sparc64;, не требуют этой
      опции.</para>

    <programlisting>options          SCSI_DELAY=15000    #Delay (in ms) before probing SCSI</programlisting>

    <para>Этот параметр заставляет ядро приостановиться на 15 секунд перед тем,
      как идентифицировать каждое устройство SCSI в вашей системе.  Если у вас
      установлены только жесткие диски IDE, вы можете игнорировать эту опцию, в
      противном случае, возможно, вы захотите уменьшить это число, например до
      5 секунд, для того, чтобы ускорить загрузку.  Естественно, что если вы
      сделаете это, а у &os; появятся проблемы с распознанием ваших устройств
      SCSI, необходимо будет увеличить этот параметр.</para>

    <programlisting>options          UCONSOLE            #Allow users to grab the console</programlisting>

    <para>Разрешает пользователям захватывать консоль, что полезно
      для пользователей X.  Например, вы можете создать консоль
      <application>xterm</application> при помощи запуска <command>xterm
      -C</command>, которая будет отображать любые сообщения от &man.write.1;,
      &man.talk.1; и любые другие сообщения, которые вы получаете, равно как и
      консольные сообщения, которые посылает ядро.</para>

    <note><para>В &os; 5.X, <literal>UCONSOLE</literal> не
      требуется.</para></note>

    <programlisting>options          USERCONFIG          #boot -c editor</programlisting>

    <para>Эта опция позволяет загружаться в редактор конфигурации ядра из меню
      загрузки.</para>

    <programlisting>options          VISUAL_USERCONFIG   #visual boot -c editor</programlisting>

    <para>Эта опция позволяет загружаться в визуальный редактор конфигурации
      ядра из меню загрузки.</para>

    <note><para>Начиная с &os; версии 5.0 и выше, опции
      <literal>USERCONFIG</literal> считается устаревшей; на смену ей пришел
      метод &man.device.hints.5;.  За дополнительной информацией о
      &man.device.hints.5; обратитесь к <xref
      linkend="device-hints">.</para></note>

    <programlisting>options          KTRACE              #ktrace(1) support</programlisting>

    <para>Включает поддержку трассировки процессов, что удобно при
      отладке.</para>

    <programlisting>options          SYSVSHM             #SYSV-style shared memory</programlisting>

    <para>Этот параметр предоставляет поддержку разделяемой памяти System V.
      Наиболее распространенное применение этого - расширение XSHM в X, которое
      многие приложения, интенсивно работающие с графикой, будут автоматически
      использовать для повышения скорости работы.  Если вы используете X,
      эта опция будет необходима.</para>

    <programlisting>options          SYSVSEM             #SYSV-style semaphores</programlisting>

    <para>Поддержка семафоров System V.  Не настолько часто используемая
      возможность, но в ядро добавляет всего несколько сотен байт.</para>

    <programlisting>options          SYSVMSG             #SYSV-style message queues</programlisting>

    <para>Поддержка сообщений System V.  Опять-таки, добавляет в ядро всего
      лишь несколько сотен байт.</para>

    <note>
      <para>Команда &man.ipcs.1; покажет все процессы, которые используют любую
	из этих возможностей System V.</para>
    </note>

    <programlisting>options     P1003_1B        #Posix P1003_1B real-time extensions
options     _KPOSIX_PRIORITY_SCHEDULING</programlisting>

    <para>Расширения реального времени, добавленные 1993 &posix;.  Определенные
      приложения из коллекции используют их, например
      <application>&staroffice;</application>.</para>

    <note><para>В &os; 5.X вся эта функциональность реализована в опции
      <literal>_KPOSIX_PRIORITY_SCHEDULING</literal>, и опция
      <literal>P1003_1B</literal> более не требуется.</para></note>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>ICMP_BANDLIM</secondary>
    </indexterm>
    <indexterm>
      <primary>Denial of Service (DoS)</primary>
    </indexterm>
    <programlisting>options        ICMP_BANDLIM        #Rate limit bad replies</programlisting>

    <para>Эта опция включает ограничение скорости ответа на ошибки ICMP.
      Обычно эту опцию лучше оставить включенной, так как она поможет защитить
      машину от атак отказа в сервисе (DoS).</para>

    <note><para>В &os; 5.X эта возможность включена по умолчанию и опция
      <literal>ICMP_BANDLIM</literal> является необязательной.</para></note>

    <indexterm>
      <primary>kernel options</primary>
      <secondary>SMP</secondary>
    </indexterm>
    <programlisting># To make an SMP kernel, the next two are needed
#options        SMP                     # Symmetric MultiProcessor Kernel
#options        APIC_IO                 # Symmetric (APIC) I/O</programlisting>

    <para>Обе эти опции являются необходимыми для поддержки симметричной
      мультипроцессорности (SMP).</para>

    <programlisting>device          isa</programlisting>

    <para>Все компьютеры, поддерживаемые &os;, имеют хотя бы одно устройство ISA.
      Для архитектуры IBM PS/2 (Микроканальная Архитектура (MCA)), &os;
      предоставляет ограниченную поддержку данной шины.  За дальнейшей
      информацией о поддержке MCA обратитесь к файлу
      <filename>/usr/src/sys/i386/conf/LINT</filename>.</para>

    <programlisting>device          eisa</programlisting>

    <para>Включите эту опцию если у вас материнская плата EISA.  Это включает
      автоопределение и конфигурирование поддержки всех устройств на шине
      EISA.</para>

    <programlisting>device          pci</programlisting>

    <para>Включите этот параметр, если у вас материнская плата с поддержкой
      PCI.  Это включит автоопределение карт PCI и проксирование из шины PCI в
      шину ISA.</para>

    <programlisting>device          agp</programlisting>

    <para>Включите эту опцию, если у вас есть AGP карта в системе.  Это включит
      поддержку AGP и AGP GART для тех карт, которые поддерживают эту
      возможность.</para>

    <programlisting># Floppy drives
device          fdc0        at isa? port IO_FD1 irq 6 drq 2
device          fd0         at fdc0 drive 0
device          fd1         at fdc0 drive 1</programlisting>

    <para>Контроллер флоппи-диска.  <literal>fd0</literal> - это дисковод
      <devicename>A:</devicename> и <literal>fd1</literal> - дисковод
      <devicename>B:</devicename>.</para>

    <programlisting>device          ata</programlisting>

    <para>Этот драйвер поддерживает все устройства ATA и ATAPI.  Вам необходима
      только одна строка <literal>device ata</literal> в ядре для того, чтобы
      обнаружить все PCI устройства ATA/ATAPI в современных машинах.</para>

    <programlisting>device          atadisk                 # ATA disk drives</programlisting>

    <para>Эта строка необходима вместе с <literal>device ata</literal> для
      поддержки дисков ATA.</para>

    <programlisting><anchor id="kernelconfig-atapi">
device          atapicd                 # ATAPI CDROM drives</programlisting>

    <para>Поддержка приводов ATAPI CDROM.  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>device          atapifd                 # ATAPI floppy drives</programlisting>

    <para>Поддержка флоппи-приводов ATAPI.  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>device          atapist                 # ATAPI tape drives</programlisting>

    <para>Поддержка ленточных приводов ATAPI (стримеров).  Используется вместе с
      <literal>device ata</literal>.</para>

    <programlisting>options         ATA_STATIC_ID           #Static device numbering</programlisting>

    <para>Заставляет драйвер нумеровать устройства статически (как старый
      драйвер), в противном случае происходит динамическая нумерация.</para>

    <programlisting># ATA and ATAPI devices
device          ata0        at isa? port IO_WD1 irq 14
device          ata1        at isa? port IO_WD2 irq 15</programlisting>

    <para>Используется для более старых не-PCI систем.</para>

    <programlisting># SCSI Controllers
device          ahb        # EISA AHA1742 family
device          ahc        # AHA2940 and onboard AIC7xxx devices
device          amd        # AMD 53C974 (Teckram DC-390(T))
device          dpt        # DPT Smartcache - See LINT for options!
device          isp        # Qlogic family
device          ncr        # NCR/Symbios Logic
device          sym        # NCR/Symbios Logic (newer chipsets)

device          adv0       at isa?
device          adw
device          bt0        at isa?
device          aha0       at isa?
device          aic0       at isa?</programlisting>

    <para>Контроллеры SCSI.  Закомментируйте те, которых у вас в системе нет.
      Если у вас в системе исключительно IDE устройства, вы можете удалить все
      эти строки.</para>

    <programlisting># SCSI peripherals
device          scbus      # SCSI bus (required)
device          da         # Direct Access (disks)
device          sa         # Sequential Access (tape etc)
device          cd         # CD
device          pass       # Passthrough device (direct SCSI
access)</programlisting>

    <para>Периферийные устройства SCSI.  Опять-таки, закомментируйте те,
      которых у вас в системе нет или, если у вас в наличии исключительно IDE,
      можете удалить все.</para>

    <programlisting># RAID controllers
device          ida        # Compaq Smart RAID
device          amr        # AMI MegaRAID
device          mlx        # Mylex DAC960 family</programlisting>

    <para>Поддерживаемые RAID-контроллеры.  Если у вас нет таковых, можете их
      закомментировать или удалить эти строки.</para>

    <programlisting># atkbdc0 controls both the keyboard and the PS/2 mouse
device          atkbdc0    at isa? port IO_KBD</programlisting>

    <para>Контроллер клавиатуры (<literal>atkbdc</literal>) предоставляет
      средства ввода/вывода для клавиатуры AT и PS/2 устройств.  Этот
      контроллер необходим драйверу клавиатуры (<literal>atkbd</literal>) и
      PS/2 устройств (<literal>psm</literal>).</para>

    <programlisting>device          atkbd0     at atkbdc? irq 1</programlisting>

    <para>Драйвер <literal>atkbd</literal> вместе с контроллером
      <literal>atkbdc</literal> предоставляет доступ к клавиатуре AT 84 или
      улучшенной клавиатуре AT, которая подключена к контроллеру AT
      клавиатуры.</para>

    <programlisting>device          psm0       at atkbdc? irq 12</programlisting>

    <para>Используйте это устройство, если ваша мышь включается в порт
      PS/2.</para>

    <programlisting>device          vga0        at isa?</programlisting>

    <para>Драйвер видеокарты.</para>

    <programlisting># splash screen/screen saver
pseudo-device          splash</programlisting>

    <para>Заставка при загрузке.  Хранители экрана также требуют этого
      устройства.</para>

    <programlisting># syscons is the default console driver, resembling an SCO console
device          sc0          at isa?</programlisting>

    <para><literal>sc0</literal> - это драйвер консоли по умолчанию, который
      имитирует консоль SCO.  Так как большая часть консольных полноэкранных
      приложений обращаются к консоли через терминальную библиотеку
      <filename>termcap</filename>, вас не должно волновать, будете ли вы
      использовать этот драйвер, либо драйвер <literal>vt0</literal>, который
      является <literal>VT220</literal>-совместимым драйвером консоли.  Если у
      вас возникнут какие-либо проблемы с приложениями, работающими с этим
      драйвером консоли, установите переменную окружения <envar>TERM</envar> в
      значение <literal>scoansi</literal>.</para>

    <programlisting># Enable this and PCVT_FREEBSD for pcvt vt220 compatible console driver
#device          vt0     at isa?
#options         XSERVER          # support for X server on a vt console
#options         FAT_CURSOR       # start with block cursor
# If you have a ThinkPAD, uncomment this along with the rest of the PCVT lines
#options         PCVT_SCANSET=2   # IBM keyboards are non-std</programlisting>

    <para>VT220-совместимый драйвер консоли, обратно совместимый с VT100/102.
      Он работает лучше на некоторых лэптопах, у которых возникают проблемы
      несовместимости с <literal>sc0</literal>.  Также, установите переменную
      окружения <envar>TERM</envar> в значение <literal>vt100</literal> или
      <literal>vt220</literal>.  Этот драйвер также может быть полезен в
      случаях подключения к большому количеству различных машин через сеть, на
      которых параметры для устройства <literal>sc0</literal> для
      <filename>termcap</filename> или <filename>terminfo</filename> могут
      отсутствовать &mdash; <literal>vt100</literal> присутствует практически
      на любой платформе.</para>

    <programlisting># Power management support (see LINT for more options)
device          apm0     at nexus? disable flags 0x20  # Advanced Power Management</programlisting>

    <para>Поддержка Advanced Power Management.  Чаще всего используется в
      лэптопах.</para>

    <programlisting># PCCARD (PCMCIA) support
device          card
device          pcic0    at isa? irq 10 port 0x3e0 iomem 0xd0000
device          pcic1    at isa? irq 11 port 0x3e2 iomem 0xd4000 disable</programlisting>

    <para>Поддержка PCMCIA.  Включите ее, если вы используете лэптоп.</para>

    <programlisting># Serial (COM) ports
device          sio0     at isa? port IO_COM1 flags 0x10 irq 4
device          sio1     at isa? port IO_COM2 irq 3
device          sio2     at isa? disable port IO_COM3 irq 5
device          sio3     at isa? disable port IO_COM4 irq 9</programlisting>

    <para>Четыре последовательных порта, которые известны как COM1-COM4 в мире
      &ms-dos;/&windows;</para>

    <note>
      <para>Если у вас есть внутренний модем на COM4 и последовательный порт
	COM2, вам понадобится поменять IRQ модема на 2 (по непонятным
	техническим причинам IRQ2 = IRQ9) для того, чтобы получить к нему
	доступ из &os;.  Если у вас есть многопортовая карта с
	последовательными портами, ознакомьтесь с &man.sio.4; чтобы узнать
	корректные значения для этих строк.  Некоторые видеокарты (в частности
	те, что используют чипы S3) используют адреса ввода/вывода в форме
	<literal>0x*2e8</literal> и, так как многие дешевые последовательные
	карты не полностью раскодируют шестнадцатибитное пространство адресов
	ввода/вывода, они конфликтуют с этими картами, в итоге COM4 оказывается
	практически недоступным.</para>

	<para>Каждый последовательный порт требует уникального IRQ (кроме тех
	  случаев, когда вы используете мультипортовую карту, которая
	  поддерживает совместное использование прерываний), поэтому значения
	  IRQ по умолчанию для COM3 и COM4 не могут быть использованы.</para>
    </note>

    <programlisting># Parallel port
device          ppc0    at isa? irq 7</programlisting>

    <para>Интерфейс параллельного порта на шине ISA.</para>

    <programlisting>device          ppbus      # Parallel port bus (required)</programlisting>

    <para>Поддержка шины параллельного порта.</para>

    <programlisting>device          lpt        # Printer</programlisting>

    <para>Поддержка принтеров на параллельном порту.</para>

    <note>
      <para>Все три последних устройства необходимы для поддержка принтеров на
	параллельном порту.</para>
    </note>

    <programlisting>device          plip       # TCP/IP over parallel</programlisting>

    <para>Драйвер TCP/IP через параллельный порт.</para>

    <programlisting>device          ppi        # Parallel port interface device</programlisting>

    <para>Поддержка ввода/вывода общего назначения (<quote>geek port</quote>) +
      IEEE1284 ввода/вывода.</para>

    <programlisting>#device         vpo        # Requires scbus and da</programlisting>

    <indexterm><primary>zip drive</primary></indexterm>
    <para>Драйвер привода Iomega Zip.  Требует наличия <literal>scbus</literal>
      и <literal>da</literal>.  Наилучшая производительность достигается с
      портами в режиме EPP 1.9.</para>

    <programlisting># PCI Ethernet NICs.
device          de         # DEC/Intel DC21x4x (<quote>Tulip</quote>)
device          fxp        # Intel EtherExpress PRO/100B (82557, 82558)
device          tx         # SMC 9432TX (83c170 <quote>EPIC</quote>)
device          vx         # 3Com 3c590, 3c595 (<quote>Vortex</quote>)
device          wx         # Intel Gigabit Ethernet Card (<quote>Wiseman</quote>)</programlisting>

    <para>Драйвера сетевых карт PCI.  Закомментируйте или удалите драйвера тех
      карт, которые отсутствуют в вашей системе.</para>

    <programlisting># PCI Ethernet NICs that use the common MII bus controller code.
device          miibus     # MII bus support</programlisting>

    <para>Поддержка шины MII требуется для некоторых PCI 10/100 Ethernet карт,
      которые используют MII-совместимые передатчики или реализовывают
      интерфейс управления передатчиком, который имитирует MII.  Добавление
      <literal>device miibus</literal> в конфигурационный файл ядра включает
      поддержку стандартный API miibus и все драйверы PHY, включая стандартный
      для тех PHY, которые не обрабатываются специфическим образом конкретным
      драйвером.</para>

    <programlisting>device          dc         # DEC/Intel 21143 and various workalikes
device          rl         # RealTek 8129/8139
device          sf         # Adaptec AIC-6915 (<quote>Starfire</quote>)
device          sis        # Silicon Integrated Systems SiS 900/SiS 7016
device          ste        # Sundance ST201 (D-Link DFE-550TX)
device          tl         # Texas Instruments ThunderLAN
device          vr         # VIA Rhine, Rhine II
device          wb         # Winbond W89C840F
device          xl         # 3Com 3c90x (<quote>Boomerang</quote>, <quote>Cyclone</quote>)</programlisting>

    <para>Драйвера, которые используют контроллер шины MII.</para>

    <programlisting># ISA Ethernet NICs.
device          ed0    at isa? port 0x280 irq 10 iomem 0xd8000
device          ex
device          ep
# WaveLAN/IEEE 802.11 wireless NICs. Note: the WaveLAN/IEEE really
# exists only as a PCMCIA device, so there is no ISA attachment needed
# and resources will always be dynamically assigned by the pccard code.
device          wi
# Aironet 4500/4800 802.11 wireless NICs. Note: the declaration below will
# work for PCMCIA and PCI cards, as well as ISA cards set to ISA PnP
# mode (the factory default). If you set the switches on your ISA
# card for a manually chosen I/O address and IRQ, you must specify
# those parameters here.
device          an
# The probe order of these is presently determined by i386/isa/isa_compat.c.
device          ie0    at isa? port 0x300 irq 10 iomem 0xd0000
device          fe0    at isa? port 0x300
device          le0    at isa? port 0x300 irq 5 iomem 0xd0000
device          lnc0   at isa? port 0x280 irq 10 drq 0
device          cs0    at isa? port 0x300
device          sn0    at isa? port 0x300 irq 10
# requires PCCARD (PCMCIA) support to be activated
#device         xe0    at isa?</programlisting>

    <para>Драйвера сетевых карт ISA.  Ознакомьтесь с файлом
      <filename>/usr/src/sys/i386/conf/LINT</filename>, чтобы узнать, какие
      сетевые карты поддерживаются каким драйвером.</para>

    <programlisting>pseudo-device   ether         # Ethernet support</programlisting>

    <para><literal>ether</literal> необходим лишь в случае, если у вас есть сетевая карта.  Он включает поддержку стандартного кода протокола Ethernet.</para>

    <programlisting>pseudo-device   sl      1     # Kernel SLIP</programlisting>

    <para><literal>sl</literal> - это поддержка SLIP.  SLIP был практически
      вытеснен PPP, который легче настраивается, лучше подходит для соединений
      модем-модем и имеет больше возможностей.  <replaceable>Число</replaceable>
      после <literal>sl</literal> определяет максимальное количество
      SLIP-сессий будет поддерживаться.</para>

    <programlisting>pseudo-device   ppp     1     # Kernel PPP</programlisting>

    <para>Поддержка PPP в ядре для соединений dial-up.  Также существует версия
      PPP, реализованного как приложение использующее <literal>tun</literal> и
      предлагает большую гибкость и большее количество возможностей, как,
      например, соединение при необходимости (наличии обращения к сети).
      <replaceable>Число</replaceable> после <literal>ppp</literal> определяет
      максимальное количество PPP-сессий будет поддерживаться.</para>

    <programlisting>pseudo-device   tun           # Packet tunnel.</programlisting>

    <para>Используется пользовательским программным обеспечением PPP.
      <replaceable>Число</replaceable> после <literal>tun</literal> определяет
      максимальное количество PPP-сессий будет поддерживаться.  Ознакомьтесь с
      секцией <link linkend="userppp">PPP</link> этой книги за дальнейшей
      информацией.</para>

    <programlisting><anchor id="kernelconfig-ptys">
pseudo-device   pty           # Pseudo-ttys (telnet etc)</programlisting>

    <para><quote>псевдо-терминал</quote> или имитированный порт для входа.
      Используется входящими <command>telnet</command> и
      <command>rlogin</command>-сессиями, приложением
      <application>xterm</application> и некоторыми другими приложениями,
      такими как <application>Emacs</application>.
      <replaceable>Число</replaceable> после <literal>pty</literal> определяет
      количество <literal>pty</literal>, которое необходимо создать.  Если вам
      необходимо более, чем стандартное (16) количество окон
      <application>xterm</application> и/или удаленных входов, увеличьте это
      число в соответствии с вашими потребностями, но не более чем до
      256.</para>

    <programlisting>pseudo-device   md            # Memory <quote>disks</quote></programlisting>

    <para>Псевдоустройства дисков в памяти.</para>

    <programlisting>pseudo-device   gif</programlisting>

    <para>или</para>

    <programlisting>pseudo-device   gif     4     # IPv6 and IPv4 tunneling</programlisting>

    <para>Поддержка туннелирования IPv6 через IPv4, IPv4 через IPv6, IPv4 через
      IPv4 и IPv6 через IPv6.  Начиная с &os;&nbsp;4.4 устройство
      <literal>gif</literal> является <quote>автоклонируемым</quote> и вы
      должны использовать первый из приведенных примеров (без числа после
      <literal>gif</literal>.  Более ранние версии &os; требуют наличия
      числа.</para>

    <programlisting>pseudo-device   faith   1     # IPv6-to-IPv4 relaying (translation)</programlisting>

    <para>Это псевдоустройство захватывает пакеты, которые были посланы ему и
      перенаправляет их демону трансляции IPv4/IPv6.</para>

    <programlisting># The `bpf' pseudo-device enables the Berkeley Packet Filter.
# Be aware of the administrative consequences of enabling this!
pseudo-device   bpf           # Berkeley packet filter</programlisting>

    <para>Фильтр пакетов Berkeley.  Это псевдоустройство позволяет переводить
      сетевые интерфейсы в <quote>неразборчивый</quote> (promiscuous) режим, в
      котором перехватывается любой пакет в широковещательной сети (например
      ethernet).  Эти пакеты могут быть сохранены на диск и/или исследованы при
      помощи &man.tcpdump.1;.</para>

    <note>
      <para>Устройство <literal>bpf</literal> также используется программой
	&man.dhclient.8; для того, чтобы получить адрес шлюза по умолчанию и
	т.п.  Если вы используете DCHP, не удаляйте эту опцию.</para>
    </note>

    <programlisting># USB support
#device         uhci          # UHCI PCI-&gt;USB interface
#device         ohci          # OHCI PCI-&gt;USB interface
#device         usb           # USB Bus (required)
#device         ugen          # Generic
#device         uhid          # <quote>Human Interface Devices</quote>
#device         ukbd          # Keyboard
#device         ulpt          # Printer
#device         umass         # Disks/Mass storage - Requires scbus and da
#device         ums           # Mouse
# USB Ethernet, requires mii
#device         aue           # ADMtek USB ethernet
#device         cue           # CATC USB ethernet
#device         kue           # Kawasaki LSI USB ethernet</programlisting>

    <para>Поддержка различных USB устройств.</para>

    <para>За дальнейшей информацией о дополнительных устройствах,
      поддерживаемых &os;, обратитесь к файлу
      <filename>/usr/src/sys/i386/conf/LINT</filename>.</para>

      <sect2>
	<title>Конфигурации с большим количеством оперативной памяти
	  (<acronym>PAE</acronym>)</title>
	<indexterm>
	  <primary>
	    Расширения физического адресного пространства (Physical Address
	    Extensions (<acronym>PAE</acronym>))
	  </primary>
	  <secondary>
	    Конфигурации с большим количеством оперативной памяти
	  </secondary>
	</indexterm>

	<para>Машины с большим количеством оперативной памяти, в которых требуется
	  более 4 гигабайт в пользовательском адресном пространстве и адресном
	  пространстве ядра (User+Kernel Virtual Address, <acronym>KVA</acronym>)
	  в обычном случае не смогут использовать более 4
	  гигабайт.  Для решения этой проблемы Intel добавили поддержку 36-битной
	  адресации в &pentium; Pro и более поздних моделях процессоров.</para>

	<para>Расширение физического адресного пространства
	  (<acronym>PAE</acronym>) в процессорах &intel; &pentium; Pro и более
	  поздних позволяет использовать до 64 гигабайт оперативной памяти.  &os;
	  имеет поддержку для этой возможности посредством опции ядра
	  <option>PAE</option>, доступной в &os; 4.9-RELEASE и &os; 5.1-RELEASE и
	  более поздних.  В связи с ограничениями архитектуры Intel, не делается
	  никакого различия между памятью ниже или выше 4 гигабайт.  Память,
	  размещенная выше 4 гигабайт, просто добавляется к доступной памяти.</para>

	<para>Для того, чтобы включить <acronym>PAE</acronym> в ядре, просто
	  добавьте приведенную строку в конфигурационный файл ядра:</para>

	<programlisting>options            PAE</programlisting>

	<note>
	  <para>Поддержка <acronym>PAE</acronym> в &os; существует только для
	    процессоров &intel; IA-32.  Также следует заметить, что
	    <acronym>PAE</acronym> в &os; не было полностью протестировано и должно
	    считаться находящимся в состоянии бета-тестирования по сравнению с
	    другими, стабильными возможностями &os;.</para>
	</note>

	<para>Поддержка <acronym>PAE</acronym> в &os; имеет следующие
	  ограничения:</para>

	<itemizedlist>
	  <listitem>
	    <para>Процесс не может получить доступ к более, чем 4 гигабайтам
	      пространства VM.</para>
	  </listitem>

	  <listitem>
	    <para><acronym>KLD</acronym> модули не могут быть загружены в ядро с
	      включенной поддержкой <acronym>PAE</acronym> из-за разницы в
	      окружении для сборки модулей и самого ядра.</para>
	  </listitem>

	  <listitem>
	    <para>Драйверы устройств, которые не используют интерфейс
	      &man.bus.dma.9; приведут к повреждению информации в ядре с включенным
	      <acronym>PAE</acronym>.  Не рекомендуется использовать такие драйвера.
	      По этой причине в &os; 5.X включен конфигурационный файл ядра
	      <filename>PAE</filename>, из которого удалены все драйверы, о которых
	      известно, что они не работают при включенной поддержке
	      <acronym>PAE</acronym>.</para>
	  </listitem>

	  <listitem>
	    <para>Некоторые системные переменные определяют использование ресурсов
	      памяти по количеству доступной физической памяти.  Такие переменные
	      могут привести к ненужному чрезмерному выделению памяти из-за
	      особенностей работы системы <acronym>PAE</acronym>.  Один из таких
	      примеров - переменная <option>kern.maxvnodes</option>, которая
	      управляет максимальным количеством vnode разрешенных в ядре.
	      Рекомендуется установить такую и подобные ей переменные вручную в
	      адекватные значения.</para>
	  </listitem>

	  <listitem>
	    <para>Возможно, понадобится увеличить пространство виртуальных адресов
	    ядра (<acronym>KVA</acronym>) или уменьшить какую-либо переменную (см.
	    выше), значение которой было неоправданно велико и могло привести к
	    исчерпанию <acronym>KVA</acronym>.  Для этого может быть использована
	    опция ядра <option>KVA_PAGES</option>.</para>
	  </listitem>
	</itemizedlist>

	<para>В случае сомнений относительно производительности и стабильности
	  рекомендуется обратиться к странице руководства &man.tuning.7;.  Страница
	  руководства &man.pae.4; содержит свежую информацию о поддержке
	  <acronym>PAE</acronym> в &os;.</para>
      </sect2>
  </sect1>

  <sect1 id="kernelconfig-nodes">
    <title>Создание файлов устройств</title>

    <indexterm><primary>файлы устройств</primary></indexterm>
    <indexterm>
      <primary><command>MAKEDEV</command></primary>
    </indexterm>

    <note><para>Если вы работаете с &os;&nbsp;5.0 или старше, вы можете
      пропустить эту секцию.  Эти версии используют &man.devfs.5; для выделения
      файлов устройств прозрачно для пользователя.</para></note>

    <para>Практически все устройства в ядре имеют соответствующий файл,
      называемый <quote>node</quote> в каталоге <filename>/dev</filename>.  Они
      выглядят как обычные файлы, но на самом деле это специальные
      <quote>точки входа</quote> в ядро, которые необходимы приложениям для
      доступа к устройствам.  Скрипт для <application>/bin/sh</application>
      <filename>/dev/MAKEDEV</filename>, который выполняется при первой
      установке операционной системы, создает практически все поддерживаемые
      файлы устройств.  Однако он не создаёт их <emphasis>все</emphasis>, таким
      образом, когда вы добавляете поддержку нового устройства, следует
      убедиться, что соответствующие файлы есть в <filename>/dev</filename>, и
      если их там нет, создать их.  Вот простой пример:</para>

    <para>Предположим, вы добавили поддержку привода IDE CD-ROM в ядро.
      Строка, которую вы добавили:</para>

    <programlisting>device acd0</programlisting>

    <para>Это означает, что вам необходимо проверить наличие файлов, название
      которых начинаются строкой <filename>acd0</filename> в каталоге
      <filename>/dev</filename>, за которой, возможно, следует буква, например
      <literal>c</literal>, или предшествует <literal>r</literal>, что
      означает, что это <quote>сырое</quote> (raw) устройство, которое
      используется для прямого доступа к аппаратному устройству.  Если
      оказывается, что таких файлов в каталоге нет, вы должны перейти в
      каталог <filename>/dev</filename> и набрать:</para>

    <indexterm>
      <primary><command>MAKEDEV</command></primary></indexterm>
    <screen>&prompt.root; <userinput>sh MAKEDEV acd0</userinput></screen>

    <para>Когда скрипт завершит работу, вы увидите, что файлы
      <filename>acd0c</filename> и <filename>racd0c</filename> созданы,
      соответственно скрипт отработал корректно.</para>

    <para>Для звуковых карт нижеследующая команда создает необходимые
      файлы:</para>

    <screen>&prompt.root; <userinput>sh MAKEDEV snd0</userinput></screen>

    <note>
      <para>Если вы создаете файлы устройств для таких устройств, как звуковые
	карты и если другие люди имеют доступ к вашей машине, было бы не лишним
	защитить их от использования извне при помощи добавления их в файл
	<filename>/etc/fbtab</filename>.  За дальнейшей информацией обратитесь
	к странице руководства &man.fbtab.5;.</para>
    </note>

    <para>Следуйте этой простой процедуре для любых других устройств, которые
      отсутствуют в ядре <filename>GENERIC</filename> и которые не имеют
      соответствующих файлов в <filename>/dev</filename>.</para>

    <note>
      <para>Все контроллеры SCSI используют одинаковый набор файлов в
	<filename>/dev</filename>, поэтому вам не нужно создавать их.  Также,
	сетевые карты и псевдоустройства SLIP и PPP не имеют вхождений в
	<filename>/dev</filename>, поэтому и о них вы не должны
	беспокоиться.</para>
    </note>
  </sect1>

  <sect1 id="kernelconfig-trouble">
    <title>Если что-то пошло не так</title>

    <para>Существует пять категорий проблем, которые могут возникнуть при
      сборке собственного ядра.  Вот они:</para>

    <variablelist>
      <varlistentry>
	<term>Не удаётся отработать команде <command>config</command>:</term>

	<listitem>
	  <para>Если команда &man.config.8; не может отработать, то, скорее всего,
	    вы допустили где-нибудь маленькую ошибку.  К счастью &man.config.8;
	    выведет номер проблемной строки, поэтому вы можете оперативно перейти к
	    ней при помощи <application>vi</application>.  Например, если вы
	    видите:</para>

	  <screen>config: line 17: syntax error</screen>

	  <para>Вы можете перейти к проблемной строке в
	    <application>vi</application> набрав <command>17G</command> в режиме
	    команд.  Убедитесь, что опция введена верно путём сравнения с файлом
	    <filename>GENERIC</filename> или другим источником.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Не удаётся отработать команде <command>make</command>:</term>

	<listitem>
	  <para>Если не удаётся отработать команде <command>make</command>, обычно
	    это означает, что ошибка в описании конфигурации ядра, но не достаточно
	    тривиальная для того, чтобы &man.config.8; мог обнаружить её.
	    Опять-таки, просмотрите файл конфигурации и, если вы все еще не можете
	    решить проблему, напишите письмо в &a.questions; включив в письмо файл
	    конфигурации ядра.  Скорее всего проблема будет решена очень
	    быстро.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Не удаётся установить новое ядро:</term>

	<listitem>
	  <para>Если ядро собралось без проблем, но не удалось его установить
	    (команда <command>make install</command> или <command>make
	    installkernel</command> сообщила об ошибке), первое, что необходимо
	    проверить, не запущена ли ваша система с уровнем безопасности 1 или
	    выше (обратитесь к &man.init.8;).  Процедура установки пробует снять
	    флаг неизменяемости с текущего ядра и установить этот флаг для нового
	    ядра.  Так как на уровне безопасности 1 и выше запрещено снятие флага
	    неизменяемости для всех файлов в системе, установка должна
	    производиться на уровне безопасности 0 и ниже.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Ядро не загружается:<anchor
	  id="kernelconfig-noboot"></term>

	<listitem>
	  <para>Если ваше новое ядро не загружается или ему не удаётся обнаружить
	    ваши устройства - не паникуйте!  К счастью, в &os; существует отличный
	    механизм для восстановления после установки несовместимого ядра.
	    Просто выберите ядро, которое хотите загрузить в загрузчике &os;.  К
	    нему вы можете получить доступ, когда система делает обратный отсчёт от
	    10.  Нажмите любую клавишу, кроме <keycap>Enter</keycap>, введите
	    <command>unload</command> и потом наберите <command>boot
	    <replaceable>kernel.old</replaceable></command> или используйте любое
	    другое ядро, которое загрузится без проблем.  Во время
	    переконфигурирования ядра всегда полезно оставлять копию ядра, о
	    котором известно, что оно рабочее.</para>

	  <para>После загрузки с рабочим ядром вы можете проверить ваш файл
	  конфигурации и попробовать собрать ядро опять.  Очень полезным в данном
	  случае окажется файл <filename>/var/log/messages</filename>, в котором,
	  среди других записей, имеются сообщения ядра от каждой успешной загрузки.
	  Также, команда &man.dmesg.8; выведет сообщения ядра от текущей
	  загрузки.</para>

	  <note>
	    <para>Если у вас возникли проблемы со сборкой ядра, убедитесь, что вы
	      сохранили ядро <filename>GENERIC</filename> или другое рабочее ядро
	      под другим именем, чтобы оно не было удалено при следующей сборке.  Вы
	      не можете использовать <filename>kernel.old</filename>, потому что
	      при установке нового ядра <filename>kernel.old</filename>
	      перезаписывается последним установленным ядром, которое может
	      оказаться нерабочим.  Также, как можно скорее переместите рабочее
	      ядро на правильное место, так как некоторые команды, такие как
	      &man.ps.1; будут работать некорректно.  Для того, чтобы
	      <quote>открыть</quote> файл ядра (для того, чтобы восстановить
	      рабочее ядро), используйте команду:</para>

	    <screen>&prompt.root; <userinput>chflags noschg /kernel</userinput></screen>

	    <para>Если вы обнаружите, что не можете этого сделать, скорее всего вы
	      работаете на уровне безопасности (&man.securelevel.8;) большем нуля.
	      Отредактируйте переменную <literal>kern_securelevel</literal> в файле
	      <filename>/etc/rc.conf</filename>, установите её в
	      <literal>-1</literal> и перезагрузитесь.  Вы можете установить её в
	      предыдущее состояние когда будете довольны своим новым
	      ядром.</para>

	    <para>И, если вы захотите <quote>закрыть</quote> ваше новое ядро или
	      любой другой файл, таким образом, что он не сможет быть перемещен или
	      изменен, используйте следующую команду:</para>

	    <screen>&prompt.root; <userinput>chflags schg /kernel</userinput></screen>

	    <para>В &os; 5.X ядро не устанавливается с флагом неизменяемости, так
	    что в &os; 5.X эта причина не может быть источником проблемы, которую
	    вы испытываете.</para></note>

	</listitem>
      </varlistentry>

      <varlistentry>
	<term>Ядро работает, но &man.ps.1; больше не работает:</term>

	<listitem>
	  <para>Если вы установили версию ядра отличную от той, с которой были
	    собраны ваши системные утилиты, например, ядро от 4.X на системе 3.X,
	    большая часть системных команд, таких как &man.ps.1; и &man.vmstat.8;
	    не будут больше работать.  Вам понадобится пересобрать библиотеку
	    <filename>libkvm</filename>, а также эти утилиты.  Это одна из причин,
	    по которой не следует использовать версию ядра, отличную от версии всей
	    остальной системы.</para>
	</listitem>
      </varlistentry>
    </variablelist>
  </sect1>
</chapter>

<!-- 
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->

