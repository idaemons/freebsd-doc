<!--
     The FreeBSD Italian Documentation Project

     $FreeBSD$
     Original revision: 1.74
-->

<chapter id="mail">
  <chapterinfo>
    <authorgroup>
      <author>
        <firstname>Bill</firstname>

        <surname>Lloyd</surname>

        <contrib>Lavoro originale di </contrib>
      </author>
    </authorgroup>

    <authorgroup>
      <author>
        <firstname>Jim</firstname>

        <surname>Mock</surname>

        <contrib>Rielaborato da </contrib>
      </author>
    </authorgroup>
  </chapterinfo>

  <title>Posta Elettronica</title>

  <sect1 id="mail-synopsis">
    <title>Sinossi</title>

    <indexterm><primary>email</primary></indexterm>
    <indexterm><primary>posta elettronica</primary></indexterm>

    <para>La <quote>Posta Elettronica</quote>, meglio conosciuta come email,
      &egrave; una delle forme di comunicazione maggiormente utilizzate
      tutt'oggi.  Questo capitolo fornisce un'introduzione di base per
      eseguire un server di posta su FreeBSD.
      Comunque, questo non &egrave; un riferimento completo e infatti
      molte considerazioni importanti sono omesse.  Per coprire questo argomento
      in modo pi&ugrave; completo, si rimanda il lettore alla moltitudine di
      eccellenti libri elencati nell'<xref linkend="bibliography">.</para>

    <para>Dopo aver letto questo capitolo, saprai:</para>

    <itemizedlist>
      <listitem>
        <para>Quali componenti software vengono coinvolti nell'invio e
          nella ricezione della posta elettronica.</para>
      </listitem>

      <listitem>
        <para>Dove sono collocati in FreeBSD i file di configurazione
          fondamentali di <application>sendmail</application>.</para>
      </listitem>

      <listitem>
        <para>Come impedire agli spammer di usare illegalmente il tuo
          server di posta come un relay.</para>
      </listitem>

      <listitem>
        <para>Come installare e configurare un mail transfer agent alternativo
          sul tuo sistema, sostituendo
          <application>sendmail</application>.</para>
      </listitem>

      <listitem>
        <para>Come risolvere i problemi pi&ugrave; frequenti legati al
          server di posta.</para>
      </listitem>
    
      <listitem>
        <para>Come configurare l'Autenticazione SMTP per aumentare la
          sicurezza.</para>
      </listitem>
    </itemizedlist>

    <para>Prima di leggere questo capitolo, dovresti:</para>

    <itemizedlist>
      <listitem>
        <para>Aver configurato correttamente la tua connessione di rete
          (<xref linkend="advanced-networking">).</para>
      </listitem>

      <listitem>
        <para>Aver configurato correttamente le informazioni DNS
          relative alla tua macchina server di posta
          (<xref linkend="advanced-networking">).</para>
      </listitem>

      <listitem>
        <para>Sapere come installare software aggiuntivo di terze parti
          (<xref linkend="ports">).</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 id="mail-using">
    <title>Utilizzo della Posta Elettronica</title>

    <indexterm><primary>POP</primary></indexterm>
    <indexterm><primary>IMAP</primary></indexterm>
    <indexterm><primary>DNS</primary></indexterm>

    <para>Ci sono cinque parti principali impegnate in uno scambio di email.
      Queste sono: <link linkend="mail-mua">il programma client</link>, <link
        linkend="mail-mta">quello server</link>, <link
        linkend="mail-dns">il DNS</link>, <link linkend="mail-receive">un demone
        POP o IMAP</link>, e naturalmente <link linkend="mail-host">la macchina
        server di posta</link>.</para>

    <sect2 id="mail-mua">
      <title>Il Programma Client</title>

      <para>Questo include programmi a riga di comando quali
        <application>mutt</application>, <application>pine</application>,
        <application>elm</application>, e <application>mail</application>,
        e programmi con un'interfaccia grafica (GUI) quali
        <application>balsa</application>, <application>xfmail</application>
        per citarne alcuni, e qualcosa di pi&ugrave; <quote>raffinato</quote>
        simile a un browser WWW.  Questi programmi semplicemente fanno passare
        le transazioni email alla <link linkend="mail-host"><quote>macchina
          server di posta</quote></link> locale, chiamando uno dei
        <link linkend="mail-mta">programmi server</link> disponibili o
        inoltrando queste transazioni via TCP.</para>
    </sect2>

    <sect2 id="mail-mta">
      <title>Il Programma Server</title>

      <indexterm>
        <primary>server di posta</primary>
        <secondary><application>sendmail</application></secondary>
      </indexterm>
      <indexterm>
        <primary>server di posta</primary>
        <secondary><application>postfix</application></secondary>
      </indexterm>
      <indexterm>
        <primary>server di posta</primary>
        <secondary><application>qmail</application></secondary>
      </indexterm>
      <indexterm>
        <primary>server di posta</primary>
        <secondary><application>exim</application></secondary>
      </indexterm>

      <para>Questo &egrave; solitamente
        <application>sendmail</application> (di default su FreeBSD) o uno degli
        altri server di posta come <application>qmail</application>,
        <application>postfix</application>, o <application>exim</application>.
        Ne esistono altri, ma questi sono i pi&ugrave; usati.</para>

      <para>Di solito il programma server svolge due funzioni&mdash;si occupa
        di ricevere la posta in arrivo e di consegnare quella in partenza.
        Non puoi connetterti al programma server via POP o IMAP per leggere la
        tua posta.  Per far questo hai bisogno di un altro
        <link linkend="mail-receive">demone</link>.</para>

      <para>Devi sapere che alcune vecchie versioni di
        <application>sendmail</application> hanno alcuni seri problemi di
        sicurezza, comunque finch&eacute; eseguirai l'ultima versione di
        <application>sendmail</application> non dovresti avere problemi.  Come
        sempre, &egrave; una buona idea mantenere aggiornato il software
        che usi.</para>
    </sect2>

    <sect2 id="mail-dns">
      <title>Email e DNS</title>

      <para>Il DNS (Domain Name System) e il suo demone <command>named</command>
        giocano un ruolo fondamentale nella consegna della posta.  Per
        consegnare la posta dal tuo host a un altro, il programma server
        cercher&agrave; l'host nel DNS per determinare la macchina server che
        ricever&agrave; la posta per il destinatario.</para>

      <para>Viene utilizzato lo stesso meccanismo quando si riceve la
        propria posta.  Il DNS contiene il database per mappare un nome host
        in un indirizzo IP, e un nome host in una macchina server di posta.
        L'indirizzo IP &egrave; specificato in un record A.  Il record MX
        (Mail eXchanger) specifica la macchina server che ricever&agrave; la tua
        posta.  Se non hai un record MX per il tuo nome host, la posta
        sar&agrave; consegnata direttamente al tuo host.</para>
    </sect2>

    <sect2 id="mail-receive">
      <title>Ricezione della Posta</title>

      <indexterm>
        <primary>email</primary>
        <secondary>ricezione</secondary>
      </indexterm>

      <para>La ricezione della posta per il tuo dominio viene realizzata dalla
        macchina server di posta.  Questa raccoglier&agrave; la posta
        indirizzata a te e la salver&agrave; per una successiva lettura o
        scaricamento.  Per scaricare la posta salvata, dovrai collegarti al
        server di posta.  Questo pu&ograve; essere fatto usando POP o IMAP.
        Se desideri leggere la posta direttamente sulla macchina server, allora
        il server POP o IMAP non &egrave; necessario.</para>

      <indexterm><primary>POP</primary></indexterm>
      <indexterm><primary>IMAP</primary></indexterm>

      <para>Se vuoi eseguire un server POP o IMAP, ci sono due cose che
        devi fare:</para>

      <procedure>
        <step>
          <para>Prendere un demone POP o IMAP dalla <ulink
              url="../../../../ports/mail.html">collezione di port</ulink> e
            installarlo sul tuo sistema.</para>
        </step>

        <step>
          <para>Modificare <filename>/etc/inetd.conf</filename> per caricare il
            server POP o IMAP.</para>
        </step>
      </procedure>
    </sect2>

    <sect2 id="mail-host">
      <title>La Macchina Server di Posta</title>

      <indexterm><primary>macchina server di posta</primary></indexterm>

      <para>La macchina server di posta &egrave; il nome del server
        che &egrave; responsabile della consegna e del ricevimento della posta
        per il tuo host, ed eventualmente per la tua rete.</para>
    </sect2>
  </sect1>

  <sect1 id="sendmail">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Christopher</firstname>

          <surname>Shumway</surname>

          <contrib>Contributo di </contrib>
        </author>
      </authorgroup>
    </sect1info>

    <title>Configurazione di <application>sendmail</application></title>

    <indexterm>
      <primary><application>sendmail</application></primary>
    </indexterm>

    <para>&man.sendmail.8; &egrave; il Mail Transfer Agent (MTA) di default su
      FreeBSD.  Il compito di <application>sendmail</application> &egrave; di
      accettare posta dai Mail User Agent (MUA), e consegnarla al server di
      posta appropriato come definito nel suo file di configurazione.  Inoltre
      <application>sendmail</application> pu&ograve; accettare connessioni via
      rete e consegnare i messaggi a caselle di posta locali o ad un altro
      programma.</para>

    <para><application>sendmail</application> utilizza i seguenti file di
      configurazione:</para>

    <indexterm>
      <primary><filename>/etc/mail/access</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/aliases</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/local-host-names</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/mailer.conf</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/mailertable</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/sendmail.cf</filename></primary>
    </indexterm>
    <indexterm>
      <primary><filename>/etc/mail/virtusertable</filename></primary>
    </indexterm>

    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>File</entry>

            <entry>Funzione</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><filename>/etc/mail/access</filename></entry>

            <entry>File database di accesso di
              <application>sendmail</application></entry>
          </row>

          <row>
            <entry><filename>/etc/mail/aliases</filename></entry>

            <entry>Alias delle caselle di posta</entry>
          </row>

          <row>
            <entry><filename>/etc/mail/local-host-names</filename></entry>

            <entry>Lista di host per i quali
              <application>sendmail</application> accetta posta</entry>
          </row>

          <row>
            <entry><filename>/etc/mail/mailer.conf</filename></entry>

            <entry>File di configurazione del programma di posta</entry>
          </row>

          <row>
            <entry><filename>/etc/mail/mailertable</filename></entry>

            <entry>Tabella di consegna del programma di posta</entry>
          </row>

          <row>
            <entry><filename>/etc/mail/sendmail.cf</filename></entry>

            <entry>File di configurazione principale di
              <application>sendmail</application></entry>
          </row>

          <row>
            <entry><filename>/etc/mail/virtusertable</filename></entry>

            <entry>Tabelle degli utenti e dei domini virtuali</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <sect2>
      <title><filename>/etc/mail/access</filename></title>

      <para>Il database di accesso definisce quali host o indirizzi
        IP hanno accesso al server di posta locale e quale tipo di accesso
        hanno.  Gli host possono essere catalogati come <option>OK</option>,
        <option>REJECT</option>, <option>RELAY</option> o possono semplicemente
        essere passati alla procedura di gestione degli errori di
        <application>sendmail</application> con un preciso errore.  Gli host
        che sono definiti <option>OK</option>, che &egrave; il valore di
        default, possono spedire posta a questo host sempre che la destinazione
        finale della posta sia la macchina locale.  Gli host che sono definiti
        <option>REJECT</option> vengono rifiutati per qualsiasi connessione di
        posta.  Gli host che hanno l'opzione <option>RELAY</option> per i loro
        nomi host possono utilizzare questo server per spedire posta verso
        qualsiasi destinazione.</para>

      <example>
        <title>Configurazione del Database di Accesso di
          <application>sendmail</application></title>

        <programlisting>cyberspammer.com                550 Non accettiamo posta dagli spammer
FREE.STEALTH.MAILER@            550 Non accettiamo posta dagli spammer
altra.sorgente.di.spam          REJECT
okay.cyberspammer.com           OK
128.32                          RELAY</programlisting>
      </example>

      <para>In questo esempio abbiamo cinque elementi.  Gli host mittenti
        che corrispondono a quelli posti sul lato sinistro della tabella sono
        condizionati dall'azione posta sul lato destro della tabella.
        I primi due esempi passano un codice di errore alla procedura di
        <application>sendmail</application> che gestisce gli errori.  Il
        messaggio viene restituito all'host remoto quando viene trovata una
        corrispondenza sul lato sinistro della tabella.  Il terzo esempio
        rifiuta la posta da un host specifico su Internet,
        <hostid>altra.sorgente.di.spam</hostid>.  Il quarto esempio accetta
        connessioni di posta da un host, <hostid
          role="fqdn">okay.cyberspammer.com</hostid>, che &egrave; pi&ugrave;
        preciso rispetto a <hostid role="domainname">cyberspammer.com</hostid>
        della prima linea.  Le corrispondenze pi&ugrave; precise sovrascrivono
        quelle meno precise.  L'ultimo esempio permette il relay della posta
        elettronica agli host che hanno un indirizzo IP che inizia con
        <hostid>128.32</hostid>.  Questi host possono spedire messaggi destinati
        ad altri server di posta attraverso questo server.</para>

      <para>Quando modifichi questo file, devi eseguire <command>make</command>
        in <filename>/etc/mail/</filename> per aggiornare il database.</para>
    </sect2>

    <sect2>
      <title><filename>/etc/mail/aliases</filename></title>

      <para>Il database degli alias contiene una lista di caselle di posta
        virtuali che sono espanse in altri utenti, file, programmi o in altri
        alias.  Seguono alcuni esempi che possono essere usati in
        <filename>/etc/mail/aliases</filename>:</para>

      <example>
        <title>Alias di Posta</title>

        <programlisting>root: utentelocale
ftp-bugs: joe,eric,paul
bit.bucket: /dev/null
procmail: "|/usr/local/bin/procmail"</programlisting>
      </example>

      <para>Il formato del file &egrave; semplice: il nome della casella di
        posta che si trova a sinistra dei due punti viene espanso negli elementi
        posti a destra dei due punti.  Il primo esempio semplicemente espande la
        casella di posta <username>root</username> nella casella di posta
        <username>utentelocale</username>, che &egrave; di nuovo ricercata
        nel database degli alias.  Se non viene trovata, allora il messaggio
        viene consegnato all'utente locale <username>utentelocale</username>.
        L'esempio successivo mostra una mailing list.  La posta indirizzata
        alla casella di posta <username>ftp-bugs</username> viene espansa nelle
        tre caselle di posta locali <username>joe</username>,
        <username>eric</username>, e <username>paul</username>.  Nota che una
        casella di posta remota pu&ograve; essere specificata come
        <literal>user@example.com</literal>.  Il terzo esempio mostra come
        scrivere la posta su un file, in questo caso
        <filename>/dev/null</filename>.  L'ultimo esempio mostra come mandare
        la posta a un programma, in questo caso il messaggio di posta diventa
        lo standard input di <filename>/usr/local/bin/procmail</filename>
        tramite una pipe Unix.</para>

      <para>Quando modifichi questo file, devi eseguire <command>make</command>
        in <filename>/etc/mail/</filename> per aggiornare il database.</para>
    </sect2>

    <sect2>
      <title><filename>/etc/mail/local-host-names</filename></title>

      <para>Questo file &egrave; una lista di nomi host che &man.sendmail.8;
        accetta come se fossero l'host locale.  Metti i domini o gli host
        per i quali <application>sendmail</application> deve ricevere posta.
        Per esempio, se questo server di posta dovesse essere in grado di
        accettare posta per il dominio
        <hostid role="domainname">example.com</hostid> e per l'host
        <hostid role="fqdn">mail.example.com</hostid>, il suo
        <filename>local-host-names</filename> potrebbe assomigliare a
        questo:</para>

      <programlisting>example.com
mail.example.com</programlisting>

      <para>Quando modifichi questo file, devi riavviare &man.sendmail.8; per
        attivare i cambiamenti.</para>
    </sect2>

    <sect2>
      <title><filename>/etc/mail/sendmail.cf</filename></title>

      <para>Il file di configurazione principale di
        <application>sendmail</application>, <filename>sendmail.cf</filename>
        controlla l'intero comportamento di <application>sendmail</application>,
        inclusa ogni cosa, dalla rielaborazione degli indirizzi e-mail alla
        stampa del messaggio di rifiuto per i server di posta remoti.
        Naturalmente, avendo svariati compiti, questo file di configurazione
        &egrave; alquanto complesso e i suoi dettagli vanno oltre lo scopo di
        questa sezione.  Fortunatamente, questo file necessita raramente di
        essere modificato per server di posta standard.</para>

      <para>Il file di configurazione principale di
        <application>sendmail</application> pu&ograve; essere costruito
        a partire da macro &man.m4.1; che definiscono le caratteristiche e il
        comportamento di <application>sendmail</application>.  Guarda
        <filename>/usr/src/contrib/sendmail/cf/README</filename> per ulteriori
        dettagli.</para>

      <para>Quando modifichi questo file, devi riavviare &man.sendmail.8; per
        attivare i cambiamenti.</para>
    </sect2>

    <sect2>
      <title><filename>/etc/mail/virtusertable</filename></title>

      <para>Il file <filename>virtusertable</filename> mappa indirizzi di posta
        relativi a domini e caselle di posta virtuali in caselle di posta reali.
        Queste caselle di posta possono essere locali, remote, alias definiti in
        <filename>/etc/mail/aliases</filename> o file.</para>

      <example>
        <title>Esempio di Mappatura per la Posta di un Dominio Virtuale</title>

        <programlisting>root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</programlisting>
      </example>

      <para>Nell'esempio precedente, abbiamo una mappatura per il dominio
        <hostid role="domainname">example.com</hostid>.  Questo file viene
        processato dall'alto verso il basso fermandosi alla prima corrispondenza
        trovata.  Il primo elemento mappa <literal>root@example.com</literal>
        nella casella di posta locale <username>root</username>.  Il secondo
        elemento mappa <literal>postmaster@example.com</literal> nella casella
        di posta <username>postmaster</username> sull'host <hostid
          role="fqdn">noc.example.net</hostid>.  Infine, se non sono state
        trovate corrispondenze per <hostid role="fqdn">example.com</hostid>
        fino a questo punto, verr&agrave; verificata l'ultima mappatura, che
        corrisponde a tutti gli altri messaggi di posta indirizzati a qualche
        utente di <hostid role="domainname">example.com</hostid>.
        Questo verr&agrave; mappato nella casella di posta locale
        <username>joe</username>.</para>
    </sect2>
  </sect1>

  <sect1 id="mail-changingmta">
    <sect1info>
      <authorgroup>
        <author>
          <firstname>Andrew</firstname>

          <surname>Boothman</surname>

          <contrib>Scritto da </contrib>
        </author>
      </authorgroup>

      <authorgroup>
        <author>
          <firstname>Gregory</firstname>

          <surname>Neil Shapiro</surname>

          <contrib>Informazioni prese da e-mail scritte da </contrib>
        </author>
      </authorgroup>
    </sect1info>

    <title>Sostituzione del proprio Mail Transfer Agent</title>

    <indexterm>
      <primary>email</primary>
      <secondary>cambiare mta</secondary>
    </indexterm>

    <para>Come gi&agrave; menzionato, l'MTA (Mail Transfer Agent, agente di
      trasferimento della posta elettronica) installato di default su FreeBSD
      &egrave; <application>sendmail</application>.  Di conseguenza
      <application>sendmail</application> &egrave; responsabile della tua posta
      in partenza e di quella in arrivo.</para>

    <para>Comunque, per vari motivi, alcuni amministratori necessitano di
      cambiare l'MTA dei loro sistemi.  Questi motivi spaziano dal voler
      semplicemente provare un altro MTA all'aver bisogno di una caratteristica
      o di un pacchetto specifico ritrovabile in un altro MTA.  Fortunatamente,
      per qualsiasi motivo, FreeBSD semplifica il processo di
      sostituzione.</para>

    <sect2>
      <title>Installazione di un nuovo MTA</title>

      <para>Hai un'ampia scelta di MTA utilizzabili.  Un buon punto di partenza
        &egrave; la <link linkend="ports">FreeBSD Ports Collection</link> dove
        puoi trovarne molti.  Naturalmente sei libero di usare qualunque
        MTA proveniente da qualche sito, a condizione che tu riesca ad eseguirlo
        sotto FreeBSD.</para>

      <para>Inizia installando il tuo nuovo MTA.  Una volta installato devi
        valutare se realmente soddisfa le tue necessit&agrave;, inoltre devi
        avere la possibilit&agrave; di configurare il tuo nuovo programma prima
        che subentri a <application>sendmail</application>.  Valutato questo,
        devi essere sicuro che durante l'installazione del nuovo programma non
        ci siano stati tentativi di sovrascrivere binari di sistema come
        <filename>/usr/bin/sendmail</filename>.  Altrimenti, il tuo nuovo
        programma di posta &egrave; stato essenzialmente messo in
        attivit&agrave; prima che tu l'abbia configurato.</para>

      <para>Per cortesia fai riferimento alla documentazione dell'MTA che hai
        scelto per informazioni su come configurarlo.</para>
    </sect2>

    <sect2>
      <title>Disabilitazione di <application>sendmail</application></title>

      <para>La procedura usata per avviare <application>sendmail</application>
        cambia significativamente tra la 4.5-RELEASE e la 4.6-RELEASE.
        Di conseguenza, la procedura usata per disabilitarlo &egrave;
        leggermente differente a seconda della versione di FreeBSD
        utilizzata.</para>

      <sect3>
        <title>FreeBSD 4.5-STABLE prima del 4/4/2002 e precedenti (inclusa
          4.5-RELEASE e precedenti)</title>

        <para>Metti:</para>

        <programlisting>sendmail_enable="NO"</programlisting>

        <para>in <filename>/etc/rc.conf</filename>.  In questo modo si
          disabiliter&agrave; il servizio di ricezione della posta
          di <application>sendmail</application>, ma se
          <filename>/etc/mail/mailer.conf</filename> (vedi sotto) non viene
          modificato, <application>sendmail</application> verr&agrave; ancora
          usato per spedire e-mail.</para>
      </sect3>

      <sect3>
        <title>FreeBSD 4.5-STABLE dopo il 4/4/2002 (inclusa 4.6-RELEASE e
          successive)</title>

        <para>Per disabilitare completamente <application>sendmail</application>
          devi mettere</para>

        <programlisting>sendmail_enable="NONE"</programlisting>

        <para>in <filename>/etc/rc.conf.</filename></para>

        <warning>
          <para>Se disabiliti il servizio di consegna della posta di
            <application>sendmail</application> in questo modo, &egrave;
            importante che questo venga rimpiazzato con un altro sistema
            di consegna della posta perfettamente funzionante.  Se non lo farai,
            le funzioni di sistema come &man.periodic.8; saranno incapaci di
            inviare i loro risultati tramite e-mail come normalmente prevedono
            di fare.  Molte parti del tuo sistema potrebbero presupporre di
            avere un sistema funzionante compatibile con
            <application>sendmail</application>.  Se le applicazioni continuano
            a usare i binari di <application>sendmail</application> per tentare
            di spedire e-mail dopo che tu l'hai disabilitato, la posta potrebbe
            finire in una coda inattiva di <application>sendmail</application>,
            senza che venga mai consegnata.</para>
        </warning>

        <para>Se vuoi solamente disabilitare il servizio di ricezione della
          posta di <application>sendmail</application>, devi mettere</para>

        <programlisting>sendmail_enable="NO"</programlisting>

        <para>in <filename>/etc/rc.conf</filename>.  Molte informazioni sulle
          opzioni di avvio di <application>sendmail</application> sono
          disponibili nella pagina man di &man.rc.sendmail.8;.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Esecuzione del nuovo MTA all'avvio</title>

      <para>Hai due possibili metodi per eseguire il tuo nuovo MTA all'avvio,
        a seconda della versione di FreeBSD utilizzata.</para>

      <sect3>
        <title>FreeBSD 4.5-STABLE prima del 11/4/2002 (inclusa 4.5-RELEASE e
          precedenti)</title>

        <para>Posiziona uno script in
          <filename>/usr/local/etc/rc.d/</filename> con estensione
          <filename>.sh</filename> ed eseguibile da <username>root</username>.
          Lo script deve accettare i parametri <literal>start</literal> e
          <literal>stop</literal>.  Nella fase di avvio di FreeBSD gli script
          di sistema eseguiranno il comando</para>

        <programlisting>/usr/local/etc/rc.d/supermailer.sh start</programlisting>

        <para>che puoi anche usare per avviare manualmente il
          server.  Nella fase di chiusura di FreeBSD, gli script di sistema
          useranno l'opzione <literal>stop</literal>, eseguendo il
          comando</para>

        <programlisting>/usr/local/etc/rc.d/supermailer.sh stop</programlisting>

        <para>che puoi anche usare per arrestare manualmente il
          server mentre il sistema &egrave; in funzione.</para>
      </sect3>

      <sect3>
        <title>FreeBSD 4.5-STABLE dopo il 11/4/2002 (inclusa 4.6-RELEASE e
          successive)</title>

        <para>Con le versioni recenti di FreeBSD, puoi usare il metodo
          precedente oppure puoi mettere</para>

        <programlisting>mta_start_script="nomefile"</programlisting>

        <para>in <filename>/etc/rc.conf</filename>, dove
          <replaceable>nomefile</replaceable> &egrave; il nome dello script
          che vuoi eseguire all'avvio per avviare il tuo MTA.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Sostituzione di <application>sendmail</application> come programma
        di posta di default del sistema</title>

      <para><application>sendmail</application> &egrave; cos&igrave;
        onnipresente come programma standard su sistemi Unix che alcuni
        programmi lo suppongono gi&agrave; installato e configurato.  Per questa
        ragione, molti degli altri MTA forniscono la loro compatibile
        implementazione dell'interfaccia a riga di comando di
        <application>sendmail</application>; questo agevola il loro utilizzo
        come sostituti <quote>drop-in</quote> di
        <application>sendmail</application>.</para>

      <para>Quindi, se usi un altro programma di posta, dovrai assicurarti
        che i programmi che tentano di eseguire i binari standard di
        <application>sendmail</application> come
        <filename>/usr/bin/sendmail</filename> in realt&agrave; eseguano
        il programma di posta da te scelto.  Fortunatamente, FreeBSD fornisce
        un meccanismo chiamato &man.mailwrapper.8; che fa questo lavoro per
        te.</para>

      <para>Quando <application>sendmail</application> &egrave; operativo,
        dovresti vedere in <filename>/etc/mail/mailer.conf</filename> qualcosa
        di simile a questo:</para>

      <programlisting>sendmail    /usr/libexec/sendmail/sendmail
send-mail   /usr/libexec/sendmail/sendmail
mailq       /usr/libexec/sendmail/sendmail
newaliases  /usr/libexec/sendmail/sendmail
hoststat    /usr/libexec/sendmail/sendmail
purgestat   /usr/libexec/sendmail/sendmail</programlisting>

      <para>Questo significa che quando uno di questi comandi
        (come <filename>sendmail</filename> stesso) viene eseguito, in
        realt&agrave; il sistema invoca una copia di mailwrapper di nome
        <filename>sendmail</filename>, la quale esamina
        <filename>mailer.conf</filename> ed esegue
        <filename>/usr/libexec/sendmail/sendmail</filename>.  Questo meccanismo
        facilita la sostituzione dei binari che sono realmente eseguiti quando
        vengono invocate queste funzioni di default di
        <filename>sendmail</filename>.</para>

      <para>Quindi se vuoi che
        <filename>/usr/local/supermailer/bin/sendmail-compat</filename> sia
        eseguito al posto di <application>sendmail</application>, devi
        modificare <filename>/etc/mail/mailer.conf</filename> in questo
        modo:</para>

      <programlisting>sendmail    /usr/local/supermailer/bin/sendmail-compat
send-mail   /usr/local/supermailer/bin/sendmail-compat
mailq       /usr/local/supermailer/bin/mailq-compat
newaliases  /usr/local/supermailer/bin/newaliases-compat
hoststat    /usr/local/supermailer/bin/hoststat-compat
purgestat   /usr/local/supermailer/bin/purgestat-compat</programlisting>
    </sect2>

    <sect2>
      <title>Conclusione</title>

      <para>Una volta che hai configurato ogni cosa a tuo piacimento, devi
        terminare i processi di <application>sendmail</application> di cui non
        hai pi&ugrave; bisogno e avviare i processi appartenenti al tuo nuovo
        programma, oppure puoi semplicemente riavviare il sistema.  Riavviando
        il sistema avrai la possibilit&agrave; di verificare se il sistema sia
        stato configurato correttamente per eseguire il tuo nuovo MTA in modo
        automatico all'avvio.</para>
    </sect2>
  </sect1>

  <sect1 id="mail-trouble">
    <title>Risoluzione dei Problemi</title>

    <indexterm>
      <primary>email</primary>
      <secondary>risoluzione dei problemi</secondary>
    </indexterm>

    <qandaset>
      <qandaentry>
        <question>
          <para>Perch&eacute; devo usare nomi di dominio completi (FQDN) per gli
            host del mio dominio?</para>
        </question>

        <answer>
          <para>Probabilmente ti accorgerai che l'host &egrave; effettivamente
            in un dominio differente; per esempio, se sei in <hostid
              role="fqdn">foo.bar.edu</hostid> e desideri raggiungere un host
            chiamato <hostid>mumble</hostid> appartenente al dominio <hostid
              role="domainname">bar.edu</hostid>, dovrai riferirti a questo
            tramite un nome di dominio completo, <hostid
              role="fqdn">mumble.bar.edu</hostid>, invece del solo
            <hostid>mumble</hostid>.</para>

          <indexterm><primary>BIND</primary></indexterm>

          <para>Tradizionalmente, questo era permesso dai resolver BIND di
            BSD.  Tuttavia la versione corrente di
            <application>BIND</application> equipaggiata con FreeBSD non
            prevede pi&ugrave; l'abbreviazione di default per nomi di dominio
            non completi all'infuori del dominio in cui sei.  Quindi l'host
            <hostid>mumble</hostid> sar&agrave; giudicato come <hostid
              role="fqdn">mumble.foo.bar.edu</hostid>, oppure sar&agrave;
            ricercato per il dominio radice.</para>

          <para>Questo differisce dal comportamento precedente, dove la ricerca
            continuava attraverso <hostid
              role="domainname">mumble.bar.edu</hostid>, e <hostid
              role="domainname">mumble.edu</hostid>.  Dai un'occhiata all'RFC
            1535 per i motivi per cui questa sia considerata una cattiva
            pratica, o persino un buco di sicurezza.</para>

          <para>Come buona soluzione al problema, puoi mettere la linea:
            <programlisting>search foo.bar.edu bar.edu</programlisting>
            al posto della precedente:
            <programlisting>domain foo.bar.edu</programlisting>
            nel tuo <filename>/etc/resolv.conf</filename>. Comunque, assicurati
            che l'ordine di ricerca non oltrepassi il
            <quote>confine tra amministrazione locale e pubblica</quote>, come
            definito nell'RFC 1535.</para>
        </answer>
      </qandaentry>

      <qandaentry>
        <question>
          <para><application>sendmail</application> riporta l'errore
            <errorname>mail loops back to myself</errorname></para>
        </question>

        <answer>
          <para>La risposta &egrave; contenuta nelle FAQ di
            <application>sendmail</application> come segue:</para>

          <programlisting>* Ottengo messaggi di <quote>Local configuration error</quote>, come questo:

553 relay.domain.net config error: mail loops back to myself
554 &lt;user@domain.net&gt;... Local configuration error

Come posso risolvere questo problema?

Hai chiesto che la posta per il dominio (es., domain.net) sia inoltrata
a un host specifico (in questo caso, relay.domain.net) attraverso l'uso di
un record MX, ma la macchina di inoltro non si riconosce appartenente a
domain.net. Aggiungi domain.net in /etc/mail/local-host-names
(se stai usando FEATURE(use_cw_file)) oppure aggiungi <quote>Cw domain.net</quote>
in /etc/mail/sendmail.cf.</programlisting>

          <para>Le FAQ di <application>sendmail</application> possono essere
            trovate su <ulink URL="http://www.sendmail.org/faq/"></ulink> ed
            &egrave; raccomandato leggerle se vuoi <quote>perfezionare</quote>
            la tua configurazione di posta.</para>
        </answer>
      </qandaentry>

      <indexterm><primary>PPP</primary></indexterm>

      <qandaentry>
        <question>
          <para>Come posso eseguire un server di posta su un host connesso ad
            Internet tramite PPP?</para>
        </question>

        <answer>
          <para>Vuoi collegare ad Internet una macchina FreeBSD posta sulla tua
            LAN.  La macchina FreeBSD sar&agrave; un gateway di posta per la
            LAN.  La connessione PPP non &egrave; molto indicata per questo
            scopo.</para>

          <indexterm><primary>UUCP</primary></indexterm>

          <para>Esistono almeno due modi per far questo. Un modo &egrave;
            usare UUCP.</para>

          <para>L'altro &egrave; trovare un server Internet a tempo pieno
            che fornisca un servizio MX secondario per il tuo dominio.
            Per esempio, se il dominio della tua societ&agrave; &egrave
            <hostid role="domainname">example.com</hostid> e il tuo fornitore
            di servizi Internet ha attivato <hostid
              role="domainname">example.net</hostid> per fornire il servizio
            MX secondario al tuo dominio:</para>

          <programlisting>example.com.         MX        10      example.com.
                     MX        20      example.net.</programlisting>

          <para>Solo un host deve essere specificato come ultimo
            ricevente (aggiungi <literal>Cw example.com</literal> in
            <filename>/etc/mail/sendmail.cf</filename> su <hostid
              role="domainname">example.com</hostid>).</para>

          <para>Quando <command>sendmail</command> tenter&agrave; di consegnare
            la posta prover&agrave; a connettersi alla tua connessione modem
            (<hostid role="domainname">example.com</hostid>).  Molto
            probabilmente finir&agrave; in time out poich&eacute; non sei
            online.  In modo automatico <command>sendmail</command>
            consegner&agrave; la posta al server MX secondario, ad esempio il
            tuo provider Internet (<hostid
              role="domainname">example.net</hostid>).  Il server MX secondario
            tenter&agrave; periodicamente di collegarsi al tuo host per
            consegnare la posta all'host MX primario (<hostid
              role="domainname">example.com</hostid>).</para>

          <para>Come script di login potresti usare qualcosa di simile a
            questo:</para>

          <programlisting>#!/bin/sh
# Mettimi in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</programlisting>

          <para>Se hai intenzione di creare uno script di login separato per
            un utente potresti usare <command>sendmail -qRexample.com</command>
            nello script precedente.  Questo forzer&agrave; a processare
            immediatamente tutta la posta per <hostid
              role="domainname">example.com</hostid> situata nella tua
            coda.</para>

          <para>Segue un'ulteriore sottigliezza della situazione:</para>

          <para>Messaggio rubato dalla &a.isp;.</para>

          <programlisting>&gt; forniamo l'MX secondario per un cliente. Il cliente si connette
&gt; automaticamente ai nostri servizi molte volte al giorno per ottenere la
&gt; posta per il suo MX primario (non chiamiamo il suo server quando arriva
&gt; posta per il suo dominio). Il nostro sendmail processa la posta in coda
&gt; ogni 30 minuti. Attualmente il cliente sta 30 minuti online per assicurarsi
&gt; che tutta la posta vada all'MX primario.
&gt;
&gt; Esiste un comando che permetta di configurare sendmail in modo tale da
&gt; spedire tutta la posta in quel momento? Naturalmente l'utente non ha
&gt; privilegi di root sulla nostra macchina.

Nella sezione <quote>privacy flags</quote> di sendmail.cf, c'&egrave; una
definizione Opgoaway,restrictqrun

Rimuovi restrictqrun per permettere a utenti non root di avviare l'elaborazione
della coda. Inoltre potresti risistemare gli MX. Noi siamo l'MX primario per i
nostri clienti come questo, e abbiamo definito:

# Se siamo il miglior MX per un host, prova direttamente invece di generare
# errori di configurazione locale.
OwTrue

In questo modo un server remoto consegner&agrave; direttamente a te, senza
tentare di connettersi al cliente. Dopodich&eacute; tu spedisci al tuo cliente.
Funziona solamente con gli <quote>host</quote>, quindi hai bisogno che il tuo
cliente chiami la sua macchina di posta <quote>customer.com</quote> cos&igrave; come
<quote>nomehost.customer.com</quote> nel DNS.
Basta mettere un record A nel DNS per <quote>customer.com</quote>.</programlisting>
        </answer>
      </qandaentry>

      <qandaentry>
        <question>
          <para>Perch&eacute; continuo a ottenere l'errore <errorname>Relaying
            Denied</errorname> quando spedisco posta da altri host?</para>
        </question>

        <answer>
          <para>Con l'installazione di default di FreeBSD,
            <application>sendmail</application> viene configurato in modo tale
            da permettere di spedire posta solamente dall'host sul quale
            &egrave; in esecuzione.  Per esempio, se c'&egrave; installato un
            server POP3, allora gli utenti saranno in grado di controllare la
            posta da scuola, dal lavoro, o da altre postazioni remote ma
            tuttavia non potranno inviare messaggi di posta all'esterno da
            postazioni esterne.  Tipicamente, pochi istanti dopo il tentativo,
            verr&agrave; spedita una email da
            <application>MAILER-DAEMON</application> con il messaggio di errore
            <errorname>5.7 Relaying Denied</errorname>.</para>

          <para>Esistono diversi modi per aggirare questo problema.  La
            soluzione pi&ugrave; semplice &egrave; mettere il proprio
            indirizzo assegnato dall'ISP nel file che contiene i domini
            a cui viene permesso di effettuare il relay,
            <filename>/etc/mail/relay-domains</filename>.  Un modo veloce
            per far questo pu&ograve; essere:</para>

          <screen>&prompt.root; <userinput>echo "your.isp.example.com" &gt; /etc/mail/relay-domains</userinput></screen>

          <para>Dopo aver creato o modificato questo file devi riavviare
            <application>sendmail</application>.  Questa soluzione &egrave;
            ideale se sei un amministratore del server e non desideri
            spedire posta localmente, o se vorresti usare un client/sistema
            punta e clicca su un'altra macchina o perfino su un altro ISP.
            Inoltre &egrave; molto utile se hai solo uno o due account
            di posta configurati.  Se ci sono molti indirizzi da aggiungere,
            puoi semplicemente aprire questo file con il tuo editor di testo
            preferito e aggiungere i domini, uno per riga:</para>

          <programlisting>your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</programlisting>

          <para>Ora l'invio della posta tramite il tuo sistema, da parte di
            qualche host in lista (a condizione che l'utente abbia un account
            sul tuo sistema), avr&agrave; successo.  Questo &egrave; un buon
            metodo per permettere agli utenti di spedire posta dal tuo sistema
            in modo remoto senza dare la possibilit&agrave; a qualcuno di
            spedire SPAM tramite il tuo sistema.</para>
        </answer>
      </qandaentry>
    </qandaset>
  </sect1>

  <sect1 id="mail-advanced">
    <title>Argomenti Avanzati</title>

    <para>La seguente sezione tratta argomenti pi&ugrave; complicati come
      l'organizzazione e la configurazione della posta per tutto il tuo
      dominio.</para>

    <sect2 id="mail-config">
      <title>Configurazione di Base</title>

      <indexterm>
        <primary>email</primary>
        <secondary>configurazione</secondary>
      </indexterm>

      <para>Dalla macchina FreeBSD, dovresti essere in grado di spedire posta a
        host esterni a condizione di aver sistemato
        <filename>/etc/resolv.conf</filename> o di avere in esecuzione un
        proprio server dei nomi.  Se vuoi che la posta per il tuo host sia
        consegnata all'MTA (es., <application>sendmail</application>) in
        esecuzione sul tuo host FreeBSD, esistono due metodi per farlo:</para>

      <itemizedlist>
        <listitem>
          <para>Eseguire un proprio server dei nomi e avere un proprio dominio.
            Per esempio, <hostid role="domainname">FreeBSD.org</hostid></para>
        </listitem>

        <listitem>
          <para>Ricevere la posta direttamente sul tuo host.  Questo viene fatto
            consegnando la posta direttamente al nome DNS corrente della tua
            macchina.  Per esempio, <hostid
              role="fqdn">example.FreeBSD.org</hostid>.</para>
        </listitem>
      </itemizedlist>

      <indexterm><primary>SMTP</primary></indexterm>

      <para>Indipendentemente dal metodo scelto, affinch&eacute; la posta
        possa essere consegnata direttamente al tuo host, devi avere un
        indirizzo IP statico permanente (non un indirizzo dinamico, come avviene
        nella maggior parte delle configurazioni di connessioni PPP).  Se sei
        dietro a un firewall, devi abilitare il traffico SMTP in entrata.  Se
        vuoi ricevere la posta direttamente sul tuo host, devi verificare una di
        queste due cose:</para>

      <itemizedlist>
        <indexterm><primary>record MX</primary></indexterm>

        <listitem>
          <para>Assicurati che il record MX (con il numero pi&ugrave; basso)
            relativo al tuo host nel tuo DNS punti all'indirizzo IP del tuo
            host.</para>
        </listitem>

        <listitem>
          <para>Assicurati che non ci siano record MX nel tuo DNS per il tuo
            host.</para>
        </listitem>
      </itemizedlist>

      <para>Entrambi questi due metodi ti permettono di ricevere posta
        direttamente sul tuo host.</para>

      <para>Prova questi comandi:</para>

      <screen>&prompt.root; <userinput>hostname</userinput>
example.FreeBSD.org
&prompt.root; <userinput>host example.FreeBSD.org</userinput>
example.FreeBSD.org has address 204.216.27.XX</screen>

      <para>Se ottieni un risultato simile, l'invio diretto a
        <email>yourlogin@example.FreeBSD.org</email> dovrebbe funzionare senza
        problemi (assumendo che <application>sendmail</application> sia
        correttamente in esecuzione su <hostid
          role="fqdn">example.FreeBSD.org</hostid>).</para>

      <para>Se invece vedi qualcosa di simile a questo:</para>

      <screen>&prompt.root; <userinput>host example.FreeBSD.org</userinput>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by hub.FreeBSD.org</screen>

      <para>Tutta la posta spedita al tuo host (<hostid
          role="fqdn">example.FreeBSD.org</hostid>) finir&agrave; per essere
        raccolta su <hostid>hub</hostid> sotto lo stesso nome utente invece
        di essere spedita direttamente al tuo host.</para>

      <para>L'informazione precedente viene gestita dal tuo server DNS.  Il
        record DNS che riporta l'informazione di instradamento della posta
        &egrave; l'elemento <emphasis>M</emphasis>ail
        e<emphasis>X</emphasis>change.  Se non esistono record MX, la posta
        sar&agrave; consegnata direttamente all'host attraverso il suo
        indirizzo IP.</para>

      <para>L'elemento MX per <hostid role="fqdn">freefall.FreeBSD.org</hostid>
        in passato assomigliava a questo:</para>

      <programlisting>freefall        MX  30  mail.crl.net
freefall        MX  40  agora.rdrop.com
freefall        MX  10  freefall.FreeBSD.org
freefall        MX  20  who.cdrom.com</programlisting>

      <para>Come puoi vedere, <hostid>freefall</hostid> aveva molti elementi MX.
        Il numero MX pi&ugrave; basso &egrave; l'host che, se disponibile,
        riceve direttamente la posta; se per qualche ragione questo non &egrave;
        accessibile, gli altri (qualche volta chiamati
        <quote>MX di backup</quote>) accettano i messaggi temporaneamente,
        e li passano all'host attivo con numero inferiore, fino all'host
        con il numero pi&ugrave; basso.</para>

      <para>I server MX alternativi dovrebbero avere connessioni Internet
        indipendenti dalla propria al fine di risultare pi&ugrave; utili.
        Il tuo ISP o un tuo amico non dovrebbero avere problemi
        a darti questo servizio.</para>
    </sect2>

    <sect2 id="mail-domain">
      <title>Posta per il Tuo Dominio</title>

      <para>Per organizzare un server di posta hai bisogno che la posta inviata
        alle stazioni di lavoro sia ricevuta direttamente sul server di posta.
        Sostanzialmente, hai bisogno di <quote>richiedere</quote> che la posta
        per i nomi host del tuo dominio (in questo caso <hostid
          role="fqdn">*.FreeBSD.org</hostid>) sia deviata al server di posta in
        modo tale che i tuoi utenti possono raccogliere la loro posta sul
        server di posta principale.</para>

      <indexterm><primary>DNS</primary></indexterm>

      <para>Per rendere la vita pi&ugrave; facile, dovrebbe esistere su
        entrambe le macchine un account utente con lo stesso <emphasis>nome
          utente</emphasis>.  Usa &man.adduser.8; per farlo.</para>

      <para>La macchina server di posta che utilizzerai deve essere
        designata come la macchina che scambia la posta per tutte le postazioni
        sulla rete.  Questo viene realizzato attraverso la configurazione del
        DNS in modo simile a quanto segue:</para>

      <programlisting>example.FreeBSD.org   A   204.216.27.XX       ; Stazione di lavoro
                      MX  10 hub.FreeBSD.org  ; Server di posta</programlisting>

      <para>In questo modo la posta per la stazione di lavoro sar&agrave;
        reindirizzata al server di posta senza preoccuparsi dove punti il
        record A.  La posta viene inviata all'host MX.</para>

      <para>Non puoi effettuare queste modifiche da solo a meno che non hai in
        esecuzione un tuo server DNS.  Se non puoi eseguire un server DNS,
        consulta il tuo ISP o chiunque ti fornisca il servizio DNS.</para>

      <para>Se stai facendo dell'hosting di posta elettronica virtuale, le
        seguenti informazioni ti torneranno utili.  In questo esempio, assumiamo
        che hai un cliente con un proprio dominio, in questo caso <hostid
          role="domainname">customer1.org</hostid>, e vuoi che tutta la posta
        per <hostid role="domainname">customer1.org</hostid> sia spedita alla
        tua macchina server di posta <hostid
          role="fqdn">mail.myhost.com</hostid>.
        L'elemento nel tuo DNS dovrebbe assomigliare a questo:</para>

      <programlisting>customer1.org     MX  10  mail.myhost.com</programlisting>

      <para><emphasis>Non</emphasis> hai bisogno di un record A per <hostid
          role="domainname">customer1.org</hostid> se vuoi solamente gestire
        la posta per tale dominio</para>

      <note>
        <para>Sii consapevole che un ping su <hostid
            role="domainname">customer1.org</hostid> non funzioner&agrave; se
          non esiste un record A per tale dominio.</para>
      </note>

      <para>L'ultima cosa che devi fare &egrave; indicare a
        <application>sendmail</application>, posto sulla tua macchina server,
        per quali domini e/o host deve accettare posta.  Esistono
        differenti modi per farlo.  I seguenti due funzionano entrambi:</para>

      <itemizedlist>
        <listitem>
          <para>Se usi <literal>FEATURE(use_cw_file)</literal> aggiungi gli host
            al tuo file <filename>/etc/mail/local-host-names</filename>.  Se usi
            una versione di <application>sendmail</application> precedente
            alla 8.10, il file da usare &egrave;
            <filename>/etc/sendmail.cw</filename>.</para>
        </listitem>

        <listitem>
          <para>Se usi la versione di <application>sendmail</application> 8.10
            o superiore aggiungi la riga <literal>Cwyour.host.com</literal> al
            tuo <filename>/etc/sendmail.cf</filename> o
            <filename>/etc/mail/sendmail.cf</filename>.</para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
 
  <sect1 id="SMTP-Auth">
    <title>Autenticazione SMTP</title>
    
    <para>Avere un'Autenticazione <acronym>SMTP</acronym> operativa sul tuo
      server di posta porta numerosi benefici.  L'Autenticazione
      <acronym>SMTP</acronym> aggiunge un ulteriore strato di sicurezza a
      <application>sendmail</application>, e ha il vantaggio di dare agli
      utenti mobili che cambiano host la possibilit&agrave; di usare lo stesso
      server di posta senza avere la necessit&agrave; di riconfigurare ogni
      volta i settaggi dei loro programmi client di posta.</para>

    <procedure>
      <step>
        <para>Installa dai port <filename
            role="package">security/cyrus-sasl</filename>.  Puoi trovare questo
          port in <filename role="package">security/cyrus-sasl</filename>.
          In fase di compilazione <filename
            role="package">security/cyrus-sasl</filename> permette di scegliere
          molte opzioni e, per il nostro scopo, assicurati di selezionare
          l'opzione <option>pwcheck</option>.</para>
      </step>

      <step>
        <para>Dopo aver installato <filename
            role="package">security/cyrus-sasl</filename>, edita
          <filename>/usr/local/lib/sasl/Sendmail.conf</filename>
          (o crealo se non esiste) e aggiungi la seguente riga:</para>

        <programlisting>pwcheck_method: passwd</programlisting>

        <para>In questo modo si permetter&agrave; a
          <application>sendmail</application> di autenticare gli utenti tramite
          il proprio database <filename>passwd</filename> di FreeBSD.  Questo
          procedimento evita di creare un nuovo set di nomi utenti e password
          per ogni utente che necessita di usare l'autenticazione
          <acronym>SMTP</acronym>, mantenendo la password di login uguale alla
          password di posta.</para>
      </step>

      <step>
        <para>Ora aggiungi le seguenti righe in
          <filename>/etc/make.conf</filename>:</para>
        <programlisting>SENDMAIL_CFLAGS=-I/usr/local/include/sasl1 -DSASL
SENDMAIL_LDFLAGS=-L/usr/local/lib
SENDMAIL_LDADD=-lsasl</programlisting>

        <para>Queste righe daranno, in fase di compilazione di
          <application>sendmail</application>, le giuste opzioni di
          configurazione per linkare a <filename
            role="package">cyrus-sasl</filename>.  Assicurati che <filename
            role="package">cyrus-sasl</filename> sia installato prima di
          ricompilare <application>sendmail</application>.</para>
      </step>

      <step>
        <para>Ricompila <application>sendmail</application> eseguendo i
          seguenti comandi:</para>

        <screen>&prompt.root; <userinput>cd /usr/src/usr.sbin/sendmail</userinput>
&prompt.root; <userinput>make cleandir</userinput>
&prompt.root; <userinput>make obj</userinput>
&prompt.root; <userinput>make</userinput>
&prompt.root; <userinput>make install</userinput></screen>

        <para>Se <filename>/usr/src</filename> non ha subito enormi cambiamenti
          e se le librerie condivise di cui si ha bisogno sono disponibili, la
          compilazione di <application>sendmail</application> non dovrebbe
          avere problemi.</para>
      </step>

      <step>
        <para>Dopo aver compilato e reinstallato
          <application>sendmail</application>, edita il tuo file
          <filename>/etc/mail/freebsd.mc</filename> (o qualunque altro file che
          usi come file <filename>.mc</filename>.  Molti amministratori
          preferiscono usare, per unicit&agrave;, l'output di &man.hostname.1;
          come nome del file <filename>.mc</filename>).  Aggiungi le seguenti
          righe:</para>

        <programlisting>dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confDEF_AUTH_INFO', `/etc/mail/auth-info')dnl</programlisting>

        <para>Queste opzioni configurano i vari metodi che
          <application>sendmail</application> ha a disposizione per autenticare
          gli utenti.  Se vuoi usare un metodo diverso da
          <application>pwcheck</application>, guarda la documentazione inclusa
          nel package.</para>
      </step>

      <step>
        <para>Per finire, esegui &man.make.1; in <filename>/etc/mail</filename>.
          Questo eseguir&agrave; il tuo nuovo file <filename>.mc</filename> e
          creer&agrave; un file <filename>.cf</filename> di nome
          <filename>freebsd.cf</filename> (o con il nome che hai usato per il
          file <filename>.mc</filename>).  Copialo in
          <filename>sendmail.cf</filename>, e manda il segnale
          <command>kill -HUP</command> a
          <application>sendmail</application>.</para>
      </step>
    </procedure>

    <para>Se tutto &egrave; andato per il verso giusto, inserisci le tue
      informazioni di login nel programma client di posta e invia un messaggio
      di prova.  Per ulteriori indagini, setta il LogLevel di
      <application>sendmail</application> a 13 e guarda
      il file <filename>/var/log/maillog</filename> per eventuali
      errori.</para>

    <para>Per ulteriori informazioni, guarda la pagina riguardante <ulink
        url="http://www.sendmail.org/~ca/email/auth.html">l'autenticazione
        <acronym>SMTP</acronym></ulink> di
      <application>sendmail</application>.</para>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
