.\"
.\" Copyright (c) 1996, 1997 Shigio Yamaguchi. All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by Shigio Yamaguchi.
.\" 4. Neither the name of the author nor the names of any co-contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd Nov 26, 1997
.\" jpman %Id: btreeop.1,v 1.3 1997/06/18 13:41:54 jsakai Stab %
.Dt BTREEOP 1
.Os BSD 4
.Sh 名称
.Nm btreeop
.Nd btree データベースメンテナンスツール
.Sh 書式
.Nm btreeop
.Op Fl A
.Op Fl C
.Op Fl D[keyno] Ar key
.Op Fl K[keyno] Ar key
.Op Fl L
.Op Fl k Ar prefix
.Op Ar dbname
.Sh 解説
.Nm btreeop
は、
.Xr btree 3
データベースに対して単純な操作を行います。
.Nm btreeop
は、データベースを作成したり、レコードを記入したり、(シーケンシャルや
インデックスで)レコードを読み出したり、レコードを削除したりすることができます。
重複したエントリを持つこともできます。
複数のキーが利用可能ですが、
.Xr btree 3 
のインデックスとしてはプライマリキーだけが利用されます。
.Sh オプション
大文字はコマンドを示します。コマンドが指定されなかった場合は、
シーケンシャルな読み出しであると想定します。
.Bl -tag -width Ds
.It Fl A
レコードを追加します。データベースが存在しない場合、
btreeop はそれを作成します。
.It Fl C
データベースを作成し、レコードを記入します。
.It Fl D[keyno] Ar key
key を用いてレコードを削除します。
デフォルトでは、 keyno は0(すなわちプライマリキー)です。
.It Fl K[keyno] Ar key
key を用いてレコードを検索します。
デフォルトでは、 keyno は0(すなわちプライマリキー)です。
.It Fl L
全てのプライマリキーを表示します。
以下の二つのコマンド行は、後者がはるかに速いことを除いて等価です。

	btreeop | awk '{print $1}' | uniq

	btreeop -L
.It Fl k Ar prefix
プライマリキーとして prefix を持つレコードを検索します。
このオプションは (-L コマンドもしくはコマンドが与えられていない場合の
ように) シーケンシャルに読み込む操作に対してだけ有効です。
以下の二つのコマンド行は、後者がはるかに速いことを除いて等価です。

	btreeop | awk '$1 ~ /^fo/ {print }'

	btreeop -k fo
.It Ar dbname
データベース名を指定します。デフォルトは 'btree' です。
.Sh データフォーマット
データベースを作成する (あるいは追加する) 際、
.Nm btreeop
はデータを標準入力から読み込みます。
データのフォーマットは以下のようになります。

  プライマリキー 2番目のキー-1    2番目のキー-2  Data
  (keyno = 0)    (keyno = 1)      (keyno = 2)
  --------------------------------------------------------------
  main           246              main.c         main (){\\n
  func           120              library.c      func(a1, a2)\\n
  .
  .
  .

.El

.Bl -enum -offset indent
.It
全ての key とデータはブランク('\\t' あるいは ' ') で区切られます。
.It
key にブランクを含めることはできません。
.It
データにはブランクを含めることができます。
.It
空のデータは許されません。
.It
加えて、META レコードが利用できます。META レコードはブランクで始まる key を
持ちます。このレコードは、インデックス検索 (-K オプション) だけで読むことが
できます。使用方法は btreeop によっては制限されません。
.El
.Sh 使用例
データベースの作成

  % btreeop -C
  key1	data1
  key2	data2
  key3	data3
  ^D
  %

レコードの追加

  % btreeop -A
   __.VERSION 2
  key2	data2-2
  ^D
  %

シーケンシャルな読み出し

  % btreeop
  key1  data1
  key2  data2-2
  key2  data2
  key3  data3
  %

インデックスによる読み出し

  % btreeop -K key2
  key2  data2-2
  key2  data2
  % btreeop -K ' __.VERSION'
   __.VERSION 2
  %

プライマリキーの一覧

  % btreeop -L
  key1
  key2
  key3
  %

レコードの削除

  % btreeop -D ' __.VERSION'
  % btreeop -K ' __.VERSION'
  %

.Sh 関連ファイル
.Bl -tag -width tags -compact
.It Pa btree
デフォルトのデータベース名
.El
.Sh 診断
.Nm btreeop
は、エラーが発生した場合、 0 以外の値で終了します。
その他の場合は、0 で終了します。
.Sh 関連項目
.Xr btree 3
.Sh 作者
Shigio Yamaguchi (shigio@wafu.netgate.net)
.Sh 歴史
.Nm
コマンドは、FreeBSD 2.2.2 から登場しました。
