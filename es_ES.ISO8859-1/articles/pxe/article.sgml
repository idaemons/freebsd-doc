<?xml version="1.0" encoding="ISO8859-1" standalone="no"?>
<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook XML V4.2-Based Extension//EN"
        "../../../share/sgml/freebsd42.dtd" [
<!ENTITY % entities PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Entity Set//ES" "../../share/sgml/entities.ent">
%entities;
]>

<!--
     The FreeBSD Documentation Project

     The FreeBSD Spanish Documentation Project

     %SOURCE%	en_US.ISO8859-1/articles/pxe/article.sgml
     %SRCID%	1.27


     $FreeBSD$
-->

<article lang="es">
  <articleinfo>
    <title>Guía de &os; Jumpstart</title>

    <authorgroup>
      <author>
        <firstname>Alfred</firstname>
        <surname>Perlstein</surname>

        <affiliation>
          <address><email>alfred@FreeBSD.org</email></address>
        </affiliation>
      </author>
    </authorgroup>

    <legalnotice id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.intel;
      &tm-attrib.general;
    </legalnotice>

    <pubdate>$FreeBSD$</pubdate>

    <releaseinfo>$FreeBSD$</releaseinfo>

    <abstract>
      <para>Este artículo explica el modo de instalar
	&os; en ordenadores usando el método PXE de &intel;
	que arranca un ordenador a través de la red.</para>

      &trans.es.gabor;
    </abstract>
  </articleinfo>

  <sect1 id="introduction">
    <title>Introducción</title>

    <warning>
      <para>Este método situará al <quote>servidor</quote>
	en un estado inseguro y peligroso así que se recomienda
	dejarlo conectado a un hub propio y no permitir
	acceso desde ordenadores que no sean los
	<quote>clientes</quote>.</para>
    </warning>

    <para>Terminología:</para>

    <informaltable frame="none" pgwide="1">
      <tgroup cols="2">

        <tbody>
          <row>
            <entry>Servidor</entry>
            <entry>El ordenador que dispone de servicio netboot y de
	      instalación para otros.</entry>
          </row>

          <row>
            <entry>Cliente</entry>
            <entry>El ordenador que acabará con &os;
	      instalado.</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <para>Requerimientos:
      Clientes con soporte de &intel; PXE netboot y una conexión de
      Ethernet.
      </para>

    <para>Por favor, avíseme si encuentra cualquier problema
      o tiene alguna sugerencia para mejorar este documento.</para>

    <para>Si quiere que alguien le ajuste o enseñe a ajustar
      un sistema particular de netinstall, por favor envíe un correo
      electrónico para tratar los detalles.</para>

    <para>Me gustaría dar las gracias a &a.ps; y a &a.jhb;
      por hacer casi toda la programación de pxeboot, la interfaz del
      sistema &intel; PXE (netboot).</para>
  </sect1>

  <sect1 id="server-config">
    <title>Configuración del servidor</title>

    <procedure>
      <step>
        <para>Instalar DHCP: Instale <filename
	    role="package">net/isc-dhcp3-server</filename>.  Puede
	  utilizar este fichero de configuración
          <ulink url="dhcpd.conf">
          <filename>dhcpd.conf</filename></ulink>, cópielo en
	    <filename>/usr/local/etc/</filename>.</para>
      </step>

      <step>
        <para>Ajuste tftp:</para>

        <procedure>
          <step>
            <para>Crée un directorio
	      <filename>/usr/tftpboot</filename>.</para>
          </step>

          <step>
            <para>Añada esta línea a
              <filename>/etc/inetd.conf</filename>:</para>

<programlisting>tftp    dgram   udp     wait    nobody  /usr/libexec/tftpd    tftpd /usr/tftpboot</programlisting>
          </step>
        </procedure>

      </step>

      <step>
        <para>Ajuste NFS:</para>

        <procedure>
          <step>
            <para>Añada a <filename>/etc/rc.conf</filename>:</para>

	    <programlisting>nfs_server_enable="YES"</programlisting>
          </step>

          <step>
            <para>Añada a <filename>/etc/exports</filename>:</para>

	    <programlisting>/usr -alldirs -ro</programlisting>
          </step>
        </procedure>
      </step>

      <step>
        <para>Reinicie el sistema o arranque los servicios nuevos
	  a mano.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 id="bootstrap-config">
    <title>Los ajustes del inicio</title>

    <procedure>
      <step>
        <para>Descargue los ficheros de inicio: Descargue
          las imágenes de disquete <ulink
	  url="&snapshots.stable;/floppies/kern.flp">
          kern.flp</ulink> y
          <ulink
	  url="&snapshots.stable;/floppies/mfsroot.flp">
          mfsroot.flp</ulink>.</para>
      </step>

      <step>
        <para>Ajuste el directorio tftp/pxe-boot:</para>

        <procedure>
          <step>
            <para>Copie pxeboot en el directorio boot:</para>

	    <screen>&prompt.root; <userinput>rm -rf /usr/obj/*</userinput>
&prompt.root; <userinput>cd /usr/src/sys/boot</userinput>
&prompt.root; <userinput>make</userinput>
&prompt.root; <userinput>cp /usr/src/sys/boot/i386/pxeldr/pxeboot /usr/tftpboot</userinput></screen>
          </step>

          <step>
            <para>Usando vndevice monte la imágen
	      <filename>kern.flp</filename> y copie todo su
	      contenido a
	      <filename>/usr/tftpboot</filename>:</para>

	    <screen>&prompt.root; <userinput>mdconfig -a -t vnode -f kern.flp -u 0</userinput> # (vnconfig vn0 kern.flp) asociar vndevice al fichero
&prompt.root; <userinput>mount /dev/md0 /mnt</userinput> # (mount /dev/vn0 /mnt) mount it
&prompt.root; <userinput>cp -R /mnt /usr/tftpboot</userinput> # copie los contenidos a /usr/tftpboot
&prompt.root; <userinput>umount /mnt</userinput>              # desmontar la imagen
&prompt.root; <userinput>vnconfig -u vn0</userinput>          # desasociar vndevice del fichero</screen>
          </step>
        </procedure>
      </step>

      <step>
        <para>Compile un kernel personalizado para los clientes
	  (para evitar, de manera particular, la pantalla de
	  ajustes de los componentes durante el inicio)
	  y cópielo a
          <filename>/usr/tftpboot</filename>.</para>
      </step>

      <step>
        <para>Cree un fichero <filename>loader.rc</filename> e
	  instálelo en
	  <filename>/usr/tftpboot/boot/loader.rc</filename> para que no
	  pida un segundo disquete, aquí está
          <ulink url="loader.rc">mi fichero</ulink>.</para>
      </step>

      <step>
        <para>Extraiga el instalador y las herramientas de ayuda de la
	  disquete mfsroot, descomprímalos y cópielos
	  también a <filename>/usr/tftpboot</filename>.</para>

	<screen>&prompt.root; <userinput>vnconfig vn0 mfsroot.flp</userinput>         # asociar un vndevice con el fichero
&prompt.root; <userinput>mount /dev/vn0 /mnt</userinput>              # montarlo
&prompt.root; <userinput>cp /mnt/mfsroot.gz /usr/tftpboot</userinput> # copiar los contenidos a /usr/tftpboot
&prompt.root; <userinput>umount /mnt</userinput>                      # desmontarlo
&prompt.root; <userinput>vnconfig -u vn0</userinput>                  # desasociar vndevice del fichero
&prompt.root; <userinput>cd /usr/tftpboot</userinput>                 # entrar en el directorio pxeboot
&prompt.root; <userinput>gunzip mfsroot.gz</userinput>                # descomprimir mfsroot</screen>
      </step>

      <step>
        <para>Cree su script sysinstall <filename>install.cfg</filename>.
          Puede usar
          <ulink url="install.cfg">el mío</ulink>
          como plantilla pero tiene que modificarlo.</para>
      </step>

      <step>
        <para>Copie el script sysinstall en la imagen mfsroot extraída
	  y descomprimida:</para>

	<screen>&prompt.root; <userinput>cd /usr/tftpboot</userinput>
&prompt.root; <userinput>vnconfig vn0 mfsroot</userinput>
&prompt.root; <userinput>mount /dev/vn0 /mnt</userinput>
&prompt.root; <userinput>cp install.cfg /mnt</userinput>
&prompt.root; <userinput>umount /mnt</userinput>
&prompt.root; <userinput>vnconfig -u vn0</userinput></screen>
      </step>
    </procedure>
  </sect1>

  <sect1 id="install-setup">
    <title>Ajuste de la instalación</title>

    <procedure>
      <step>
        <para>Copie los ficheros de la instalación en un
	  sitio accesible por NFS del servidor.  Cree un directorio
	  según la directiva <quote>nfs</quote> en
	  <filename>install.cfg</filename> y haga una copia espejo de
	  los ficheros de instalación de &os; en este sitio.
	  Tiene que quedar más o menos así:</para>

	<screen>ABOUT.TXT       TROUBLE.TXT     compat20        floppies        ports
ERRATA.TXT      UPGRADE.TXT     compat21        games           proflibs
HARDWARE.TXT    XF86336         compat22        info            src
INSTALL.TXT     bin             compat3x        kern.flp
LAYOUT.TXT      catpages        crypto          manpages
README.TXT      cdrom.inf       dict            mfsroot.flp
RELNOTES.TXT    compat1x        doc             packages</screen>
      </step>

      <step>
        <para>Copie los paquetes comprimidos en el directorio
	  packages/All en <filename>nfs</filename>.</para>
      </step>

      <step>
        <para>Asegúrese de tener un fichero
	  <filename>INDEX</filename> preparado
	  en el directorio de los paquetes.  Puede hacer sus propias
	  entradas en <filename>INDEX</filename> de la siguiente
	  manera:</para>

	<programlisting>alfred-1.0||/|Alfred install bootstrap||alfred@FreeBSD.org||||</programlisting>

        <para>Luego podrá instalar paquetes propios, particularmente
	  sus paquetes para terminar la instalación (<quote>post-install
	  paquetes</quote>).</para>
      </step>
    </procedure>
  </sect1>

  <sect1 id="custom-postinst-package">
    <title>Propios paquetes para ajustes posteriores a la
      instalación</title>

    <para>Puede usar el script <ulink url="pkgmaker.sh"><filename>pkgmaker.sh
      </filename></ulink> para crear un paquete propio para después
      de la instalación.  La idea de tener uno es instalar o
      configurar algo especial que necesite.  El script
      <filename>pkgmaker</filename> se ejecuta en el directorio del paquete
      que quiera crear con el solo argumento del paquete (p.ej. mypkg)
      que luego le creará un fichero mypkg.tgz para incluir en su
      paquete sysinstall.</para>

    <para>En el directorio de su paquete propio tendrá que tener un
      fichero llamado <filename>PLIST</filename> que enumere todos los
      ficheros que quiera incorporar en su paquete.</para>

    <para>También podrá tener ficheros llamados
      <ulink url="pre"><filename>pre</filename></ulink> y
      <ulink url="post"><filename>post</filename></ulink>
      en ese directorio.  Estos son shell script que se ejecutarán
      antes o después de la instalación del paquete.</para>

    <para>Puesto que el paquete está en su fichero
      <filename>install.cfg</filename> se ejecutará para
      proceder los últimos retoques de la configuración.</para>
  </sect1>
</article>
